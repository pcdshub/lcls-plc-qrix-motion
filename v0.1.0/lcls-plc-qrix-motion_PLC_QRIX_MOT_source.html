<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DUTs &mdash; pcdshub/lcls-plc-qrix-motion  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/tree.css?v=837a00b9" />
      <link rel="stylesheet" type="text/css" href="_static/width.css?v=ab210c7a" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Data Types" href="lcls-plc-qrix-motion_PLC_QRIX_MOT_epics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pcdshub/lcls-plc-qrix-motion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">lcls-plc-qrix-motion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_pragmas.html">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_nc.html">NC Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_ethercat.html">EtherCAT Terminals</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_boxes.html">Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PLC_QRIX_MOT</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_PLC_QRIX_MOT_summary.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_PLC_QRIX_MOT_summary.html#pragmas">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_PLC_QRIX_MOT_summary.html#libraries">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_PLC_QRIX_MOT_summary.html#symbols">Symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_PLC_QRIX_MOT_epics.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_PLC_QRIX_MOT_epics.html#database-records">Database Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DUTs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dut-sensor">DUT_Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-sensorhgs">DUT_SensorHGS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#gvls">GVLs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#global-version">Global_Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-eps">GVL_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-var">GVL_VAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">Main</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#pous">POUs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fb-2axestrans">FB_2AxesTrans</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-2axestrans-1">FB_2AxesTrans_1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-3axesjack">FB_3AxesJack</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-3axesjack-1">FB_3AxesJack_1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-slits">FB_Slits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-1-plctask">PRG_1_PlcTask</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-2-pmps">PRG_2_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-2theta">PRG_2Theta</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-3-log">PRG_3_LOG</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-cryo">PRG_Cryo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-arm">PRG_DET_ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-chamber">PRG_DET_CHAMBER</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-frame">PRG_DET_FRAME</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-slit">PRG_DET_SLIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-diffractometer">PRG_Diffractometer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-las">PRG_LAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt">PRG_OPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt-slits">PRG_OPT_SLITS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt-xpm">PRG_OPT_XPM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt-yg">PRG_OPT_YG</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-questar">PRG_Questar</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-rotdet">PRG_RotDet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sds">PRG_SDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sensor">PRG_Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-spetrometerarm">PRG_SpetrometerArm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-ssl">PRG_SSL</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pcdshub/lcls-plc-qrix-motion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DUTs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lcls-plc-qrix-motion_PLC_QRIX_MOT_source.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="duts">
<h1>DUTs<a class="headerlink" href="#duts" title="Link to this heading"></a></h1>
<section id="dut-sensor">
<h2>DUT_Sensor<a class="headerlink" href="#dut-sensor" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">DUT_Sensor</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">fCntsInEGU</span><span class="p">:</span>                     <span class="n">REAL</span><span class="p">;</span>
    <span class="n">sEGU</span><span class="p">:</span>                           <span class="n">STRING</span><span class="p">;</span>
    <span class="n">sName</span><span class="p">:</span>                          <span class="n">STRING</span><span class="p">;</span>
    <span class="n">fValue</span><span class="p">:</span>                         <span class="n">REAL</span><span class="p">;</span>
    <span class="n">iRawCnts</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span>        <span class="n">INT</span><span class="p">;</span>
    <span class="n">iOffset</span><span class="p">:</span>                        <span class="n">INT</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#dut-sensor">DUT_Sensor</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="dut-sensorhgs">
<h2>DUT_SensorHGS<a class="headerlink" href="#dut-sensorhgs" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">DUT_SensorHGS</span><span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">fCntsInEGU</span><span class="p">:</span>                     <span class="n">REAL</span><span class="p">;</span>
    <span class="n">sEGU</span><span class="p">:</span>                           <span class="n">STRING</span><span class="p">;</span>
    <span class="n">sName</span><span class="p">:</span>                          <span class="n">STRING</span><span class="p">;</span>
    <span class="n">fValue</span><span class="p">:</span>                         <span class="n">REAL</span><span class="p">;</span>
    <span class="n">iRawCnts</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span>        <span class="n">DINT</span><span class="p">;</span>
    <span class="n">iOffset</span><span class="p">:</span>                        <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
</section>
<section id="gvls">
<h1>GVLs<a class="headerlink" href="#gvls" title="Link to this heading"></a></h1>
<section id="global-version">
<h2>Global_Version<a class="headerlink" href="#global-version" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcGenerated&#39;</span><span class="p">}</span>
<span class="o">//</span> <span class="n">This</span> <span class="n">function</span> <span class="n">has</span> <span class="n">been</span> <span class="n">automatically</span> <span class="n">generated</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">project</span> <span class="n">information</span><span class="o">.</span>
<span class="n">VAR_GLOBAL</span> <span class="n">CONSTANT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;const_non_replaced&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;linkalways&#39;</span><span class="p">}</span>
    <span class="n">stLibVersion_qrix_motion</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iMajor</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iMinor</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">iBuild</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iRevision</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sVersion</span> <span class="o">:=</span> <span class="s1">&#39;0.1.0&#39;</span><span class="p">);</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-eps">
<h2>GVL_EPS<a class="headerlink" href="#gvl-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:ESTOP_RST&#39;</span><span class="p">}</span>
    <span class="n">bResetIClk</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:ESTOP&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 18&#39;</span><span class="p">}</span>
    <span class="n">bESTOP</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2B-05 SV_AIR (EL2004)]^Channel 1^Output&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:SV1&#39;</span><span class="p">}</span>
    <span class="n">bOpenSV1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2B-05 SV_AIR (EL2004)]^Channel 2^Output&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:SV2&#39;</span><span class="p">}</span>
    <span class="n">bOpenSV2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1C_ServoDR (NCR-HD Series)]^260th receive PDO Mapping^Positive torque limit value&#39;</span><span class="p">}</span>
    <span class="n">iServoTorqueLimitPositive</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1C_ServoDR (NCR-HD Series)]^260th receive PDO Mapping^Negative torque limit value&#39;</span><span class="p">}</span>
    <span class="n">iServoTorqueLimitNegative</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-pmps">
<h2>GVL_PMPS<a class="headerlink" href="#gvl-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: PLC:QRIX:MOTION:ARB&#39;</span><span class="p">}</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: PLC:QRIX:MOTION:FFO:01&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[PMPS_FFO]^Channel 1^Output&#39;</span><span class="p">}</span>
    <span class="n">fbFastFaultOutput1</span><span class="p">:</span> <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.92.73.1.1&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: PLC:QRIX:MOTION:FFO:02&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[PMPS_FFO]^Channel 2^Output&#39;</span><span class="p">}</span>
    <span class="n">fbFastFaultOutput2</span><span class="p">:</span> <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.92.73.1.1&#39;</span><span class="p">);</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-sensor">
<h2>GVL_Sensor<a class="headerlink" href="#gvl-sensor" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:FLOATING&#39;</span><span class="p">}</span>

    <span class="n">bFloating</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">YDF1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit1&#39;</span><span class="p">}</span>
    <span class="n">stYDF1</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">YDF2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit2&#39;</span><span class="p">}</span>
    <span class="n">stYDF2</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">YDF3</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit3&#39;</span><span class="p">}</span>
    <span class="n">stYDF3</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Height</span> <span class="n">difference</span> <span class="n">btw</span> <span class="n">granite</span> <span class="n">shelf</span> <span class="ow">and</span> <span class="n">detector</span> <span class="n">frame</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit4&#39;</span><span class="p">}</span>
    <span class="n">stHDF</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Granite</span> <span class="n">TiltZ</span> <span class="p">:</span> <span class="n">Pitch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 2^Value&#39;</span><span class="p">}</span>
    <span class="n">stGraniteP</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Granite</span> <span class="n">TiltX</span> <span class="p">:</span> <span class="n">Roll</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 1^Value&#39;</span><span class="p">}</span>
    <span class="n">stGraniteR</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Frame</span> <span class="n">TiltZ</span> <span class="p">:</span> <span class="n">Pitch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 4^Value&#39;</span><span class="p">}</span>
    <span class="n">stFrameP</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Frame</span> <span class="n">TiltX</span> <span class="p">:</span> <span class="n">Roll</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 3^Value&#39;</span><span class="p">}</span>
    <span class="n">stFrameR</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-04 PS_P (EL3064)]^AI Standard Channel 1^Value&#39;</span><span class="p">}</span>
    <span class="n">stPS1</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-04 PS_P (EL3064)]^AI Standard Channel 2^Value&#39;</span><span class="p">}</span>
    <span class="n">stPS2</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-04 PS_P (EL3064)]^AI Standard Channel 3^Value&#39;</span><span class="p">}</span>
    <span class="n">stPS3</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#dut-sensor">DUT_Sensor</a></p></li>
<li><p><a class="reference internal" href="#dut-sensorhgs">DUT_SensorHGS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="gvl-var">
<h2>GVL_VAR<a class="headerlink" href="#gvl-var" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:JackOff&#39;</span><span class="p">}</span>
    <span class="n">bDoneJackOff</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:DoneLevitation&#39;</span><span class="p">}</span>
    <span class="n">bDoneLevitation</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:bDoneLanding&#39;</span><span class="p">}</span>
    <span class="n">bDoneLanding</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:DoneAdjustingRoll&#39;</span><span class="p">}</span>
    <span class="n">bDoneAdjustingRoll</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:DoneAdjustingPitch&#39;</span><span class="p">}</span>
    <span class="n">bDoneAdjustingPitch</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:DoneAdjustingHeight&#39;</span><span class="p">}</span>
    <span class="n">bDoneAdjustingHeight</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="main">
<h2>Main<a class="headerlink" href="#main" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>

<span class="p">(</span><span class="o">*</span>
    <span class="n">Only</span> <span class="n">includes</span> <span class="n">motor</span> <span class="n">definitions</span> <span class="k">for</span> <span class="n">the</span> <span class="n">IOC</span>
    <span class="n">These</span> <span class="n">are</span> <span class="n">hard</span><span class="o">-</span><span class="n">coded</span> <span class="n">to</span> <span class="n">be</span> <span class="n">Main</span><span class="o">.</span><span class="n">M</span><span class="c1">#,</span>
    <span class="n">but</span> <span class="n">are</span> <span class="n">very</span> <span class="n">convenient</span> <span class="n">to</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">GVL</span><span class="p">,</span>
    <span class="n">hence</span> <span class="n">the</span> <span class="n">confusing</span> <span class="n">namespace</span> <span class="n">here</span>
    <span class="n">This</span> <span class="n">should</span> <span class="n">be</span> <span class="n">refactored</span> <span class="n">once</span> <span class="n">the</span> <span class="n">IOC</span>
    <span class="n">supports</span> <span class="n">arbitrary</span> <span class="n">ads</span> <span class="n">paths</span> <span class="k">for</span> <span class="n">motors</span>
<span class="o">*</span><span class="p">)</span>


    <span class="o">//</span> <span class="n">Sample</span> <span class="n">Chamber</span> <span class="n">Sliding</span> <span class="n">Seal</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">axis</span>
    <span class="o">//</span><span class="n">connect</span> <span class="n">EPS</span> <span class="n">limits</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SC:SSL:MMS&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_01]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_01</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M1</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SSL:MMS&#39;</span><span class="p">);</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">Start</span> <span class="n">Adding</span> <span class="n">Spectometer</span> <span class="n">Arm</span> <span class="n">Axes</span> <span class="n">Here</span><span class="o">*</span><span class="p">)</span>

    <span class="o">//</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">Stepper</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:MMS:2Theta&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-04 DR_2Th (EL7047)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-04 DR_2Th (EL7047)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-06 ENC_2Th (EL5042)]^FB Inputs Channel 1^Position;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>                      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-05 MB_2Th (EL2602)]^Channel 1^Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M2</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SA:MMS:2Theta&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XS1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:NORTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-03 DR_XS1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-03 DR_XS1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-07 ENC_X1_X2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M3</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:OPTSL:MMS:NORTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XS2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:SOUTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-04 DR_XS2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-04 DR_XS2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-07 ENC_X1_X2 (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M4</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:OPTSL:MMS:SOUTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YS1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:TOP&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-05 DR_YS1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-05 DR_YS1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-08 ENC_Y1_Y2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M5</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:OPTSL:MMS:TOP&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YS2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:BOTTOM&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-06 DR_YS2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-06 DR_YS2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-08 ENC_Y1_Y2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M6</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:OPTSL:MMS:BOTTOM&#39;</span><span class="p">);;</span>

    <span class="o">//</span> <span class="n">YG1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT:MMS:Y1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-10 DR_YG1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-10 DR_YG1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-10 ENC_YG1_YG2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M7</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPT:MMS:Y2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YG2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT:MMS:Y2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-11 DR_YG2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-11 DR_YG2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-10 ENC_YG1_YG2 (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M8</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPT:MMS:Y2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YG3</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT:MMS:Y3&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-12 DR_YG3 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-12 DR_YG3 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-11 ENC_YG3_X1PM (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M9</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPT:MMS:Y3&#39;</span><span class="p">);</span>


    <span class="o">//</span> <span class="n">RxG</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:G:MMS:Rx&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-08 DR_RxG (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-08 DR_RxG (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-09 ENC_RxG_XG (EL5042)]^FB Inputs Channel 1 compact^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M10</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:G:MMS:Rx&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XG</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:G:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-09 DR_XG (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-09 DR_XG (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-09 ENC_RxG_XG (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M11</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:G:MMS:X&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XPM1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:PM:MMS:X1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-14 DR_XPM1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-14 DR_XPM1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-11 ENC_YG3_X1PM (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M12</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:PM:MMS:X1&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XPM2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:PM:MMS:X2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-15 DR_XPM2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-15 DR_XPM2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-12 ENC_X2PM_RzPM (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M13</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:PM:MMS:X2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">RzPM</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:PM:MMS:Rz&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-16 DR_RzPM (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-16 DR_RzPM (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-12 ENC_X2PM_RzPM (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M14</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:PM:MMS:Rz&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YDF1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:MMS:Y1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2B-15 DR_YDF1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-15 DR_YDF1 (EL7041-0052)]^STM Status^Status^Digital input 2</span>
    <span class="s1">&#39;}</span>
    <span class="n">M15</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DF:MMS:Y1&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YDF2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:MMS:Y2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2B-16 DR_YDF2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-16 DR_YDF2 (EL7041-0052)]^STM Status^Status^Digital input 2</span>
    <span class="s1">&#39;}</span>
    <span class="n">M16</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DF:MMS:Y2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YDF3</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:MMS:Y3&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2B-19 DR_YDF3 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-19 DR_YDF3 (EL7041-0052)]^STM Status^Status^Digital input 2</span>
    <span class="s1">&#39;}</span>
    <span class="n">M17</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DF:MMS:Y3&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XSDC1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:NORTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-09 DR_XSDC1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">09</span> <span class="n">DR_XSDC1</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">03</span> <span class="n">ENC_X1_X2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M18</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DETSL:MMS:NORTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XSDC2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:SOUTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-10 DR_XSDC2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">10</span> <span class="n">DR_XSDC2</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">03</span> <span class="n">ENC_X1_X2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M19</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DETSL:MMS:SOUTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YSDC1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:TOP&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-11 DR_YSDC1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">11</span> <span class="n">DR_YSDC1</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">04</span> <span class="n">ENC_Y1_Y2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M20</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DETSL:MMS:TOP&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YSDC2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:BOTTOM&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-12 DR_YSDC2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">12</span> <span class="n">DR_YSDC2</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">04</span> <span class="n">ENC_Y1_Y2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M21</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DETSL:MMS:BOTTOM&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XDC</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DC:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-14 DR_XDC (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">14</span> <span class="n">DR_XDC</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">05</span> <span class="n">ENC_XDC_RyDC</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M22</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DC:MMS:X&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">RyDC</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DC:MMS:Ry&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-15 DR_RyDC (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">15</span> <span class="n">DR_RyDC</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">05</span> <span class="n">ENC_XDC_RyDC</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M23</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DC:MMS:Ry&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">ZDC</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DC:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-16 DR_ZDC (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">16</span> <span class="n">DR_ZDC</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">06</span> <span class="n">ENC_ZDC_YF1</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M24</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DC:MMS:Z&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YF1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DA:MMS:Y1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 10;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 11;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">06</span> <span class="n">ENC_ZDC_YF1</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>              <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">19</span> <span class="n">MB_YF1_YF2</span> <span class="p">(</span><span class="n">EL2602</span><span class="p">)]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M25</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DA:MMS:Y1&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YF2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DA:MMS:Y2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 12;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 13;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">07</span> <span class="n">ENC_YF2_ZF</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>                      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">19</span> <span class="n">MB_YF1_YF2</span> <span class="p">(</span><span class="n">EL2602</span><span class="p">)]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M26</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DA:MMS:Y2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">ZF</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DA:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 14;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 15;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">07</span> <span class="n">ENC_YF2_ZF</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>                      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-18 MB_ZF (EL2602)]^Channel 1^Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M27</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39; QRIX:DA:MMS:Z&#39;</span><span class="p">);</span>


    <span class="o">//</span> <span class="n">Diffractometer</span> <span class="o">-</span>  <span class="mi">8</span> <span class="n">axes</span> <span class="n">START</span> <span class="n">AT</span> <span class="n">M28</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_04]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M28</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:X&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_04]^Channel 4^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M29</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:Y&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_08]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_08</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_06</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M30</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:Z&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:DETY&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_08]^Channel 5^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_08</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">6</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_06</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M31</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:DETY&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:PHI&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_08]^Channel 3^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_08</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_13</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M32</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:PHI&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:CHI&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_15]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_15</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">6</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_13</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M33</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:CHI&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:THETA&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_15]^Channel 3^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_15</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">7</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">IM1K3</span><span class="o">-</span><span class="n">EL5042_03_17</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M34</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:THETA&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:2THETA&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_15]^Channel 5^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_15</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">6</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">8</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_17</span> <span class="o">-</span> <span class="n">Diff</span> <span class="o">-</span> <span class="n">Theta</span> <span class="o">-</span> <span class="mi">2</span><span class="n">Theta</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M35</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:2THETA&#39;</span><span class="p">);</span>



    <span class="o">//</span> <span class="n">Laser</span> <span class="n">Table</span>  <span class="o">-</span>  <span class="mi">3</span> <span class="n">axes</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:LAS:MMS:VIS&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_02_06]^Channel 6^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_02_06</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">5</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_05</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M36</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:LAS:MMS:VIS&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIAG:MMS:H&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  :=  TIIB[EL1088_02_06]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_02_06</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_08</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M37</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIAG:MMS:H&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIAG:MMS:V&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_02_06]^Channel 4^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_02_06</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_08</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M38</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIAG:MMS:V&#39;</span><span class="p">);</span>


    <span class="o">//</span><span class="n">Sample</span> <span class="n">Delivery</span> <span class="o">-</span> <span class="mi">6</span> <span class="n">Axes</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_01]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_01</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_04_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M39</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:X&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_03]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_03</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_04_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M40</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:Y&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_05]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_05</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_04_06</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M41</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:Z&#39;</span><span class="p">);</span>

     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:ROT_V&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nRawEncoderUINT     := TIIB[EL5101_05_01]^ENC Status compact^Counter value;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M42</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:ROT_V&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:ROT_H&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_10]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_10</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5101_05_02</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M43</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:ROT_H&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:H&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_12]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_12</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5101_05_03</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="s1">&#39;}</span>
    <span class="n">M44</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:H&#39;</span><span class="p">);</span>

    <span class="o">//</span><span class="n">Detector</span> <span class="n">Rotation</span>
    <span class="o">//</span><span class="n">Need</span> <span class="n">to</span> <span class="n">fix</span> <span class="n">linking</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DET:MMS:ROT&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nRawEncoderULINT     := TIIB[BOX-22 DET_ROT (EL5042)]^FB Inputs Channel 1^Position&#39;</span><span class="p">}</span>
    <span class="n">M45</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DET:MMS:ROT&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Cryo</span> <span class="o">-</span>  <span class="mi">4</span> <span class="n">axes</span>
    <span class="o">//</span><span class="n">Cryo</span> <span class="o">-</span><span class="n">X</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_12]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_12</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_13</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span> <span class="s1">&#39;}</span>
    <span class="n">M46</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:X&#39;</span><span class="p">);</span>
    <span class="o">//</span><span class="n">CRYO</span> <span class="n">Y</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_14]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_14</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_13</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span> <span class="s1">&#39;}</span>
    <span class="n">M47</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:Y&#39;</span><span class="p">);</span>
    <span class="o">//</span><span class="n">CRYO</span> <span class="n">Z</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_15]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_15</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_16</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span> <span class="s1">&#39;}</span>
    <span class="n">M48</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:Z&#39;</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">CRYO</span><span class="o">-</span><span class="n">ROT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:ROT&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_11]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_11</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_16</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span> <span class="s1">&#39;}</span>
    <span class="n">M49</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:ROT&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span>
    <span class="o">//</span> <span class="n">Questar</span> <span class="o">-</span>  <span class="mi">2</span> <span class="n">axes</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:QUESTAR:MMS:01&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SSL-EL7041]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SSL</span><span class="o">-</span><span class="n">EL7041</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">IM1K3</span><span class="o">-</span><span class="n">EL5042</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M49</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:QUESTAR:MMS:01&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:QUESTAR:MMS:02&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SSL-EL7041]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SSL</span><span class="o">-</span><span class="n">EL7041</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">IM1K3</span><span class="o">-</span><span class="n">EL5042</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M50</span><span class="p">:</span> <span class="n">DUT_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:QUESTAR:MMS:02&#39;</span><span class="p">);</span>

<span class="o">*</span><span class="p">)</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
</section>
<section id="pous">
<h1>POUs<a class="headerlink" href="#pous" title="Link to this heading"></a></h1>
<section id="fb-2axestrans">
<h2>FB_2AxesTrans<a class="headerlink" href="#fb-2axestrans" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_2AxesTrans</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stFirstAxis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rEncoderOffsetFirst</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rEncoderOffsetSecound</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Distance</span> <span class="n">between</span> <span class="mi">1</span><span class="n">st</span> <span class="n">stage</span> <span class="ow">and</span> <span class="mi">2</span><span class="n">nd</span> <span class="n">stage</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rDistance</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.40</span><span class="p">;</span>

    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>

    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbFirstStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSecondStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosFirstStage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosSecondStage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.03</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stFirst</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stSecond</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: FIRST&#39;</span><span class="p">}</span>
    <span class="n">fbFirst</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SECOND&#39;</span><span class="p">}</span>
    <span class="n">fbSecond</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">X_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqAngle</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">X</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActAngle</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>



     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>
    <span class="n">rTrig_Block</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Open</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Close</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqAngle</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span> <span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_Pos</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Angle</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;OPT_XPM_Translation&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Initialize</span>
<span class="n">ACT_init</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>

<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqPosition</span> <span class="o">&lt;&gt;</span> <span class="n">rReqPosition</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqPosition</span> <span class="o">:=</span> <span class="n">rReqPosition</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Position.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqAngle</span> <span class="o">&lt;&gt;</span> <span class="n">rReqAngle</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqAngle</span> <span class="o">:=</span> <span class="n">rReqAngle</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Angle&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosFirstStage</span>              <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistance</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqAngle</span> <span class="o">+</span> <span class="n">rEncoderOffsetFirst</span><span class="p">;</span>
<span class="n">fPosSecondStage</span>             <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistance</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqAngle</span> <span class="o">+</span> <span class="n">rEncoderOffsetSecound</span><span class="p">;</span>



<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span> <span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rActPosition</span>        <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stFirstAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetFirst</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stSecondAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSecound</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">rActAngle</span>           <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stSecondAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSecound</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stFirstAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetFirst</span><span class="p">))</span> <span class="o">/</span> <span class="n">rDistance</span> <span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbFirstStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stFirstAxis</span><span class="p">);</span>
<span class="n">fbSecondStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSecondAxis</span><span class="p">);</span>



<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;First&#39;</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosFirstStage</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stSecond</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Second&#39;</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosSecondStage</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>



<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbFirst</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbSecond</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbFirst</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stFirst</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stFirstAxis</span><span class="p">);</span>

<span class="n">fbSecond</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSecond</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSecondAxis</span><span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="fb-2axestrans-1">
<h2>FB_2AxesTrans_1<a class="headerlink" href="#fb-2axestrans-1" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_2AxesTrans_1</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stFirstAxis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_First</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetFirst</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Secound</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetSecound</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Distance</span> <span class="n">between</span> <span class="mi">1</span><span class="n">st</span> <span class="n">stage</span> <span class="ow">and</span> <span class="mi">2</span><span class="n">nd</span> <span class="n">stage</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rDistance</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.40</span><span class="p">;</span>

    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>

     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Home</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbFirstStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSecondStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosFirstStage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosSecondStage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.03</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stFirst</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stSecond</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: FIRST&#39;</span><span class="p">}</span>
    <span class="n">fbFirst</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SECOND&#39;</span><span class="p">}</span>
    <span class="n">fbSecond</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ANG_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqAngle</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_POSISION</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_ANGLE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActAngle</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>



     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>
    <span class="n">rTrig_Block</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Open</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Close</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqAngle</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span> <span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_Pos</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Angle</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;OPT_XPM_Translation&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Initialize</span>
<span class="n">ACT_init</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>

<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqPosition</span> <span class="o">&lt;&gt;</span> <span class="n">rReqPosition</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqPosition</span> <span class="o">:=</span> <span class="n">rReqPosition</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Position.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqAngle</span> <span class="o">&lt;&gt;</span> <span class="n">rReqAngle</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqAngle</span> <span class="o">:=</span> <span class="n">rReqAngle</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Angle&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosFirstStage</span>              <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistance</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqAngle</span> <span class="o">+</span> <span class="n">rEncoderOffsetFirst</span><span class="p">;</span>
<span class="n">fPosSecondStage</span>             <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistance</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqAngle</span> <span class="o">+</span> <span class="n">rEncoderOffsetSecound</span><span class="p">;</span>



<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span> <span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rActPosition</span>        <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stFirstAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetFirst</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stSecondAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSecound</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">rActAngle</span>           <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stSecondAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSecound</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stFirstAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetFirst</span><span class="p">))</span> <span class="o">/</span> <span class="n">rDistance</span> <span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbFirstStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stFirstAxis</span><span class="p">);</span>
<span class="n">fbSecondStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSecondAxis</span><span class="p">);</span>



<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;First&#39;</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosFirstStage</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stSecond</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Second&#39;</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosSecondStage</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>



<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbFirst</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbSecond</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbFirst</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stFirst</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stFirstAxis</span><span class="p">);</span>

<span class="n">fbSecond</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSecond</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSecondAxis</span><span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="fb-3axesjack">
<h2>FB_3AxesJack<a class="headerlink" href="#fb-3axesjack" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_3AxesJack</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stJack1Axis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack1</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack1</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack2</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack2</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack3</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack3</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Distance</span> <span class="n">X</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rDistanceX</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.24</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span><span class="n">Distance</span> <span class="n">Z</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rDistanceZ</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.88</span><span class="p">;</span>

    <span class="n">rLimitPositionMax</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="n">rLimitPositionMin</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">8</span><span class="p">;</span>
    <span class="n">rLimitPitchMin</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitPitchMax</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span>  <span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitRollMin</span><span class="p">:</span> <span class="n">REAL</span>  <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitRollMax</span><span class="p">:</span> <span class="n">REAL</span>  <span class="o">:=</span>  <span class="mi">18</span><span class="p">;</span>

    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>

     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Home</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
    <span class="n">fbJack1Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbJack2Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbJack3Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosJack1Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosJack2Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosJack3Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stJack1</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stJack2</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stJack3</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK1&#39;</span><span class="p">}</span>
    <span class="n">fbJack1</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK2&#39;</span><span class="p">}</span>
    <span class="n">fbJack2</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK3&#39;</span><span class="p">}</span>
    <span class="n">fbJack3</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Y_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPitch</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ROLL_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqRoll</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Y</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPitch</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ROLL</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActRoll</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqPitch</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqRoll</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">rPosAvgJAck1_3</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span> <span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_Pos</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Angle</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;3Jack&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>


    <span class="n">fbPower</span><span class="p">:</span> <span class="n">MC_POWER</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Initialize</span>
<span class="n">ACT_init</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>

<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Software</span> <span class="n">Limits</span> <span class="n">to</span> <span class="n">protect</span> <span class="n">blades</span>
<span class="n">ACT_VirtualLimitSW</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqPosition</span> <span class="o">&lt;&gt;</span> <span class="n">rReqPosition</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqPosition</span> <span class="o">:=</span> <span class="n">rReqPosition</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Position.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqPitch</span> <span class="o">&lt;&gt;</span> <span class="n">rReqPitch</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqPitch</span> <span class="o">:=</span> <span class="n">rReqPitch</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Pitch&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqRoll</span> <span class="o">&lt;&gt;</span> <span class="n">rReqRoll</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqRoll</span> <span class="o">:=</span> <span class="n">rReqRoll</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Roll&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosJack1Stage</span>      <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">+</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack1</span><span class="p">;</span>
<span class="n">fPosJack2Stage</span>      <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack2</span><span class="p">;</span>
<span class="n">fPosJack3Stage</span>      <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">-</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack3</span><span class="p">;</span>

<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span> <span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rPosAvgJack1_3</span>      <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stJack1Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stJack3Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack3</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">rActPosition</span>        <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">rPosAvgJAck1_3</span> <span class="o">+</span> <span class="p">(</span><span class="n">stJack2Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">));</span>
<span class="n">rActPitch</span>           <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stJack1Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stJack3Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack3</span><span class="p">))</span> <span class="o">/</span> <span class="n">rDistanceZ</span><span class="p">);</span>
<span class="n">rActRoll</span>            <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">(</span><span class="n">rActPosition</span> <span class="o">-</span> <span class="p">(</span><span class="n">stJack2Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">rDistanceX</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span> <span class="o">//</span> <span class="n">mrad</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbJack1Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack1Axis</span><span class="p">);</span>
<span class="n">fbJack2Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack2Axis</span><span class="p">);</span>
<span class="n">fbJack3Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack3Axis</span><span class="p">);</span>



<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack1&#39;</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack1Stage</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stJack2</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack2&#39;</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack2Stage</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stJack3</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack3&#39;</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack3Stage</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>


<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbJack1</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbJack2</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbJack3</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbJack1</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack1</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack1Axis</span><span class="p">);</span>

<span class="n">fbJack2</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack2</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack2Axis</span><span class="p">);</span>

<span class="n">fbJack3</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack3</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack3Axis</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_VirtualLimitSW</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Force</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">false</span>
<span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">SafetyReady</span> <span class="n">flags</span> <span class="n">manually</span>
<span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


<span class="o">//</span> <span class="n">Note</span><span class="p">:</span> <span class="n">FB_MotionStage</span> <span class="n">calls</span> <span class="n">FB_SetEnables</span> <span class="n">internally</span> <span class="n">that</span> <span class="n">overwrites</span> <span class="o">.</span><span class="n">bAllForwardEnable</span><span class="o">/.</span><span class="n">bAllBackwardEnable</span> <span class="n">flags</span>

<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&lt;=</span> <span class="n">rLimitPitchMax</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&gt;=</span> <span class="n">rLimitPitchMin</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActRoll</span> <span class="o">&lt;=</span> <span class="n">rLimitRollMax</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActRoll</span> <span class="o">&gt;=</span> <span class="n">rLimitRollMin</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&gt;=</span> <span class="n">rLimitPitchMin</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&lt;=</span> <span class="n">rLimitPitchMax</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="fb-3axesjack-1">
<h2>FB_3AxesJack_1<a class="headerlink" href="#fb-3axesjack-1" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_3AxesJack_1</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stJack1Axis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack1</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack1</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack2</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack2</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack3</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack3</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>

     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Home</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
    <span class="n">fbJack1Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbJack2Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbJack3Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosJack1Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosJack2Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosJack3Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.05</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stJack1</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stJack2</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stJack3</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK1&#39;</span><span class="p">}</span>
    <span class="n">fbJack1</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK2&#39;</span><span class="p">}</span>
    <span class="n">fbJack2</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK3&#39;</span><span class="p">}</span>
    <span class="n">fbJack3</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">POS_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PIT_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPitch</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ROL_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqRoll</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_POSISION</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_PITCH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPitch</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_ROLL</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActRoll</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqPitch</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqRoll</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">rPosAvgJAck1_3</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span> <span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_Pos</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Angle</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;3Jack&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>


    <span class="n">fbPower</span><span class="p">:</span> <span class="n">MC_POWER</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span> <span class="n">CONSTANT</span>
    <span class="o">//</span><span class="n">DO</span> <span class="n">NOT</span> <span class="n">CHANGE</span> <span class="n">PLEASE</span>
    <span class="p">(</span><span class="o">*</span><span class="n">Distance</span> <span class="n">X</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rDistanceX</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.24</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span><span class="n">Distance</span> <span class="n">Z</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rDistanceZ</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.88</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span> <span class="n">Limit</span> <span class="n">to</span> <span class="n">Y</span> <span class="o">+/-</span><span class="mi">5</span><span class="n">mm</span> <span class="ow">and</span> <span class="o">+/-</span> <span class="n">Pitch</span><span class="o">/</span><span class="n">Roll</span> <span class="mi">18</span><span class="n">mrad</span> <span class="o">*</span><span class="p">)</span>
    <span class="n">rLimitPositionMin</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
    <span class="n">rLimitPositionMax</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">rLimitPitchMin</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitPitchMax</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span>  <span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitRollMin</span><span class="p">:</span> <span class="n">REAL</span>  <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitRollMax</span><span class="p">:</span> <span class="n">REAL</span>  <span class="o">:=</span>  <span class="mi">18</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Initialize</span>
<span class="n">ACT_init</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>

<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Software</span> <span class="n">Limits</span> <span class="n">to</span> <span class="n">protect</span> <span class="n">blades</span>
<span class="n">ACT_VirtualLimitSW</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqPosition</span> <span class="o">&lt;&gt;</span> <span class="n">rReqPosition</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqPosition</span> <span class="o">:=</span> <span class="n">rReqPosition</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Position.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqPitch</span> <span class="o">&lt;&gt;</span> <span class="n">rReqPitch</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqPitch</span> <span class="o">:=</span> <span class="n">rReqPitch</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Pitch&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqRoll</span> <span class="o">&lt;&gt;</span> <span class="n">rReqRoll</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqRoll</span> <span class="o">:=</span> <span class="n">rReqRoll</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Roll&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosJack1Stage</span>      <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">+</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack1</span><span class="p">;</span>
<span class="n">fPosJack2Stage</span>      <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack2</span><span class="p">;</span>
<span class="n">fPosJack3Stage</span>      <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">-</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack3</span><span class="p">;</span>

<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span> <span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rPosAvgJack1_3</span>      <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stJack1Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stJack3Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack3</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">rActPosition</span>        <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">rPosAvgJAck1_3</span> <span class="o">+</span> <span class="p">(</span><span class="n">stJack2Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">));</span>
<span class="n">rActPitch</span>           <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stJack1Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stJack3Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack3</span><span class="p">))</span> <span class="o">/</span> <span class="n">rDistanceZ</span><span class="p">);</span>
<span class="n">rActRoll</span>            <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">(</span><span class="n">rActPosition</span> <span class="o">-</span> <span class="p">(</span><span class="n">stJack2Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetJack2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">rDistanceX</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span> <span class="o">//</span> <span class="n">mrad</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbJack1Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack1Axis</span><span class="p">);</span>
<span class="n">fbJack2Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack2Axis</span><span class="p">);</span>
<span class="n">fbJack3Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack3Axis</span><span class="p">);</span>



<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack1&#39;</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack1Stage</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stJack2</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack2&#39;</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack2Stage</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stJack3</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack3&#39;</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack3Stage</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>


<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbJack1</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbJack2</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbJack3</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbJack1</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack1</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack1Axis</span><span class="p">);</span>

<span class="n">fbJack2</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack2</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack2Axis</span><span class="p">);</span>

<span class="n">fbJack3</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack3</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack3Axis</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_VirtualLimitSW</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Force</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">false</span>
<span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">SafetyReady</span> <span class="n">flags</span> <span class="n">manually</span>
<span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


<span class="o">//</span> <span class="n">Note</span><span class="p">:</span> <span class="n">FB_MotionStage</span> <span class="n">calls</span> <span class="n">FB_SetEnables</span> <span class="n">internally</span> <span class="n">that</span> <span class="n">overwrites</span> <span class="o">.</span><span class="n">bAllForwardEnable</span><span class="o">/.</span><span class="n">bAllBackwardEnable</span> <span class="n">flags</span>

<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&lt;=</span> <span class="n">rLimitPitchMax</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&gt;=</span> <span class="n">rLimitPitchMin</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActRoll</span> <span class="o">&gt;=</span> <span class="n">rLimitRollMin</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActRoll</span> <span class="o">&lt;=</span> <span class="n">rLimitRollMax</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&gt;=</span> <span class="n">rLimitPitchMin</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&lt;=</span> <span class="n">rLimitPitchMax</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="fb-slits">
<h2>FB_Slits<a class="headerlink" href="#fb-slits" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_Slits</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stTopBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">Left</span> <span class="n">Slit</span> <span class="kn">from</span> <span class="nn">upstream</span> <span class="n">view</span>
    <span class="n">stRightBlade</span><span class="p">:</span> <span class="n">DUT_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">Right</span> <span class="n">Slit</span> <span class="kn">from</span> <span class="nn">upstream</span> <span class="n">view</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>

<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Offset_Top</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetTop</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Bottom</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetBottom</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: ZeroOffset_Left; io: io;&#39;</span><span class="p">}</span>
    <span class="n">rEncoderOffsetLeft</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Right</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetRight</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Home</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
    <span class="n">fbTopBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbBottomBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbLeftBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbRightBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosTopBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosBottomBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosLeftBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosRightBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">bCollisionLimitationVert</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bCollisionLimitationHorz</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stTop</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stBOTTOM</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stLeft</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>
    <span class="n">stRight</span><span class="p">:</span> <span class="n">DUT_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: TOP&#39;</span><span class="p">}</span>
    <span class="n">fbTop</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: BOTTOM&#39;</span><span class="p">}</span>
    <span class="n">fbBottom</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: LEFT&#39;</span><span class="p">}</span>
    <span class="n">fbLeft</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: RIGHT&#39;</span><span class="p">}</span>
    <span class="n">fbRight</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XWID_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YWID_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XCEN_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YCEN_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_XWIDTH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_YWIDTH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_XCENTER</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_YCENTER</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XCEN_SETZERO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rSetCenterX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YCEN_SETZERO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rSetCenterY</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">OPEN</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bOpen</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">CLOSE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bClose</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">BLOCK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bBlock</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>
    <span class="n">rTrig_Block</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Open</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Close</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span><span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_TOP</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Bottom</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Left</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Right</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;Slits&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>

    <span class="n">fbPower</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Initialize</span>
<span class="n">ACT_init</span><span class="p">();</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>
<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Software</span> <span class="n">Limits</span> <span class="n">to</span> <span class="n">protect</span> <span class="n">blades</span>
<span class="n">ACT_VirtualLimitSW</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_BLOCK</span><span class="p">:</span>
<span class="n">rTrig_Block</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bBlock</span><span class="p">);</span>
<span class="n">rTrig_Open</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bOpen</span><span class="p">);</span>
<span class="n">rTrig_Close</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bClose</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Block</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="o">//</span><span class="n">BLOCK</span>

    <span class="n">bBlock</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Open</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>


    <span class="n">bOpen</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Close</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>


    <span class="n">bClose</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeX</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeX</span> <span class="o">:=</span> <span class="n">rReqApertureSizeX</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterX</span> <span class="o">:=</span> <span class="n">rReqCenterX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X center&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterX</span> <span class="o">:=</span> <span class="n">rActCenterX</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeY</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeY</span> <span class="o">:=</span> <span class="n">rReqApertureSizeY</span><span class="p">;</span>
        <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>

<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterY</span> <span class="o">:=</span> <span class="n">rReqCenterY</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y center.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterY</span> <span class="o">:=</span> <span class="n">rActCenterY</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span> <span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosTopBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span> <span class="o">+</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="p">;</span>
<span class="n">fPosBottomBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span><span class="o">+</span><span class="n">rEncoderOffsetBottom</span><span class="p">);</span>

<span class="n">fPosLeftBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetLeft</span><span class="p">);</span>
<span class="n">fPosRightBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetRight</span><span class="p">);</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span> <span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rActApertureSizeX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stLeftBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetLeft</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stRightBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="o">-</span> <span class="n">rEncoderOffsetRight</span><span class="p">));</span>

<span class="n">rActApertureSizeY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">));</span>

<span class="n">rActCenterX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stLeftBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetLeft</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="n">stRightBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetRight</span> <span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>

<span class="n">rActCenterY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>


<span class="o">//</span> <span class="n">Prevent</span> <span class="n">collision</span>
<span class="n">bCollisionLimitationHorz</span>    <span class="o">:=</span> <span class="p">(</span><span class="n">rActApertureSizeX</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">);</span>
<span class="n">bCollisionLimitationVert</span>    <span class="o">:=</span> <span class="p">(</span><span class="n">rActApertureSizeY</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stRightBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbTopBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stTopBlade</span><span class="p">);</span>
<span class="n">fbBottomBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stBottomBlade</span><span class="p">);</span>
<span class="n">fbLeftBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stLeftBlade</span><span class="p">);</span>
<span class="n">fbRightBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stRightBlade</span><span class="p">);</span>



<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Top&#39;</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosTopBlade</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Bottom&#39;</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosBottomBlade</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stLeft</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Left&#39;</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosLeftBlade</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stRight</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Right&#39;</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosRightBlade</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbTop</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbBottom</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionY</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbLeft</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbRight</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbTop</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stTop</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stTopBlade</span><span class="p">);</span>

<span class="n">fbBottom</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stBOTTOM</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stBottomBlade</span><span class="p">);</span>

<span class="n">fbLeft</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stLeft</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stLeftBlade</span><span class="p">);</span>

<span class="n">fbRight</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stRight</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stRightBlade</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_VirtualLimitSW</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Force</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">false</span>
<span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">SafetyReady</span> <span class="n">flags</span> <span class="n">manually</span>
<span class="n">stTopBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stRightBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


<span class="o">//</span> <span class="n">Note</span><span class="p">:</span> <span class="n">FB_MotionStage</span> <span class="n">calls</span> <span class="n">FB_SetEnables</span> <span class="n">internally</span> <span class="n">that</span> <span class="n">overwrites</span> <span class="o">.</span><span class="n">bAllForwardEnable</span><span class="o">/.</span><span class="n">bAllBackwardEnable</span> <span class="n">flags</span>

<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationVert</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationVert</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationHorz</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationHorz</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="prg-1-plctask">
<h2>PRG_1_PlcTask<a class="headerlink" href="#prg-1-plctask" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_1_PlcTask</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">PRG_2_PMPS</span><span class="p">();</span>
<span class="n">PRG_3_LOG</span><span class="p">();</span>
<span class="n">PRG_SSL</span><span class="p">();</span>
<span class="n">PRG_Diffractometer</span><span class="p">();</span>
<span class="n">PRG_LAS</span><span class="p">();</span>
<span class="n">PRG_SDS</span><span class="p">();</span>
<span class="n">PRG_RotDet</span><span class="p">();</span>
<span class="o">//</span><span class="n">PRG_Questar</span><span class="p">();</span>
<span class="n">PRG_SpetrometerArm</span><span class="p">();</span>
<span class="n">PRG_Cryo</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#prg-2-pmps">PRG_2_PMPS</a></p></li>
<li><p><a class="reference internal" href="#prg-3-log">PRG_3_LOG</a></p></li>
<li><p><a class="reference internal" href="#prg-cryo">PRG_Cryo</a></p></li>
<li><p><a class="reference internal" href="#prg-diffractometer">PRG_Diffractometer</a></p></li>
<li><p><a class="reference internal" href="#prg-las">PRG_LAS</a></p></li>
<li><p><a class="reference internal" href="#prg-questar">PRG_Questar</a></p></li>
<li><p><a class="reference internal" href="#prg-rotdet">PRG_RotDet</a></p></li>
<li><p><a class="reference internal" href="#prg-sds">PRG_SDS</a></p></li>
<li><p><a class="reference internal" href="#prg-ssl">PRG_SSL</a></p></li>
<li><p><a class="reference internal" href="#prg-spetrometerarm">PRG_SpetrometerArm</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-2-pmps">
<h2>PRG_2_PMPS<a class="headerlink" href="#prg-2-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_2_PMPS</span>
<span class="n">VAR</span>
    <span class="n">fbArbiterIO</span><span class="p">:</span> <span class="n">FB_SubSysToArbiter_IO</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="o">.</span><span class="n">Execute</span><span class="p">();</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput2</span><span class="o">.</span><span class="n">Execute</span><span class="p">();</span>
<span class="n">fbArbiterIO</span><span class="p">(</span>
    <span class="n">Arbiter</span><span class="o">:=</span><span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
    <span class="n">fbFFHWO</span><span class="o">:=</span><span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-2theta">
<h2>PRG_2Theta<a class="headerlink" href="#prg-2theta" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_2Theta</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbPower_AxisM2</span><span class="p">:</span>  <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fb2ThetaStepper</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bMoveOk</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

<span class="n">END_VAR</span>

<span class="n">VAR</span> <span class="n">CONSTANT</span>
    <span class="n">fThresholdPS1</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.15</span><span class="p">;</span>
    <span class="n">fThresholdPS2</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.15</span><span class="p">;</span>
    <span class="n">fThresholdPS3</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.15</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">binit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Stepper</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">IF_MOVING</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="n">ACT_Stepper</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">ACT_Stepper</span><span class="p">:</span>
<span class="n">fb2ThetaStepper</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bAllEnable</span> <span class="o">:=</span>               <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bEnable</span>
                            <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span> <span class="o">//</span> <span class="n">ESTOP</span>
                            <span class="n">AND</span>     <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="n">fThresholdPS1</span>
                            <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="n">fThresholdPS2</span>
                            <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="n">fThresholdPS3</span> <span class="o">//</span> <span class="n">Compressed</span><span class="o">-</span><span class="n">air</span> <span class="n">pressure</span>
                            <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span>
                            <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bLimitForwardEnable</span>  <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>

<span class="n">fbPower_AxisM2</span><span class="p">(</span>
    <span class="n">Axis</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bAllForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bAllBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span><span class="o">:=</span> <span class="mi">100</span>
<span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-3-log">
<h2>PRG_3_LOG<a class="headerlink" href="#prg-3-log" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_3_LOG</span>
<span class="n">VAR</span>
      <span class="n">fbLogHandler</span><span class="p">:</span> <span class="n">FB_LogHandler</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">fbLogHandler</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</section>
<section id="prg-cryo">
<h2>PRG_Cryo<a class="headerlink" href="#prg-cryo" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_Cryo
VAR
    fb_Cryo_ROT : FB_MotionStage;
    fb_Cryo_X : FB_MotionStage;
    fb_Cryo_Y : FB_MotionStage;
    fb_Cryo_Z : FB_MotionStage;
    bInit : BOOl := TRUE;
END_VAR
IF ( bInit) THEN
    bInit := FALSE;
    Main.M46.bHardwareEnable := TRUE;
    Main.M46.bPowerSelf := TRUE;
    Main.M46.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M46.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M47.bHardwareEnable := TRUE;
    Main.M47.bPowerSelf := TRUE;
    Main.M47.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M47.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M48.bHardwareEnable := TRUE;
    Main.M48.bPowerSelf := TRUE;
    Main.M48.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M48.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M49.bHardwareEnable := TRUE;
    Main.M49.bPowerSelf := TRUE;
    Main.M49.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M49.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;
END_IF


//EPS??

fb_Cryo_X(stMotionStage:=Main.M46);
fb_Cryo_Y(stMotionStage:=Main.M47);
fb_Cryo_Z(stMotionStage:=Main.M48);
fb_Cryo_ROT(stMotionStage:=Main.M49);

END_PROGRAM
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-arm">
<h2>PRG_DET_ARM<a class="headerlink" href="#prg-det-arm" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_ARM</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bExecuteCouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteDecouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">fbMotionYF1</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionYF2</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionZF</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbAutoCoupling</span><span class="p">:</span> <span class="n">FB_GantryAutoCoupling</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .Count := TIIB[BOX-06 ENC_ZDC_YF1 (EL5042)]^FB Inputs Channel 2^Position&#39;</span><span class="p">}</span>
    <span class="n">stRenishawAbsEncMaster</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .Count := TIIB[BOX-07 ENC_YF2_ZF (EL5042)]^FB Inputs Channel 1^Position&#39;</span><span class="p">}</span>
    <span class="n">stRenishawAbsEncSlave</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span>
    <span class="n">fbPower_AxisM25</span><span class="p">:</span> <span class="n">MC_POWER</span><span class="p">;</span>
    <span class="n">fbPower_AxisM26</span><span class="p">:</span> <span class="n">MC_POWER</span><span class="p">;</span>
    <span class="n">fbPower_AxisM27</span><span class="p">:</span> <span class="n">MC_POWER</span><span class="p">;</span>

    <span class="n">tonBrakeRlease_M25</span><span class="p">,</span> <span class="n">tonBrakeRlease_M26</span><span class="p">,</span> <span class="n">tonBrakeRlease_M27</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="o">//</span> <span class="o">*</span><span class="p">)</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">IF_MOVING</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">IF_MOVING</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">IF_ENABLED</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>



    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">stRenishawAbsEncMaster</span><span class="o">.</span><span class="n">Ref</span> <span class="o">:=</span> <span class="mi">15370335</span><span class="p">;</span>
<span class="n">stRenishawAbsEncSlave</span><span class="o">.</span><span class="n">Ref</span> <span class="o">:=</span> <span class="mi">15347257</span><span class="p">;</span>

<span class="o">//</span> <span class="n">AutoCoupling</span>
<span class="n">fbAutoCoupling</span><span class="p">(</span>     <span class="n">nGantryTol</span>                      <span class="o">:=</span> <span class="mi">200000</span><span class="p">,</span> <span class="o">//</span> <span class="mi">50</span><span class="n">nm</span><span class="o">/</span><span class="n">count</span>
                <span class="n">Master</span>                              <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="p">,</span>
                <span class="n">MasterEnc</span>                   <span class="o">:=</span> <span class="n">stRenishawAbsEncMaster</span><span class="p">,</span>
                <span class="n">Slave</span>                               <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="p">,</span>
                <span class="n">SlaveEnc</span>                    <span class="o">:=</span> <span class="n">stRenishawAbsEncSlave</span><span class="p">,</span>
                <span class="n">bExecuteCouple</span>              <span class="o">:=</span> <span class="n">bExecuteCouple</span><span class="p">,</span>
                <span class="n">bExecuteDecouple</span>    <span class="o">:=</span> <span class="n">bExecuteDecouple</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bAllEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bAllEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bAllEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Call</span> <span class="n">Motion</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">fbMotionYF1</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="p">);</span>
<span class="n">fbMotionYF2</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="p">);</span>
<span class="n">fbMotionZF</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span> <span class="n">For</span> <span class="n">test</span>
<span class="o">//</span> <span class="n">Release</span> <span class="n">brake</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="n">enabled</span><span class="o">.</span>
<span class="n">tonBrakeRlease_M25</span><span class="p">(</span>
    <span class="n">IN</span><span class="o">:=</span><span class="p">(</span><span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">OR</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">DriveDeviceError</span><span class="p">,</span>
    <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#1s,</span>
    <span class="n">Q</span><span class="o">=&gt;</span><span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bBrakeRelease</span>
<span class="p">);</span>
<span class="n">tonBrakeRlease_M26</span><span class="p">(</span>
    <span class="n">IN</span><span class="o">:=</span><span class="p">(</span><span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">OR</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">DriveDeviceError</span><span class="p">,</span>
    <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#1s,</span>
    <span class="n">Q</span><span class="o">=&gt;</span><span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bBrakeRelease</span>
<span class="p">);</span>
<span class="n">tonBrakeRlease_M27</span><span class="p">(</span>
    <span class="n">IN</span><span class="o">:=</span><span class="p">(</span><span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">OR</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">DriveDeviceError</span><span class="p">,</span>
    <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#1s,</span>
    <span class="n">Q</span><span class="o">=&gt;</span><span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bBrakeRelease</span>
<span class="p">);</span>
<span class="n">fbPower_AxisM25</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="n">AND</span> <span class="n">PLimFwd</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="n">AND</span> <span class="n">PLimBwd</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">fbPower_AxisM26</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="n">AND</span> <span class="n">SLimFwd</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="n">AND</span> <span class="n">SLimBwd</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">fbPower_AxisM27</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">GVL_Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span><span class="p">,</span>
<span class="p">);</span>


<span class="o">//</span> <span class="o">*</span><span class="p">)</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-chamber">
<h2>PRG_DET_CHAMBER<a class="headerlink" href="#prg-det-chamber" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_CHAMBER</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbMotionXDC</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionRyDC</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionZDC</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">Lock</span> <span class="n">stages</span> <span class="n">until</span> <span class="n">they</span> <span class="n">are</span> <span class="n">tested</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>



<span class="o">//</span> <span class="n">Det</span><span class="o">.</span> <span class="n">Chmber</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bHardwareEnable</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bPowerSelf</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">nBrakeMode</span><span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bHardwareEnable</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bPowerSelf</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">nBrakeMode</span><span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bHardwareEnable</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bPowerSelf</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">nBrakeMode</span><span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">ALWAYS</span> <span class="p">;</span> <span class="o">//</span> <span class="n">This</span> <span class="n">axis</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">enables</span> <span class="n">due</span> <span class="n">to</span> <span class="n">belows</span>
<span class="n">END_IF</span><span class="p">;</span>


<span class="n">fbMotionXDC</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="p">);</span>
<span class="n">fbMotionRyDC</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="p">);</span>
<span class="n">fbMotionZDC</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-frame">
<h2>PRG_DET_FRAME<a class="headerlink" href="#prg-det-frame" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_FRAME</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:bError&#39;</span><span class="p">}</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:bResetError&#39;</span><span class="p">}</span>
    <span class="n">bResetError</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableMotion</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnableMotion_M15</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnableMotion_M16</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnableMotion_M17</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnableSetGaugeValue</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bEnableMoveRelative</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:EnableJackOff&#39;</span><span class="p">}</span>
    <span class="n">bEnableJackOff</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:EnableLevitation&#39;</span><span class="p">}</span>
    <span class="n">bEnableLevitation</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:EnableLanding&#39;</span><span class="p">}</span>
    <span class="n">bEnableLanding</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:EnableAdjustingRoll&#39;</span><span class="p">}</span>
    <span class="n">bEnableAdjustingRoll</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:EnableAdjustingPitch&#39;</span><span class="p">}</span>
    <span class="n">bEnableAdjustingPitch</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:EnableAdjustingHeight&#39;</span><span class="p">}</span>
    <span class="n">bEnableAdjustingHeight</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="n">bDone_M15</span><span class="p">,</span> <span class="n">bDone_M16</span><span class="p">,</span> <span class="n">bDone_M17</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">tonWaitToStabilize</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="n">tonSV2Open</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tonSV1Close</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="n">tonDelayTrig</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="n">iStepJackOff</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingRoll</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepSetGaugeValue</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepMoveRelative</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingPitch</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingHeight</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">trigDone</span><span class="p">:</span> <span class="n">F_TRIG</span><span class="p">;</span>

    <span class="n">fDistanceX</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">2.114</span><span class="p">;</span> <span class="o">//</span> <span class="ow">in</span> <span class="n">m</span>
    <span class="n">fDistanceZ</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">2.142</span><span class="p">;</span> <span class="o">//</span> <span class="ow">in</span> <span class="n">m</span>

    <span class="n">fbPower_AxisM15</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM16</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM17</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>

    <span class="n">fbSetPosition_M15</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_M16</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_M17</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="n">fTargetPos_M15</span><span class="p">,</span> <span class="n">fTargetPos_M16</span><span class="p">,</span> <span class="n">fTargetPos_M17</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">fbMoveRelative_M15</span><span class="p">:</span> <span class="n">MC_MoveRelative</span><span class="p">;</span>
    <span class="n">fbMoveRelative_M16</span><span class="p">:</span> <span class="n">MC_MoveRelative</span><span class="p">;</span>
    <span class="n">fbMoveRelative_M17</span><span class="p">:</span> <span class="n">MC_MoveRelative</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>


    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


    <span class="o">//</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>

    <span class="o">//</span> <span class="n">Read</span> <span class="n">linear</span> <span class="n">gauge</span> <span class="n">value</span>
    <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span> <span class="n">Read</span> <span class="n">axis</span> <span class="n">status</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>

<span class="n">fbPower_AxisM15</span><span class="p">(</span>
    <span class="n">Enable</span> <span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span><span class="p">,</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="n">fbPower_AxisM16</span><span class="p">(</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span><span class="p">,</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="n">fbPower_AxisM17</span><span class="p">(</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span><span class="p">,</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span>
<span class="p">);</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">bFloating</span> <span class="o">:=</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.3</span> <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.18</span> <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.15</span><span class="p">;</span>

<span class="n">ACT_1_JACK_OFF</span><span class="p">();</span>
<span class="n">ACT_2_Levitation</span><span class="p">();</span>
<span class="n">ACT_3_Landing</span><span class="p">();</span>
<span class="n">ACT_4_AdjustingRoll</span><span class="p">();</span>
<span class="n">ACT_5_AdjustingPitch</span><span class="p">();</span>
<span class="n">ACT_6_AdjustingHeight</span><span class="p">();</span>
<span class="n">ACT_INIT</span><span class="p">();</span>
<span class="n">ACT_SetGaugeValue</span><span class="p">();</span>
<span class="n">ACT_MoveRelative</span><span class="p">();</span>
<span class="n">ACT_ResetError</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">ACT_1_JACK_OFF</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepJackOff</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableJackOff</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Step1</span> <span class="n">read</span> <span class="ow">and</span> <span class="n">apply</span> <span class="n">gauge</span> <span class="n">value</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">done</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bEnableSetGaugeValue</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">read</span> <span class="n">latest</span> <span class="n">status</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
            <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span> <span class="n">AND</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span> <span class="n">AND</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span> <span class="n">THEN</span>
                <span class="o">//</span> <span class="n">We</span> <span class="n">dont</span> <span class="n">need</span> <span class="n">to</span> <span class="n">move</span> <span class="nb">any</span> <span class="n">more</span><span class="o">....</span>
                <span class="n">iStepJackOFF</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>
            <span class="n">ELSIF</span> <span class="nb">max</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span>
                <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">10.0</span> <span class="n">THEN</span>
                <span class="o">//</span> <span class="n">Some</span> <span class="n">axis</span> <span class="n">may</span> <span class="n">be</span> <span class="n">step</span><span class="o">-</span><span class="n">out</span><span class="o">...</span>
                <span class="n">iStepJackOFF</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">ELSE</span>
                <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">END_IF</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step3</span> <span class="n">calcurate</span> <span class="n">motion</span> <span class="n">distance</span>
        <span class="n">fTargetPos_M15</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">;</span>
        <span class="n">fTargetPos_M16</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">;</span>
        <span class="n">fTargetPos_M17</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">;</span>

        <span class="o">//</span> <span class="n">Enable</span> <span class="n">Relative</span> <span class="n">Motion</span> <span class="n">Act</span>
        <span class="n">bEnableMoveRelative</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

        <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">Done</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bEnableMoveRelative</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">read</span> <span class="ow">and</span> <span class="n">apply</span> <span class="n">gauge</span> <span class="n">value</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">5</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">End</span>
        <span class="n">bEnableJackOff</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepJackOff</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bEnableJackOff</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepJackOff</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_2_Levitation</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bEnableLevitation</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.15</span> <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.15</span> <span class="n">THEN</span>
        <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span><span class="p">;</span>
    <span class="n">bDoneLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>


<span class="o">//</span> <span class="n">SV2</span> <span class="n">will</span> <span class="nb">open</span> <span class="n">after</span> <span class="mi">3</span> <span class="n">secounds</span> <span class="kn">from</span> <span class="nn">SV1</span> <span class="n">opened</span><span class="o">...</span>
<span class="n">tonSV2Open</span><span class="p">(</span>
    <span class="n">IN</span> <span class="o">:=</span> <span class="n">bEnableLevitation</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span><span class="p">,</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#3s</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">tonSV2Open</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bEnableLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLevitation</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_3_Landing</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bEnableLanding</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bDoneLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="n">tonSV1Close</span><span class="p">(</span>
    <span class="n">IN</span> <span class="o">:=</span> <span class="n">bEnableLanding</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span><span class="p">,</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#3s</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">tonSV1Close</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLanding</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_4_AdjustingRoll</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepAdjustingRoll</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableAdjustingRoll</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Step1</span> <span class="n">read</span> <span class="ow">and</span> <span class="n">apply</span> <span class="n">gauge</span> <span class="n">value</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">done</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bEnableSetGaugeValue</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step3</span> <span class="n">calcurate</span> <span class="n">motion</span> <span class="n">distance</span>
        <span class="o">//</span> <span class="n">read</span> <span class="n">latest</span> <span class="n">status</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>

        <span class="n">IF</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Need</span> <span class="n">to</span> <span class="n">up</span> <span class="n">YDF1</span>
            <span class="n">fTargetPos_M15</span> <span class="o">:=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span><span class="p">))</span> <span class="o">*</span> <span class="n">fDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;</span>
            <span class="n">fTargetPos_M16</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">fTargetPos_M17</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Enable</span> <span class="n">Relative</span> <span class="n">Motion</span> <span class="n">Act</span>
            <span class="n">bEnableMoveRelative</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">Need</span> <span class="n">to</span> <span class="n">up</span> <span class="n">YDF2</span>
            <span class="n">fTargetPos_M15</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">fTargetPos_M16</span> <span class="o">:=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span><span class="p">))</span> <span class="o">*</span> <span class="n">fDistanceX</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;</span>
            <span class="n">fTargetPos_M17</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Enable</span> <span class="n">Relative</span> <span class="n">Motion</span> <span class="n">Act</span>
            <span class="n">bEnableMoveRelative</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">Done</span><span class="o">.</span> <span class="ow">and</span> <span class="n">wait</span> <span class="n">tilt</span> <span class="n">sensor</span> <span class="n">stabilization</span><span class="o">.</span>
        <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bEnableMoveRelative</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
        <span class="n">IF</span> <span class="n">tonWaitToStabilize</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>
            <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">5</span><span class="p">:</span>
        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Iterartion</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">End</span>
            <span class="n">bEnableAdjustingRoll</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepAdjustingRoll</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bEnableAdjustingRoll</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepAdjustingRoll</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_5_AdjustingPitch</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepAdjustingPitch</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableAdjustingPitch</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Step1</span> <span class="n">read</span> <span class="ow">and</span> <span class="n">apply</span> <span class="n">gauge</span> <span class="n">value</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">done</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bEnableSetGaugeValue</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step3</span> <span class="n">calcurate</span> <span class="n">motion</span> <span class="n">distance</span>
        <span class="o">//</span> <span class="n">read</span> <span class="n">latest</span> <span class="n">status</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>

        <span class="n">IF</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Need</span> <span class="n">to</span> <span class="n">up</span> <span class="n">YDF1</span> <span class="n">AND</span> <span class="mi">2</span>
            <span class="n">fTargetPos_M15</span> <span class="o">:=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span><span class="p">))</span> <span class="o">*</span> <span class="n">fDistanceZ</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;</span>
            <span class="n">fTargetPos_M16</span> <span class="o">:=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span><span class="p">))</span> <span class="o">*</span> <span class="n">fDistanceZ</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;;</span>
            <span class="n">fTargetPos_M17</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Enable</span> <span class="n">Relative</span> <span class="n">Motion</span> <span class="n">Act</span>
            <span class="n">bEnableMoveRelative</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">Need</span> <span class="n">to</span> <span class="n">up</span> <span class="n">YDF3</span>
            <span class="n">fTargetPos_M15</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">fTargetPos_M16</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">fTargetPos_M17</span> <span class="o">:=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span><span class="p">))</span> <span class="o">*</span> <span class="n">fDistanceZ</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;</span>
            <span class="o">//</span> <span class="n">Enable</span> <span class="n">Relative</span> <span class="n">Motion</span> <span class="n">Act</span>
            <span class="n">bEnableMoveRelative</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">Done</span><span class="o">.</span> <span class="ow">and</span> <span class="n">wait</span> <span class="n">tilt</span> <span class="n">sensor</span> <span class="n">stabilization</span><span class="o">.</span>
        <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bEnableMoveRelative</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
        <span class="n">IF</span> <span class="n">tonWaitToStabilize</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">5</span><span class="p">:</span>
        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Iteration</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">End</span>
            <span class="n">bEnableAdjustingPitch</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepAdjustingPitch</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bEnableAdjustingPitch</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepAdjustingPitch</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_6_AdjustingHeight</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepAdjustingHeight</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableAdjustingHeight</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Step1</span> <span class="n">read</span> <span class="ow">and</span> <span class="n">apply</span> <span class="n">gauge</span> <span class="n">value</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">done</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bEnableSetGaugeValue</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step3</span> <span class="n">calcurate</span> <span class="n">motion</span> <span class="n">distance</span>
        <span class="o">//</span> <span class="n">read</span> <span class="n">latest</span> <span class="n">status</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">ReadStatus</span><span class="p">();</span>

        <span class="o">//</span> <span class="n">Need</span> <span class="n">to</span> <span class="n">move</span> <span class="n">YDF</span> <span class="mi">1</span><span class="o">~</span><span class="mi">3</span>
        <span class="n">fTargetPos_M15</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;</span>
        <span class="n">fTargetPos_M16</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;</span>
        <span class="n">fTargetPos_M17</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">REAL_TO_LREAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">;</span>
        <span class="o">//</span> <span class="n">Enable</span> <span class="n">Relative</span> <span class="n">Motion</span> <span class="n">Act</span>
        <span class="n">bEnableMoveRelative</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>

    <span class="mi">4</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">Done</span><span class="o">.</span> <span class="ow">and</span> <span class="n">wait</span> <span class="n">tilt</span> <span class="n">sensor</span> <span class="n">stabilization</span><span class="o">.</span>
        <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bEnableMoveRelative</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
        <span class="n">IF</span> <span class="n">tonWaitToStabilize</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">5</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">check</span> <span class="n">pitch</span> <span class="ow">and</span> <span class="n">roll</span> <span class="p">(</span><span class="k">if</span> <span class="n">some</span> <span class="n">axis</span> <span class="ow">is</span> <span class="n">step</span><span class="o">-</span><span class="n">out</span><span class="p">)</span>
        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="n">OR</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="n">THEN</span>
            <span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>

        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">bError</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Iteration</span>
            <span class="n">bEnableAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">End</span>
            <span class="n">bEnableAdjustingHeight</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepAdjustingHeight</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bEnableAdjustingHeight</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepAdjustingHeight</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_INIT</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bINIT</span> <span class="n">THEN</span>
    <span class="n">bINIT</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Read</span> <span class="n">linear</span> <span class="n">gauge</span> <span class="n">value</span>
    <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_MoveRelative</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepMoveRelative</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableMoveRelative</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">bBusy</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">bEnableMotion</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">bDone_M15</span> <span class="o">:=</span> <span class="n">bDone_M16</span> <span class="o">:=</span> <span class="n">bDone_M17</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepMoveRelative</span><span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableMoveRelative</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="n">Execute</span> <span class="n">motion</span>
        <span class="n">IF</span> <span class="n">fbMoveRelative_M15</span><span class="o">.</span><span class="n">Error</span> <span class="n">OR</span> <span class="n">fbMoveRelative_M16</span><span class="o">.</span><span class="n">Error</span> <span class="n">OR</span> <span class="n">fbMoveRelative_M17</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
            <span class="n">iStepMoveRelative</span><span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">bError</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>

        <span class="n">IF</span> <span class="p">(</span><span class="n">bDone_M15</span> <span class="n">AND</span> <span class="n">bDone_M16</span> <span class="n">AND</span> <span class="n">bDone_M17</span><span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">fbMoveRelative_M15</span><span class="o">.</span><span class="n">Execute</span> <span class="n">OR</span> <span class="n">fbMoveRelative_M16</span><span class="o">.</span><span class="n">Execute</span> <span class="n">OR</span> <span class="n">fbMoveRelative_M17</span><span class="o">.</span><span class="n">Execute</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">iStepMoveRelative</span><span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>

        <span class="n">IF</span> <span class="n">fbMoveRelative_M15</span><span class="o">.</span><span class="n">Done</span> <span class="n">THEN</span>
            <span class="n">bDone_M15</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
        <span class="n">IF</span> <span class="n">fbMoveRelative_M16</span><span class="o">.</span><span class="n">Done</span> <span class="n">THEN</span>
            <span class="n">bDone_M16</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
        <span class="n">IF</span> <span class="n">fbMoveRelative_M17</span><span class="o">.</span><span class="n">Done</span> <span class="n">THEN</span>
            <span class="n">bDone_M17</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>

        <span class="n">fbMoveRelative_M15</span><span class="p">(</span> <span class="n">Axis</span>            <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                            <span class="n">Execute</span>         <span class="o">:=</span> <span class="n">bEnableMotion</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bDone_M15</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">),</span>
                            <span class="n">Distance</span>        <span class="o">:=</span> <span class="n">fTargetPos_M15</span><span class="p">,</span>
                            <span class="n">Velocity</span>        <span class="o">:=</span> <span class="mf">0.05</span><span class="p">,</span>
                            <span class="n">Acceleration</span><span class="o">:=</span> <span class="mf">0.8</span><span class="p">,</span>
                            <span class="n">Deceleration</span><span class="o">:=</span> <span class="mf">0.8</span><span class="p">,</span>
                            <span class="n">Jerk</span>            <span class="o">:=</span> <span class="mi">32</span>
        <span class="p">);</span>
        <span class="n">fbMoveRelative_M16</span><span class="p">(</span> <span class="n">Axis</span>            <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                            <span class="n">Execute</span>         <span class="o">:=</span> <span class="n">bEnableMotion</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bDone_M16</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">),</span>
                            <span class="n">Distance</span>        <span class="o">:=</span> <span class="n">fTargetPos_M16</span><span class="p">,</span>
                            <span class="n">Velocity</span>        <span class="o">:=</span> <span class="mf">0.05</span><span class="p">,</span>
                            <span class="n">Acceleration</span><span class="o">:=</span> <span class="mf">0.8</span><span class="p">,</span>
                            <span class="n">Deceleration</span><span class="o">:=</span> <span class="mf">0.8</span><span class="p">,</span>
                            <span class="n">Jerk</span>            <span class="o">:=</span> <span class="mi">32</span>
        <span class="p">);</span>
        <span class="n">fbMoveRelative_M17</span><span class="p">(</span> <span class="n">Axis</span>            <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                            <span class="n">Execute</span>         <span class="o">:=</span> <span class="n">bEnableMotion</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bDone_M17</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">),</span>
                            <span class="n">Distance</span>        <span class="o">:=</span> <span class="n">fTargetPos_M17</span><span class="p">,</span>
                            <span class="n">Velocity</span>        <span class="o">:=</span> <span class="mf">0.05</span><span class="p">,</span>
                            <span class="n">Acceleration</span><span class="o">:=</span> <span class="mf">0.8</span><span class="p">,</span>
                            <span class="n">Deceleration</span><span class="o">:=</span> <span class="mf">0.8</span><span class="p">,</span>
                            <span class="n">Jerk</span>            <span class="o">:=</span> <span class="mi">32</span>
        <span class="p">);</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">End</span>
        <span class="n">bEnableMotion</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bEnableMoveRelative</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepMoveRelative</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">fbMoveRelative_M15</span><span class="o">.</span><span class="n">Execute</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbMoveRelative_M16</span><span class="o">.</span><span class="n">Execute</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbMoveRelative_M17</span><span class="o">.</span><span class="n">Execute</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bEnableMotion</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bEnableMoveRelative</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepMoveRelative</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_ResetError</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bResetError</span> <span class="n">THEN</span>
    <span class="n">bResetError</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bError</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableMotion</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableMotion_M15</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableMotion_M16</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableMotion_M17</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableMoveRelative</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">bDone_M15</span> <span class="o">:=</span> <span class="n">bDone_M16</span> <span class="o">:=</span> <span class="n">bDone_M17</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepSetGaugeValue</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepMoveRelative</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_SetGaugeValue</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepSetGaugeValue</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableSetGaugeValue</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">fTargetPos_M15</span> <span class="o">:=</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fValue</span><span class="p">;</span>
            <span class="n">fTargetPos_M16</span> <span class="o">:=</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">fValue</span><span class="p">;</span>
            <span class="n">fTargetPos_M17</span> <span class="o">:=</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">fValue</span><span class="p">;</span>

            <span class="n">iStepSetGaugeValue</span><span class="o">:=</span><span class="mi">2</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="n">fbSetPosition_M15</span><span class="p">(</span>  <span class="n">Axis</span> <span class="o">:=</span>         <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                            <span class="n">Execute</span> <span class="o">:=</span>      <span class="n">NOT</span> <span class="n">fbSetPosition_M15</span><span class="o">.</span><span class="n">Done</span><span class="p">,</span>
                            <span class="n">Position</span> <span class="o">:=</span>     <span class="n">fTargetPos_M15</span>
        <span class="p">);</span>

        <span class="n">fbSetPosition_M16</span><span class="p">(</span>  <span class="n">Axis</span> <span class="o">:=</span>         <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                            <span class="n">Execute</span> <span class="o">:=</span>      <span class="n">NOT</span> <span class="n">fbSetPosition_M16</span><span class="o">.</span><span class="n">Done</span><span class="p">,</span>
                            <span class="n">Position</span> <span class="o">:=</span>     <span class="n">fTargetPos_M16</span>
        <span class="p">);</span>

        <span class="n">fbSetPosition_M17</span><span class="p">(</span>  <span class="n">Axis</span> <span class="o">:=</span>         <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                            <span class="n">Execute</span> <span class="o">:=</span>      <span class="n">NOT</span> <span class="n">fbSetPosition_M17</span><span class="o">.</span><span class="n">Done</span><span class="p">,</span>
                            <span class="n">Position</span> <span class="o">:=</span>     <span class="n">fTargetPos_M17</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">fbSetPosition_M15</span><span class="o">.</span><span class="n">Done</span> <span class="n">OR</span> <span class="n">fbSetPosition_M15</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
            <span class="n">fbSetPosition_M15</span><span class="p">(</span>      <span class="n">Axis</span> <span class="o">:=</span>         <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                                <span class="n">Execute</span> <span class="o">:=</span>  <span class="n">FALSE</span>
            <span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>
        <span class="n">IF</span> <span class="n">fbSetPosition_M16</span><span class="o">.</span><span class="n">Done</span> <span class="n">OR</span> <span class="n">fbSetPosition_M16</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
            <span class="n">fbSetPosition_M16</span><span class="p">(</span>      <span class="n">Axis</span> <span class="o">:=</span>         <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                                <span class="n">Execute</span> <span class="o">:=</span>  <span class="n">FALSE</span>
            <span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>
        <span class="n">IF</span> <span class="n">fbSetPosition_M17</span><span class="o">.</span><span class="n">Done</span> <span class="n">OR</span> <span class="n">fbSetPosition_M17</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
            <span class="n">fbSetPosition_M17</span><span class="p">(</span>      <span class="n">Axis</span> <span class="o">:=</span>         <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
                                <span class="n">Execute</span> <span class="o">:=</span>  <span class="n">FALSE</span>
            <span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>

        <span class="n">IF</span> <span class="n">NOT</span><span class="p">(</span><span class="n">fbSetPosition_M15</span><span class="o">.</span><span class="n">Execute</span> <span class="n">OR</span> <span class="n">fbSetPosition_M16</span><span class="o">.</span><span class="n">Execute</span> <span class="n">OR</span> <span class="n">fbSetPosition_M17</span><span class="o">.</span><span class="n">Execute</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">iStepSetGaugeValue</span><span class="o">:=</span><span class="mi">3</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>

    <span class="mi">3</span><span class="p">:</span>
        <span class="n">bEnableSetGaugeValue</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepSetGaugeValue</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-slit">
<h2>PRG_DET_SLIT<a class="headerlink" href="#prg-det-slit" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_SLIT</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL&#39;</span><span class="p">}</span>
    <span class="n">fbSlits_Det</span><span class="p">:</span> <span class="n">FB_Slits</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bMoveOk</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bInit</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="mi">4</span> <span class="n">jaws</span> <span class="n">slit</span>


<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


    <span class="o">//</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">fbSlits_Det</span><span class="p">(</span>        <span class="n">i_DevName</span><span class="o">:=</span>                                     <span class="s1">&#39;DET_SLITS&#39;</span><span class="p">,</span>
                <span class="n">stTopBlade</span><span class="o">:=</span>                                <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="p">,</span>
                <span class="n">stBottomBlade</span><span class="o">:=</span>                             <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="p">,</span>
                <span class="n">stLeftBlade</span><span class="o">:=</span>                               <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="p">,</span>
                <span class="n">stRightBlade</span><span class="o">:=</span>                              <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="p">,</span>
                <span class="n">io_fbFFHWO</span><span class="o">:=</span>                                <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">,</span>
                <span class="n">fbArbiter</span><span class="o">:=</span>                                 <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
                <span class="n">bExecuteMotion</span><span class="o">:=</span>                    <span class="n">bExecuteMotion</span><span class="p">,</span>
                <span class="n">bMoveOk</span><span class="o">:=</span>                                   <span class="n">bMoveOk</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-slits">FB_Slits</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-diffractometer">
<h2>PRG_Diffractometer<a class="headerlink" href="#prg-diffractometer" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Diffractometer</span>
<span class="n">VAR</span>
    <span class="n">fb_Diff_Theta</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_2Theta</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_2ThetaY</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Chi</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Phi</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span><span class="n">EPS</span>
    <span class="n">stEPS_Diff_Z</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Z</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">stEPS_Diff_Chi</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Chi</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">stEPS_Diff_Phi</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Phi</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">stEPS_Diff_Theta</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Theta</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">stEPS_Diff_2Theta</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_2Theta</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">stEPS_Diff_2ThetaY</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_2ThetaY</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Encoders</span> <span class="k">for</span> <span class="n">rotary</span> <span class="n">stages</span>
    <span class="n">fbSetPosition</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fb2ThetaAutoCoupling</span><span class="p">:</span> <span class="n">FB_GantryAutoCoupling</span><span class="p">;</span>
    <span class="n">couple</span> <span class="p">:</span> <span class="n">MC_GEARIN</span><span class="p">;</span>
    <span class="n">decouple</span> <span class="p">:</span> <span class="n">MC_GEAROUT</span><span class="p">;</span>
    <span class="n">bExecuteCouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bExecuteDecouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">n2Theta</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span><span class="n">ULINT</span><span class="p">;</span>
    <span class="n">r2Theta</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">temp</span><span class="p">:</span><span class="n">ULINT</span><span class="p">;</span>
    <span class="n">rtemp</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">GantryDiff</span><span class="p">:</span><span class="n">REAL</span><span class="p">;</span>

    <span class="n">fb_Diff_2Theta_Encoder</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

<span class="n">END_IF</span>

<span class="o">//</span><span class="n">EPS</span>
<span class="p">(</span><span class="o">*</span>
<span class="n">EPS_Diff_Z</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;Less20mm;LAS_D_H&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Z</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_Diff_Z</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;=-</span><span class="mi">20</span><span class="p">);</span>
<span class="n">EPS_Diff_Z</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">PRG_LAS</span><span class="o">.</span><span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;=</span><span class="mi">50</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Z</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;=-</span><span class="mi">20</span><span class="p">);</span>
<span class="n">EPS_Diff_Z</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stEPS_Diff_Z</span><span class="p">);</span>
<span class="n">fb_Diff_Z</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span> <span class="o">:=</span> <span class="n">stEPS_Diff_Z</span><span class="p">;</span>

<span class="n">EPS_Diff_Chi</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;Less-5mm;Theta&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Chi</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_Diff_Chi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;-</span><span class="mi">5</span><span class="p">);</span>
<span class="n">EPS_Diff_Chi</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mi">5</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Chi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;-</span><span class="mi">5</span><span class="p">);</span>
<span class="n">EPS_Diff_Chi</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stEPS_Diff_Chi</span><span class="p">);</span>
<span class="n">fb_Diff_Chi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span> <span class="o">:=</span> <span class="n">stEPS_Diff_Chi</span><span class="p">;</span>

<span class="n">EPS_Diff_Theta</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;CHI;PHI;MIDIT&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Theta</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;=</span><span class="mi">5</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Chi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;-</span><span class="mi">5</span><span class="p">);</span>
<span class="n">EPS_Diff_Theta</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mi">10</span> <span class="n">OR</span> <span class="p">(</span><span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&lt;</span><span class="mf">90.1</span> <span class="n">AND</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mf">89.9</span><span class="p">))</span> <span class="p">;</span>
<span class="n">EPS_Diff_Theta</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mi">10</span> <span class="n">OR</span> <span class="p">(</span><span class="n">PRG_LAS</span><span class="o">.</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&lt;</span><span class="mf">90.1</span> <span class="n">AND</span> <span class="n">PRG_LAS</span><span class="o">.</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mf">89.9</span><span class="p">));</span>
<span class="n">EPS_Diff_Theta</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stEPS_Diff_Theta</span><span class="p">);</span>
<span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span> <span class="o">:=</span> <span class="n">stEPS_Diff_Theta</span><span class="p">;</span> <span class="o">//</span><span class="n">Need</span> <span class="n">More</span>

<span class="n">EPS_Diff_Phi</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;Less-45;MID_IR;Theta&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Phi</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_Diff_phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">45</span><span class="p">);</span>
<span class="n">EPS_Diff_Phi</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">PRG_LAS</span><span class="o">.</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&lt;</span><span class="mi">45</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">45</span><span class="p">);</span>
<span class="n">EPS_Diff_Phi</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">45</span> <span class="n">OR</span> <span class="p">(</span><span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&lt;</span><span class="mf">0.1</span> <span class="n">AND</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mf">359.5</span><span class="p">));</span>
<span class="n">EPS_Diff_Phi</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stEPS_Diff_Phi</span><span class="p">);</span>
<span class="n">FB_Diff_Phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span> <span class="o">:=</span> <span class="n">stEPS_Diff_Phi</span><span class="p">;</span>
<span class="o">*</span><span class="p">)</span>



<span class="n">fb_Diff_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="p">);</span>
<span class="n">fb_Diff_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="p">);</span>
<span class="n">fb_Diff_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="p">);</span>
<span class="n">fb_Diff_2ThetaY</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="p">);</span>
<span class="n">fb_Diff_Phi</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="p">);</span>
<span class="n">fb_Diff_Chi</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="p">);</span>
<span class="n">fb_Diff_Theta</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">);</span>
<span class="n">fb_Diff_2Theta</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-las">PRG_LAS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-las">
<h2>PRG_LAS<a class="headerlink" href="#prg-las" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_LAS</span>
<span class="n">VAR</span>
    <span class="n">fb_LAS_VIS</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_LAS_D_H</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_LAS_D_V</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span><span class="n">EPS</span>
    <span class="n">stLAS_VIS</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">fbLAS_VIS_EPS</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">stLAS_D_H</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">fbLAS_D_H_EPS</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

<span class="n">END_IF</span>
<span class="o">//</span><span class="n">EPS</span>
<span class="p">(</span><span class="o">*</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;Less10mm;SampleZ;PHI&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span><span class="n">Zero</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">retracted</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">10</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Z</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=-</span><span class="mi">20</span><span class="p">);</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">10</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">);</span>
<span class="n">fbLAS_D_H_EPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stLAS_D_H</span><span class="p">);</span>
<span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSForwardEnable</span> <span class="o">:=</span> <span class="n">stLAS_D_H</span><span class="p">;</span> <span class="o">//</span> <span class="n">Update</span> <span class="n">Motion</span> <span class="n">stage</span> <span class="n">structure</span><span class="o">.</span>

<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;IN90mm;PHIat90;Theta&lt;10&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span><span class="n">Zero</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">retracted</span>
<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">);</span>
<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">5</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;&gt;</span><span class="mi">90</span><span class="p">);</span>
<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">5</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">);</span>
<span class="n">fbLAS_VIS_EPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">fbLAS_VIS_EPS</span><span class="p">);</span>
<span class="o">//</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSForwardEnable</span> <span class="o">:=</span> <span class="n">fbLAS_VIS_EPS</span><span class="p">;</span>
<span class="o">*</span><span class="p">)</span>


<span class="n">fb_LAS_VIS</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="p">);</span>
<span class="n">fb_LAS_D_H</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="p">);</span>
<span class="n">fb_LAS_D_V</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-diffractometer">PRG_Diffractometer</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt">
<h2>PRG_OPT<a class="headerlink" href="#prg-opt" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_OPT</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbMotionRxG</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionXG</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionRzPM</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">Lock</span> <span class="n">stages</span> <span class="n">until</span> <span class="n">they</span> <span class="n">are</span> <span class="n">tested</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>

<span class="n">IF</span> <span class="n">bINIT</span> <span class="n">THEN</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>

    <span class="n">bINIT</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>


<span class="n">fbMotionRxG</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="p">);</span>
<span class="n">fbMotionXG</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="p">);</span>
<span class="n">fbMotionRzPM</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt-slits">
<h2>PRG_OPT_SLITS<a class="headerlink" href="#prg-opt-slits" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_OPT_SLITS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL&#39;</span><span class="p">}</span>
    <span class="n">fbSlits_Opt</span><span class="p">:</span> <span class="n">FB_Slits</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bMoveOk</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bInit</span><span class="p">:</span><span class="n">BOOl</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="mi">4</span> <span class="n">jaws</span> <span class="n">slit</span>



<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


    <span class="o">//</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>



<span class="n">fbSlits_Opt</span><span class="p">(</span>        <span class="n">i_DevName</span><span class="o">:=</span>                                     <span class="s1">&#39;OPT_SLITS&#39;</span><span class="p">,</span>
                <span class="n">stTopBlade</span><span class="o">:=</span>                                <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="p">,</span>
                <span class="n">stBottomBlade</span><span class="o">:=</span>                             <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="p">,</span>
                <span class="n">stLeftBlade</span><span class="o">:=</span>                               <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="p">,</span>
                <span class="n">stRightBlade</span><span class="o">:=</span>                              <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="p">,</span>
                <span class="n">io_fbFFHWO</span><span class="o">:=</span>                                <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">,</span>
                <span class="n">fbArbiter</span><span class="o">:=</span>                                 <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
                <span class="n">bExecuteMotion</span><span class="o">:=</span>                    <span class="n">bExecuteMotion</span><span class="p">,</span>
                <span class="n">bMoveOk</span><span class="o">:=</span>                                   <span class="n">bMoveOk</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-slits">FB_Slits</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt-xpm">
<h2>PRG_OPT_XPM<a class="headerlink" href="#prg-opt-xpm" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_OPT_XPM</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:PM&#39;</span><span class="p">}</span>
    <span class="n">fb2AxesXPM</span><span class="p">:</span> <span class="n">FB_2AxesTrans</span><span class="p">;</span>
    <span class="n">bExecuteMotionXPM</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bMoveOkXPM</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span> <span class="n">CONSTANT</span>
    <span class="n">rDistance</span>       <span class="p">:</span><span class="n">REAL</span>   <span class="o">:=</span>      <span class="mf">0.4</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">Lock</span> <span class="n">stages</span> <span class="n">until</span> <span class="n">they</span> <span class="n">are</span> <span class="n">tested</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>


<span class="n">IF</span> <span class="n">bINIT</span> <span class="n">THEN</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

        <span class="o">//</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>

    <span class="n">bINIT</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="n">fb2AxesXPM</span><span class="p">(</span> <span class="n">i_DevName</span>               <span class="o">:=</span>      <span class="s1">&#39;OPT_XPM&#39;</span><span class="p">,</span>
            <span class="n">stFirstAxis</span>             <span class="o">:=</span>      <span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="p">,</span>
            <span class="n">stSecondAxis</span>    <span class="o">:=</span>      <span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="p">,</span>
            <span class="n">bExecuteMotion</span>  <span class="o">:=</span>      <span class="n">bExecuteMotionXPM</span><span class="p">,</span>
            <span class="n">io_fbFFHWO</span>              <span class="o">:=</span>      <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">,</span>
            <span class="n">fbArbiter</span>               <span class="o">:=</span>      <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
            <span class="n">rDistance</span>               <span class="o">:=</span>      <span class="n">rDistance</span><span class="p">,</span><span class="o">//</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">//</span> <span class="mf">0.4</span><span class="n">m</span>
            <span class="n">bMoveOk</span>                 <span class="o">:=</span> <span class="n">bMoveOkXPM</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-2axestrans">FB_2AxesTrans</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt-yg">
<h2>PRG_OPT_YG<a class="headerlink" href="#prg-opt-yg" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_OPT_YG</span>
<span class="n">VAR</span>
    <span class="n">bDebug</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bMoveOk</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT&#39;</span><span class="p">}</span>
    <span class="n">fbYGMotion</span><span class="p">:</span> <span class="n">FB_3AxesJack</span><span class="p">;</span>

    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">Lock</span> <span class="n">stages</span> <span class="n">until</span> <span class="n">they</span> <span class="n">are</span> <span class="n">tested</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>



<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>


    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


    <span class="o">//</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>



<span class="n">fbYGMotion</span><span class="p">(</span>
    <span class="n">bExecuteMotion</span>  <span class="o">:=</span> <span class="n">bExecuteMotion</span><span class="p">,</span>
    <span class="n">bMoveOk</span>                 <span class="o">:=</span> <span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stJack1Axis</span>             <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="p">,</span>
    <span class="n">stJack2Axis</span>             <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="p">,</span>
    <span class="n">stJack3Axis</span>             <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="p">,</span>
    <span class="n">i_DevName</span>               <span class="o">:=</span> <span class="s1">&#39;OPT_YG&#39;</span><span class="p">,</span>
    <span class="n">io_fbFFHWO</span>              <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">,</span>
    <span class="n">fbArbiter</span>               <span class="o">:=</span> <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-3axesjack">FB_3AxesJack</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-questar">
<h2>PRG_Questar<a class="headerlink" href="#prg-questar" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_Questar
VAR
    fb_Ques_01 : FB_MotionStage;
    fb_Ques_02: FB_MotionStage;
    bInit : BOOl := TRUE;
END_VAR
IF ( bInit) THEN
    bInit := FALSE;
    Main.M17.bHardwareEnable := TRUE;
    Main.M17.bPowerSelf := TRUE;
    Main.M17.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M17.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M18.bHardwareEnable := TRUE;
    Main.M18.bPowerSelf := TRUE;
    Main.M18.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M18.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;


END_IF
//EPS??


fb_Ques_01(stMotionStage:=Main.M17);
fb_Ques_02(stMotionStage:=Main.M18);

END_PROGRAM
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-rotdet">
<h2>PRG_RotDet<a class="headerlink" href="#prg-rotdet" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_RotDet</span>
<span class="n">VAR</span>
    <span class="n">fb_Rot_Det</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
   <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fb_Rot_Det</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sds">
<h2>PRG_SDS<a class="headerlink" href="#prg-sds" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_SDS
VAR
    fb_SDS_ROT_V : FB_MotionStage;
    fb_SDS_X : FB_MotionStage;
    fb_SDS_Y : FB_MotionStage;
    fb_SDS_Z : FB_MotionStage;
    fb_SDS_ROT_H : FB_MotionStage;
    fb_SDS_H : FB_MotionStage;
    bInit : BOOl := TRUE;
END_VAR
IF ( bInit) THEN
    bInit := FALSE;
    Main.M39.bHardwareEnable := TRUE;
    Main.M39.bPowerSelf := TRUE;
    Main.M39.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M39.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M40.bHardwareEnable := TRUE;
    Main.M40.bPowerSelf := TRUE;
    Main.M40.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M40.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M41.bHardwareEnable := TRUE;
    Main.M41.bPowerSelf := TRUE;
    Main.M41.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M41.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M42.bHardwareEnable := TRUE;
    Main.M42.bPowerSelf := TRUE;
    Main.M42.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M42.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;
    Main.M42.bLimitBackwardEnable := TRUE;
    Main.M42.bLimitForwardEnable := TRUE;

    Main.M43.bHardwareEnable := TRUE;
    Main.M43.bPowerSelf := TRUE;
    Main.M43.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M43.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

    Main.M44.bHardwareEnable := TRUE;
    Main.M44.bPowerSelf := TRUE;
    Main.M44.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M44.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

END_IF
//EPS??

fb_SDS_X(stMotionStage:=Main.M39);
fb_SDS_Y(stMotionStage:=Main.M40);
fb_SDS_Z(stMotionStage:=Main.M41);
fb_SDS_ROT_V(stMotionStage:=Main.M42);
fb_SDS_ROT_H(stMotionStage:=Main.M43);
fb_SDS_H(stMotionStage:=Main.M44);

END_PROGRAM
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sensor">
<h2>PRG_Sensor<a class="headerlink" href="#prg-sensor" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Sensor</span>
<span class="n">VAR</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(Out) RxPDO-Map^Head Value Mode&#39;</span><span class="p">}</span>
    <span class="n">bSensorHeadValueMode</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(Out) RxPDO-Map^Normal Value Mode&#39;</span><span class="p">}</span>
    <span class="n">bSensorHeadNormalValueMode</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>

    <span class="n">bResetSensorMode</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>

    <span class="n">uintTest</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">If</span> <span class="n">bInit</span> <span class="n">Then</span>
    <span class="n">bSensorHeadNormalValueMode</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
<span class="n">End_If</span><span class="p">;</span>

<span class="n">If</span><span class="p">(</span><span class="n">bResetSensorMode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="n">Then</span>
    <span class="n">bResetSensorMode</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">bSensorHeadValueMode</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">bSensorHeadNormalValueMode</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
<span class="n">End_If</span><span class="p">;</span>


<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">sName</span>                     <span class="o">:=</span> <span class="s1">&#39;YDF1 Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">sEGU</span>                      <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fCntsInEGU</span>        <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">sName</span>                     <span class="o">:=</span> <span class="s1">&#39;YDF2 Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">sEGU</span>                      <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">fCntsInEGU</span>        <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">sName</span>                     <span class="o">:=</span> <span class="s1">&#39;YDF3 Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">sEGU</span>                      <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">fCntsInEGU</span>        <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;HDF Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">sName</span>         <span class="o">:=</span> <span class="s1">&#39;Granite Pitch&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">sEGU</span>          <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span> <span class="o">//</span> <span class="mi">1</span><span class="n">V</span> <span class="o">=</span> <span class="mi">1</span><span class="n">mrad</span> <span class="ow">in</span> <span class="n">Low</span> <span class="n">gain</span> <span class="n">mode</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">iOffset</span>   <span class="o">:=</span> <span class="o">-</span><span class="mi">1005</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">sName</span>         <span class="o">:=</span> <span class="s1">&#39;Granite Roll&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">sEGU</span>          <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">iOffset</span>   <span class="o">:=</span> <span class="mi">3326</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">sName</span>           <span class="o">:=</span> <span class="s1">&#39;Det. Frame Pitch&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">sEGU</span>            <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fCntsInEGU</span>      <span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">sName</span>           <span class="o">:=</span> <span class="s1">&#39;Det. Frame Roll&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">sEGU</span>            <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fCntsInEGU</span>      <span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;PS1&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;MPa&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mf">13106.8</span><span class="p">;</span>     <span class="o">//</span> <span class="mf">0.25</span><span class="n">MPa</span><span class="o">/</span><span class="n">V</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">iOffset</span>            <span class="o">:=</span> <span class="mi">3277</span><span class="p">;</span>        <span class="o">//</span> <span class="mi">0</span><span class="n">MPa</span><span class="o">@</span><span class="mi">1</span><span class="n">V</span>  <span class="n">P</span><span class="o">=</span><span class="mf">0.25</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">V0</span><span class="p">),</span> <span class="n">V0</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;PS2&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;MPa&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mf">13106.8</span><span class="p">;</span>     <span class="o">//</span> <span class="mf">0.25</span><span class="n">MPa</span><span class="o">/</span><span class="n">V</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">iOffset</span>            <span class="o">:=</span> <span class="mi">3277</span><span class="p">;</span>        <span class="o">//</span> <span class="mi">0</span><span class="n">MPa</span><span class="o">@</span><span class="mi">1</span><span class="n">V</span>  <span class="n">P</span><span class="o">=</span><span class="mf">0.25</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">V0</span><span class="p">),</span> <span class="n">V0</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;PS3&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;MPa&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mf">13106.8</span><span class="p">;</span>     <span class="o">//</span> <span class="mf">0.25</span><span class="n">MPa</span><span class="o">/</span><span class="n">V</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">iOffset</span>            <span class="o">:=</span> <span class="mi">3277</span><span class="p">;</span>        <span class="o">//</span> <span class="mi">0</span><span class="n">MPa</span><span class="o">@</span><span class="mi">1</span><span class="n">V</span>  <span class="n">P</span><span class="o">=</span><span class="mf">0.25</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">V0</span><span class="p">),</span> <span class="n">V0</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fValue</span>            <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">fValue</span>            <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">fValue</span>            <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">iRawCnts</span>  <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span>  <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">fValue</span>        <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">fValue</span>        <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span>          <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span>          <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>


<span class="o">//</span><span class="n">uintTest</span><span class="o">:=</span> <span class="n">REAL_TO_UINT</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fValue</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-spetrometerarm">
<h2>PRG_SpetrometerArm<a class="headerlink" href="#prg-spetrometerarm" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SpetrometerArm</span>
<span class="n">VAR</span>
        <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-01 Coupler (EK1100)]^Rack#1A-02 SFIN (EL1918)^StandardOutputs^Standard In Var 2&#39;</span><span class="p">}</span>
    <span class="n">bEnaIclk</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-01 Coupler (EK1100)]^Rack#1A-02 SFIN (EL1918)^StandardOutputs^Standard In Var 1&#39;</span><span class="p">}</span>
    <span class="n">bEnaIclkErrAck</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-01 Coupler (EK1100)]^Rack#1A-02 SFIN (EL1918)^StandardOutputs^Standard In Var 9&#39;</span><span class="p">}</span>
    <span class="n">bEnaIclkRestartESTOP</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">fbPower_AxisM11</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM12</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM13</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM14</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">ACT_ESTOP</span><span class="p">();</span>

<span class="n">PRG_2Theta</span><span class="p">();</span>
<span class="n">PRG_DET_ARM</span><span class="p">();</span>
<span class="n">PRG_DET_CHAMBER</span><span class="p">();</span>
<span class="n">PRG_DET_SLIT</span><span class="p">();</span>
<span class="n">PRG_DET_FRAME</span><span class="p">();</span>
<span class="n">PRG_OPT_SLITS</span><span class="p">();</span>
<span class="n">PRG_OPT_YG</span><span class="p">();</span>
<span class="n">PRG_OPT_XPM</span><span class="p">();</span>
<span class="n">PRG_OPT</span><span class="p">();</span>
<span class="n">PRG_Sensor</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">ACT_ESTOP</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bEnaIclkErrAck</span> <span class="n">THEN</span>
    <span class="n">bEnaIclkErrAck</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">bEnaIclkRestartESTOP</span> <span class="n">THEN</span>
    <span class="n">bEnaIclkRestartESTOP</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">When</span> <span class="n">user</span> <span class="n">push</span> <span class="n">the</span> <span class="n">ESTOPs</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span> <span class="n">THEN</span>

    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span> <span class="n">Disable</span> <span class="n">M1</span><span class="p">(</span><span class="n">Servo</span><span class="p">)</span> <span class="ow">and</span> <span class="n">M2</span><span class="p">(</span><span class="n">Stepper</span><span class="p">)</span> <span class="k">if</span> <span class="n">the</span> <span class="n">frame</span> <span class="ow">is</span> <span class="n">landing</span><span class="o">...</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">bFloating</span> <span class="n">THEN</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span> <span class="n">When</span> <span class="n">user</span> <span class="n">requests</span> <span class="n">to</span> <span class="n">reset</span> <span class="n">ESTOP</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bResetIclk</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bResetIclk</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnaIclkErrAck</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bEnaIclkRestartESTOP</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-2theta">PRG_2Theta</a></p></li>
<li><p><a class="reference internal" href="#prg-det-arm">PRG_DET_ARM</a></p></li>
<li><p><a class="reference internal" href="#prg-det-chamber">PRG_DET_CHAMBER</a></p></li>
<li><p><a class="reference internal" href="#prg-det-frame">PRG_DET_FRAME</a></p></li>
<li><p><a class="reference internal" href="#prg-det-slit">PRG_DET_SLIT</a></p></li>
<li><p><a class="reference internal" href="#prg-opt">PRG_OPT</a></p></li>
<li><p><a class="reference internal" href="#prg-opt-slits">PRG_OPT_SLITS</a></p></li>
<li><p><a class="reference internal" href="#prg-opt-xpm">PRG_OPT_XPM</a></p></li>
<li><p><a class="reference internal" href="#prg-opt-yg">PRG_OPT_YG</a></p></li>
<li><p><a class="reference internal" href="#prg-sensor">PRG_Sensor</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-ssl">
<h2>PRG_SSL<a class="headerlink" href="#prg-ssl" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_SSL
VAR
    fb_SSL_Motor : FB_MotionStage;
    (*EPS Limit switches*)
    {attribute &#39;TcLinkTo&#39; := &#39;TIIB[EL1004_02_03]^Channel 2^Input&#39;}
    bLimitBackwardEnable AT %I* :BOOL;
    {attribute &#39;TcLinkTo&#39; := &#39;TIIB[EL1004_02_03]^Channel 3^Input&#39;}
    bLimitForwardEnable AT %I* :BOOL;
    {attribute &#39;pytmc&#39; := &#39;pv: QRIX:SPCA:COUPLED&#39;}

    bAlreadyCoupled :BOOL := FALSE;
    bExecuteCouple :BOOL := TRUE;
    // Current coupled motion difference
    nCurrGantryDiff : LINT;
    // Autocoupling  Axes
    couple : MC_GEARIN;
    bInitComplete : BOOL;
    bInit : BOOl := TRUE;
END_VAR

VAR CONSTANT
    // Encoder reference values in counts ???!!! degrees?!!
    // Enc Ref Vals from alignment
    nSSL_ENC_REF : ULINT := 16171800;
    nSPCA_ENC_REF : ULINT := 14866900;
    nGANTRY_TOLERANCE : LINT := 100; // default gantry tolerance in encoder counts = units???

END_VAR
IF ( bInit) THEN
    bInit := FALSE;
    Main.M1.bPowerSelf := TRUE;
    Main.M1.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M1.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;
END_IF
// couple axes

// Couple both axes
// Auto-coupling at init and auto-reset of coupling boolean
(*bExecuteCouple S= NOT bInitComplete;

bExecuteCouple R= couple.Busy OR bAlreadyCoupled;
couple (Master:= Main.M1.Axis,
        Slave:=Main.M25.Axis,
        Execute:=bExecuteCouple,
        RatioNumerator := 1,
        RatioDenominator :=1
);

bInitComplete S= bAlreadyCoupled;
nCurrGantryDiff := ((ULINT_TO_LINT(Main.M1.nRawEncoderULINT) - ULINT_TO_LINT(nSSL_ENC_REF)) - (ULINT_TO_LINT(Main.M25.nRawEncoderULINT) - ULINT_TO_LINT(nSSL_ENC_REF)));

*)
//EPS needs to be implemented and coupling of axes servo and wheel from spectometer arm
// hpw to recover from this situation?!
//Main.M1.bHardwareEnable := bLimitBackwardEnable AND bLimitForwardEnable AND (ABS(nCurrGantryDiff) &gt; nGANTRY_TOLERANCE); //Include STO from SPCA
//Main.M1.bHardwareEnable := bLimitBackwardEnable AND bLimitForwardEnable;
fb_SSL_Motor(stMotionStage:=Main.M1);

END_PROGRAM
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lcls-plc-qrix-motion_PLC_QRIX_MOT_epics.html" class="btn btn-neutral float-left" title="Data Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>