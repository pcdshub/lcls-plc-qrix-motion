

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DUTs &mdash; pcdshub/lcls-plc-qrix-motion  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/tree.css?v=837a00b9" />
      <link rel="stylesheet" type="text/css" href="_static/width.css?v=ab210c7a" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/docs-versions-menu.js?v=3d6a1aea"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Data Types" href="lcls-plc-qrix-motion_qrix_motion_epics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pcdshub/lcls-plc-qrix-motion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">lcls-plc-qrix-motion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_pragmas.html">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_nc.html">NC Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_ethercat.html">EtherCAT Terminals</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_boxes.html">Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_links.html">Links</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">qrix_motion</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_qrix_motion_summary.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_qrix_motion_summary.html#pragmas">Pragmas</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_qrix_motion_summary.html#libraries">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_qrix_motion_summary.html#symbols">Symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_qrix_motion_epics.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="lcls-plc-qrix-motion_qrix_motion_epics.html#database-records">Database Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DUTs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dut-sensor">DUT_Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dut-sensorhgs">DUT_SensorHGS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-diffstate">E_DiffState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-gantryenablestate">E_GantryEnableState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-multileadermotioncoupling">E_MultiLeaderMotionCoupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-realigncouplestate">E_RealignCoupleState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sampleslotstates">E_SampleSlotStates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdsfacestate">E_SDSFaceState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdsgaragerstates">E_SDSGarageRStates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdsgarageystates">E_SDSGarageYStates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdshomingstate">E_SDSHomingState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdsseqstate">E_SDSSeqState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdsstate">E_SDSState</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdssubstate">E_SDSSubstate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdstransferarmhstates">E_SDSTransferArmHStates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-sdstransferarmrstates">E_SDSTransferArmRStates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#enum-las-vis-states">ENUM_LAS_VIS_States</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-autorealigncouple">ST_AutoRealignCouple</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-boundedvalue">ST_BoundedValue</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-coordinategantryaxisenable">ST_CoordinateGantryAxisEnable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-diffractometerslot">ST_DiffractometerSlot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-garageslot">ST_GarageSlot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-multileadermotioncoupling">ST_MultiLeaderMotionCoupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-sampleslot">ST_SampleSlot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-sds">ST_SDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-sdspersistent">ST_SDSPersistent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-transferslot">ST_TransferSlot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#st-uiselect">ST_UISelect</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#gvls">GVLs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#global-version">Global_Version</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-eps">GVL_EPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-interface">GVL_Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gvl-var">GVL_VAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#main">Main</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#pous">POUs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#f-checkaxis">F_CheckAxis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-checkaxisgeq">F_CheckAxisGEQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-checkaxisgrt">F_CheckAxisGRT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-checkaxisleq">F_CheckAxisLEQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-checkaxisles">F_CheckAxisLES</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-limit">F_Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-targetcryoyposition">F_TargetCryoYPosition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-2axestrans">FB_2AxesTrans</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-3axesjack">FB_3AxesJack</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-autorealigncouple">FB_AutoRealignCouple</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-coordinategantryaxisenable">FB_CoordinateGantryAxisEnable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-measurereferencevelocity">FB_MeasureReferenceVelocity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-multileadermotioncoupling">FB_MultiLeaderMotionCoupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-readcoe">FB_ReadCoE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-sds">FB_SDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fb-slits">FB_Slits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-1-plctask">PRG_1_PlcTask</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-2-pmps">PRG_2_PMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-2theta">PRG_2Theta</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-3-log">PRG_3_LOG</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-cryo">PRG_Cryo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-arm">PRG_DET_ARM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-chamber">PRG_DET_CHAMBER</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-frame">PRG_DET_FRAME</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-det-slit">PRG_DET_SLIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-diffractometer">PRG_Diffractometer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-las">PRG_LAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt">PRG_OPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt-slits">PRG_OPT_SLITS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt-xpm">PRG_OPT_XPM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-opt-yg">PRG_OPT_YG</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-questar">PRG_Questar</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-rotdet">PRG_RotDet</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sds">PRG_SDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-sensor">PRG_Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-spetrometerarm">PRG_SpetrometerArm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prg-ssl">PRG_SSL</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pcdshub/lcls-plc-qrix-motion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">DUTs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lcls-plc-qrix-motion_qrix_motion_source.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="duts">
<h1>DUTs<a class="headerlink" href="#duts" title="Link to this heading"></a></h1>
<section id="dut-sensor">
<h2>DUT_Sensor<a class="headerlink" href="#dut-sensor" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">DUT_Sensor</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">fCntsInEGU</span><span class="p">:</span>                     <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">EU</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">sEGU</span><span class="p">:</span>                           <span class="n">STRING</span><span class="p">;</span>
    <span class="n">sName</span><span class="p">:</span>                          <span class="n">STRING</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">VALUE</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">fValue</span><span class="p">:</span>                         <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">RAWCOUNTS</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">iRawCnts</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span>        <span class="n">INT</span><span class="p">;</span>
    <span class="n">iOffset</span><span class="p">:</span>                        <span class="n">INT</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#dut-sensor">DUT_Sensor</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="dut-sensorhgs">
<h2>DUT_SensorHGS<a class="headerlink" href="#dut-sensorhgs" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">DUT_SensorHGS</span><span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="n">fCntsInEGU</span><span class="p">:</span>                     <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">EU</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">sEGU</span><span class="p">:</span>                           <span class="n">STRING</span><span class="p">;</span>
    <span class="n">sName</span><span class="p">:</span>                          <span class="n">STRING</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">VALUE</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">fValue</span><span class="p">:</span>                         <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">RAWCOUNTS</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">iRawCnts</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span>        <span class="n">DINT</span><span class="p">;</span>
    <span class="n">iOffset</span><span class="p">:</span>                        <span class="n">DINT</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-diffstate">
<h2>E_DiffState<a class="headerlink" href="#e-diffstate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_DiffState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">NOMINAL_POSITION</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-gantryenablestate">
<h2>E_GantryEnableState<a class="headerlink" href="#e-gantryenablestate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_GantryEnableState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">STANDBY</span><span class="p">,</span>
    <span class="n">ERROR</span><span class="p">,</span>
    <span class="n">WAIT_FOR_FULLY_ENABLED</span><span class="p">,</span>
    <span class="n">WAIT_FOR_READY_STATE</span><span class="p">,</span>
    <span class="n">DELAY_FOR_MOVE_START</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-multileadermotioncoupling">
<h2>E_MultiLeaderMotionCoupling<a class="headerlink" href="#e-multileadermotioncoupling" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_MultiLeaderMotionCoupling</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">STATE_STANDBY</span><span class="p">,</span>
    <span class="n">STATE_WAIT_FOR_FOLLOWER_NOT_BUSY</span><span class="p">,</span>
    <span class="n">STATE_WAIT_FOR_FOLLOWER_ENABLED</span><span class="p">,</span>
    <span class="n">STATE_WAIT_FOR_FOLLOWER_READY</span><span class="p">,</span>
    <span class="n">STATE_ENABLE_EXTERNAL_SETPOINT_GENERATOR</span><span class="p">,</span>
    <span class="n">STATE_FOLLOWING_ACTIVE</span><span class="p">,</span>
    <span class="n">STATE_DISABLE_EXTERNAL_SETPOINT_GENERATOR</span><span class="p">,</span>
    <span class="n">STATE_ERROR</span><span class="p">,</span>
    <span class="n">STATE_MONITOR_TARGET_WINDOW</span><span class="p">,</span>
    <span class="n">STATE_HALT_MOTION</span>
<span class="p">)</span> <span class="n">UDINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-realigncouplestate">
<h2>E_RealignCoupleState<a class="headerlink" href="#e-realigncouplestate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_RealignCoupleState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">STANDBY</span><span class="p">,</span>
    <span class="n">DECOUPLE_AXES</span><span class="p">,</span>
    <span class="n">COMMAND_AXES_INTO_REALIGNMENT</span><span class="p">,</span>
    <span class="n">WAIT_FOR_MOVE_START</span><span class="p">,</span>
    <span class="n">RECOUPLE_AXES</span><span class="p">,</span>
    <span class="n">CLEANUP</span><span class="p">,</span>
    <span class="n">ERROR</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sampleslotstates">
<h2>E_SampleSlotStates<a class="headerlink" href="#e-sampleslotstates" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SampleSlotStates</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">EMPTY</span><span class="p">,</span>
    <span class="n">FULL</span><span class="p">,</span>
    <span class="n">DISABLED</span>
<span class="p">);</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdsfacestate">
<h2>E_SDSFaceState<a class="headerlink" href="#e-sdsfacestate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSFaceState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">FACE_TRANSFER_ARM</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">FACE_SIDE_PORT</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdsgaragerstates">
<h2>E_SDSGarageRStates<a class="headerlink" href="#e-sdsgaragerstates" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSGarageRStates</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">T1</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">T2</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">T3</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">T4</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">M1</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">M2</span> <span class="o">:=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">M3</span> <span class="o">:=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">M4</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">B1</span> <span class="o">:=</span> <span class="mi">9</span><span class="p">,</span>
    <span class="n">B2</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">B3</span> <span class="o">:=</span> <span class="mi">11</span><span class="p">,</span>
    <span class="n">B4</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">,</span>
    <span class="n">PREDICTED_HOME</span> <span class="o">:=</span> <span class="mi">13</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdsgarageystates">
<h2>E_SDSGarageYStates<a class="headerlink" href="#e-sdsgarageystates" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSGarageYStates</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">T1</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">T2</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">T3</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">T4</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">M1</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">M2</span> <span class="o">:=</span> <span class="mi">6</span><span class="p">,</span>
    <span class="n">M3</span> <span class="o">:=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">M4</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">B1</span> <span class="o">:=</span> <span class="mi">9</span><span class="p">,</span>
    <span class="n">B2</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">B3</span> <span class="o">:=</span> <span class="mi">11</span><span class="p">,</span>
    <span class="n">B4</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">,</span>
    <span class="n">RETRACTED</span> <span class="o">:=</span> <span class="mi">13</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdshomingstate">
<h2>E_SDSHomingState<a class="headerlink" href="#e-sdshomingstate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSHomingState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">INIT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">WAIT_NOT_BUSY</span><span class="p">,</span>
    <span class="n">TRIGGER_HOMING</span><span class="p">,</span>
    <span class="n">WAIT_FOR_HOMED</span><span class="p">,</span>
    <span class="n">HOMED</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdsseqstate">
<h2>E_SDSSeqState<a class="headerlink" href="#e-sdsseqstate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSSeqState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">Inactive</span><span class="p">,</span>
    <span class="n">Home_Transfer_Arm</span><span class="p">,</span>
    <span class="n">Check_Garage_Height</span><span class="p">,</span>
    <span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">,</span>
    <span class="n">Retract_Garage_1</span><span class="p">,</span>
    <span class="n">Home_Garage</span><span class="p">,</span>
    <span class="n">Move_Diffractometer_to_Load_Unload_Position</span><span class="p">,</span>
    <span class="n">Confirm_Vacuum_Valve_Open</span><span class="p">,</span>
    <span class="n">Select_Garage_Slot_for_Removal</span><span class="p">,</span>
    <span class="n">Select_Garage_Slot_for_Loading</span><span class="p">,</span>
    <span class="n">Garage_Face_Transfer_Arm</span><span class="p">,</span>
    <span class="n">Rotate_Garage_for_Clearance_to_Lower</span><span class="p">,</span>
    <span class="n">Move_Garage_to_Slot_Height</span><span class="p">,</span>
    <span class="n">Prerotate_Transfer_Arm_for_Extraction</span><span class="p">,</span>
    <span class="n">Prerotate_Transfer_Arm_for_Insertion</span><span class="p">,</span>
    <span class="n">Extend_Transfer_Arm_for_Extraction</span><span class="p">,</span>
    <span class="n">Extend_Transfer_Arm_for_Insertion</span><span class="p">,</span>
    <span class="n">Extend_Transfer_Arm_for_Diffractometer_Extraction</span><span class="p">,</span>
    <span class="n">Extend_Transfer_Arm_for_Diffractometer_Insertion</span><span class="p">,</span>
    <span class="n">Screw_in_Half_Turn</span><span class="p">,</span>
    <span class="n">Fine_Adjustment</span><span class="p">,</span>
    <span class="n">Unscrew_Sample_from_Garage</span><span class="p">,</span>
    <span class="n">Unscrew_Sample_from_Diffractometer</span><span class="p">,</span>
    <span class="n">Screw_Sample_into_Garage</span><span class="p">,</span>
    <span class="n">Screw_Sample_into_Diffractometer</span><span class="p">,</span>
    <span class="n">Confirm_Extraction</span><span class="p">,</span>
    <span class="n">Confirm_Insertion</span><span class="p">,</span>
    <span class="n">Confirm_Diffractometer_Insertion</span><span class="p">,</span>
    <span class="n">Confirm_Diffractometer_Extraction</span><span class="p">,</span>
    <span class="n">Update_Sample_Database</span><span class="p">,</span>
    <span class="n">Retract_Transfer_Arm</span><span class="p">,</span>
    <span class="n">Rotate_Garage_for_Clearance_to_Raise</span><span class="p">,</span>
    <span class="n">Retract_Garage_2</span><span class="p">,</span>
    <span class="n">Return_Garage_to_Home</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdsstate">
<h2>E_SDSState<a class="headerlink" href="#e-sdsstate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSState</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">Standby</span><span class="p">,</span>
    <span class="n">Error</span><span class="p">,</span>
    <span class="n">Operating</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdssubstate">
<h2>E_SDSSubstate<a class="headerlink" href="#e-sdssubstate" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSSubstate</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">Inactive</span><span class="p">,</span>
    <span class="n">Select_Desired_Action</span><span class="p">,</span>
    <span class="n">Check_Can_Home_Garage</span><span class="p">,</span>
    <span class="n">Home_Garage</span><span class="p">,</span>
    <span class="n">Check_Can_Home_Transfer_Arm</span><span class="p">,</span>
    <span class="n">Home_Transfer_Arm</span><span class="p">,</span>
    <span class="n">Check_Can_Load_Arm_From_Garage</span><span class="p">,</span>
    <span class="n">Load_Arm_from_Garage</span><span class="p">,</span>
    <span class="n">Check_Can_Unload_Arm_to_Garage</span><span class="p">,</span>
    <span class="n">Unload_Arm_to_Garage</span><span class="p">,</span>
    <span class="n">Check_Can_Load_Unload_Garage_from_Port</span><span class="p">,</span>
    <span class="n">Load_Unload_Garage_from_Port</span><span class="p">,</span>
    <span class="n">Check_Can_Load_Diffractometer_from_Arm</span><span class="p">,</span>
    <span class="n">Load_Diffractometer_from_Arm</span><span class="p">,</span>
    <span class="n">Check_Can_Unload_Diffractometer_to_Arm</span><span class="p">,</span>
    <span class="n">Unload_Diffractometer_to_Arm</span><span class="p">,</span>
    <span class="n">Check_Can_Manual_Control</span><span class="p">,</span>
    <span class="n">Manual_Control</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdstransferarmhstates">
<h2>E_SDSTransferArmHStates<a class="headerlink" href="#e-sdstransferarmhstates" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSTransferArmHStates</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">RETRACTED</span><span class="p">,</span>
    <span class="n">GARAGE_SAMPLE_REMOVAL</span><span class="p">,</span>
    <span class="n">CONFIRM_GARAGE_EXTRACTION</span><span class="p">,</span>
    <span class="n">CONFIRM_DIFF_EXTRACTION</span><span class="p">,</span>
    <span class="n">DIFF_SAMPLE_EXTRACTION</span><span class="p">,</span>
    <span class="n">GARAGE_SAMPLE_INSERTION</span><span class="p">,</span>
    <span class="n">CONFIRM_GARAGE_INSERTION</span><span class="p">,</span>
    <span class="n">CONFIRM_DIFF_INSERTION</span><span class="p">,</span>
    <span class="n">DIFF_SAMPLE_INSERTION</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="e-sdstransferarmrstates">
<h2>E_SDSTransferArmRStates<a class="headerlink" href="#e-sdstransferarmrstates" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;strict&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">E_SDSTransferArmRStates</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">FULLY_CCW</span><span class="p">,</span>
    <span class="n">PREROTATE_SAMPLE_REMOVAL</span><span class="p">,</span>
    <span class="n">PREROTATE_SAMPLE_INSERTION</span><span class="p">,</span>
    <span class="n">UNSCREW_FROM_GARAGE</span><span class="p">,</span>
    <span class="n">UNSCREW_FROM_DIFF</span><span class="p">,</span>
    <span class="n">SCREW_INTO_GARAGE</span><span class="p">,</span>
    <span class="n">SCREW_INTO_DIFF</span><span class="p">,</span>
    <span class="n">SCREW_IN_HALF_TURN</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="enum-las-vis-states">
<h2>ENUM_LAS_VIS_States<a class="headerlink" href="#enum-las-vis-states" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">TYPE</span> <span class="n">ENUM_LAS_VIS_States</span> <span class="p">:</span>
<span class="p">(</span>
    <span class="n">UNKNOWN</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Position7to24mm</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">Position62to77mm</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="p">)</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="st-autorealigncouple">
<h2>ST_AutoRealignCouple<a class="headerlink" href="#st-autorealigncouple" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_AutoRealignCouple</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">eState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Gives</span> <span class="n">the</span> <span class="n">current</span> <span class="n">coupling</span> <span class="n">realignment</span> <span class="n">state</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span><span class="p">:</span> <span class="n">E_RealignCoupleState</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bExecute</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Hold</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">run</span> <span class="n">an</span> <span class="n">automatic</span> <span class="n">realignment</span> <span class="n">sequence</span><span class="o">.</span> <span class="n">FALSE</span> <span class="n">to</span> <span class="n">cancel</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bExecuteCouple</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">couple</span> <span class="n">axes</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bExecuteCouple</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bExecuteDecouple</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="n">FALSE</span> <span class="n">to</span> <span class="n">decouple</span> <span class="n">axes</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bExecuteDecouple</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fRealignSpeed</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">speed</span> <span class="n">at</span> <span class="n">which</span> <span class="n">the</span> <span class="n">axis</span> <span class="n">will</span> <span class="n">be</span> <span class="n">moved</span> <span class="n">when</span> <span class="n">realigning</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fRealignSpeed</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bCoupled</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">the</span> <span class="n">axes</span> <span class="n">are</span> <span class="n">coupled</span><span class="o">.</span> <span class="n">FALSE</span> <span class="k">if</span> <span class="n">they</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">coupled</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bCoupled</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-realigncouplestate">E_RealignCoupleState</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-boundedvalue">
<h2>ST_BoundedValue<a class="headerlink" href="#st-boundedvalue" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_BoundedValue</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fIn</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="nb">input</span> <span class="n">value</span> <span class="n">before</span> <span class="n">bounds</span> <span class="n">are</span> <span class="n">applied</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fIn</span>    <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">The</span> <span class="nb">input</span> <span class="n">value</span> <span class="n">before</span> <span class="n">bounds</span> <span class="n">are</span> <span class="n">applied</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fMax</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">maximum</span> <span class="n">bound</span> <span class="k">for</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fMax</span>   <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">The</span> <span class="n">maximum</span> <span class="n">bound</span> <span class="k">for</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fMin</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">minimum</span> <span class="n">bound</span> <span class="k">for</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fMin</span>   <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">The</span> <span class="n">minimum</span> <span class="n">bound</span> <span class="k">for</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fOut</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">output</span> <span class="n">value</span> <span class="n">after</span> <span class="n">bounds</span> <span class="n">are</span> <span class="n">applied</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fOut</span>   <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">The</span> <span class="n">output</span> <span class="n">value</span> <span class="n">after</span> <span class="n">bounds</span> <span class="n">are</span> <span class="n">applied</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bMaxLim</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span> <span class="n">has</span> <span class="n">been</span> <span class="n">limited</span> <span class="n">by</span> <span class="n">the</span> <span class="n">upper</span> <span class="n">bound</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMaxLim</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span> <span class="n">has</span> <span class="n">been</span> <span class="n">limited</span> <span class="n">by</span> <span class="n">the</span> <span class="n">upper</span> <span class="n">bound</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bMinLim</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span> <span class="n">has</span> <span class="n">been</span> <span class="n">limited</span> <span class="n">by</span> <span class="n">the</span> <span class="n">lower</span> <span class="n">bound</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMinLim</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">the</span> <span class="n">output</span> <span class="n">value</span> <span class="n">has</span> <span class="n">been</span> <span class="n">limited</span> <span class="n">by</span> <span class="n">the</span> <span class="n">lower</span> <span class="n">bound</span><span class="o">.</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
</section>
<section id="st-coordinategantryaxisenable">
<h2>ST_CoordinateGantryAxisEnable<a class="headerlink" href="#st-coordinategantryaxisenable" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_CoordinateGantryAxisEnable</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bEnable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Set</span> <span class="n">false</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">this</span> <span class="n">function</span> <span class="n">block</span> <span class="kn">from</span><span class="w"> </span><span class="nn">allowing</span> <span class="n">the</span> <span class="n">motors</span> <span class="n">to</span> <span class="n">enable</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bEnable</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Set</span> <span class="n">false</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">this</span> <span class="n">function</span> <span class="n">block</span> <span class="kn">from</span><span class="w"> </span><span class="nn">allowing</span> <span class="n">the</span> <span class="n">motors</span> <span class="n">to</span> <span class="n">enable</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bLeaderDriveReady</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Intended</span> <span class="n">to</span> <span class="n">be</span> <span class="n">linked</span> <span class="n">to</span> <span class="n">the</span> <span class="n">leader</span> <span class="n">drive</span> <span class="n">ready</span> <span class="n">status</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bLeaderDriveReady</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Intended</span> <span class="n">to</span> <span class="n">be</span> <span class="n">linked</span> <span class="n">to</span> <span class="n">the</span> <span class="n">leader</span> <span class="n">drive</span> <span class="n">ready</span> <span class="n">status</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bFollowDriveReady</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Intended</span> <span class="n">to</span> <span class="n">be</span> <span class="n">linked</span> <span class="n">to</span> <span class="n">the</span> <span class="n">follow</span> <span class="n">drive</span> <span class="n">ready</span> <span class="n">status</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bFollowDriveReady</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Intended</span> <span class="n">to</span> <span class="n">be</span> <span class="n">linked</span> <span class="n">to</span> <span class="n">the</span> <span class="n">follow</span> <span class="n">drive</span> <span class="n">ready</span> <span class="n">status</span><span class="o">.</span>
    <span class="n">tTimeout</span><span class="p">:</span> <span class="n">TIME</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#5s; // Timeout before giving up on a state.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">eState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Present</span> <span class="n">enable</span> <span class="n">sequence</span> <span class="n">state</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span><span class="p">:</span> <span class="n">E_GantryEnableState</span><span class="p">;</span> <span class="o">//</span> <span class="n">Present</span> <span class="n">enable</span> <span class="n">sequence</span> <span class="n">state</span><span class="o">.</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-gantryenablestate">E_GantryEnableState</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-diffractometerslot">
<h2>ST_DiffractometerSlot<a class="headerlink" href="#st-diffractometerslot" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_DiffractometerSlot</span> <span class="n">EXTENDS</span> <span class="n">ST_SampleSlot</span> <span class="p">:</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Represents</span> <span class="n">a</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">SDS</span> <span class="n">garage</span><span class="o">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fYPos</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">y</span><span class="o">-</span><span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">garage</span><span class="p">,</span> <span class="ow">in</span> <span class="n">units</span> <span class="n">of</span> <span class="n">mm</span><span class="p">,</span> <span class="n">which</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">slot</span> <span class="n">being</span> <span class="n">approximately</span> <span class="n">level</span> <span class="k">with</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fYPos</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fDeg</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">angular</span> <span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">garage</span> <span class="ow">in</span> <span class="n">units</span> <span class="n">of</span> <span class="n">degrees</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fDeg</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-sampleslot">ST_SampleSlot</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-garageslot">
<h2>ST_GarageSlot<a class="headerlink" href="#st-garageslot" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_GarageSlot</span> <span class="n">EXTENDS</span> <span class="n">ST_SampleSlot</span> <span class="p">:</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Represents</span> <span class="n">a</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">SDS</span> <span class="n">garage</span><span class="o">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fYPos</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">y</span><span class="o">-</span><span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">garage</span><span class="p">,</span> <span class="ow">in</span> <span class="n">units</span> <span class="n">of</span> <span class="n">mm</span><span class="p">,</span> <span class="n">which</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">slot</span> <span class="n">being</span> <span class="n">approximately</span> <span class="n">level</span> <span class="k">with</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fYPos</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fDeg</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">angular</span> <span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">garage</span> <span class="ow">in</span> <span class="n">units</span> <span class="n">of</span> <span class="n">degrees</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fDeg</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-sampleslot">ST_SampleSlot</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-multileadermotioncoupling">
<h2>ST_MultiLeaderMotionCoupling<a class="headerlink" href="#st-multileadermotioncoupling" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_MultiLeaderMotionCoupling</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bEnable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Set</span> <span class="ow">and</span> <span class="n">hold</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">the</span> <span class="n">axis</span> <span class="n">to</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">multi</span><span class="o">-</span><span class="n">leader</span> <span class="n">mode</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bEnable</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bReset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Set</span> <span class="ow">and</span> <span class="n">release</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">fully</span> <span class="n">reset</span> <span class="n">errors</span> <span class="ow">and</span> <span class="n">state</span> <span class="n">machine</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bReset</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bBusy</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="n">indicates</span> <span class="n">state</span> <span class="n">machine</span> <span class="n">running</span> <span class="ow">and</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">error</span> <span class="n">state</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">sStatusMsg</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">String</span> <span class="n">used</span> <span class="n">to</span> <span class="n">give</span> <span class="n">helpful</span> <span class="n">messages</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">sStatusMsg</span><span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Ex</span><span class="p">:</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_11</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Ready</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bFollowerDriveReady</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Linked</span> <span class="n">to</span> <span class="n">the</span> <span class="n">ready</span> <span class="n">status</span> <span class="n">of</span> <span class="n">the</span> <span class="n">drive</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bFollowerDriveReady</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Link</span> <span class="n">to</span> <span class="n">the</span> <span class="n">ready</span> <span class="n">status</span> <span class="n">of</span> <span class="n">the</span> <span class="n">drive</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bUseDynamicLimits</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Set</span> <span class="n">AND</span> <span class="n">hold</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">enable</span> <span class="n">dynamic</span> <span class="n">limits</span> <span class="n">to</span> <span class="n">acc</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">AND</span> <span class="n">pos</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bUseDynamicLimits</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fTargetAcc</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">target</span> <span class="n">acceleration</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fTargetAcc</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Set</span> <span class="ow">in</span> <span class="n">software</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">axis</span> <span class="n">to</span> <span class="n">target</span> <span class="n">an</span> <span class="n">acceleration</span> <span class="n">based</span> <span class="n">on</span> <span class="n">multiple</span> <span class="n">leaders</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fTargetVel</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">target</span> <span class="n">velocity</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fTargetVel</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Set</span> <span class="ow">in</span> <span class="n">software</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">axis</span> <span class="n">to</span> <span class="n">target</span> <span class="n">a</span> <span class="n">velocity</span> <span class="n">based</span> <span class="n">on</span> <span class="n">multiple</span> <span class="n">leaders</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fTargetPos</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">The</span> <span class="n">target</span> <span class="n">position</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fTargetPos</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Set</span> <span class="ow">in</span> <span class="n">software</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">axis</span> <span class="n">to</span> <span class="n">target</span> <span class="n">a</span> <span class="n">position</span> <span class="n">based</span> <span class="n">on</span> <span class="n">multiple</span> <span class="n">leaders</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fPosDelta</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Target</span> <span class="n">position</span> <span class="n">minus</span> <span class="n">position</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fPosDelta</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Difference</span> <span class="n">between</span> <span class="n">current</span> <span class="n">position</span> <span class="ow">and</span> <span class="n">target</span> <span class="n">position</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fTTGain</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Target</span> <span class="n">tracking</span> <span class="n">gain</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fTargetTrackingGain</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">//</span> <span class="n">Gain</span> <span class="n">used</span> <span class="n">to</span> <span class="n">tune</span> <span class="n">target</span> <span class="n">tracking</span> <span class="n">when</span> <span class="n">within</span> <span class="n">target</span> <span class="n">position</span> <span class="n">window</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">fHaltPos</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Position</span> <span class="n">at</span> <span class="n">which</span> <span class="n">axis</span> <span class="n">halted</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fHaltPos</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span> <span class="o">//</span> <span class="n">Position</span> <span class="n">at</span> <span class="n">which</span> <span class="n">halt</span> <span class="ow">is</span> <span class="n">called</span><span class="o">.</span> <span class="n">Allows</span> <span class="k">for</span> <span class="n">centering</span> <span class="n">deadband</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: stAcc&#39;</span><span class="p">}</span>
    <span class="n">stAcc</span><span class="p">:</span> <span class="n">ST_BoundedValue</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: stVel&#39;</span><span class="p">}</span>
    <span class="n">stVel</span><span class="p">:</span> <span class="n">ST_BoundedValue</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: stPos&#39;</span><span class="p">}</span>
    <span class="n">stPos</span><span class="p">:</span> <span class="n">ST_BoundedValue</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">nDir</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Internally</span> <span class="n">calculated</span> <span class="n">direction</span> <span class="n">value</span> <span class="k">for</span> <span class="n">external</span> <span class="n">setpoint</span> <span class="n">generator</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">nDir</span><span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bError</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">is</span> <span class="n">active</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">sErrorMsg</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Displays</span> <span class="n">error</span> <span class="n">message</span> <span class="n">relevant</span> <span class="n">to</span> <span class="n">the</span> <span class="n">active</span> <span class="n">error</span><span class="o">.</span> <span class="n">Empty</span> <span class="n">otherwise</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">sErrorMsg</span><span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">sErrorHelp</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Displays</span> <span class="n">additional</span> <span class="n">help</span> <span class="k">for</span> <span class="n">the</span> <span class="n">active</span> <span class="n">rror</span><span class="o">.</span> <span class="n">Empty</span> <span class="n">otherwise</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">sErrorHelp</span><span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">eState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Records</span> <span class="n">the</span> <span class="n">current</span> <span class="n">state</span> <span class="n">of</span> <span class="n">the</span> <span class="n">multi</span><span class="o">-</span><span class="n">leader</span> <span class="n">function</span> <span class="n">block</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span><span class="p">:</span> <span class="n">E_MultiLeaderMotionCoupling</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-multileadermotioncoupling">E_MultiLeaderMotionCoupling</a></p></li>
<li><p><a class="reference internal" href="#st-boundedvalue">ST_BoundedValue</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-sampleslot">
<h2>ST_SampleSlot<a class="headerlink" href="#st-sampleslot" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_SampleSlot</span> <span class="p">:</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Represents</span> <span class="n">a</span> <span class="n">general</span> <span class="n">slot</span> <span class="k">for</span> <span class="n">a</span> <span class="n">sample</span> <span class="n">puck</span><span class="o">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">eState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Enumeration</span> <span class="n">of</span> <span class="n">possible</span> <span class="n">states</span> <span class="k">for</span> <span class="n">a</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span><span class="o">.</span> <span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="ow">or</span> <span class="n">disabled</span><span class="p">)</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span><span class="p">:</span> <span class="n">E_SampleSlotStates</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">sTag</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">A</span> <span class="n">two</span> <span class="n">character</span> <span class="n">identifier</span> <span class="k">for</span> <span class="n">the</span> <span class="n">slot</span><span class="o">.</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">B3</span><span class="p">,</span> <span class="n">etc</span><span class="o">...</span>
    <span class="s1">&#39;}</span>
    <span class="n">sTag</span><span class="p">:</span> <span class="n">STRING</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">sDesc</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">If</span> <span class="n">the</span> <span class="n">slot</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">full</span> <span class="n">state</span><span class="p">,</span> <span class="n">this</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">supposed</span> <span class="n">to</span> <span class="n">describe</span> <span class="n">what</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">slot</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">sDesc</span><span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-sampleslotstates">E_SampleSlotStates</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-sds">
<h2>ST_SDS<a class="headerlink" href="#st-sds" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_SDS</span> <span class="p">:</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Structure</span> <span class="n">to</span> <span class="n">represent</span> <span class="n">the</span> <span class="n">data</span> <span class="n">used</span> <span class="k">for</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span> <span class="n">that</span> <span class="ow">is</span> <span class="ow">not</span>
    <span class="n">needed</span> <span class="n">to</span> <span class="n">be</span> <span class="n">persistent</span><span class="o">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Initialized</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">the</span> <span class="n">non</span><span class="o">-</span><span class="n">persistent</span> <span class="n">data</span> <span class="n">has</span> <span class="n">been</span> <span class="n">initialized</span><span class="o">.</span> <span class="n">FALSE</span> <span class="k">if</span> <span class="n">it</span> <span class="n">has</span> <span class="ow">not</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bInitialized</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Enable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">enable</span> <span class="n">SDS</span> <span class="n">system</span><span class="o">.</span> <span class="n">FALSE</span> <span class="n">to</span> <span class="n">disable</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bEnable</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Maint</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="ow">in</span> <span class="n">maintenance</span> <span class="n">mode</span><span class="o">.</span> <span class="n">FALSE</span> <span class="k">if</span> <span class="n">NOT</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMaint</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Error</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">is</span> <span class="n">active</span><span class="o">.</span> <span class="n">FALSE</span> <span class="k">if</span> <span class="ow">not</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bError</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">ErrorMsg</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Error</span> <span class="n">message</span> <span class="n">to</span> <span class="n">help</span> <span class="n">describe</span> <span class="n">the</span> <span class="n">active</span> <span class="n">error</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">sErrorMsg</span> <span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Success</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">successfully</span> <span class="n">completed</span> <span class="n">state</span> <span class="n">machine</span> <span class="n">step</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bSuccess</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Variables</span> <span class="n">used</span> <span class="k">for</span> <span class="n">homing</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">HomeReq</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">homing</span> <span class="ow">is</span> <span class="n">required</span> <span class="k">for</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomingRequired</span> <span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">tHomingRequiredTimeoutTime</span> <span class="p">:</span> <span class="n">TIME</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#1h;</span>
    <span class="n">tonHomingRequiredTimeout</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tonHomingStateTimeout</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">nHomingState</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">MinHomeReq</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Minutes</span> <span class="n">until</span> <span class="n">homing</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">again</span> <span class="k">for</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fMinUntilHomingRequired</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">FaceState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Enum</span> <span class="n">to</span> <span class="n">describe</span> <span class="n">which</span> <span class="n">way</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">garage</span> <span class="n">should</span> <span class="n">face</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eFaceState</span><span class="p">:</span> <span class="n">E_SDSFaceState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">FacePortOffset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Degree</span> <span class="n">offset</span> <span class="n">when</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">face</span> <span class="n">the</span> <span class="n">side</span> <span class="n">port</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fFacePortOffset</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">90</span><span class="p">;</span> <span class="o">//</span> <span class="n">degree</span> <span class="n">offset</span> <span class="n">when</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">face</span> <span class="n">the</span> <span class="n">side</span> <span class="n">port</span><span class="o">.</span>

    <span class="o">//</span> <span class="n">Transfer</span> <span class="n">Arm</span> <span class="n">State</span> <span class="n">Positioner</span>
    <span class="n">stTransferArmHEpicsToPlc</span><span class="p">:</span> <span class="n">ST_StateEpicsToPlc</span><span class="p">;</span>
    <span class="n">stTransferArmHPlcToEpics</span><span class="p">:</span> <span class="n">ST_StatePlcToEpics</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">ArmHStateGet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">eTransferArmHStateGet</span><span class="p">:</span> <span class="n">E_SDSTransferArmHStates</span><span class="p">;</span> <span class="o">//</span> <span class="n">get</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">horizontal</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">ArmHStateSet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">eTransferArmHStateSet</span><span class="p">:</span> <span class="n">E_SDSTransferArmHStates</span><span class="p">;</span> <span class="o">//</span> <span class="nb">set</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">horizontal</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="n">astTransferArmHPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">ARMH</span><span class="p">:</span><span class="n">PS1D</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">horizontal</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbTransferArmHPos1D</span><span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span> <span class="o">//</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">horizontal</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="o">//</span> <span class="n">Transfer</span> <span class="n">Arm</span> <span class="n">State</span> <span class="n">Positioner</span>
    <span class="n">stTransferArmREpicsToPlc</span><span class="p">:</span> <span class="n">ST_StateEpicsToPlc</span><span class="p">;</span>
    <span class="n">stTransferArmRPlcToEpics</span><span class="p">:</span> <span class="n">ST_StatePlcToEpics</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">ArmRStateGet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">eTransferArmRStateGet</span><span class="p">:</span> <span class="n">E_SDSTransferArmRStates</span><span class="p">;</span> <span class="o">//</span> <span class="n">get</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">ArmRStateSet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">eTransferArmRStateSet</span><span class="p">:</span> <span class="n">E_SDSTransferArmRStates</span><span class="p">;</span> <span class="o">//</span> <span class="nb">set</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="n">astTransferArmRPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">ARMR</span><span class="p">:</span><span class="n">PS1D</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbTransferArmRPos1D</span><span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span> <span class="o">//</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="o">//</span> <span class="n">Garage</span> <span class="n">Y</span> <span class="n">State</span> <span class="n">Positioner</span>
    <span class="n">stGarageYEpicsToPlc</span><span class="p">:</span> <span class="n">ST_StateEpicsToPlc</span><span class="p">;</span>
    <span class="n">stGarageYPlcToEpics</span><span class="p">:</span> <span class="n">ST_StatePlcToEpics</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">GarYStateGet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">eGarageYStateGet</span><span class="p">:</span> <span class="n">E_SDSGarageYStates</span><span class="p">;</span> <span class="o">//</span> <span class="n">get</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">GarYStateSet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">eGarageYStateSet</span><span class="p">:</span> <span class="n">E_SDSGarageYStates</span><span class="p">;</span> <span class="o">//</span> <span class="nb">set</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="n">astGarageYPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GARY</span><span class="p">:</span><span class="n">PS1D</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">y</span><span class="o">-</span><span class="n">position</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbGarageYPos1D</span><span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span> <span class="o">//</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">y</span><span class="o">-</span><span class="n">position</span><span class="o">.</span>

    <span class="o">//</span> <span class="n">Garage</span> <span class="n">R</span> <span class="n">State</span> <span class="n">Positioner</span>
    <span class="n">stGarageREpicsToPlc</span><span class="p">:</span> <span class="n">ST_StateEpicsToPlc</span><span class="p">;</span>
    <span class="n">stGarageRPlcToEpics</span><span class="p">:</span> <span class="n">ST_StatePlcToEpics</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">GarRStateGet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">eGarageRStateGet</span><span class="p">:</span> <span class="n">E_SDSGarageRStates</span><span class="p">;</span> <span class="o">//</span> <span class="n">get</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">GarRStateSet</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">eGarageRStateSet</span><span class="p">:</span> <span class="n">E_SDSGarageRStates</span><span class="p">;</span> <span class="o">//</span> <span class="nb">set</span> <span class="n">state</span> <span class="n">enum</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">states</span><span class="o">.</span>

    <span class="n">astGarageRPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GARR</span><span class="p">:</span><span class="n">PS1D</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">rotation</span><span class="o">..</span>
    <span class="s1">&#39;}</span>
    <span class="n">fbGarageRPos1D</span><span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span> <span class="o">//</span> <span class="n">Position</span> <span class="n">State</span> <span class="mi">1</span><span class="n">D</span> <span class="n">used</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">rotation</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">State</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Present</span> <span class="n">state</span> <span class="k">for</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eState</span> <span class="p">:</span> <span class="n">E_SDSState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SubState</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Present</span> <span class="n">sub</span><span class="o">-</span><span class="n">state</span> <span class="k">for</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eSubState</span> <span class="p">:</span> <span class="n">E_SDSSubState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SeqState</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Present</span> <span class="n">sequence</span> <span class="n">state</span> <span class="k">for</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eSeqState</span><span class="p">:</span> <span class="n">E_SDSSeqState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SecRemaining</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Seconds</span> <span class="n">remaining</span> <span class="n">before</span> <span class="n">current</span> <span class="n">sequence</span> <span class="n">step</span> <span class="n">times</span> <span class="n">out</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fSecRemaining</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">StatusMsg</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Status</span> <span class="n">message</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">sStatusMsg</span><span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Booleans</span> <span class="n">to</span> <span class="n">track</span> <span class="n">what</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">do</span><span class="o">.</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarLoadable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">load</span> <span class="n">a</span> <span class="n">garage</span> <span class="n">slot</span><span class="o">.</span> <span class="kc">False</span> <span class="k">if</span> <span class="nb">all</span> <span class="n">garage</span> <span class="n">slots</span> <span class="n">are</span> <span class="n">full</span> <span class="ow">or</span> <span class="n">disabled</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bGarageLoadable</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarUnloadable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">unload</span> <span class="n">a</span> <span class="n">garage</span> <span class="n">slot</span><span class="o">.</span> <span class="kc">False</span> <span class="k">if</span> <span class="nb">all</span> <span class="n">garage</span> <span class="n">slots</span> <span class="n">are</span> <span class="n">empty</span> <span class="ow">or</span> <span class="n">disabled</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bGarageUnloadable</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">ArmLoadable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">load</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">slot</span><span class="o">.</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">full</span> <span class="ow">or</span> <span class="n">disabled</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bTransferArmLoadable</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">ArmUnloadable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">unload</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">slot</span><span class="o">.</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">empty</span> <span class="ow">or</span> <span class="n">disabled</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bTransferArmUnloadable</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">DiffLoadable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">load</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">slot</span><span class="o">.</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">full</span> <span class="ow">or</span> <span class="n">disabled</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDiffractometerLoadable</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">DiffUnloadable</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">currently</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">unload</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">slot</span><span class="o">.</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">the</span> <span class="n">diffractoemter</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">empty</span> <span class="ow">or</span> <span class="n">disabled</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDiffractometerUnloadable</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: Sel&#39;</span><span class="p">}</span>
    <span class="n">stUISelect</span> <span class="p">:</span> <span class="n">ST_UISelect</span><span class="p">;</span>

    <span class="n">tonForwardHomingLimit</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="n">stGarageYStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stGarageRStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stTransferArmHStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stTransferArmRStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiffXStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffXStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiffXStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiffYStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffYStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiffYStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiffZStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffZStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiffZStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiff2ThetaYStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiff2ThetaYStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiff2ThetaYStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiffPhiStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffPhiStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiffPhiStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiffChiStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffChiStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiffChiStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiff2ThetaStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiff2ThetaStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiff2ThetaStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="n">eDiffThetaStateGet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffThetaStateSet</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">stDiffThetaStage</span> <span class="p">:</span> <span class="n">REFERENCE</span> <span class="n">TO</span> <span class="n">ST_MotionStage</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarAboveColl</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">garage</span> <span class="n">above</span> <span class="n">collision</span> <span class="n">height</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bGarageAboveCollisionHeight</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">TAHHomeState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Transfer</span> <span class="n">arm</span> <span class="n">horizontal</span> <span class="n">homing</span> <span class="n">state</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eTransferArmHHomingState</span> <span class="p">:</span> <span class="n">E_SDSHomingState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">TARHomeState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Transfer</span> <span class="n">arm</span> <span class="n">rotational</span> <span class="n">homing</span> <span class="n">state</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eTransferArmRHomingState</span> <span class="p">:</span> <span class="n">E_SDSHomingState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarRHomeState</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Garage</span> <span class="n">rotational</span> <span class="n">homing</span> <span class="n">state</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eGarageRHomingState</span> <span class="p">:</span> <span class="n">E_SDSHomingState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarRotSpeed</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Garage</span> <span class="n">rotational</span> <span class="n">speed</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fGarageRotationSpeed</span> <span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">TARotSpeed</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Garage</span> <span class="n">rotational</span> <span class="n">speed</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fTransferArmRotationSpeed</span> <span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarRotClearancePos</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Garage</span> <span class="n">rotational</span> <span class="n">position</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">collision</span> <span class="k">with</span> <span class="n">loaded</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">when</span> <span class="n">moving</span> <span class="n">up</span> <span class="ow">and</span> <span class="n">down</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fGarageRotationClearancePos</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">LoadingSel</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">loading</span> <span class="kn">from</span><span class="w"> </span><span class="nn">port.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bLoadingSelected</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">UnloadingSel</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">unloading</span> <span class="kn">from</span><span class="w"> </span><span class="nn">port.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bUnloadingSelected</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">NumGarSlots</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">garage</span> <span class="n">sample</span> <span class="n">slots</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">nGarageSlots</span> <span class="p">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">12</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">SelGarSlot</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Selected</span> <span class="n">garage</span> <span class="n">slot</span> <span class="k">for</span> <span class="n">loading</span><span class="o">/</span><span class="n">unloading</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eSelectedGarageSlot</span> <span class="p">:</span> <span class="n">E_SDSGarageYStates</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-diffstate">E_DiffState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsfacestate">E_SDSFaceState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsgaragerstates">E_SDSGarageRStates</a></p></li>
<li><p><a class="reference internal" href="#e-sdsgarageystates">E_SDSGarageYStates</a></p></li>
<li><p><a class="reference internal" href="#e-sdshomingstate">E_SDSHomingState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsseqstate">E_SDSSeqState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsstate">E_SDSState</a></p></li>
<li><p><a class="reference internal" href="#e-sdstransferarmhstates">E_SDSTransferArmHStates</a></p></li>
<li><p><a class="reference internal" href="#e-sdstransferarmrstates">E_SDSTransferArmRStates</a></p></li>
<li><p><a class="reference internal" href="#st-uiselect">ST_UISelect</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-sdspersistent">
<h2>ST_SDSPersistent<a class="headerlink" href="#st-sdspersistent" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_SDSPersistent</span> <span class="p">:</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Structure</span> <span class="n">to</span> <span class="n">represent</span> <span class="n">the</span> <span class="n">data</span> <span class="n">used</span> <span class="k">for</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span> <span class="n">that</span> <span class="ow">is</span>
    <span class="n">needed</span> <span class="n">to</span> <span class="n">be</span> <span class="n">persistent</span><span class="o">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">STRUCT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bInitialized</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="k">if</span> <span class="n">the</span> <span class="n">persistent</span> <span class="n">data</span> <span class="n">has</span> <span class="n">been</span> <span class="n">initialized</span><span class="o">.</span> <span class="n">FALSE</span> <span class="k">if</span> <span class="n">it</span> <span class="n">has</span> <span class="ow">not</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bInitialized</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: Garage:Slot&#39;</span><span class="p">}</span>
    <span class="n">astGarageSlot</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span><span class="o">..</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_GarageSlot</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: Transfer:Slot&#39;</span><span class="p">}</span>
    <span class="n">stTransferArmSlot</span><span class="p">:</span> <span class="n">ST_TransferSlot</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: Diff:Slot&#39;</span><span class="p">}</span>
    <span class="n">stDiffractometerSlot</span><span class="p">:</span> <span class="n">ST_DiffractometerSlot</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarHSafeFromCol</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Height</span> <span class="n">at</span> <span class="n">which</span> <span class="n">garage</span> <span class="n">consider</span> <span class="n">safe</span> <span class="kn">from</span><span class="w"> </span><span class="nn">collisions.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fGarageHeightSafeFromCollision</span> <span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">10</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarRClearOff</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Garage</span> <span class="n">rotational</span> <span class="n">offset</span> <span class="k">for</span> <span class="n">clearance</span> <span class="n">when</span> <span class="n">moving</span> <span class="n">up</span> <span class="ow">and</span> <span class="n">down</span> <span class="k">with</span> <span class="n">loading</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">fGarageRotationClearanceOffset</span> <span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">45</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-sdsgarageystates">E_SDSGarageYStates</a></p></li>
<li><p><a class="reference internal" href="#st-diffractometerslot">ST_DiffractometerSlot</a></p></li>
<li><p><a class="reference internal" href="#st-garageslot">ST_GarageSlot</a></p></li>
<li><p><a class="reference internal" href="#st-transferslot">ST_TransferSlot</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-transferslot">
<h2>ST_TransferSlot<a class="headerlink" href="#st-transferslot" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_TransferSlot</span> <span class="n">EXTENDS</span> <span class="n">ST_SampleSlot</span> <span class="p">:</span>
<span class="p">(</span><span class="o">*</span>
    <span class="n">Represents</span> <span class="n">a</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">SDS</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
<span class="o">*</span><span class="p">)</span>
<span class="n">STRUCT</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#st-sampleslot">ST_SampleSlot</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="st-uiselect">
<h2>ST_UISelect<a class="headerlink" href="#st-uiselect" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span> <span class="n">ST_UISelect</span> <span class="p">:</span>
<span class="n">STRUCT</span>
    <span class="o">//</span> <span class="n">Booleans</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">operator</span> <span class="n">to</span> <span class="n">choose</span> <span class="n">what</span> <span class="n">they</span> <span class="n">want</span> <span class="n">to</span> <span class="n">do</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Load</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">a</span> <span class="n">loading</span> <span class="n">sequence</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bLoad</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Unload</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">a</span> <span class="n">unloading</span> <span class="n">sequence</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bUnload</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">ManualControl</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">manual</span> <span class="n">control</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bManualControl</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">ExitManualControl</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">exit</span> <span class="n">manual</span> <span class="n">control</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bExitManualControl</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">LoadArmFromGar</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">load</span> <span class="n">arm</span> <span class="kn">from</span><span class="w"> </span><span class="nn">garage.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bLoadArmFromGarage</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">UnloadArmToGar</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">unload</span> <span class="n">arm</span> <span class="kn">from</span><span class="w"> </span><span class="nn">garage.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bUnloadArmToGarage</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">LoadGarFromPort</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">load</span> <span class="n">garage</span> <span class="kn">from</span><span class="w"> </span><span class="nn">port.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bLoadGarageFromPort</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">UnloadGarFromPort</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">load</span> <span class="n">garage</span> <span class="kn">from</span><span class="w"> </span><span class="nn">port.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bLoadUnloadGarageFromPort</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">LoadDiffFromArm</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">load</span> <span class="n">diffractometer</span> <span class="kn">from</span><span class="w"> </span><span class="nn">arm.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bLoadDiffractometerFromArm</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">UnloadDiffToArm</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">unload</span> <span class="n">diffractometer</span> <span class="n">to</span> <span class="n">arm</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bUnloadDiffractometerToArm</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">HomeArm</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">home</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeTransferArm</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">HomeGar</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">command</span> <span class="n">home</span> <span class="n">garage</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeGarage</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">GarSlot</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Select</span> <span class="n">garage</span> <span class="n">slot</span> <span class="n">to</span> <span class="n">unload</span> <span class="ow">or</span> <span class="n">load</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">eGarageSlot</span> <span class="p">:</span> <span class="n">E_SDSGarageYStates</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Proceed</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">to</span> <span class="n">proceed</span> <span class="n">to</span> <span class="nb">next</span> <span class="n">sequence</span> <span class="n">step</span><span class="p">,</span> <span class="k">if</span> <span class="n">applicable</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bProceed</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Retry</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="kc">True</span> <span class="n">when</span> <span class="n">prompted</span> <span class="n">to</span> <span class="n">retry</span> <span class="n">a</span> <span class="n">defined</span> <span class="n">previous</span> <span class="n">step</span><span class="p">,</span> <span class="k">if</span> <span class="n">applicable</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bRetry</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">Cancel</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">cancel</span> <span class="nb">next</span> <span class="n">sequence</span> <span class="n">step</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bCancel</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">TextInput</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">General</span> <span class="n">purpose</span> <span class="n">text</span> <span class="nb">input</span> <span class="n">field</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">sTextInput</span><span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
<span class="n">END_STRUCT</span>
<span class="n">END_TYPE</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-sdsgarageystates">E_SDSGarageYStates</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="gvls">
<h1>GVLs<a class="headerlink" href="#gvls" title="Link to this heading"></a></h1>
<section id="global-version">
<h2>Global_Version<a class="headerlink" href="#global-version" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcGenerated&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;no-analysis&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;linkalways&#39;</span><span class="p">}</span>
<span class="o">//</span> <span class="n">This</span> <span class="n">function</span> <span class="n">has</span> <span class="n">been</span> <span class="n">automatically</span> <span class="n">generated</span> <span class="kn">from</span><span class="w"> </span><span class="nn">the</span> <span class="n">project</span> <span class="n">information</span><span class="o">.</span>
<span class="n">VAR_GLOBAL</span> <span class="n">CONSTANT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;const_non_replaced&#39;</span><span class="p">}</span>
    <span class="n">stLibVersion_qrix_motion</span> <span class="p">:</span> <span class="n">ST_LibVersion</span> <span class="o">:=</span> <span class="p">(</span><span class="n">iMajor</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iMinor</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">iBuild</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iRevision</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nFlags</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sVersion</span> <span class="o">:=</span> <span class="s1">&#39;0.4.0&#39;</span><span class="p">);</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-eps">
<h2>GVL_EPS<a class="headerlink" href="#gvl-eps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:ESTOP_RST&#39;</span><span class="p">}</span>
    <span class="n">bResetIClk</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:ESTOP&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 18&#39;</span><span class="p">}</span>
    <span class="n">bESTOP</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2B-05 SV_AIR (EL2004)]^Channel 1^Output&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:SV1&#39;</span><span class="p">}</span>
    <span class="n">bOpenSV1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2B-05 SV_AIR (EL2004)]^Channel 2^Output&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:SV2&#39;</span><span class="p">}</span>
    <span class="n">bOpenSV2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1C_ServoDR (NCR-HD Series)]^260th receive PDO Mapping^Positive torque limit value&#39;</span><span class="p">}</span>
    <span class="n">iServoTorqueLimitPositive</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1C_ServoDR (NCR-HD Series)]^260th receive PDO Mapping^Negative torque limit value&#39;</span><span class="p">}</span>
    <span class="n">iServoTorqueLimitNegative</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-interface">
<h2>GVL_Interface<a class="headerlink" href="#gvl-interface" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>

    <span class="p">(</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">Outputs</span> <span class="n">to</span> <span class="n">QRIX</span> <span class="n">Vacuum</span> <span class="n">PLC</span><span class="o">*</span><span class="p">)</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-R03-DRL-01 (EK1200)^Term 141 (EL6692)^IO Outputs^QRIX_MOT_SDS_MMS_H_RAW_ENC_CNTS</span>
    <span class="s1">&#39;}</span>
    <span class="n">QRIX_MOT_SDS_MMS_H_RAW_ENC_CNTS</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-R03-DRL-01 (EK1200)^Term 141 (EL6692)^IO Outputs^QRIX_MOT_SDS_MMS_H_FORWARD_EN</span>
    <span class="s1">&#39;}</span>
    <span class="n">QRIX_MOT_SDS_MMS_H_FORWARD_EN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-R03-DRL-01 (EK1200)^Term 141 (EL6692)^IO Outputs^QRIX_MOT_SDS_MMS_H_BACKWARD_EN</span>
    <span class="s1">&#39;}</span>
    <span class="n">QRIX_MOT_SDS_MMS_H_BACKWARD_EN</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">Inputs</span> <span class="kn">from</span><span class="w"> </span><span class="nn">QRIX</span> <span class="n">Vacuum</span> <span class="n">PLC</span><span class="o">*</span><span class="p">)</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-R03-DRL-01 (EK1200)^Term 141 (EL6692)^IO Inputs^QRIX_VAC_VGC_03_OPEN_LIMIT_SWITCH</span>
    <span class="s1">&#39;}</span>
    <span class="n">QRIX_VAC_VGC_03_OPEN_LIMIT_SWITCH</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-R03-DRL-01 (EK1200)^Term 141 (EL6692)^IO Inputs^QRIX_VAC_VGC_03_CLOSED_LIMIT_SWITCH</span>
    <span class="s1">&#39;}</span>
    <span class="n">QRIX_VAC_VGC_03_CLOSED_LIMIT_SWITCH</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-R03-DRL-01 (EK1200)^Term 141 (EL6692)^IO Inputs^QRIX_VAC_VGC_03_OP_CMD</span>
    <span class="s1">&#39;}</span>
    <span class="n">QRIX_VAC_VGC_03_OP_CMD</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span>  <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-R03-DRL-01 (EK1200)^Term 141 (EL6692)^IO Inputs^QRIX_VAC_VGC_03_CL_CMD</span>
    <span class="s1">&#39;}</span>
    <span class="n">QRIX_VAC_VGC_03_CL_CMD</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-pmps">
<h2>GVL_PMPS<a class="headerlink" href="#gvl-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: PLC:QRIX:MOTION:ARB&#39;</span><span class="p">}</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: PLC:QRIX:MOTION:FFO:01&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[PMPS_FFO]^Channel 1^Output&#39;</span><span class="p">}</span>
    <span class="n">fbFastFaultOutput1</span><span class="p">:</span> <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.92.73.1.1&#39;</span><span class="p">);</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: PLC:QRIX:MOTION:FFO:02&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.q_xFastFaultOut:=TIIB[PMPS_FFO]^Channel 2^Output&#39;</span><span class="p">}</span>
    <span class="n">fbFastFaultOutput2</span><span class="p">:</span> <span class="n">FB_HardwareFFOutput</span> <span class="o">:=</span> <span class="p">(</span><span class="n">bAutoReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">i_sNetID</span><span class="o">:=</span><span class="s1">&#39;172.21.92.73.1.1&#39;</span><span class="p">);</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="gvl-sensor">
<h2>GVL_Sensor<a class="headerlink" href="#gvl-sensor" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">FLOATING</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bFloating</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">YDF1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">DDS</span><span class="p">:</span><span class="n">YDF1</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit1&#39;</span><span class="p">}</span>
    <span class="n">stYDF1</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>
    <span class="n">nYDF1</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">YDF2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">DDS</span><span class="p">:</span><span class="n">YDF2</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit2&#39;</span><span class="p">}</span>
    <span class="n">stYDF2</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>
    <span class="n">nYDF2</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">YDF3</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">DDS</span><span class="p">:</span><span class="n">YDF3</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit3&#39;</span><span class="p">}</span>
    <span class="n">stYDF3</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>
    <span class="n">nYDF3</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Height</span> <span class="n">difference</span> <span class="n">btw</span> <span class="n">granite</span> <span class="n">shelf</span> <span class="ow">and</span> <span class="n">detector</span> <span class="n">frame</span><span class="o">.</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">DDS</span><span class="p">:</span><span class="n">HDF</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Response Data Unit4&#39;</span><span class="p">}</span>
    <span class="n">stHDF</span><span class="p">:</span> <span class="n">DUT_SensorHGS</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Granite</span> <span class="n">TiltZ</span> <span class="p">:</span> <span class="n">Pitch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">GS</span><span class="p">:</span><span class="n">INM</span><span class="p">:</span><span class="n">Z</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 2^Value&#39;</span><span class="p">}</span>
    <span class="n">stGraniteP</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Granite</span> <span class="n">TiltX</span> <span class="p">:</span> <span class="n">Roll</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">GS</span><span class="p">:</span><span class="n">INM</span><span class="p">:</span><span class="n">X</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 1^Value&#39;</span><span class="p">}</span>
    <span class="n">stGraniteR</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Frame</span> <span class="n">TiltZ</span> <span class="p">:</span> <span class="n">Pitch</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">INM</span><span class="p">:</span><span class="n">Z</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 4^Value&#39;</span><span class="p">}</span>
    <span class="n">stFrameP</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Frame</span> <span class="n">TiltX</span> <span class="p">:</span> <span class="n">Roll</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">INM</span><span class="p">:</span><span class="n">X</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-03 AI_TiltSensor (EL3174-0002)]^AI Standard Channel 3^Value&#39;</span><span class="p">}</span>
    <span class="n">stFrameR</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">GPT</span><span class="p">:</span><span class="n">PS1</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-04 PS_P (EL3064)]^AI Standard Channel 1^Value&#39;</span><span class="p">}</span>
    <span class="n">stPS1</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">GPT</span><span class="p">:</span><span class="n">PS2</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-04 PS_P (EL3064)]^AI Standard Channel 2^Value&#39;</span><span class="p">}</span>
    <span class="n">stPS2</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">GPT</span><span class="p">:</span><span class="n">PS3</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .iRawCnts       := TIIB[Rack#2B-04 PS_P (EL3064)]^AI Standard Channel 3^Value&#39;</span><span class="p">}</span>
    <span class="n">stPS3</span><span class="p">:</span> <span class="n">DUT_Sensor</span><span class="p">;</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#dut-sensor">DUT_Sensor</a></p></li>
<li><p><a class="reference internal" href="#dut-sensorhgs">DUT_SensorHGS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="gvl-var">
<h2>GVL_VAR<a class="headerlink" href="#gvl-var" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VAR_GLOBAL</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bDoneJackOff</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDoneJackOff</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bDoneLevitation</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDoneLevitation</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bDoneLanding</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDoneLanding</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bDoneAdjustingRoll</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDoneAdjustingRoll</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bDoneAdjustingPitch</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDoneAdjustingPitch</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bDoneAdjustingHeight</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bDoneAdjustingHeight</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Reset</span> <span class="ow">and</span> <span class="n">monitor</span> <span class="n">circuit</span> <span class="n">breakers</span> <span class="n">on</span> <span class="n">spectrometer</span> <span class="n">arm</span>
    <span class="o">//</span> <span class="n">BOX0108</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">B0108</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^BOX-01 Coupler (EK1100)^BOX-08 CP_SDC (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerB0108Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">B0108</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^BOX-01 Coupler (EK1100)^BOX-08 CP_SDC (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerB0108Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">BOX0113</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">B0113</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^BOX-01 Coupler (EK1100)^BOX-13 CP_DC (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerB0113Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">B0113</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^BOX-01 Coupler (EK1100)^BOX-13 CP_DC (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerB0113Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">BOX0118</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">B0118</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^BOX-01 Coupler (EK1100)^BOX-18 CP_YF1_YF2 (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerB0118Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">B0118</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^BOX-01 Coupler (EK1100)^BOX-18 CP_YF1_YF2 (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerB0118Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Rack</span> <span class="mi">2</span><span class="n">A02</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2A02</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2A-01 Coupler (EK1100)^Rack#2A-02 CP_SLIT (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2A02Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2A02</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2A-01 Coupler (EK1100)^Rack#2A-02 CP_SLIT (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2A02Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Rack</span> <span class="mi">2</span><span class="n">A07</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2A07</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2A-01 Coupler (EK1100)^Rack#2A-07 CP_G (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2A07Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2A07</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2A-01 Coupler (EK1100)^Rack#2A-07 CP_G (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2A07Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Rack</span> <span class="mi">2</span><span class="n">A13</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2A13</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2A-01 Coupler (EK1100)^Rack#2A-13 CP_PM (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2A13Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2A13</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2A-01 Coupler (EK1100)^Rack#2A-13 CP_PM (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2A13Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Rack</span> <span class="mi">2</span><span class="n">B14</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2B14</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2B-01 Coupler (EK1100)^Rack#2B-14 CP_YDF (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2B14Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2B14</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2B-01 Coupler (EK1100)^Rack#2B-14 CP_YDF (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2B14Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Rack</span> <span class="mi">2</span><span class="n">B17</span> <span class="n">Circuit</span> <span class="n">Breaker</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2B17</span><span class="p">:</span><span class="n">Reset</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2B-01 Coupler (EK1100)^Rack#2B-17 CP_YDF_ZF (EL9221-5000)^OCP Outputs^Control^Reset&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2B17Reset</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">CB</span><span class="p">:</span><span class="n">R2B17</span><span class="p">:</span><span class="n">Tripped</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^Rack#2B-01 Coupler (EK1100)^Rack#2B-17 CP_YDF_ZF (EL9221-5000)^OCP Inputs^Status^Tripped&#39;</span><span class="p">}</span>
    <span class="n">bCircuitBreakerR2B17Tripped</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fCryoZNeutralPositionAtDiffZ0</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fBraidDiameter</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">70</span><span class="p">;</span> <span class="o">//</span> <span class="n">mm</span>
<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
<section id="main">
<h2>Main<a class="headerlink" href="#main" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;qualified_only&#39;</span><span class="p">}</span>
<span class="n">VAR_GLOBAL</span>

<span class="p">(</span><span class="o">*</span>
    <span class="n">Only</span> <span class="n">includes</span> <span class="n">motor</span> <span class="n">definitions</span> <span class="k">for</span> <span class="n">the</span> <span class="n">IOC</span>
    <span class="n">These</span> <span class="n">are</span> <span class="n">hard</span><span class="o">-</span><span class="n">coded</span> <span class="n">to</span> <span class="n">be</span> <span class="n">Main</span><span class="o">.</span><span class="n">M</span><span class="c1">#,</span>
    <span class="n">but</span> <span class="n">are</span> <span class="n">very</span> <span class="n">convenient</span> <span class="n">to</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">GVL</span><span class="p">,</span>
    <span class="n">hence</span> <span class="n">the</span> <span class="n">confusing</span> <span class="n">namespace</span> <span class="n">here</span>
    <span class="n">This</span> <span class="n">should</span> <span class="n">be</span> <span class="n">refactored</span> <span class="n">once</span> <span class="n">the</span> <span class="n">IOC</span>
    <span class="n">supports</span> <span class="n">arbitrary</span> <span class="n">ads</span> <span class="n">paths</span> <span class="k">for</span> <span class="n">motors</span>
<span class="o">*</span><span class="p">)</span>
    <span class="o">//</span> <span class="n">Sample</span> <span class="n">Chamber</span> <span class="n">Sliding</span> <span class="n">Seal</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">axis</span>
    <span class="o">//</span><span class="n">connect</span> <span class="n">EPS</span> <span class="n">limits</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SC:SSL:MMS&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_01 - SSL]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_01</span> <span class="o">-</span> <span class="n">SSL</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M1</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SC:SSL:MMS&#39;</span><span class="p">);</span>


    <span class="p">(</span><span class="o">*</span> <span class="n">Start</span> <span class="n">Adding</span> <span class="n">Spectometer</span> <span class="n">Arm</span> <span class="n">Axes</span> <span class="n">Here</span><span class="o">*</span><span class="p">)</span>

    <span class="o">//</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">Stepper</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:MMS:2Theta&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-04 DR_2Th (EL7047)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-04 DR_2Th (EL7047)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-06 ENC_2Th (EL5042)]^FB Inputs Channel 1^Position;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>                      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-05 MB_2Th (EL2602)]^Channel 1^Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M2</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SA:MMS:2Theta&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XS1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:NORTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-03 DR_XS1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-03 DR_XS1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-07 ENC_X1_X2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M3</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPTSL:MMS:NORTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XS2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:SOUTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-04 DR_XS2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-04 DR_XS2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-07 ENC_X1_X2 (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M4</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPTSL:MMS:SOUTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YS1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:TOP&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-05 DR_YS1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-05 DR_YS1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-08 ENC_Y1_Y2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M5</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPTSL:MMS:TOP&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YS2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL:MMS:BOTTOM&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-06 DR_YS2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-06 DR_YS2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-08 ENC_Y1_Y2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M6</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPTSL:MMS:BOTTOM&#39;</span><span class="p">);;</span>

    <span class="o">//</span> <span class="n">YG1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT:MMS:Y1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-10 DR_YG1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-10 DR_YG1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-10 ENC_YG1_YG2 (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M7</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPT:MMS:Y1&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YG2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT:MMS:Y2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-11 DR_YG2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-11 DR_YG2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-10 ENC_YG1_YG2 (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M8</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPT:MMS:Y2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YG3</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT:MMS:Y3&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-12 DR_YG3 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-12 DR_YG3 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-11 ENC_YG3_X1PM (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M9</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:OPT:MMS:Y3&#39;</span><span class="p">);</span>


    <span class="o">//</span> <span class="n">RxG</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:G:MMS:Rx&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-08 DR_RxG (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-08 DR_RxG (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-09 ENC_RxG_XG (EL5042)]^FB Inputs Channel 1 compact^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M10</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:G:MMS:Rx&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XG</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:G:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-09 DR_XG (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-09 DR_XG (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-09 ENC_RxG_XG (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M11</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:G:MMS:X&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XPM1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:PM:MMS:X1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-14 DR_XPM1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-14 DR_XPM1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-11 ENC_YG3_X1PM (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M12</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:PM:MMS:X1&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XPM2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:PM:MMS:X2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-15 DR_XPM2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-15 DR_XPM2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-12 ENC_X2PM_RzPM (EL5042)]^FB Inputs Channel 1^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M13</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:PM:MMS:X2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">RzPM</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:PM:MMS:Rz&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2A-16 DR_RzPM (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2A-16 DR_RzPM (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-12 ENC_X2PM_RzPM (EL5042)]^FB Inputs Channel 2^Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M14</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:PM:MMS:Rz&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YDF1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:MMS:Y1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2B-15 DR_YDF1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-15 DR_YDF1 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Rack</span><span class="c1">#2D LinearGaugeAmp (SC-HG1-ETC)^Process Data(In)  TxPDO-Map^Response Data Unit1</span>
    <span class="s1">&#39;}</span>
    <span class="n">M15</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DF:MMS:Y1&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YDF2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:MMS:Y2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2B-16 DR_YDF2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-16 DR_YDF2 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Rack</span><span class="c1">#2D LinearGaugeAmp (SC-HG1-ETC)^Process Data(In)  TxPDO-Map^Response Data Unit2</span>
    <span class="s1">&#39;}</span>
    <span class="n">M16</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DF:MMS:Y2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YDF3</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:MMS:Y3&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#2B-19 DR_YDF3 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-19 DR_YDF3 (EL7041-0052)]^STM Status^Status^Digital input 2;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">Rack</span><span class="c1">#2D LinearGaugeAmp (SC-HG1-ETC)^Process Data(In)  TxPDO-Map^Response Data Unit3</span>
    <span class="s1">&#39;}</span>
    <span class="n">M17</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DF:MMS:Y3&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XSDC1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:NORTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-09 DR_XSDC1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">09</span> <span class="n">DR_XSDC1</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">03</span> <span class="n">ENC_X1_X2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M18</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DETSL:MMS:NORTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XSDC2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:SOUTH&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-10 DR_XSDC2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">10</span> <span class="n">DR_XSDC2</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">03</span> <span class="n">ENC_X1_X2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M19</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DETSL:MMS:SOUTH&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YSDC1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:TOP&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-11 DR_YSDC1 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">11</span> <span class="n">DR_YSDC1</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">04</span> <span class="n">ENC_Y1_Y2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M20</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DETSL:MMS:TOP&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YSDC2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL:MMS:BOTTOM&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-12 DR_YSDC2 (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">12</span> <span class="n">DR_YSDC2</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">04</span> <span class="n">ENC_Y1_Y2</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M21</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DETSL:MMS:BOTTOM&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">XDC</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DC:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-14 DR_XDC (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">14</span> <span class="n">DR_XDC</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">05</span> <span class="n">ENC_XDC_RyDC</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M22</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DC:MMS:X&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">RyDC</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DC:MMS:Ry&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-15 DR_RyDC (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">15</span> <span class="n">DR_RyDC</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">05</span> <span class="n">ENC_XDC_RyDC</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M23</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DC:MMS:Ry&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">ZDC</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DC:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[BOX-16 DR_ZDC (EL7041-0052)]^STM Status^Status^Digital input 1;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">16</span> <span class="n">DR_ZDC</span> <span class="p">(</span><span class="n">EL7041</span><span class="o">-</span><span class="mi">0052</span><span class="p">)]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">06</span> <span class="n">ENC_ZDC_YF1</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span>
    <span class="s1">&#39;}</span>
    <span class="n">M24</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DC:MMS:Z&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YF1</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DA:MMS:Y1&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 10;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 11;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">06</span> <span class="n">ENC_ZDC_YF1</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>              <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">19</span> <span class="n">MB_YF1_YF2</span> <span class="p">(</span><span class="n">EL2602</span><span class="p">)]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M25</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DA:MMS:Y1&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">YF2</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DA:MMS:Y2&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 12;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 13;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">07</span> <span class="n">ENC_YF2_ZF</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>                      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">19</span> <span class="n">MB_YF1_YF2</span> <span class="p">(</span><span class="n">EL2602</span><span class="p">)]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M26</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DA:MMS:Y2&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">ZF</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DA:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .bLimitForwardEnable    := TIIB[Rack#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 14;</span>
                                <span class="o">.</span><span class="n">bLimitBackwardEnable</span>       <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#1A-02 SFIN (EL1918)]^StandardInputs^Standard Out Var 15;</span>
                                <span class="o">.</span><span class="n">nRawEncoderULINT</span>           <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">BOX</span><span class="o">-</span><span class="mi">07</span> <span class="n">ENC_YF2_ZF</span> <span class="p">(</span><span class="n">EL5042</span><span class="p">)]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                                <span class="o">.</span><span class="n">bBrakeRelease</span>                      <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">Rack</span><span class="c1">#2B-18 MB_ZF (EL2602)]^Channel 1^Output</span>
    <span class="s1">&#39;}</span>
    <span class="n">M27</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="o">:=</span><span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DA:MMS:Z&#39;</span><span class="p">);</span>


    <span class="o">//</span> <span class="n">Diffractometer</span> <span class="o">-</span>  <span class="mi">8</span> <span class="n">axes</span> <span class="n">START</span> <span class="n">AT</span> <span class="n">M28</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_04]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_02</span><span class="o">-</span><span class="n">Diff</span><span class="o">-</span><span class="n">X</span><span class="o">-</span><span class="n">Y</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M28</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:X&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_04]^Channel 4^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_02</span><span class="o">-</span><span class="n">Diff</span><span class="o">-</span><span class="n">X</span><span class="o">-</span><span class="n">Y</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M29</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:Y&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_08]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_08</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_06</span><span class="o">-</span><span class="n">DIff</span><span class="o">-</span><span class="n">Z</span><span class="o">-</span><span class="mi">2</span><span class="n">ThetaY</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M30</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:Z&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:DETY&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_08]^Channel 5^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_08</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">6</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_06</span><span class="o">-</span><span class="n">DIff</span><span class="o">-</span><span class="n">Z</span><span class="o">-</span><span class="mi">2</span><span class="n">ThetaY</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M31</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:DETY&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:PHI&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_08]^Channel 3^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_08</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_13</span> <span class="o">-</span> <span class="n">Diff</span> <span class="o">-</span> <span class="n">Phi</span> <span class="o">-</span> <span class="n">Chi</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M32</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:PHI&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:CHI&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_15]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_15</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">6</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_13</span> <span class="o">-</span> <span class="n">Diff</span> <span class="o">-</span> <span class="n">Phi</span> <span class="o">-</span> <span class="n">Chi</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M33</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:CHI&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:THETA&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_15]^Channel 3^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_15</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">7</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_17</span> <span class="o">-</span> <span class="n">Diff</span> <span class="o">-</span> <span class="n">Theta</span> <span class="o">-</span> <span class="mi">2</span><span class="n">Theta</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M34</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:THETA&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIFF:MMS:2THETA&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_03_15]^Channel 5^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_15</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">6</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_03_10</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">8</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_03_17</span> <span class="o">-</span> <span class="n">Diff</span> <span class="o">-</span> <span class="n">Theta</span> <span class="o">-</span> <span class="mi">2</span><span class="n">Theta</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M35</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIFF:MMS:2THETA&#39;</span><span class="p">);</span>



    <span class="o">//</span> <span class="n">Laser</span> <span class="n">Table</span>  <span class="o">-</span>  <span class="mi">3</span> <span class="n">axes</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:LAS:MMS:VIS&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_02_06]^Channel 6^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_02_06</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">5</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_05</span> <span class="o">-</span> <span class="n">LAS_VIS</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M36</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:LAS:MMS:VIS&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIAG:MMS:H&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  :=  TIIB[EL1088_02_06]^Channel 2^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span>  <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_02_06</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_08</span> <span class="o">-</span> <span class="n">LAS_D_V</span><span class="o">-</span><span class="n">H</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M37</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIAG:MMS:H&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DIAG:MMS:V&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL1088_02_06]^Channel 4^Input;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1088_02_06</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_08</span> <span class="o">-</span> <span class="n">LAS_D_V</span><span class="o">-</span><span class="n">H</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M38</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DIAG:MMS:V&#39;</span><span class="p">);</span>


    <span class="o">//</span><span class="n">Sample</span> <span class="n">Delivery</span> <span class="o">-</span> <span class="mi">6</span> <span class="n">Axes</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_01]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_01</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_04_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M39</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:X&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_03]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_03</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_04_02</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M40</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:Y&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_05]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_05</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_04_06</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M41</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:Z&#39;</span><span class="p">);</span>

     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:ROT_V&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nRawEncoderUINT     := TIIB[EL5101_05_01]^ENC Status compact^Counter value;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_04</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">4</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M42</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:ROT_V&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:ROT_H&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_10]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_10</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5101_05_02</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Input</span><span class="s1">&#39;}</span>
    <span class="n">M43</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:ROT_H&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SDS:MMS:H&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_04_12]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_04_12</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bHome</span>                                <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL1004_04_09</span><span class="p">]</span><span class="o">^</span><span class="n">Channel</span> <span class="mi">3</span><span class="o">^</span><span class="n">Input</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderUINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5101_05_03</span><span class="p">]</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Counter</span> <span class="n">value</span><span class="s1">&#39;}</span>
    <span class="n">M44</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:SDS:MMS:H&#39;</span><span class="p">);</span>

    <span class="o">//</span><span class="n">Detector</span> <span class="n">Rotation</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DET:MMS:ROT&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nRawEncoderULINT     := TIIB[BOX-22 DET_ROT (EL5042)]^FB Inputs Channel 1^Position&#39;</span><span class="p">}</span>
    <span class="n">M45</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:DET:MMS:ROT&#39;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Cryo</span> <span class="o">-</span>  <span class="mi">4</span> <span class="n">axes</span>
    <span class="o">//</span><span class="n">Cryo</span> <span class="o">-</span><span class="n">X</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:X&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_12]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_12</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_13</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M46</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:X&#39;</span><span class="p">);</span>
    <span class="o">//</span><span class="n">CRYO</span> <span class="n">Y</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:Y&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_14]^STM Status^Status^Digital input 2;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_14</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">1</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_13</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">2</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M47</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:Y&#39;</span><span class="p">);</span>
    <span class="o">//</span><span class="n">CRYO</span> <span class="n">Z</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:Z&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[EL7047_02_15]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL7047_02_15</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">EL5042_02_16</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M48</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:Z&#39;</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">CRYO</span><span class="o">-</span><span class="n">ROT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:CRYO:MMS:ROT&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nRawEncoderULINT     := TIIB[EL5042_02_16]^FB Inputs Channel 2^Position&#39;</span><span class="p">}</span>
    <span class="n">M49</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:CRYO:MMS:ROT&#39;</span><span class="p">);</span>

<span class="p">(</span><span class="o">*</span>
    <span class="o">//</span> <span class="n">Questar</span> <span class="o">-</span>  <span class="mi">2</span> <span class="n">axes</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:QUESTAR:MMS:01&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SSL-EL7041]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SSL</span><span class="o">-</span><span class="n">EL7041</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">IM1K3</span><span class="o">-</span><span class="n">EL5042</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M49</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:QUESTAR:MMS:01&#39;</span><span class="p">);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:QUESTAR:MMS:02&#39;</span><span class="p">}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLimitForwardEnable  := TIIB[SSL-EL7041]^STM Status^Status^Digital input 1;</span>
                              <span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">SSL</span><span class="o">-</span><span class="n">EL7041</span><span class="p">]</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Digital</span> <span class="nb">input</span> <span class="mi">2</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">nRawEncoderULINT</span>     <span class="o">:=</span> <span class="n">TIIB</span><span class="p">[</span><span class="n">IM1K3</span><span class="o">-</span><span class="n">EL5042</span><span class="p">]</span><span class="o">^</span><span class="n">FB</span> <span class="n">Inputs</span> <span class="n">Channel</span> <span class="mi">1</span><span class="o">^</span><span class="n">Position</span><span class="s1">&#39;}</span>
    <span class="n">M50</span><span class="p">:</span> <span class="n">ST_MotionStage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;QRIX:QUESTAR:MMS:02&#39;</span><span class="p">);</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">END_VAR</span>
</pre></div>
</div>
</section>
</section>
<section id="pous">
<h1>POUs<a class="headerlink" href="#pous" title="Link to this heading"></a></h1>
<section id="f-checkaxis">
<h2>F_CheckAxis<a class="headerlink" href="#f-checkaxis" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_CheckAxis</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stMotionStage</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">nComparisonCode</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">fQueryValue</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">CASE</span> <span class="n">nComparisonCode</span> <span class="n">OF</span>
    <span class="mi">0</span><span class="p">:</span> <span class="n">F_CheckAxis</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span>  <span class="n">fQueryValue</span> <span class="n">AND</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&lt;</span>  <span class="n">fQueryValue</span><span class="p">;</span> <span class="o">//</span> <span class="o">&lt;</span>
    <span class="mi">1</span><span class="p">:</span> <span class="n">F_CheckAxis</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;=</span> <span class="n">fQueryValue</span> <span class="n">AND</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&lt;=</span> <span class="n">fQueryValue</span><span class="p">;</span> <span class="o">//</span> <span class="o">&lt;=</span>
    <span class="mi">2</span><span class="p">:</span> <span class="n">F_CheckAxis</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span>  <span class="n">fQueryValue</span> <span class="n">AND</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&gt;</span>  <span class="n">fQueryValue</span><span class="p">;</span> <span class="o">//</span> <span class="o">&gt;</span>
    <span class="mi">3</span><span class="p">:</span> <span class="n">F_CheckAxis</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;=</span> <span class="n">fQueryValue</span> <span class="n">AND</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&gt;=</span> <span class="n">fQueryValue</span><span class="p">;</span> <span class="o">//</span> <span class="o">&lt;=</span>
<span class="n">ELSE</span>
    <span class="k">return</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</section>
<section id="f-checkaxisgeq">
<h2>F_CheckAxisGEQ<a class="headerlink" href="#f-checkaxisgeq" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_CheckAxisGEQ</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stMotionStage</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">fQueryValue</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_CheckAxisGEQ</span> <span class="o">:=</span> <span class="n">F_CheckAxis</span><span class="p">(</span><span class="n">stMotionStage</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fQueryValue</span><span class="p">);</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#f-checkaxis">F_CheckAxis</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="f-checkaxisgrt">
<h2>F_CheckAxisGRT<a class="headerlink" href="#f-checkaxisgrt" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_CheckAxisGRT</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stMotionStage</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">fQueryValue</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_CheckAxisGRT</span> <span class="o">:=</span> <span class="n">F_CheckAxis</span><span class="p">(</span><span class="n">stMotionStage</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fQueryValue</span><span class="p">);</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#f-checkaxis">F_CheckAxis</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="f-checkaxisleq">
<h2>F_CheckAxisLEQ<a class="headerlink" href="#f-checkaxisleq" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_CheckAxisLEQ</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stMotionStage</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">fQueryValue</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_CheckAxisLEQ</span> <span class="o">:=</span> <span class="n">F_CheckAxis</span><span class="p">(</span><span class="n">stMotionStage</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fQueryValue</span><span class="p">);</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#f-checkaxis">F_CheckAxis</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="f-checkaxisles">
<h2>F_CheckAxisLES<a class="headerlink" href="#f-checkaxisles" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_CheckAxisLES</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stMotionStage</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">fQueryValue</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">F_CheckAxisLES</span> <span class="o">:=</span> <span class="n">F_CheckAxis</span><span class="p">(</span><span class="n">stMotionStage</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fQueryValue</span><span class="p">);</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#f-checkaxis">F_CheckAxis</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="f-limit">
<h2>F_Limit<a class="headerlink" href="#f-limit" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_Limit</span> <span class="p">:</span> <span class="n">BOOL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">fVal</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fLLim</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fHLim</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">bInclusive</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInclusive</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="n">fLLim</span> <span class="o">&lt;=</span> <span class="n">fHLim</span> <span class="n">THEN</span>
        <span class="n">F_Limit</span> <span class="o">:=</span> <span class="n">fLLim</span> <span class="o">&lt;=</span> <span class="n">fVal</span> <span class="n">AND</span> <span class="n">fHLim</span> <span class="o">&gt;=</span> <span class="n">fVal</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="n">F_Limit</span> <span class="o">:=</span> <span class="n">fLLim</span> <span class="o">&gt;=</span> <span class="n">fVal</span> <span class="n">OR</span> <span class="n">fHLim</span> <span class="o">&lt;=</span> <span class="n">fVal</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">ELSE</span>
    <span class="n">IF</span> <span class="n">fLLim</span> <span class="o">&lt;=</span> <span class="n">fHLim</span> <span class="n">THEN</span>
        <span class="n">F_Limit</span> <span class="o">:=</span> <span class="n">fLLim</span> <span class="o">&lt;</span> <span class="n">fVal</span> <span class="n">AND</span> <span class="n">fHLim</span> <span class="o">&gt;</span> <span class="n">fVal</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="n">F_Limit</span> <span class="o">:=</span> <span class="n">fLLim</span> <span class="o">&gt;</span> <span class="n">fVal</span> <span class="n">OR</span> <span class="n">fHLim</span> <span class="o">&lt;</span> <span class="n">fVal</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</section>
<section id="f-targetcryoyposition">
<h2>F_TargetCryoYPosition<a class="headerlink" href="#f-targetcryoyposition" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION</span> <span class="n">F_TargetCryoYPosition</span> <span class="p">:</span> <span class="n">LREAL</span>
<span class="n">VAR_INPUT</span>
    <span class="n">fNeutralPosition</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fBraidDiameter</span>   <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPhiAngleDeg</span>     <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">F_TargetCryoYPosition</span> <span class="o">:=</span> <span class="n">fNeutralPosition</span> <span class="o">-</span> <span class="n">ABS</span><span class="p">(</span><span class="n">fBraidDiameter</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Cos</span><span class="p">(</span><span class="n">fPhiAngleDeg</span> <span class="o">*</span> <span class="mf">3.1415</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)));</span>

<span class="n">END_FUNCTION</span>
</pre></div>
</div>
</section>
<section id="fb-2axestrans">
<h2>FB_2AxesTrans<a class="headerlink" href="#fb-2axestrans" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_2AxesTrans</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stFirstAxis</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rEncoderOffsetFirst</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rEncoderOffsetSecound</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Distance</span> <span class="n">between</span> <span class="mi">1</span><span class="n">st</span> <span class="n">stage</span> <span class="ow">and</span> <span class="mi">2</span><span class="n">nd</span> <span class="n">stage</span><span class="o">*</span><span class="p">)</span>
    <span class="n">rDistance</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.48</span><span class="p">;</span>

    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>

    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbFirstStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbSecondStage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosFirstStage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosSecondStage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.03</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stFirst</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">stSecond</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: FIRST&#39;</span><span class="p">}</span>
    <span class="n">fbFirst</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: SECOND&#39;</span><span class="p">}</span>
    <span class="n">fbSecond</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">X_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqAngle</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">X</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActAngle</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>



     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>
    <span class="n">rTrig_Block</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Open</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Close</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqAngle</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span> <span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_Pos</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Angle</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;OPT_XPM_Translation&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Initialize</span>
<span class="n">ACT_init</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>

<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqPosition</span> <span class="o">&lt;&gt;</span> <span class="n">rReqPosition</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqPosition</span> <span class="o">:=</span> <span class="n">rReqPosition</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Position.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqAngle</span> <span class="o">&lt;&gt;</span> <span class="n">rReqAngle</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqAngle</span> <span class="o">:=</span> <span class="n">rReqAngle</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Angle&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span><span class="w"> </span><span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosFirstStage</span>              <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistance</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqAngle</span> <span class="o">+</span> <span class="n">rEncoderOffsetFirst</span><span class="p">;</span>
<span class="n">fPosSecondStage</span>             <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistance</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rReqAngle</span> <span class="o">+</span> <span class="n">rEncoderOffsetSecound</span><span class="p">;</span>



<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span><span class="w"> </span><span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rActPosition</span>        <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stFirstAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetFirst</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stSecondAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSecound</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">rActAngle</span>           <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">(</span> <span class="p">((</span><span class="n">stSecondAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetSecound</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stFirstAxis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetFirst</span><span class="p">))</span> <span class="o">/</span> <span class="n">rDistance</span> <span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stFirstAxis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stSecondAxis</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbFirstStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stFirstAxis</span><span class="p">);</span>
<span class="n">fbSecondStage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSecondAxis</span><span class="p">);</span>



<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;First&#39;</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosFirstStage</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stFirst</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stSecond</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Second&#39;</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosSecondStage</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stSecond</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>



<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbFirst</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbSecond</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbFirst</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stFirst</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stFirstAxis</span><span class="p">);</span>

<span class="n">fbSecond</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSecond</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSecondAxis</span><span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="fb-3axesjack">
<h2>FB_3AxesJack<a class="headerlink" href="#fb-3axesjack" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_3AxesJack</span>
<span class="n">VAR_IN_OUT</span>
    <span class="o">//</span> <span class="n">Jack</span> <span class="mi">1</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">axis</span> <span class="n">that</span><span class="p">,</span> <span class="n">when</span> <span class="n">higher</span> <span class="n">than</span> <span class="n">Jack</span> <span class="mi">2</span><span class="p">,</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">negative</span> <span class="n">pitch</span><span class="o">/</span><span class="n">roll</span>
    <span class="n">stJack1Axis</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Jack</span> <span class="mi">2</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">axis</span> <span class="n">that</span><span class="p">,</span> <span class="n">when</span> <span class="n">higher</span> <span class="n">than</span> <span class="n">Jack1</span><span class="p">,</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">positive</span> <span class="n">pitch</span><span class="o">/</span><span class="n">roll</span>
    <span class="n">stJack2Axis</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Jack</span> <span class="mi">3</span> <span class="n">must</span> <span class="n">be</span> <span class="n">used</span> <span class="k">as</span> <span class="n">the</span> <span class="n">jack</span> <span class="n">that</span> <span class="n">only</span> <span class="n">contributes</span> <span class="n">to</span> <span class="n">Roll</span> <span class="n">OR</span> <span class="n">only</span> <span class="n">contributes</span> <span class="n">to</span> <span class="n">Pitch</span>
    <span class="o">//</span> <span class="n">Assign</span> <span class="n">your</span> <span class="n">axes</span> <span class="n">such</span> <span class="n">that</span> <span class="n">this</span> <span class="n">jack</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">jack</span> <span class="n">that</span> <span class="n">can</span> <span class="n">only</span> <span class="n">do</span> <span class="n">roll</span> <span class="n">OR</span> <span class="n">pitch</span><span class="o">.</span>
    <span class="o">//</span> <span class="n">Jack</span> <span class="mi">3</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">positive</span> <span class="n">side</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pitch</span><span class="o">/</span><span class="n">roll</span><span class="p">,</span> <span class="n">so</span> <span class="n">to</span> <span class="n">reverse</span> <span class="n">the</span> <span class="n">sign</span> <span class="n">simply</span>
    <span class="o">//</span> <span class="n">supply</span> <span class="n">a</span> <span class="n">negative</span> <span class="n">rDistanceX</span> <span class="ow">or</span> <span class="n">rDistanceY</span><span class="p">,</span> <span class="n">the</span> <span class="n">choice</span> <span class="n">of</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">negative</span> <span class="n">depends</span> <span class="n">on</span>
    <span class="o">//</span> <span class="n">whether</span> <span class="n">JAck3</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">axis</span> <span class="n">that</span> <span class="n">does</span> <span class="n">only</span> <span class="n">roll</span> <span class="ow">or</span> <span class="n">only</span> <span class="n">pitch</span><span class="o">.</span>
    <span class="n">stJack3Axis</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bMoveToPosition</span><span class="p">;</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveToPosition</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bMoveToPitch</span><span class="p">;</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveToPitch</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">bMoveToRoll</span><span class="p">;</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveToRoll</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Desired</span> <span class="n">height</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="ow">and</span> <span class="n">roll</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Y_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqPitch</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ROLL_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqRoll</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack1</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack1</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack2</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack2</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Jack3</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetJack3</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">The</span> <span class="n">distance</span> <span class="n">along</span> <span class="n">the</span> <span class="n">pitch</span> <span class="n">axis</span> <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">sides</span> <span class="n">of</span> <span class="n">jacks</span><span class="o">.</span>
    <span class="n">rDistanceX</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.24</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">distance</span> <span class="n">along</span> <span class="n">the</span> <span class="n">roll</span> <span class="n">axis</span> <span class="n">between</span> <span class="n">the</span> <span class="n">two</span> <span class="n">sides</span> <span class="n">of</span> <span class="n">jacks</span><span class="o">.</span>
    <span class="n">rDistanceZ</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.88</span><span class="p">;</span>
    <span class="n">bJack3DoesPitch</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">rLimitPositionMax</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="n">rLimitPositionMin</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">8</span><span class="p">;</span>
    <span class="n">rLimitPitchMin</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitPitchMax</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span>  <span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitRollMin</span><span class="p">:</span> <span class="n">REAL</span>  <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
    <span class="n">rLimitRollMax</span><span class="p">:</span> <span class="n">REAL</span>  <span class="o">:=</span>  <span class="mi">18</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Home</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
    <span class="n">fbJack1Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbJack2Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbJack3Stage</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosJack1Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosJack2Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosJack3Stage</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stJack1</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">stJack2</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">stJack3</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK1&#39;</span><span class="p">}</span>
    <span class="n">fbJack1</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK2&#39;</span><span class="p">}</span>
    <span class="n">fbJack2</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: JACK3&#39;</span><span class="p">}</span>
    <span class="n">fbJack3</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqPitch</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqRoll</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Y</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPosition</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PITCH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActPitch</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ROLL</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActRoll</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span> <span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_Pos</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Angle</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">fbPower</span><span class="p">:</span> <span class="n">MC_POWER</span><span class="p">;</span>

    <span class="n">y1</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">y2</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">y3</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">y12Ave</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">y12Diff</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>

<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Software</span> <span class="n">Limits</span> <span class="n">to</span> <span class="n">protect</span> <span class="n">blades</span>
<span class="n">ACT_VirtualLimitSW</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rOldReqPosition</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="n">OR</span> <span class="n">bMoveToPosition</span> <span class="n">THEN</span>
        <span class="n">rOldReqPosition</span> <span class="o">:=</span> <span class="n">rReqPosition</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Position.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">rActPosition</span><span class="p">;</span>
    <span class="n">rOldReqPosition</span> <span class="o">:=</span> <span class="n">rReqPosition</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rReqPitch</span> <span class="o">-</span> <span class="n">rOldReqPitch</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="n">OR</span> <span class="n">bMoveToPitch</span> <span class="n">THEN</span>
    <span class="n">rOldReqPitch</span> <span class="o">:=</span> <span class="n">rReqPitch</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Pitch&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">rReqPitch</span> <span class="o">:=</span> <span class="n">rActPitch</span><span class="p">;</span>
    <span class="n">rOldReqPitch</span> <span class="o">:=</span> <span class="n">rReqPitch</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rReqRoll</span> <span class="o">-</span> <span class="n">rOldReqRoll</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="n">OR</span> <span class="n">bMoveToRoll</span> <span class="n">THEN</span>
    <span class="n">rOldReqRoll</span> <span class="o">:=</span> <span class="n">rReqRoll</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Roll&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">rReqRoll</span> <span class="o">:=</span> <span class="n">rActRoll</span><span class="p">;</span>
    <span class="n">rOldReqRoll</span> <span class="o">:=</span> <span class="n">rReqRoll</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span><span class="w"> </span><span class="nn">requested</span> <span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="ow">and</span> <span class="n">midpoint</span> <span class="n">height</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">bJack3DoesPitch</span> <span class="n">THEN</span>
    <span class="n">fPosJack1Stage</span> <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">-</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack1</span><span class="p">;</span>
    <span class="n">fPosJack2Stage</span> <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">-</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack2</span><span class="p">;</span>
    <span class="n">fPosJack3Stage</span> <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack3</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">fPosJack1Stage</span> <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">-</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack1</span><span class="p">;</span>
    <span class="n">fPosJack2Stage</span> <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">-</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">+</span> <span class="n">rDistanceZ</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqPitch</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack2</span><span class="p">;</span>
    <span class="n">fPosJack3Stage</span> <span class="o">:=</span> <span class="n">rReqPosition</span> <span class="o">+</span> <span class="n">rDistanceX</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rReqRoll</span> <span class="o">+</span> <span class="n">rEncoderOffsetJack3</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span><span class="w"> </span><span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">y1</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">y2</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">y3</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
<span class="n">y12Ave</span> <span class="o">:=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span>
<span class="n">y12Diff</span> <span class="o">:=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Compute</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">height</span> <span class="n">of</span> <span class="n">the</span> <span class="n">midpoint</span> <span class="n">of</span> <span class="n">the</span> <span class="n">three</span> <span class="n">jacks</span><span class="o">.</span>
<span class="n">rActPosition</span> <span class="o">:=</span> <span class="p">(</span><span class="n">y12Ave</span> <span class="o">+</span> <span class="n">y3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Compute</span> <span class="n">the</span> <span class="n">roll</span> <span class="ow">and</span> <span class="n">pitch</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">the</span> <span class="n">relative</span> <span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">three</span> <span class="n">jacks</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">bJack3DoesPitch</span> <span class="n">THEN</span>
    <span class="n">rActPitch</span> <span class="o">:=</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y12Ave</span><span class="p">)</span> <span class="o">/</span> <span class="n">rDistanceZ</span><span class="p">;</span>
    <span class="n">rActRoll</span>  <span class="o">:=</span> <span class="n">y12Diff</span> <span class="o">/</span> <span class="n">rDistanceX</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">rActRoll</span> <span class="o">:=</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y12Ave</span><span class="p">)</span> <span class="o">/</span> <span class="n">rDistanceX</span><span class="p">;</span>
    <span class="n">rActPitch</span>  <span class="o">:=</span> <span class="n">y12Diff</span> <span class="o">/</span> <span class="n">rDistanceZ</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbJack1Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack1Axis</span><span class="p">);</span>
<span class="n">fbJack2Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack2Axis</span><span class="p">);</span>
<span class="n">fbJack3Stage</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack3Axis</span><span class="p">);</span>

<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack1&#39;</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack1Stage</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack1</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stJack2</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack2&#39;</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack2Stage</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack2</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stJack3</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Jack3&#39;</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosJack3Stage</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stJack3</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbJack1</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbJack2</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbJack3</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbJack1</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack1</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack1Axis</span><span class="p">);</span>

<span class="n">fbJack2</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack2</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack2Axis</span><span class="p">);</span>

<span class="n">fbJack3</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stJack3</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stJack3Axis</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_VirtualLimitSW</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Set</span> <span class="n">SafetyReady</span> <span class="n">flags</span> <span class="n">manually</span>
<span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Note</span><span class="p">:</span> <span class="n">FB_MotionStage</span> <span class="n">calls</span> <span class="n">FB_SetEnables</span> <span class="n">internally</span> <span class="n">that</span> <span class="n">overwrites</span> <span class="o">.</span><span class="n">bAllForwardEnable</span><span class="o">/.</span><span class="n">bAllBackwardEnable</span> <span class="n">flags</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&lt;=</span> <span class="n">rLimitPitchMax</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack1Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&gt;=</span> <span class="n">rLimitPitchMin</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActRoll</span> <span class="o">&lt;=</span> <span class="n">rLimitRollMax</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack2Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActRoll</span> <span class="o">&gt;=</span> <span class="n">rLimitRollMin</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllForwardEnable</span>  <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&lt;=</span> <span class="n">rLimitPositionMax</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&gt;=</span> <span class="n">rLimitPitchMin</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stJack3Axis</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">rActPosition</span> <span class="o">&gt;=</span> <span class="n">rLimitPositionMin</span> <span class="n">AND</span> <span class="n">rActPitch</span> <span class="o">&lt;=</span> <span class="n">rLimitPitchMax</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="fb-autorealigncouple">
<h2>FB_AutoRealignCouple<a class="headerlink" href="#fb-autorealigncouple" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_AutoRealignCouple</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stMotionStageLeader</span><span class="p">:</span>  <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stMotionStageFollow</span><span class="p">:</span>  <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stAutoRealignCouple</span><span class="p">:</span>  <span class="n">ST_AutoRealignCouple</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">tTimeout</span><span class="p">:</span> <span class="n">TIME</span><span class="p">;</span>
    <span class="n">tStateTimeout</span><span class="p">:</span> <span class="n">TIME</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#1s;</span>
    <span class="n">tonTimeout</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tonRecouple</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">STANDBY</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bCoupled</span> <span class="o">:=</span> <span class="n">stMotionStageLeader</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">CoupleState</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">AND</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">CoupleState</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="n">CASE</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>

    <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">STANDBY</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecute</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">DECOUPLE_AXES</span><span class="p">;</span>
        <span class="n">END_IF</span>
        <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>

    <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">DECOUPLE_AXES</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">gantry</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">coupled</span><span class="p">,</span> <span class="n">the</span> <span class="n">motor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">busy</span><span class="p">,</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">then</span> <span class="n">decouple</span> <span class="n">the</span> <span class="n">axes</span><span class="o">.</span>
        <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">tStateTimeout</span><span class="p">);</span>
        <span class="n">IF</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bCoupled</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">COMMAND_AXES_INTO_REALIGNMENT</span><span class="p">;</span>
            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bCoupled</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">COMMAND_AXES_INTO_REALIGNMENT</span><span class="p">;</span>
            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">sCustomErrorMessage</span> <span class="o">:=</span> <span class="s1">&#39;Cannot autorealign axes if the follower axis is in an error state.&#39;</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">tonTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">sCustomErrorMessage</span> <span class="o">:=</span> <span class="s1">&#39;Failed to decouple axes before timeout.&#39;</span><span class="p">;</span>
        <span class="n">END_IF</span>

    <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">COMMAND_AXES_INTO_REALIGNMENT</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">gantry</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">coupled</span><span class="p">,</span> <span class="n">the</span> <span class="n">motor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">busy</span><span class="p">,</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">then</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">decouple</span> <span class="n">command</span> <span class="ow">and</span>
        <span class="o">//</span> <span class="n">command</span> <span class="n">the</span> <span class="n">follower</span> <span class="n">axis</span> <span class="n">to</span> <span class="n">align</span> <span class="k">with</span> <span class="n">the</span> <span class="n">leader</span> <span class="n">axis</span><span class="o">.</span>
        <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">tStateTimeout</span><span class="p">);</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bCoupled</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">stMotionStageLeader</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">fRealignSpeed</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bMoveCmd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">WAIT_FOR_MOVE_START</span><span class="p">;</span>
            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">sCustomErrorMessage</span> <span class="o">:=</span> <span class="s1">&#39;Cannot autorealign axes if the follower axis is in an error state.&#39;</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">tonTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">sCustomErrorMessage</span> <span class="o">:=</span> <span class="s1">&#39;Failed to decouple axes before timeout.&#39;</span><span class="p">;</span>
            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">END_IF</span>

    <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">WAIT_FOR_MOVE_START</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">the</span> <span class="n">following</span> <span class="n">motor</span> <span class="n">to</span> <span class="n">reach</span> <span class="n">the</span> <span class="n">busy</span> <span class="n">status</span><span class="p">,</span> <span class="n">then</span> <span class="n">proceed</span><span class="o">.</span>
        <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">tStateTimeout</span><span class="p">);</span>
        <span class="n">IF</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">RECOUPLE_AXES</span><span class="p">;</span>

            <span class="o">//</span> <span class="n">Estimate</span> <span class="n">the</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">time</span> <span class="n">it</span> <span class="n">should</span> <span class="n">take</span> <span class="n">to</span> <span class="n">make</span> <span class="n">the</span> <span class="n">move</span><span class="p">,</span> <span class="n">use</span> <span class="n">a</span> <span class="n">minimum</span> <span class="n">time</span> <span class="n">of</span> <span class="n">the</span> <span class="n">state</span> <span class="n">timeout</span> <span class="n">time</span><span class="o">.</span>
            <span class="n">tTimeout</span> <span class="o">:=</span> <span class="n">LREAL_TO_TIME</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">stMotionStageLeader</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">/</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">fRealignSpeed</span> <span class="o">*</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">);</span>
            <span class="n">IF</span> <span class="n">tTimeout</span> <span class="o">&lt;</span> <span class="n">tStateTimeout</span> <span class="n">THEN</span>
                <span class="n">tTimeout</span> <span class="o">:=</span> <span class="n">tStateTimeout</span><span class="p">;</span>
            <span class="n">END_IF</span>

            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">tonTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">sCustomErrorMessage</span> <span class="o">:=</span> <span class="s1">&#39;Failed to start motor move before timeout.&#39;</span><span class="p">;</span>
        <span class="n">END_IF</span>

    <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">RECOUPLE_AXES</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">follower</span> <span class="n">motor</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">busy</span> <span class="p">(</span><span class="n">finished</span> <span class="ow">or</span> <span class="n">errored</span> <span class="ow">or</span> <span class="n">stopped</span><span class="p">)</span> <span class="n">then</span> <span class="n">recouple</span> <span class="n">the</span> <span class="n">follower</span> <span class="n">motor</span> <span class="n">to</span>
        <span class="o">//</span> <span class="n">the</span> <span class="n">leader</span> <span class="n">motor</span><span class="o">.</span>
        <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">tTimeout</span> <span class="o">+</span> <span class="n">T</span><span class="c1">#250ms);</span>
        <span class="n">tonRecouple</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#250ms);</span>
        <span class="n">IF</span> <span class="n">tonRecouple</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">CLEANUP</span><span class="p">;</span>
            <span class="n">tonRecouple</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">tonTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">sCustomErrorMessage</span> <span class="o">:=</span> <span class="s1">&#39;Failed to recouple motors after move.&#39;</span><span class="p">;</span>
            <span class="n">tonRecouple</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">END_IF</span>

    <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">CLEANUP</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">motors</span> <span class="n">are</span> <span class="n">coupled</span> <span class="n">again</span> <span class="n">then</span> <span class="n">reinitialize</span> <span class="n">the</span> <span class="n">bits</span> <span class="n">to</span>
        <span class="o">//</span> <span class="n">get</span> <span class="n">them</span> <span class="n">ready</span> <span class="k">for</span> <span class="n">another</span> <span class="n">realignment</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">future</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bCoupled</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">STANDBY</span><span class="p">;</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSE</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">RECOUPLE_AXES</span><span class="p">;</span>
        <span class="n">END_IF</span>

    <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Timeout</span><span class="p">:</span> <span class="n">In</span> <span class="n">case</span> <span class="n">something</span> <span class="n">bad</span> <span class="n">happens</span><span class="p">,</span> <span class="n">have</span> <span class="n">the</span> <span class="n">timeout</span> <span class="n">timer</span> <span class="ow">in</span> <span class="n">place</span> <span class="n">to</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">bits</span> <span class="n">to</span> <span class="n">guarantee</span> <span class="n">we</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">get</span>
        <span class="o">//</span>          <span class="n">stuck</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">recoupling</span> <span class="ow">and</span> <span class="n">alignment</span> <span class="n">sequence</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bCoupled</span> <span class="n">OR</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">stMotionStageFollow</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">END_IF</span>
        <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">stAutoRealignCouple</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_RealignCoupleState</span><span class="o">.</span><span class="n">STANDBY</span><span class="p">;</span>
        <span class="n">tonTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">tonRecouple</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-realigncouplestate">E_RealignCoupleState</a></p></li>
<li><p><a class="reference internal" href="#st-autorealigncouple">ST_AutoRealignCouple</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-coordinategantryaxisenable">
<h2>FB_CoordinateGantryAxisEnable<a class="headerlink" href="#fb-coordinategantryaxisenable" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_CoordinateGantryAxisEnable
VAR_IN_OUT
    stMotionStageLeader: ST_MotionStage;
    stMotionStageFollow: ST_MotionStage;
    stCoordinateGantryAxisEnable: ST_CoordinateGantryAxisEnable;
END_VAR
VAR
    bInit: BOOL := TRUE;
    rtExecuteMove: R_TRIG;
    tonTimeout: TON;
    bMovePos: BOOL;
    bMoveNeg: BOOL;
    bMovePosAndOK: BOOL;
    bMoveNegAndOK: BOOL;
END_VAR
IF bInit THEN
    bInit := FALSE;
    stCoordinateGantryAxisEnable.eState := E_GantryEnableState.STANDBY;
END_IF

CASE stCoordinateGantryAxisEnable.eState OF

    E_GantryEnableState.STANDBY:
        IF stMotionStageLeader.bExecute AND stCoordinateGantryAxisEnable.bEnable THEN
            rtExecuteMove(CLK:=FALSE);
            stMotionStageLeader.bExecute := FALSE;
            stMotionStageLeader.bEnable := TRUE;
            stMotionStageFollow.bEnable := TRUE;
            stCoordinateGantryAxisEnable.eState := E_GantryEnableState.WAIT_FOR_FULLY_ENABLED;
        ELSIF stMotionStageLeader.bExecute AND NOT stCoordinateGantryAxisEnable.bEnable THEN
            stMotionStageLeader.bExecute := FALSE;
            stMotionStageLeader.bError := TRUE;
            stMotionStageFollow.bError := TRUE;
            stMotionStageLeader.sCustomErrorMessage := &#39;Move Failed. The gantry is currently disabled.&#39;;
            stMotionStageFollow.sCustomErrorMessage := stMotionStageLeader.sCustomErrorMessage;
        ELSE
            stMotionStageLeader.bEnable := FALSE;
            stMotionStageFollow.bEnable := FALSE;
        END_IF
        tonTimeout(IN:=FALSE);

    E_GantryEnableState.WAIT_FOR_FULLY_ENABLED:
        // Wait until the logic confirms both motors are fully enabled
        tonTimeout(IN:=NOT stMotionStageLeader.bAllEnable OR NOT stMotionStageFollow.bAllEnable,PT:=stCoordinateGantryAxisEnable.tTimeout);

        // Check which direction we are moving, and if the directional enables will allow that move.
        bMovePos        := stMotionStageLeader.stAxisStatus.fActPosition &lt; stMotionStageLeader.fPosition;
        bMoveNeg        := stMotionStageLeader.stAxisStatus.fActPosition &gt; stMotionStageLeader.fPosition;
        bMovePosAndOK   := bMovePos AND stMotionStageLeader.bAllForwardEnable AND stMotionStageFollow.bAllForwardEnable;
        bMoveNegAndOK   := bMoveNeg AND stMotionStageLeader.bAllBackwardEnable AND stMotionStageFollow.bAllBackwardEnable;

        // Check for fully enabled
        IF stMotionStageLeader.bAllEnable AND stMotionStageFollow.bAllEnable THEN
            // Check direction of motion and if that direction is enabled
            IF bMovePosAndOK OR bMoveNegAndOK THEN
                stCoordinateGantryAxisEnable.eState := E_GantryEnableState.WAIT_FOR_READY_STATE;
                tonTimeout(IN:=FALSE);
            ELSE
                // Direction of motion is not enabled, so let&#39;s report the error and give a helpful error message.
                stMotionStageLeader.bError := TRUE;
                stMotionStageFollow.bError := TRUE;
                IF bMovePos THEN
                    IF NOT stMotionStageLeader.bLimitForwardEnable THEN
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move forward failed due to forward limit switch.&#39;;
                        stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move forward failed due to forward limit switch for &#39;,stMotionStageLeader.sName);
                    ELSIF NOT stMotionStageFollow.bLimitForwardEnable THEN
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move forward failed due to forward limit switch.&#39;;
                        stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move forward failed due to forward limit switch for &#39;,stMotionStageFollow.sName);
                    ELSIF NOT stMotionStageLeader.bGantryForwardEnable AND stMotionStageLeader.bGantryAxis THEN
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move forward failed due to gantry motion tolerance limit.&#39;;
                        stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move forward failed due to gantry motion tolerance limit for &#39;,stMotionStageLeader.sName);
                    ELSIF NOT stMotionStageFollow.bGantryForwardEnable AND stMotionStageFollow.bGantryAxis THEN
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move forward failed due to gantry motion tolerance limit.&#39;;
                        stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move forward failed due to gantry motion tolerance limit for &#39;,stMotionStageFollow.sName);
                    ELSIF NOT stMotionStageLeader.stEPSForwardEnable.bEPS_OK THEN
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move forward failed due to EPS condition.&#39;;
                        stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move forward failed due to EPS condition for &#39;,stMotionStageLeader.sName);
                    ELSIF NOT stMotionStageFollow.stEPSForwardEnable.bEPS_OK THEN
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move forward failed due to EPS condition.&#39;;
                        stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move forward failed due to EPS condition for &#39;,stMotionStageFollow.sName);
                    ELSE
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move forward failed for unspecified reason.&#39;;
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move forward failed for unspecified reason.&#39;;
                    END_IF
                ELSIF bMoveNeg THEN
                    IF NOT stMotionStageLeader.bLimitBackwardEnable THEN
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move backward failed due to forward limit switch.&#39;;
                        stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move backward failed due to forward limit switch for &#39;,stMotionStageLeader.sName);
                    ELSIF NOT stMotionStageFollow.bLimitBackwardEnable THEN
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move backward failed due to forward limit switch.&#39;;
                        stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move backward failed due to forward limit switch for &#39;,stMotionStageFollow.sName);
                    ELSIF NOT stMotionStageLeader.bGantryBackwardEnable AND stMotionStageLeader.bGantryAxis THEN
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move backward failed due to gantry motion tolerance limit.&#39;;
                        stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move backward failed due to gantry motion tolerance limit for &#39;,stMotionStageLeader.sName);
                    ELSIF NOT stMotionStageFollow.bGantryBackwardEnable AND stMotionStageFollow.bGantryAxis THEN
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move backward failed due to gantry motion tolerance limit.&#39;;
                        stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move backward failed due to gantry motion tolerance limit for &#39;,stMotionStageFollow.sName);
                    ELSIF NOT stMotionStageLeader.stEPSBackwardEnable.bEPS_OK THEN
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move backward failed due to EPS condition.&#39;;
                        stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move backward failed due to EPS condition for &#39;,stMotionStageLeader.sName);
                    ELSIF NOT stMotionStageFollow.stEPSBackwardEnable.bEPS_OK THEN
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move backward failed due to EPS condition.&#39;;
                        stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move backward failed due to EPS condition for &#39;,stMotionStageFollow.sName);
                    ELSE
                        stMotionStageLeader.sCustomErrorMessage := &#39;Move backward failed for unspecified reason.&#39;;
                        stMotionStageFollow.sCustomErrorMessage := &#39;Move backward failed for unspecified reason.&#39;;
                    END_IF
                ELSE
                    stMotionStageLeader.sCustomErrorMessage := &#39;Move failed because it was not large enough to register.&#39;;
                    stMotionStageFollow.sCustomErrorMessage := &#39;Move failed because it was not large enough to register.&#39;;
                END_IF
            stCoordinateGantryAxisEnable.eState := E_GantryEnableState.ERROR;
            END_IF
        ELSIF tonTimeout.Q THEN
            stMotionStageLeader.bError := TRUE;
            stMotionStageFollow.bError := TRUE;
            IF NOT stMotionStageLeader.bEnable THEN
                stMotionStageLeader.sCustomErrorMessage := &#39;Move never enabled because bEnable never received.&#39;;
                stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move never enabled because bEnable never received on &#39;,stMotionStageLeader.sName);
            ELSIF NOT stMotionStageFollow.bEnable THEN
                stMotionStageFollow.sCustomErrorMessage := &#39;Move never enabled because bEnable never received.&#39;;
                stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move never enabled because bEnable never received on &#39;,stMotionStageFollow.sName);
            ELSIF NOT stMotionStageLeader.bHardwareEnable THEN
                stMotionStageLeader.sCustomErrorMessage := &#39;Move never enabled because bHardwareEnable set false.&#39;;
                stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move never enabled because bHardwareEnable set false on &#39;,stMotionStageLeader.sName);
            ELSIF NOT stMotionStageFollow.bHardwareEnable THEN
                stMotionStageFollow.sCustomErrorMessage := &#39;Move never enabled because bHardwareEnable set false.&#39;;
                stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move never enabled because bHardwareEnable set false on &#39;,stMotionStageFollow.sName);
            ELSIF NOT stMotionStageLeader.stEPSPowerEnable.bEPS_OK THEN
                stMotionStageLeader.sCustomErrorMessage := &#39;Move never enabled because of EPS condition.&#39;;
                stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move never enabled because of EPS condition on &#39;,stMotionStageLeader.sName);
            ELSIF NOT stMotionStageFollow.stEPSPowerEnable.bEPS_OK THEN
                stMotionStageFollow.sCustomErrorMessage := &#39;Move never enabled because of EPS condition.&#39;;
                stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move never enabled because of EPS condition on &#39;,stMotionStageFollow.sName);
            ELSIF NOT stMotionStageLeader.bUserEnable THEN
                stMotionStageLeader.sCustomErrorMessage := &#39;Move never enabled because user enable is set to false.&#39;;
                stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move never enabled because user enable is set to false on &#39;,stMotionStageLeader.sName);
            ELSIF NOT stMotionStageFollow.bUserEnable THEN
                stMotionStageFollow.sCustomErrorMessage := &#39;Move never enabled because user enable is set to false.&#39;;
                stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move never enabled because user enable is set to false on &#39;,stMotionStageFollow.sName);
            ELSE
                stMotionStageLeader.sCustomErrorMessage := &#39;Move never enabled in the timeout duration.&#39;;
                stMotionStageFollow.sCustomErrorMessage := &#39;Move never enabled in the timeout duration.&#39;;
            END_IF
            stCoordinateGantryAxisEnable.eState := E_GantryEnableState.ERROR;
        END_IF

    E_GantryEnableState.WAIT_FOR_READY_STATE:
        // Wait for the motor drives to switch to the ready state before commanding the move.
        tonTimeout(IN:=NOT stCoordinateGantryAxisEnable.bLeaderDriveReady OR NOT stCoordinateGantryAxisEnable.bFollowDriveReady,PT:=stCoordinateGantryAxisEnable.tTimeout);

        // Are both drives reporting that they are ready?
        IF stCoordinateGantryAxisEnable.bLeaderDriveReady AND stCoordinateGantryAxisEnable.bFollowDriveReady THEN
            stCoordinateGantryAxisEnable.eState := E_GantryEnableState.DELAY_FOR_MOVE_START;
            tonTimeout(IN:=FALSE);
        ELSIF tonTimeout.Q THEN
            stMotionStageLeader.bError := TRUE;
            stMotionStageFollow.bError := TRUE;
            IF NOT stCoordinateGantryAxisEnable.bLeaderDriveReady THEN
                stMotionStageLeader.sCustomErrorMessage := &#39;Move failed because motor drive did not get ready status before timeout.&#39;;
                stMotionStageFollow.sCustomErrorMessage := CONCAT(&#39;Move failed because &#39;,CONCAT(stMotionStageLeader.sName,&#39; drive did not get ready status before timeout.&#39;));
            ELSE
                stMotionStageFollow.sCustomErrorMessage := &#39;Move failed because motor drive did not get ready status before timeout.&#39;;
                stMotionStageLeader.sCustomErrorMessage := CONCAT(&#39;Move failed because &#39;,CONCAT(stMotionStageFollow.sName,&#39; did not get ready status before timeout.&#39;));
            END_IF
            stCoordinateGantryAxisEnable.eState := E_GantryEnableState.ERROR;
        END_IF

    E_GantryEnableState.DELAY_FOR_MOVE_START:
        // Allow the move execution to begin
        rtExecuteMove(CLK:=TRUE);
        IF rtExecuteMove.Q THEN
            stMotionStageLeader.bExecute := TRUE;
        END_IF
        tonTimeout(IN:=NOT stMotionStageLeader.bBusy,PT:=T#100ms);
        IF tonTimeout.Q THEN
            stCoordinateGantryAxisEnable.eState := E_GantryEnableState.STANDBY;
        END_IF

    E_GantryEnableState.ERROR:
        // Error handling
        stCoordinateGantryAxisEnable.eState := E_GantryEnableState.STANDBY;

ELSE
    stCoordinateGantryAxisEnable.eState := E_GantryEnableState.ERROR;
END_CASE

END_FUNCTION_BLOCK
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-gantryenablestate">E_GantryEnableState</a></p></li>
<li><p><a class="reference internal" href="#st-coordinategantryaxisenable">ST_CoordinateGantryAxisEnable</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-measurereferencevelocity">
<h2>FB_MeasureReferenceVelocity<a class="headerlink" href="#fb-measurereferencevelocity" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_MeasureReferenceVelocity</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stMotionStage</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">nMicrostepsPerStep</span><span class="p">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">64</span><span class="p">;</span> <span class="o">//</span> <span class="mi">64</span> <span class="k">for</span> <span class="n">Beckhoff</span> <span class="n">stepper</span> <span class="n">drives</span> <span class="n">EL7047</span><span class="p">,</span> <span class="n">EL7037</span><span class="p">,</span> <span class="n">EL7041</span><span class="p">,</span> <span class="n">EL7031</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fMeasuredReferenceVelocity</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nState</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">fbReadDriveAddress</span><span class="p">:</span> <span class="n">MC_ReadDriveAddress</span><span class="p">;</span>
    <span class="n">nMicrostepCounter</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">In</span> <span class="n">microsteps</span> <span class="p">(</span><span class="mi">64</span> <span class="n">microsteps</span> <span class="n">per</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">bCounterOverflow</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bCounterUnderflow</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nMaxStepFrequencyBuffer</span><span class="p">:</span> <span class="n">BYTE</span><span class="p">;</span> <span class="o">//</span> <span class="n">An</span> <span class="n">enum</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="nb">max</span> <span class="n">step</span> <span class="n">frequency</span>
    <span class="n">fbReadCoEMaxStepFrequency</span><span class="p">:</span> <span class="n">FB_ReadCoE</span><span class="p">;</span>
    <span class="n">nMaxStepFrequency</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">Fullsteps</span> <span class="n">per</span> <span class="n">Second</span>
    <span class="n">fStartingInternalPosition</span><span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">fEndingInternalPosition</span><span class="p">:</span> <span class="n">DINT</span><span class="p">;</span>
    <span class="n">fStartingEUPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fEndingEUPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fDeltaEUPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fDeltaInternalPosition</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fDeltaSteps</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fEUPerStep</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">rtOverflow</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rtUnderflow</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">nDriveAddressReadState</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">bDriveAddressValid</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">CASE</span> <span class="n">nDriveAddressReadState</span> <span class="n">OF</span>
<span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">bDriveAddressValid</span> <span class="n">THEN</span>
        <span class="n">nDriveAddressReadState</span> <span class="o">:=</span> <span class="n">nDriveAddressReadState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">fbReadDriveAddress</span><span class="p">(</span>
            <span class="n">Axis</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
            <span class="n">Execute</span><span class="o">:=</span><span class="n">FALSE</span>
        <span class="p">);</span>
    <span class="n">END_IF</span>
<span class="mi">0</span><span class="p">:</span> <span class="o">//</span> <span class="n">Read</span> <span class="n">drive</span> <span class="n">address</span>
    <span class="n">fbReadDriveAddress</span><span class="p">(</span>
        <span class="n">Axis</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
        <span class="n">Execute</span><span class="o">:=</span><span class="n">TRUE</span>
    <span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbReadDriveAddress</span><span class="o">.</span><span class="n">Busy</span> <span class="n">THEN</span>
        <span class="n">nDriveAddressReadState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDriveAddressValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">ELSIF</span> <span class="n">fbReadDriveAddress</span><span class="o">.</span><span class="n">Error</span> <span class="n">THEN</span>
        <span class="n">nDriveAddressReadState</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">100</span><span class="p">:</span>
    <span class="n">nDriveAddressReadState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="n">END_CASE</span>

<span class="n">CASE</span> <span class="n">nState</span> <span class="n">OF</span>
<span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">IF</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bDriveAddressValid</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">fStartingInternalPosition</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">fEndingInternalPosition</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">rtOverflow</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bCounterOverflow</span><span class="p">);</span>
        <span class="n">rtUnderflow</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bCounterUnderflow</span><span class="p">);</span>
        <span class="n">fbReadCoEMaxStepFrequency</span><span class="p">(</span>
            <span class="n">bExecute</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">,</span>
            <span class="n">pBuffer</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nMaxStepFrequencyBuffer</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">bDriveAddressValid</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">0</span><span class="p">:</span> <span class="o">//</span> <span class="n">A</span> <span class="n">move</span> <span class="n">has</span> <span class="n">started</span> <span class="n">so</span> <span class="n">read</span> <span class="n">the</span> <span class="n">starting</span> <span class="n">position</span> <span class="n">information</span>
    <span class="n">fbReadCoEMaxStepFrequency</span><span class="p">(</span>
        <span class="n">bExecute</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
        <span class="n">pBuffer</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nMaxStepFrequencyBuffer</span><span class="p">),</span>
        <span class="n">sNetId</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">DriveAddress</span><span class="o">.</span><span class="n">NetID</span><span class="p">,</span>
        <span class="n">nSlaveAddr</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">DriveAddress</span><span class="o">.</span><span class="n">SlaveAddress</span><span class="p">,</span>
        <span class="n">nDesiredCoEIndex</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#8012,</span>
        <span class="n">nDesiredCoESubIndex</span><span class="o">:=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">nBufferLength</span><span class="o">:=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">bBusy</span><span class="o">=&gt;</span><span class="p">,</span>
        <span class="n">bError</span><span class="o">=&gt;</span>
    <span class="p">);</span>
    <span class="n">IF</span> <span class="n">fbReadCoEMaxStepFrequency</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="n">nState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">ELSIF</span> <span class="n">fbReadCoEMaxStepFrequency</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">1</span><span class="p">:</span>
    <span class="n">fbReadCoEMaxStepFrequency</span><span class="p">(</span>
        <span class="n">bExecute</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
        <span class="n">pBuffer</span><span class="o">:=</span><span class="n">ADR</span><span class="p">(</span><span class="n">nMaxStepFrequencyBuffer</span><span class="p">),</span>
        <span class="n">sNetId</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">DriveAddress</span><span class="o">.</span><span class="n">NetID</span><span class="p">,</span>
        <span class="n">nSlaveAddr</span><span class="o">:=</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">DriveAddress</span><span class="o">.</span><span class="n">SlaveAddress</span><span class="p">,</span>
        <span class="n">nDesiredCoEIndex</span><span class="o">:=</span><span class="mi">16</span><span class="c1">#8012,</span>
        <span class="n">nDesiredCoESubIndex</span><span class="o">:=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">nBufferLength</span><span class="o">:=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">bBusy</span><span class="o">=&gt;</span><span class="p">,</span>
        <span class="n">bError</span><span class="o">=&gt;</span>
    <span class="p">);</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbReadCoEMaxStepFrequency</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="n">nState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">fStartingEUPosition</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
        <span class="n">fStartingInternalPosition</span> <span class="o">:=</span> <span class="n">nMicrostepCounter</span><span class="p">;</span>

        <span class="n">CASE</span> <span class="n">nMaxStepFrequencyBuffer</span> <span class="n">OF</span>
        <span class="mi">0</span><span class="p">:</span>
            <span class="n">nMaxStepFrequency</span> <span class="o">:=</span> <span class="mi">1000</span><span class="p">;</span>
        <span class="mi">1</span><span class="p">:</span>
            <span class="n">nMaxStepFrequency</span> <span class="o">:=</span> <span class="mi">2000</span><span class="p">;</span>
        <span class="mi">2</span><span class="p">:</span>
            <span class="n">nMaxStepFrequency</span> <span class="o">:=</span> <span class="mi">4000</span><span class="p">;</span>
        <span class="mi">3</span><span class="p">:</span>
            <span class="n">nMaxStepFrequency</span> <span class="o">:=</span> <span class="mi">8000</span><span class="p">;</span>
        <span class="mi">4</span><span class="p">:</span>
            <span class="n">nMaxStepFrequency</span> <span class="o">:=</span> <span class="mi">16000</span><span class="p">;</span>
        <span class="mi">5</span><span class="p">:</span>
            <span class="n">nMaxStepFrequency</span> <span class="o">:=</span> <span class="mi">32000</span><span class="p">;</span>
        <span class="n">END_CASE</span>
    <span class="n">ELSIF</span> <span class="n">fbReadCoEMaxStepFrequency</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">2</span><span class="p">:</span> <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">the</span> <span class="n">move</span> <span class="n">ends</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">read</span> <span class="n">the</span> <span class="n">last</span> <span class="n">position</span> <span class="n">information</span>
    <span class="n">rtOverflow</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bCounterOverflow</span><span class="p">);</span>
    <span class="n">rtUnderflow</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bCounterUnderflow</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">rtOverflow</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
        <span class="n">fEndingInternalPosition</span> <span class="o">:=</span> <span class="n">fEndingInternalPosition</span> <span class="o">+</span> <span class="mi">65535</span><span class="p">;</span>
    <span class="n">ELSIF</span> <span class="n">rtUnderflow</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
        <span class="n">fEndingInternalPosition</span> <span class="o">:=</span> <span class="n">fEndingInternalPosition</span> <span class="o">-</span> <span class="mi">65535</span><span class="p">;</span>
    <span class="n">END_IF</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="n">nState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">fEndingEUPosition</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
        <span class="n">fEndingInternalPosition</span> <span class="o">:=</span> <span class="n">fEndingInternalPosition</span> <span class="o">+</span> <span class="n">nMicrostepCounter</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">3</span><span class="p">:</span> <span class="o">//</span> <span class="n">Calculate</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">velocity</span> <span class="kn">from</span><span class="w"> </span><span class="nn">the</span> <span class="n">measured</span> <span class="n">move</span>
    <span class="n">fDeltaEUPosition</span> <span class="o">:=</span> <span class="n">fEndingEUPosition</span> <span class="o">-</span> <span class="n">fStartingEUPosition</span><span class="p">;</span>
    <span class="n">fDeltaInternalPosition</span> <span class="o">:=</span> <span class="n">fEndingInternalPosition</span> <span class="o">-</span> <span class="n">fStartingInternalPosition</span><span class="p">;</span>
    <span class="n">fDeltaSteps</span> <span class="o">:=</span> <span class="n">fDeltaInternalPosition</span> <span class="o">/</span> <span class="n">UINT_TO_LREAL</span><span class="p">(</span><span class="n">nMicrostepsPerStep</span><span class="p">);</span>

    <span class="n">IF</span> <span class="n">fDeltaSteps</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span> <span class="n">THEN</span>
        <span class="n">fEUPerStep</span> <span class="o">:=</span> <span class="n">fDeltaEUPosition</span> <span class="o">/</span> <span class="n">fDeltaSteps</span><span class="p">;</span>

        <span class="n">fMeasuredReferenceVelocity</span> <span class="o">:=</span> <span class="n">UINT_TO_LREAL</span><span class="p">(</span><span class="n">nMaxStepFrequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">fEUPerStep</span><span class="p">;</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">fMeasuredReferenceVelocity</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">100</span><span class="p">:</span> <span class="o">//</span> <span class="n">Reserve</span> <span class="k">for</span> <span class="n">error</span> <span class="n">handling</span>
    <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-readcoe">FB_ReadCoE</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-multileadermotioncoupling">
<h2>FB_MultiLeaderMotionCoupling<a class="headerlink" href="#fb-multileadermotioncoupling" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>FUNCTION_BLOCK FB_MultiLeaderMotionCoupling
VAR_IN_OUT
    stMotionStageFollow: ST_MotionStage;
    stMultiLeaderMotionCoupling: ST_MultiLeaderMotionCoupling;
END_VAR
VAR_INPUT
    fTargetPos : LREAL;
    fTargetVel : LREAL;
    fTargetAcc : LREAL;
    bError     : BOOL;
    tTimeout   :   TIME  := T#5s;
END_VAR
VAR
    bInit        : BOOL := TRUE;
    nTimeout     : ULINT;
    tonTimeout   : TON;
    tonHaltDelay : TON;

    tonTargetPositionTimer: TON;

    fMoveTime              : LREAL; // in seconds
    tMove                  : TIME;
    tonMoveProgressCounter : TON;
    GetCurrentTaskIndex    : GETCURTASKINDEX;
    fSecPerScan            : LREAL;
    fDistanceThisScan      : LREAL;
    fPosSetpoint           : LREAL;

    EnableSetPointGenerator  : MC_ExtSetPointGenEnable;
    DisableSetPointGenerator : MC_ExtSetPointGenDisable;
    mcHalt                   : MC_Halt;
END_VAR
// During initialization or reset, restore state values to defaults.
IF bInit OR stMultiLeaderMotionCoupling.bReset THEN
    bInit := FALSE;
    stMotionStageFollow.bReset             := TRUE;
    stMultiLeaderMotionCoupling.bReset     := FALSE;
    stMultiLeaderMotionCoupling.bBusy      := FALSE;
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;&#39;;
    stMultiLeaderMotionCoupling.bError     := FALSE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_STANDBY;

    METH_Init(
        stMotionStage     := stMotionStageFollow,
        stMultiLeader     := stMultiLeaderMotionCoupling,
        bEnableByDefault  := stMultiLeaderMotionCoupling.bEnable,
        bUseDynamicLimits := stMultiLeaderMotionCoupling.bUseDynamicLimits
    );
END_IF

stMultiLeaderMotionCoupling.fTargetPos := fTargetPos;
stMultiLeaderMotionCoupling.fTargetVel := ABS(fTargetVel);
stMultiLeaderMotionCoupling.fTargetAcc := fTargetAcc;

stMultiLeaderMotionCoupling.fPosDelta := stMultiLeaderMotionCoupling.stPos.fOut - stMotionStageFollow.Axis.NcToPlc.ActPos;

nTimeout := TIME_TO_ULINT(tTimeout - tonTimeout.ET); // Get the remaining timeout time in ms.

CASE stMultiLeaderMotionCoupling.eState OF

    E_MultiLeaderMotionCoupling.STATE_STANDBY:
        // Wait here for multi-leader mode to be enabled.
        // If we get here and there is an active error, request the user to clear the error.
        ACT_01_STATE_STANDBY();

    E_MultiLeaderMotionCoupling.STATE_WAIT_FOR_FOLLOWER_NOT_BUSY:
        // The external setpoint generator cannot be activated when the axis is currently busy.
        // Give the duration of the timeout to wait for the axis to stop being busy.
        // If the timeout duration expires, give a helpful error message and give up.
        ACT_02_STATE_WAIT_FOR_FOLLOWER_NOT_BUSY();

    E_MultiLeaderMotionCoupling.STATE_WAIT_FOR_FOLLOWER_ENABLED:
        // The external setpoint generator cannot be activated until the axis is enabled.
        // Give the duration of the timeout to wait for the axis to be enabled.
        // If the timeout duration expires, give a helpful error message and give up.
        ACT_03_STATE_WAIT_FOR_FOLLOWER_ENABLED();

    E_MultiLeaderMotionCoupling.STATE_WAIT_FOR_FOLLOWER_READY:
        // The external setpoint generator cannot be activated until the motor drive ready status is received.
        // Give the duration of the timeout to wait for the motor drive to report its ready status.
        // If the timeout duration expires, give a helpful error message and give up.
        ACT_04_STATE_WAIT_FOR_FOLLOWER_READY();

    E_MultiLeaderMotionCoupling.STATE_ENABLE_EXTERNAL_SETPOINT_GENERATOR:
        // With all the prerequisites satisfied, we can attempt to enable the external setpoint generator.
        // Give the duration of the timeout to wait for the external setpoint generator to enable.
        // If the timeout duration expires, give a helpful error message and give up.
        ACT_05_STATE_ENABLE_EXTERNAL_SETPOINT_GENERATOR();

    E_MultiLeaderMotionCoupling.STATE_FOLLOWING_ACTIVE:
        // The external setpoint generator allows us to feed arbitrary setpoint, velocity, acceleration, and direction
        // commands to the follower axis. This is the backbone of the multi-leader control logic.
        // The position and velocity inputs will be able to be used to control the position of an axis based on the
        // positions of one or more other axes by feeding the desired position output of an arbitrary function or
        // multi-dimensional lookup table into this function block.
        // In this state, any other position commands to the follower axis will be overwritten every time
        // this function block is executed. The function block can be disabled to allow manual commands to
        // be used by this axis.
        // On a manual disable command or an error in the follower axis, this state will move into the
        // disable external setpoint generator state or the error state respectively.
        ACT_06_STATE_FOLLOWING_ACTIVE();

    E_MultiLeaderMotionCoupling.STATE_DISABLE_EXTERNAL_SETPOINT_GENERATOR:
        // Attempt to disable the external setpoint generator.
        // Give the duration of the timeout to wait for the external setpoint generator to disable.
        // If the timeout duration expires, give a helpful error message and give up.
        ACT_07_STATE_DISABLE_EXTERNAL_SETPOINT_GENERATOR();

    E_MultiLeaderMotionCoupling.STATE_ERROR:
        // Allow a state for handling errors.
        // First, try to disable the external setpoint generator.
        // If the timeout duration expires, give a helpful error message and give up.
        ACT_08_STATE_ERROR();

    E_MultiLeaderMotionCoupling.STATE_MONITOR_TARGET_WINDOW:
        // Check to see if the axis leaves the target window. If it does,
        // switch back to enabling the external setpoint generator.
        ACT_09_STATE_MONITOR_TARGET_WINDOW();

    E_MultiLeaderMotionCoupling.STATE_HALT_MOTION:
        // Stop the motion on the axis so that it doesn&#39;t sit there using full current
        // when it can be using holding current.
        ACT_10_STATE_HALT_MOTION();

ELSE
    // Catch-all for invalid states. Report the number of the invalid state and move into error state.
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := CONCAT(&#39;Attempted to enter invalid state with ID: &#39;, UDINT_TO_STRING(stMultiLeaderMotionCoupling.eState));
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Contact ECS to investigate.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;

END_CASE

END_FUNCTION_BLOCK

ACTION ACT_01_STATE_STANDBY:
(* ACTION - STATE STANDBY *)

stMotionStageFollow.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;

IF stMultiLeaderMotionCoupling.bEnable AND NOT stMultiLeaderMotionCoupling.bError THEN
    stMultiLeaderMotionCoupling.bBusy      := TRUE;
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Moving from STANDBY to WAIT_FOR_FOLLOWER_NOT_BUSY.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_WAIT_FOR_FOLLOWER_NOT_BUSY;
ELSIF NOT stMultiLeaderMotionCoupling.bEnable THEN
    stMultiLeaderMotionCoupling.bBusy      := FALSE;
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting to be enabled.&#39;;
ELSIF stMultiLeaderMotionCoupling.bError THEN
    stMultiLeaderMotionCoupling.bBusy      := FALSE;
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting for reset button to be pressed to clear the error.&#39;;
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;STATE_STANDBY: Unexpected condition.&#39;;
END_IF
END_ACTION

ACTION ACT_02_STATE_WAIT_FOR_FOLLOWER_NOT_BUSY:
(* ACTION - STATE WAIT FOR FOLLOWER NOT BUSY *)

tonTimeout(IN:=TRUE,PT:=tTimeout);
IF NOT stMotionStageFollow.bBusy THEN
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Moving from WAIT_FOR_FOLLOWER_NOT_BUSY to WAIT_FOR_FOLLOWER_ENABLED.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_WAIT_FOR_FOLLOWER_ENABLED;
    tonTimeout(IN:=FALSE);
ELSIF tonTimeout.Q THEN
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;Timeout occured during STATE_WAIT_FOR_FOLLOWER_NOT_BUSY.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Make sure the axis is not busy before enabling multi-leader mode.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting for follower to not be busy.&#39;;
END_IF
END_ACTION

ACTION ACT_03_STATE_WAIT_FOR_FOLLOWER_ENABLED:
(* ACTION - STATE WAIT FOR FOLLOWER ENABLED *)

tonTimeout(IN:=TRUE,PT:=tTimeout);

stMotionStageFollow.nEnableMode := ENUM_StageEnableMode.NEVER;
stMotionStageFollow.bEnable     := TRUE;

// NEED TO ADD IN DIRECTIONAL ENABLES TOO.
// Make function that handles directional enables and gives proper error messages for them.
IF stMotionStageFollow.bAllEnable THEN
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_WAIT_FOR_FOLLOWER_READY;
    tonTimeout(IN:=FALSE);
ELSIF tonTimeout.Q THEN
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;Timeout occured during STATE_WAIT_FOR_FOLLOWER_ENABLED.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Check to see what condition is preventing the axis from enabling.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting for follower to be enabled.&#39;;
END_IF
END_ACTION

ACTION ACT_04_STATE_WAIT_FOR_FOLLOWER_READY:
(* ACTION - STATE WAIT FOR FOLLOWER READY *)

tonTimeout(IN:=TRUE,PT:=tTimeout);
IF stMultiLeaderMotionCoupling.bFollowerDriveReady THEN
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_ENABLE_EXTERNAL_SETPOINT_GENERATOR;
    tonTimeout(IN:=FALSE);
ELSIF tonTimeout.Q THEN
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;Timeout occured during STATE_WAIT_FOR_FOLLOWER_READY.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Something is preventing the motor drive from giving the ready status.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting for follower drive to give ready status.&#39;;
END_IF
END_ACTION

ACTION ACT_05_STATE_ENABLE_EXTERNAL_SETPOINT_GENERATOR:
(* ACTION - STATE ENABLE EXTERNAL SETPOINT GENERATOR *)

ACT_ComputeTargets();

tonTimeout(IN:=TRUE,PT:=tTimeout);

MC_ExtSetPointGenFeed(
    Position     := stMotionStageFollow.Axis.NcToPlc.ActPos,
    Velocity     := 0.0,
    Acceleration := 0.0,
    Direction    := 1,
    Axis         := stMotionStageFollow.Axis
);

EnableSetPointGenerator(
    Axis         := stMotionStageFollow.Axis,
    Execute      := TRUE,
    PositionType := E_PositionType.POSITIONTYPE_ABSOLUTE,
    Done=&gt;,
    Busy=&gt;,
    Error=&gt;,
    ErrorID=&gt;,
    Enabled=&gt;
);

// See: https://infosys.beckhoff.com/english.php?content=../content/1033/tcplclib_tc2_mc2/70136971.html&amp;id=
// StateDWord.14 gives a boolean for the enable/disable state of the external setpoint generator.
// TRUE = ENABLED. FALSE = DISABLED.
IF stMotionStageFollow.Axis.NcToPlc.StateDWord.14 THEN
    EnableSetPointGenerator(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE
    );
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_FOLLOWING_ACTIVE;
    tonTimeout(IN:=FALSE);
ELSIF EnableSetPointGenerator.Error THEN
    EnableSetPointGenerator(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE
    );
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := CONCAT(&#39;EnableSetPointGenerator returned error code: &#39;, UDINT_TO_STRING(EnableSetPointGenerator.ErrorID));
    CASE EnableSetPointGenerator.ErrorID OF
        ELSE
            stMultiLeaderMotionCoupling.sErrorHelp := &#39;This error code is missing explanation from Beckhoff.&#39;;
    END_CASE
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSIF tonTimeout.Q THEN
    EnableSetPointGenerator(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE
    );
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;Timeout occured during STATE_ENABLE_EXTERNAL_SETPOINT_GENERATOR.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Failed to enable setpoint generator. Check enable and ready statuses.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting for setpoint generator to be enabled.&#39;;
END_IF
END_ACTION

ACTION ACT_06_STATE_FOLLOWING_ACTIVE:
(* ACTION - STATE FOLLOWING ACTIVE *)

ACT_ComputeTargets();

stMultiLeaderMotionCoupling.fPosDelta := stMultiLeaderMotionCoupling.stPos.fOut - stMotionStageFollow.Axis.NcToPlc.ActPos;

IF stMultiLeaderMotionCoupling.stVel.fOut &lt;&gt; 0 THEN
    fMoveTime := ABS(stMultiLeaderMotionCoupling.fPosDelta / stMultiLeaderMotionCoupling.stVel.fOut);
ELSE
    fMoveTime := 0;
END_IF
tMove := LREAL_TO_TIME(fMoveTime * 1000);

// Determine the direction in which the axis is being commanded.
IF stMultiLeaderMotionCoupling.stVel.fOut = 0 AND stMultiLeaderMotionCoupling.stAcc.fOut = 0 THEN
    stMultiLeaderMotionCoupling.nDir := 0;  (* stand still *)
ELSIF stMultiLeaderMotionCoupling.stPos.fOut &gt;= stMotionStageFollow.Axis.NcToPlc.ActPos THEN
    stMultiLeaderMotionCoupling.nDir := 1;  (* positive motion *)
ELSE
    stMultiLeaderMotionCoupling.nDir := -1; (* negative motion *)
END_IF

stMultiLeaderMotionCoupling.stVel.fOut := stMultiLeaderMotionCoupling.stVel.fOut * stMultiLeaderMotionCoupling.nDir;

IF ABS(stMultiLeaderMotionCoupling.fPosDelta) &lt; stMotionStageFollow.stAxisParameters.fTargetPosControlRange THEN
    tonTargetPositionTimer(IN:=TRUE,PT:=LREAL_TO_TIME(stMotionStageFollow.stAxisParameters.fTargetPosControlTime * 1000));
ELSE
    tonTargetPositionTimer(IN:=FALSE);
END_IF

IF NOT stMultiLeaderMotionCoupling.bEnable THEN
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_DISABLE_EXTERNAL_SETPOINT_GENERATOR;
ELSIF stMotionStageFollow.bError THEN
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;MultiLeaderMotionCoupling suspended due to follower axis error.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := stMotionStageFollow.sErrorMessage;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := CONCAT(&#39;Actively controlling [&#39;, CONCAT(stMotionStageFollow.sName,&#39;] in multi-leader mode.&#39;));

    IF NOT tonTargetPositionTimer.Q THEN
        // Feed the dynamic parameters into the external setpoint generator interface of the follower axis
        IF GetCurrentTaskIndex.index = 0 THEN
            (* get cycle time *)
            GetCurrentTaskIndex();
        END_IF
        fSecPerScan := UDINT_TO_LREAL(TwinCAT_SystemInfoVarList._TaskInfo[GetCurrentTaskIndex.index].cycleTime) / 1E7;
        IF fMoveTime &lt;&gt; 0 THEN
            fDistanceThisScan := stMultiLeaderMotionCoupling.fPosDelta / fMoveTime * stMultiLeaderMotionCoupling.nDir * fSecPerScan;
        ELSE
            fDistanceThisScan := 0;
        END_IF
        fPosSetpoint := stMotionStageFollow.Axis.NcToPlc.ActPos + fDistanceThisScan;
        IF WORD_TO_BOOL(stMotionStageFollow.stAxisParameters.bEncEnableSoftEndMaxControl) AND fPosSetpoint &gt; stMotionStageFollow.stAxisParameters.fEncSoftEndMax THEN
            fPosSetpoint := stMotionStageFollow.stAxisParameters.fEncSoftEndMax;
        ELSIF WORD_TO_BOOL(stMotionStageFollow.stAxisParameters.bEncEnableSoftEndMinControl) AND fPosSetpoint &lt; stMotionStageFollow.stAxisParameters.fEncSoftEndMin THEN
            fPosSetpoint := stMotionStageFollow.stAxisParameters.fEncSoftEndMin;
        END_IF
        MC_ExtSetPointGenFeed(
            Position     := fPosSetpoint,
            Velocity     := stMultiLeaderMotionCoupling.stVel.fOut,
            Acceleration := stMultiLeaderMotionCoupling.stAcc.fOut,
            Direction    := stMultiLeaderMotionCoupling.nDir,
            Axis         := stMotionStageFollow.Axis
        );
        tonTimeout(IN:=FALSE);
        tonHaltDelay(IN:=FALSE);
    ELSE
        MC_ExtSetPointGenFeed(
            Position     := stMultiLeaderMotionCoupling.stPos.fOut, // stMotionStageFollow.Axis.NcToPlc.ActPos,
            Velocity     := stMultiLeaderMotionCoupling.fPosDelta * stMultiLeaderMotionCoupling.fTargetTrackingGain, // 0,
            Acceleration := stMultiLeaderMotionCoupling.stAcc.fOut,
            Direction    := stMultiLeaderMotionCoupling.nDir,
            Axis         := stMotionStageFollow.Axis
        );
        tonHaltDelay(IN:=TRUE,PT:=tTimeout);
        IF tonHaltDelay.Q THEN
            stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_HALT_MOTION;
            tonHaltDelay(IN:=FALSE);
        END_IF
    END_IF
END_IF
END_ACTION

ACTION ACT_07_STATE_DISABLE_EXTERNAL_SETPOINT_GENERATOR:
(* ACTION - STATE DISABLE EXTERNAL SETPOINT GENERATOR *)

tonTimeout(IN:=TRUE,PT:=tTimeout);
DisableSetPointGenerator(
    Axis         := stMotionStageFollow.Axis,
    Execute      := TRUE,
    Done=&gt;,
    Busy=&gt;,
    Error=&gt;,
    ErrorID=&gt;,
    Enabled=&gt;
);

stMotionStageFollow.bEnable     := FALSE;

// See: https://infosys.beckhoff.com/english.php?content=../content/1033/tcplclib_tc2_mc2/70136971.html&amp;id=
// StateDWord.14 gives a boolean for the enable/disable state of the external setpoint generator.
// TRUE = ENABLED. FALSE = DISABLED.
IF NOT stMotionStageFollow.Axis.NcToPlc.StateDWord.14 THEN
    DisableSetPointGenerator(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE
    );
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_STANDBY;
    tonTimeout(IN:=FALSE);
ELSIF DisableSetPointGenerator.Error THEN
    DisableSetPointGenerator(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE
    );
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := CONCAT(&#39;DisableSetPointGenerator returned error code: &#39;, UDINT_TO_STRING(DisableSetPointGenerator.ErrorID));
    CASE DisableSetPointGenerator.ErrorID OF
        ELSE
            stMultiLeaderMotionCoupling.sErrorHelp := &#39;This error code is missing explanation from Beckhoff.&#39;;
    END_CASE
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSIF tonTimeout.Q THEN
    DisableSetPointGenerator(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE
    );
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;Timeout occured during STATE_DISABLE_EXTERNAL_SETPOINT_GENERATOR.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Failed to disable setpoint generator.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting for setpoint generator to be disabled.&#39;;
END_IF
END_ACTION

ACTION ACT_08_STATE_ERROR:
(* ACTION - STATE ERROR *)

tonTimeout(IN:=TRUE,PT:=tTimeout);

stMultiLeaderMotionCoupling.bBusy := FALSE;

DisableSetPointGenerator(
    Axis         := stMotionStageFollow.Axis,
    Execute      := TRUE,
    Done=&gt;,
    Busy=&gt;,
    Error=&gt;,
    ErrorID=&gt;,
    Enabled=&gt;
);

stMotionStageFollow.bEnable     := FALSE;

// See: https://infosys.beckhoff.com/english.php?content=../content/1033/tcplclib_tc2_mc2/70136971.html&amp;id=
// StateDWord.14 gives a boolean for the enable/disable state of the external setpoint generator.
// TRUE = ENABLED. FALSE = DISABLED.
IF NOT stMotionStageFollow.Axis.NcToPlc.StateDWord.14 THEN
    DisableSetPointGenerator(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE
    );
    tonTimeout(IN:=FALSE);
    IF NOT stMultiLeaderMotionCoupling.bError THEN
        stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_STANDBY;
    ELSE
        stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting for reset button to be pressed to clear error.&#39;;
    END_IF
ELSIF tonTimeout.Q THEN
    // Timeout would occur if the disable setpoint generator function block failed to complete.
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;Timeout occured during STATE_ERROR.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Failed to disable setpoint generator.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Waiting setpoint generator to be disabled [STATE_ERROR].&#39;;
END_IF
END_ACTION

ACTION ACT_09_STATE_MONITOR_TARGET_WINDOW:
(* ACTION - STATE MONITOR TARGET WINDOW *)

ACT_ComputeTargets();

stMotionStageFollow.bEnable := FALSE;

stMultiLeaderMotionCoupling.fPosDelta := stMultiLeaderMotionCoupling.stPos.fOut - stMultiLeaderMotionCoupling.fHaltPos;

IF NOT stMultiLeaderMotionCoupling.bEnable THEN
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_STANDBY;
ELSIF ABS(stMultiLeaderMotionCoupling.fPosDelta) &gt;= stMotionStageFollow.stAxisParameters.fTargetPosControlRange THEN
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_WAIT_FOR_FOLLOWER_ENABLED;
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Holding mode active. Monitoring target position window for changes.&#39;;
END_IF
END_ACTION

ACTION ACT_10_STATE_HALT_MOTION:
(* ACTION - STATE HALT MOTION *)

// Halt and switch to waiting state.
tonTimeout(IN:=TRUE,PT:=tTimeout);
mcHalt(
    Axis:=stMotionStageFollow.Axis,
    Execute:=TRUE,
    Deceleration:=stMultiLeaderMotionCoupling.stAcc.fOut,
    BufferMode:=MC_BufferMode.MC_Aborting,
    Done=&gt;,
    Busy=&gt;,
    Active=&gt;,
    CommandAborted=&gt;,
    Error=&gt;,
    ErrorID=&gt;
);

IF NOT stMultiLeaderMotionCoupling.bEnable THEN
    mcHalt(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE,
        Deceleration:=stMultiLeaderMotionCoupling.stAcc.fOut,
        BufferMode:=MC_BufferMode.MC_Aborting
    );
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_DISABLE_EXTERNAL_SETPOINT_GENERATOR;
ELSIF mcHalt.Done THEN
    mcHalt(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE,
        Deceleration:=stMultiLeaderMotionCoupling.stAcc.fOut,
        BufferMode:=MC_BufferMode.MC_Aborting
    );
    stMultiLeaderMotionCoupling.fHaltPos := stMotionStageFollow.Axis.NcToPlc.ActPos;
    stMultiLeaderMotionCoupling.eState   := E_MultiLeaderMotionCoupling.STATE_MONITOR_TARGET_WINDOW;
    tonTimeout(IN:=FALSE);
ELSIF mcHalt.Error THEN
    mcHalt(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE,
        Deceleration:=stMultiLeaderMotionCoupling.stAcc.fOut,
        BufferMode:=MC_BufferMode.MC_Aborting
    );
    stMultiLeaderMotionCoupling.bError    := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg := CONCAT(&#39;MC_HALT returned error code: &#39;, UDINT_TO_STRING(mcHalt.ErrorID));
    CASE DisableSetPointGenerator.ErrorID OF
        ELSE
            stMultiLeaderMotionCoupling.sErrorHelp := &#39;This error code is missing explanation from Beckhoff.&#39;;
    END_CASE
    stMultiLeaderMotionCoupling.eState := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSIF tonTimeout.Q THEN
    mcHalt(
        Axis:=stMotionStageFollow.Axis,
        Execute:=FALSE,
        Deceleration:=stMultiLeaderMotionCoupling.stAcc.fOut,
        BufferMode:=MC_BufferMode.MC_Aborting
    );
    stMultiLeaderMotionCoupling.bError     := TRUE;
    stMultiLeaderMotionCoupling.sErrorMsg  := &#39;Timeout occured during STATE_HALT_MOTION.&#39;;
    stMultiLeaderMotionCoupling.sErrorHelp := &#39;Failed to halt the axis within the timeout duration.&#39;;
    stMultiLeaderMotionCoupling.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
    tonTimeout(IN:=FALSE);
ELSE
    stMultiLeaderMotionCoupling.sStatusMsg := &#39;Halting axis.&#39;;
END_IF
END_ACTION

ACTION ACT_ComputeTargets:
// ACTION - Compute Targets

// Clip the commanded speed and position to the same limits
// set for the axis. The purpose of this is to allow an axis to automatically ignore commands that
// would otherwise lead to errors from the axis being commanded. Flags are set to indicate if one
// of the limiters is active.

stMultiLeaderMotionCoupling.stAcc.fMax := stMotionStageFollow.stAxisParameters.fAccelerationMax;
stMultiLeaderMotionCoupling.stAcc.fMin := -stMotionStageFollow.stAxisParameters.fDecelerationMax;

stMultiLeaderMotionCoupling.stVel.fMax := stMotionStageFollow.stAxisParameters.fVeloMaximum;
stMultiLeaderMotionCoupling.stVel.fMin := -stMotionStageFollow.stAxisParameters.fVeloMaximum;

stMultiLeaderMotionCoupling.stPos.fMax := stMotionStageFollow.stAxisParameters.fEncSoftEndMax;
stMultiLeaderMotionCoupling.stPos.fMin := stMotionStageFollow.stAxisParameters.fEncSoftEndMin;

stMultiLeaderMotionCoupling.stAcc.fIn := stMultiLeaderMotionCoupling.fTargetAcc;
stMultiLeaderMotionCoupling.stVel.fIn := stMultiLeaderMotionCoupling.fTargetVel;
stMultiLeaderMotionCoupling.stPos.fIn := stMultiLeaderMotionCoupling.fTargetPos;

IF stMultiLeaderMotionCoupling.bUseDynamicLimits THEN
    METH_ApplyKinematicLimits(
        bEnable:=TRUE,
        stAcc:=stMultiLeaderMotionCoupling.stAcc,
        stVel:=stMultiLeaderMotionCoupling.stVel,
        stPos:=stMultiLeaderMotionCoupling.stPos
    );
ELSE
    METH_ApplyKinematicLimits(
        bEnable:=FALSE,
        stAcc:=stMultiLeaderMotionCoupling.stAcc,
        stVel:=stMultiLeaderMotionCoupling.stVel,
        stPos:=stMultiLeaderMotionCoupling.stPos
    );
END_IF
END_ACTION

METHOD METH_ApplyKinematicLimits : BOOL
VAR_IN_OUT
    stAcc: ST_BoundedValue;
    stVel: ST_BoundedValue;
    stPos: ST_BoundedValue;
END_VAR
VAR_INPUT
    bEnable: BOOL;
END_VAR
IF bEnable THEN
    METH_MaxMinLim(stVal:=stAcc);
    METH_MaxMinLim(stVal:=stVel);
    METH_MaxMinLim(stVal:=stPos);
ELSE
    stAcc.fOut := stAcc.fIn;
    stVel.fOut := stVel.fIn;
    stPos.fOut := stPos.fIn;
END_IF
END_METHOD

METHOD METH_Init : BOOL
VAR_IN_OUT
    stMotionStage : ST_MotionStage;
    stMultiLeader : ST_MultiLeaderMotionCoupling;
END_VAR
VAR_INPUT
    bEnableByDefault  : BOOL;
    bUseDynamicLimits : BOOL;
END_VAR
VAR
    mcReadParams: MC_ReadParameterSet;
END_VAR
mcReadParams(
    Parameter := stMotionStage.stAxisParameters,
    Axis := stMotionStage.Axis,
    Execute := TRUE,
    Error =&gt;
);

IF NOT mcReadParams.Error THEN
    stMultiLeader.stAcc.fMax := stMotionStage.stAxisParameters.fAccelerationMax;
    stMultiLeader.stAcc.fMin := -stMotionStage.stAxisParameters.fDecelerationMax;

    stMultiLeader.stVel.fMax := stMotionStage.stAxisParameters.fVeloMaximum;
    stMultiLeader.stVel.fMin := -stMotionStage.stAxisParameters.fVeloMaximum;

    stMultiLeader.stPos.fMax := stMotionStage.stAxisParameters.fEncSoftEndMax;
    stMultiLeader.stPos.fMin := stMotionStage.stAxisParameters.fEncSoftEndMin;
ELSE
    stMultiLeader.bError     := TRUE;
    stMultiLeader.sErrorMsg  := &#39;MultiLeaderMotionCoupling failed to load axis parameters.&#39;;
    stMultiLeader.sErrorHelp := stMotionStageFollow.sErrorMessage;
    stMultiLeader.eState     := E_MultiLeaderMotionCoupling.STATE_ERROR;
END_IF

mcReadParams(
    Parameter := stMotionStage.stAxisParameters,
    Axis := stMotionStage.Axis,
    Execute := FALSE,
    Error =&gt;
);

stMultiLeader.fTargetPos := stMotionStage.Axis.NcToPlc.ActPos;

stMultiLeader.bEnable           := bEnableByDefault;
stMultiLeader.bUseDynamicLimits := bUseDynamicLimits;
END_METHOD

METHOD METH_MaxMinLim : BOOL
VAR_IN_OUT
    stVal: ST_BoundedValue;
END_VAR
stVal.bMaxLim := FALSE;
stVal.bMinLim := FALSE;

IF stVal.fIn &gt; stVal.fMax THEN
    stVal.fOut    := stVal.fMax;
    stVal.bMaxLim := TRUE;
ELSIF stVal.fIn &lt; stVal.fMin THEN
    stVal.fOut    := stVal.fMin;
    stVal.bMinLim := TRUE;
ELSE
    stVal.fOut := stVal.fIn;
END_IF
END_METHOD
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-multileadermotioncoupling">E_MultiLeaderMotionCoupling</a></p></li>
<li><p><a class="reference internal" href="#st-boundedvalue">ST_BoundedValue</a></p></li>
<li><p><a class="reference internal" href="#st-multileadermotioncoupling">ST_MultiLeaderMotionCoupling</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-readcoe">
<h2>FB_ReadCoE<a class="headerlink" href="#fb-readcoe" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_ReadCoE</span>
<span class="n">VAR_INPUT</span>
    <span class="n">bExecute</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">pBuffer</span><span class="p">:</span> <span class="n">PVOID</span><span class="p">;</span> <span class="o">//</span> <span class="n">ADR</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">sNetId</span><span class="p">:</span> <span class="n">T_AmsNetId</span><span class="p">;</span> <span class="o">//</span> <span class="n">Have</span> <span class="n">to</span> <span class="n">be</span> <span class="n">entered</span>
    <span class="n">nSlaveAddr</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">Have</span> <span class="n">to</span> <span class="n">be</span> <span class="n">entered</span>
    <span class="n">nDesiredCoEIndex</span><span class="p">:</span> <span class="n">WORD</span><span class="p">;</span> <span class="o">//</span> <span class="n">Ex</span><span class="p">:</span> <span class="n">CoE</span> <span class="mi">16</span><span class="c1">#9000 (9000:1)</span>
    <span class="n">nDesiredCoESubIndex</span><span class="p">:</span> <span class="n">Byte</span><span class="p">;</span> <span class="o">//</span> <span class="n">Ex</span><span class="p">:</span> <span class="n">CoE</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">9000</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nBufferLength</span><span class="p">:</span> <span class="n">UDINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">number</span> <span class="n">of</span> <span class="nb">bytes</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">CoE</span> <span class="n">to</span> <span class="n">be</span> <span class="n">read</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">fbCoERead</span><span class="p">:</span> <span class="n">FB_EcCoESdoRead</span><span class="p">;</span> <span class="o">//</span> <span class="n">Function</span> <span class="n">Block</span> <span class="k">for</span> <span class="n">reading</span> <span class="kn">from</span><span class="w"> </span><span class="nn">CoE</span>
    <span class="n">nState</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="o">//</span> <span class="n">RW</span><span class="o">-</span><span class="n">status</span>
    <span class="n">rtExecute</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">CASE</span> <span class="n">nState</span> <span class="n">OF</span>
<span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">rtExecute</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">bExecute</span><span class="p">);</span>
    <span class="n">IF</span> <span class="n">rtExecute</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bError</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">ELSE</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="mi">0</span><span class="p">:</span>
   <span class="o">//</span> <span class="n">Read</span> <span class="n">entry</span>
    <span class="n">fbCoERead</span><span class="p">(</span>
       <span class="n">sNetId</span><span class="o">:=</span> <span class="n">sNetId</span><span class="p">,</span>
       <span class="n">nSlaveAddr</span><span class="o">:=</span> <span class="n">nSlaveAddr</span><span class="p">,</span>
       <span class="n">nSubIndex</span><span class="o">:=</span> <span class="n">nDesiredCoeSubIndex</span><span class="p">,</span>
       <span class="n">nIndex</span><span class="o">:=</span> <span class="n">nDesiredCoEIndex</span><span class="p">,</span>
       <span class="n">pDstBuf</span><span class="o">:=</span> <span class="n">pBuffer</span><span class="p">,</span>
       <span class="n">cbBufLen</span><span class="o">:=</span> <span class="n">nBufferLength</span><span class="p">,</span>
       <span class="n">bExecute</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">,</span>
       <span class="n">tTimeout</span><span class="o">:=</span> <span class="n">T</span><span class="c1">#1S</span>
   <span class="p">);</span>
   <span class="n">fbCoERead</span><span class="p">(</span>
       <span class="n">sNetId</span><span class="o">:=</span> <span class="n">sNetId</span><span class="p">,</span>
       <span class="n">nSlaveAddr</span><span class="o">:=</span> <span class="n">nSlaveAddr</span><span class="p">,</span>
       <span class="n">nSubIndex</span><span class="o">:=</span> <span class="n">nDesiredCoeSubIndex</span><span class="p">,</span>
       <span class="n">nIndex</span><span class="o">:=</span> <span class="n">nDesiredCoEIndex</span><span class="p">,</span>
       <span class="n">pDstBuf</span><span class="o">:=</span> <span class="n">pBuffer</span><span class="p">,</span>
       <span class="n">cbBufLen</span><span class="o">:=</span> <span class="n">nBufferLength</span><span class="p">,</span>
       <span class="n">bExecute</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
       <span class="n">tTimeout</span><span class="o">:=</span> <span class="n">T</span><span class="c1">#1S</span>
   <span class="p">);</span>
   <span class="n">nState</span> <span class="o">:=</span> <span class="n">nState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="o">//</span> <span class="n">Next</span> <span class="n">state</span>
<span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">Execute</span> <span class="n">CoE</span> <span class="n">read</span> <span class="n">until</span> <span class="n">done</span>
    <span class="n">fbCoERead</span><span class="p">(</span>
       <span class="n">sNetId</span><span class="o">:=</span> <span class="n">sNetId</span><span class="p">,</span>
       <span class="n">nSlaveAddr</span><span class="o">:=</span> <span class="n">nSlaveAddr</span><span class="p">,</span>
       <span class="n">nSubIndex</span><span class="o">:=</span> <span class="n">nDesiredCoeSubIndex</span><span class="p">,</span>
       <span class="n">nIndex</span><span class="o">:=</span> <span class="n">nDesiredCoEIndex</span><span class="p">,</span>
       <span class="n">pDstBuf</span><span class="o">:=</span> <span class="n">pBuffer</span><span class="p">,</span>
       <span class="n">cbBufLen</span><span class="o">:=</span> <span class="n">nBufferLength</span><span class="p">,</span>
       <span class="n">bExecute</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
       <span class="n">tTimeout</span><span class="o">:=</span> <span class="n">T</span><span class="c1">#1S</span>
    <span class="p">);</span>
    <span class="n">IF</span> <span class="n">fbCoERead</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
      <span class="n">nState</span> <span class="o">:=</span> <span class="mi">100</span><span class="p">;</span>     <span class="o">//</span> <span class="n">Error</span> <span class="n">case</span>
    <span class="n">ELSE</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbCoERead</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>    <span class="o">//</span> <span class="n">Done</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">END_IF</span>
<span class="mi">100</span><span class="p">:</span> <span class="o">//</span> <span class="n">Error</span> <span class="n">handling</span><span class="o">..</span>
    <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_CASE</span>

<span class="n">END_FUNCTION_BLOCK</span>
</pre></div>
</div>
</section>
<section id="fb-sds">
<h2>FB_SDS<a class="headerlink" href="#fb-sds" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_SDS</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDSin</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">nIndex</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

    <span class="n">fbStateSetup</span><span class="p">:</span> <span class="n">FB_StateSetupHelper</span><span class="p">;</span>
    <span class="n">stDefault</span><span class="p">:</span> <span class="n">ST_PositionState</span> <span class="o">:=</span> <span class="p">(</span>
        <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">fVelocity</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
        <span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span>
    <span class="p">);</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">present</span> <span class="n">homing</span> <span class="n">status</span>
<span class="n">ACT_CheckHomeStatus</span><span class="p">();</span>

<span class="n">IF</span> <span class="n">NOT</span> <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">bInitialized</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Do</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">required</span> <span class="n">initialization</span> <span class="k">for</span> <span class="n">the</span> <span class="n">persistent</span> <span class="n">data</span> <span class="n">of</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span><span class="o">.</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;TA&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">stDiffractometerSlot</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;DF&#39;</span><span class="p">;</span>

    <span class="n">FOR</span> <span class="n">nIndex</span> <span class="o">:=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">to</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
        <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">;</span>
        <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">sDesc</span>  <span class="o">:=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="n">END_FOR</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;T1&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T2</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;T2&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T3</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;T3&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T4</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;T4&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M1</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;M1&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M2</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;M2&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M3</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;M3&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M4</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;M4&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B1</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;B1&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B2</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;B2&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B3</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;B3&#39;</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span> <span class="o">:=</span> <span class="s1">&#39;B4&#39;</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M1</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B1</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T2</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">90.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M2</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">90.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B2</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">90.0</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T3</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M3</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">180.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B3</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">180.0</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T4</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">270.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M4</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">270.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">:=</span> <span class="mf">270.0</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">100.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T2</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">100.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T3</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">100.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T4</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">100.5</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M1</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">74.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M2</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">74.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M3</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">74.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">M4</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">74.5</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B1</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">44.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B2</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">44.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B3</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">44.5</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">44.5</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">fGarageHeightSafeFromCollision</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">40.0</span><span class="p">;</span>
    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">fGarageRotationClearanceOffset</span> <span class="o">:=</span> <span class="mf">45.0</span><span class="p">;</span>

    <span class="n">stSDSPersistent</span><span class="o">.</span><span class="n">bInitialized</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">NOT</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">bInitialized</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">Do</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">required</span> <span class="n">initialization</span> <span class="k">for</span> <span class="n">the</span> <span class="n">non</span><span class="o">-</span><span class="n">persistent</span> <span class="n">data</span> <span class="n">of</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span><span class="o">.</span>
    <span class="n">stSDSin</span><span class="o">.</span><span class="n">bHomingRequired</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stDefault</span><span class="p">,</span> <span class="n">bSetDefault</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="n">stSDSin</span><span class="o">.</span><span class="n">bInitialized</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Update</span> <span class="n">load</span><span class="o">/</span><span class="n">unloadable</span> <span class="n">statuses</span> <span class="k">for</span> <span class="n">the</span> <span class="n">garage</span><span class="p">,</span> <span class="n">transfer</span> <span class="n">arm</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">diffractometer</span><span class="o">.</span>
<span class="n">UpdateLoadUnloadAbleStatuses</span><span class="p">(</span>
    <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="p">,</span>
    <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSPersistent</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">garage</span> <span class="ow">is</span> <span class="n">above</span> <span class="n">the</span> <span class="n">threshold</span> <span class="n">to</span> <span class="n">rotate</span> <span class="n">freely</span> <span class="n">without</span> <span class="n">fear</span> <span class="n">of</span> <span class="n">hitting</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span><span class="o">.</span>
<span class="n">ConfirmGarageFreeToRotate</span><span class="p">(</span>
    <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="p">,</span>
    <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSPersistent</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Control</span> <span class="n">the</span> <span class="n">sequencing</span> <span class="n">of</span> <span class="n">the</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span><span class="o">.</span>
<span class="n">StateMachine</span><span class="p">(</span>
    <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="p">,</span>
    <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSPersistent</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Update</span> <span class="n">the</span> <span class="n">position</span> <span class="n">states</span>
<span class="n">UpdatePositionStates</span><span class="p">(</span>
    <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="p">,</span>
    <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSPersistent</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Call</span> <span class="n">state</span> <span class="n">position</span> <span class="n">function</span> <span class="n">blocks</span><span class="o">.</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">fbTransferArmHPos1D</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">astPositionState</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">,</span>
    <span class="n">eEnumSet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumGet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">stEpicsToPlc</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHEpicsToPlc</span><span class="p">,</span>
    <span class="n">stPlcToEpics</span><span class="o">=&gt;</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHPlcToEpics</span>
<span class="p">);</span>

<span class="n">stSDSin</span><span class="o">.</span><span class="n">fbTransferArmRPos1D</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">astPositionState</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">,</span>
    <span class="n">eEnumSet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumGet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">stEpicsToPlc</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmREpicsToPlc</span><span class="p">,</span>
    <span class="n">stPlcToEpics</span><span class="o">=&gt;</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmRPlcToEpics</span>
<span class="p">);</span>

<span class="n">stSDSin</span><span class="o">.</span><span class="n">fbGarageYPos1D</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stGarageYStage</span><span class="p">,</span>
    <span class="n">astPositionState</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">astGarageYPosState</span><span class="p">,</span>
    <span class="n">eEnumSet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eGarageYStateSet</span><span class="p">,</span>
    <span class="n">eEnumGet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eGarageYStateGet</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">stEpicsToPlc</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stGarageYEpicsToPlc</span><span class="p">,</span>
    <span class="n">stPlcToEpics</span><span class="o">=&gt;</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stGarageYPlcToEpics</span>
<span class="p">);</span>

<span class="n">stSDSin</span><span class="o">.</span><span class="n">fbGarageRPos1D</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="p">,</span>
    <span class="n">astPositionState</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">astGarageRPosState</span><span class="p">,</span>
    <span class="n">eEnumSet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eGarageRStateSet</span><span class="p">,</span>
    <span class="n">eEnumGet</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">eGarageRStateGet</span><span class="p">,</span>
    <span class="n">bEnable</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span>
    <span class="n">stEpicsToPlc</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stGarageREpicsToPlc</span><span class="p">,</span>
    <span class="n">stPlcToEpics</span><span class="o">=&gt;</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stGarageRPlcToEpics</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Ensure</span> <span class="n">UI</span> <span class="n">boolean</span> <span class="n">commands</span> <span class="n">are</span> <span class="n">cleared</span> <span class="n">after</span> <span class="n">holding</span> <span class="k">for</span> <span class="n">one</span> <span class="n">second</span><span class="o">.</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bExitManualControl</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bHomeGarage</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bHomeTransferArm</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoad</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoadArmFromGarage</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoadDiffractometerFromArm</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoadGarageFromPort</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoadUnloadGarageFromPort</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bManualControl</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bCancel</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bUnload</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bUnloadArmToGarage</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bUnloadDiffractometerToArm</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Align</span> <span class="k">with</span> <span class="n">the</span> <span class="n">saved</span> <span class="n">selection</span> <span class="n">at</span> <span class="n">the</span> <span class="n">end</span> <span class="n">of</span> <span class="n">each</span> <span class="n">cycle</span><span class="o">.</span>
<span class="n">stSDSin</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">;</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_CheckHomeStatus</span><span class="p">:</span>
<span class="o">//</span> <span class="n">ACTION</span> <span class="o">-</span> <span class="n">Check</span> <span class="n">home</span> <span class="n">status</span>

<span class="n">CASE</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="n">OF</span>
    <span class="mi">0</span><span class="p">:</span> <span class="o">//</span> <span class="n">Initialization</span>
        <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonForwardHomingLimit</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">nCommand</span> <span class="o">=</span> <span class="n">E_EpicsMotorCmd</span><span class="o">.</span><span class="n">HOME</span> <span class="n">AND</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">Homing</span> <span class="n">Sequence</span> <span class="n">Triggered</span>
        <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonForwardHomingLimit</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">SetVelo</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#1s);</span>
        <span class="n">IF</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">nCommand</span> <span class="o">=</span> <span class="n">E_EpicsMotorCmd</span><span class="o">.</span><span class="n">HOME</span> <span class="n">AND</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bHome</span> <span class="n">THEN</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingStateTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonForwardHomingLimit</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingStateTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonForwardHomingLimit</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">IF</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingStateTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
                <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">END_IF</span>
        <span class="n">END_IF</span>
    <span class="mi">2</span><span class="p">:</span> <span class="o">//</span> <span class="n">Homing</span> <span class="n">Sequence</span> <span class="n">Successful</span>
        <span class="n">IF</span> <span class="n">F_Limit</span><span class="p">(</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">fHomePosition</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">bHomingRequired</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingRequiredTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingStateTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingStateTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
            <span class="n">IF</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingStateTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
                <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">END_IF</span>
        <span class="n">END_IF</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="o">//</span> <span class="n">Error</span> <span class="n">Handling</span>
        <span class="n">stSDSin</span><span class="o">.</span><span class="n">nHomingState</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">END_CASE</span>

<span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingRequiredTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">bHomingRequired</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">tHomingRequiredTimeoutTime</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingRequiredTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">stSDSin</span><span class="o">.</span><span class="n">bHomingRequired</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bHome</span> <span class="n">AND</span> <span class="n">F_Limit</span><span class="p">(</span>
    <span class="n">fVal</span> <span class="o">:=</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
    <span class="n">fLLim</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">fHLim</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">bInclusive</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stSDSin</span><span class="o">.</span><span class="n">bHomingRequired</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">stSDSin</span><span class="o">.</span><span class="n">fMinUntilHomingRequired</span> <span class="o">:=</span> <span class="n">TIME_TO_REAL</span><span class="p">(</span><span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingRequiredTimeout</span><span class="o">.</span><span class="n">PT</span> <span class="o">-</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">tonHomingRequiredTimeout</span><span class="o">.</span><span class="n">ET</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60000</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">bHomingRequired</span> <span class="n">AND</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&gt;</span> <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="n">AND</span>
    <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">nCommand</span> <span class="o">&lt;&gt;</span> <span class="n">E_EpicsMotorCmd</span><span class="o">.</span><span class="n">HOME</span> <span class="n">THEN</span>

    <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSDSin</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">sCustomErrorMessage</span> <span class="o">:=</span> <span class="s1">&#39;Axis homing status overdue. Please home the axis.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanDo2Criteria</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">bCanDo</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bCantDo</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">b1</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">b2</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">sErrorMsgTF</span> <span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
    <span class="n">sErrorMsgFT</span> <span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
    <span class="n">sErrorMsgFF</span> <span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">bCanDo</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">b1</span> <span class="n">AND</span> <span class="n">b2</span> <span class="n">THEN</span>
    <span class="n">bCanDo</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">b1</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">b2</span> <span class="n">THEN</span>
    <span class="n">bCantDo</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">sErrorMsgTF</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">b1</span> <span class="n">AND</span> <span class="n">b2</span> <span class="n">THEN</span>
    <span class="n">bCantDo</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">sErrorMsgFT</span> <span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">bCantDo</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">sErrorMsgFF</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanHomeGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if garage can be homed.&#39;</span><span class="p">;</span>

<span class="n">InitHomeGarage</span><span class="p">(</span>
    <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageAboveCollisionHeight</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">CONCAT</span><span class="p">(</span><span class="s1">&#39;The garage must be above &#39;</span><span class="p">,</span>
        <span class="n">CONCAT</span><span class="p">(</span><span class="n">LREAL_TO_STRING</span><span class="p">(</span><span class="n">stSDSP</span><span class="o">.</span><span class="n">fGarageHeightSafeFromCollision</span><span class="p">),</span>
        <span class="s1">&#39; mm for the rotation axis to be homed.&#39;</span><span class="p">));</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanHomeTransferArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if transfer arm can be homed.&#39;</span><span class="p">;</span>

<span class="n">InitHomeTransferArm</span><span class="p">(</span>
    <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
<span class="p">);</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanLoadArmFromGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if there is an open slot in the transfer arm and at least one full slot in the garage.&#39;</span><span class="p">;</span>

<span class="n">CheckCanDo2Criteria</span><span class="p">(</span>
    <span class="n">bCanDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span><span class="p">,</span>
    <span class="n">bCantDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">b1</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageUnloadable</span><span class="p">,</span>
    <span class="n">b2</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmLoadable</span><span class="p">,</span>
    <span class="n">sErrorMsgTF</span> <span class="o">:=</span> <span class="s1">&#39;The transfer arm is currently full and cannot be used to remove a sample from the garage.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFT</span> <span class="o">:=</span> <span class="s1">&#39;The garage is currently empty and therefore no samples can be removed.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFF</span> <span class="o">:=</span> <span class="s1">&#39;The garage is currently empty and the transfer arm is full. Therefore, no samples can be removed.&#39;</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanLoadDiffractometerFromArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if the diffractometer slot is open and if the transfer arm is carrying a sample.&#39;</span><span class="p">;</span>

<span class="n">CheckCanDo2Criteria</span><span class="p">(</span>
    <span class="n">bCanDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span><span class="p">,</span>
    <span class="n">bCantDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">b1</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerLoadable</span><span class="p">,</span>
    <span class="n">b2</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmUnloadable</span><span class="p">,</span>
    <span class="n">sErrorMsgTF</span> <span class="o">:=</span> <span class="s1">&#39;The transfer arm is currently empty and cannot be used to place a sample in the diffractometer.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFT</span> <span class="o">:=</span> <span class="s1">&#39;The diffractometer already has a sample in it.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFF</span> <span class="o">:=</span> <span class="s1">&#39;The diffractoemter already has a sample and the transfer arm is empty.&#39;</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanLoadUnloadGarageFromPort</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if the garage can be loaded or unloaded from the port.&#39;</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanManualControl</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if we can switch to manual control.&#39;</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanUnloadArmToGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if there is an open slot in the garage and if the transfer arm is carrying a sample.&#39;</span><span class="p">;</span>

<span class="n">CheckCanDo2Criteria</span><span class="p">(</span>
    <span class="n">bCanDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span><span class="p">,</span>
    <span class="n">bCantDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">b1</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageLoadable</span><span class="p">,</span>
    <span class="n">b2</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmUnloadable</span><span class="p">,</span>
    <span class="n">sErrorMsgTF</span> <span class="o">:=</span> <span class="s1">&#39;The transfer arm is currently empty and cannot be used to load sample into the garage.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFT</span> <span class="o">:=</span> <span class="s1">&#39;The garage is currently full and therefore no samples can be loaded into it.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFF</span> <span class="o">:=</span> <span class="s1">&#39;The garage is currently full and the transfer arm is empty.&#39;</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">CheckCanUnloadDiffractometerToArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Checking if the diffractometer slot is full and if the transfer arm is empty.&#39;</span><span class="p">;</span>

<span class="n">CheckCanDo2Criteria</span><span class="p">(</span>
    <span class="n">bCanDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span><span class="p">,</span>
    <span class="n">bCantDo</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">b1</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerUnloadable</span><span class="p">,</span>
    <span class="n">b2</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmLoadable</span><span class="p">,</span>
    <span class="n">sErrorMsgTF</span> <span class="o">:=</span> <span class="s1">&#39;The transfer arm is currently full and cannot be used to unload a sample from the diffractometer.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFT</span> <span class="o">:=</span> <span class="s1">&#39;The diffractometer does not have a sample in it.&#39;</span><span class="p">,</span>
    <span class="n">sErrorMsgFF</span> <span class="o">:=</span> <span class="s1">&#39;The diffractometeris empty and the transfer arm is full.&#39;</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ConfirmDiffractometerExtraction</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm back a few mm. Please confirm the sample is held by the diffractometer and then click &quot;proceed&quot;. If the sample is still in the transfer arm, click &quot;retry&quot; to go back to fine adjustment.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_DIFF_EXTRACTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ConfirmDiffractometerInsertion</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm back a few mm. Please confirm the sample is held by the diffractometer and then click &quot;proceed&quot;. If the sample is still in the transfer arm, click &quot;retry&quot; to go back to fine adjustment.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_DIFF_INSERTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ConfirmExtraction</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm back a few mm. Please confirm the sample is held by the arm and then click &quot;proceed&quot;. If the sample is still in the holder, click &quot;retry&quot; to go back to fine adjustment.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_GARAGE_EXTRACTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ConfirmGarageFreeToRotate</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INST</span>
    <span class="n">tonHoldDelay</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Missing</span> <span class="n">handling</span> <span class="k">for</span> <span class="n">erroring</span> <span class="n">encoder</span><span class="o">.</span>

<span class="n">tonHoldDelay</span><span class="p">(</span>
    <span class="n">IN</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageYStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&gt;=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">fGarageHeightSafeFromCollision</span><span class="p">,</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#1s</span>
<span class="p">);</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageAboveCollisionHeight</span> <span class="o">:=</span> <span class="n">tonHoldDelay</span><span class="o">.</span><span class="n">Q</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ConfirmInsertion</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm back a few mm. Please confirm the sample is held by the garage and then click &quot;proceed&quot;. If the sample is still in the transfer arm, click &quot;retry&quot; to go back to fine adjustment.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_GARAGE_INSERTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ConfirmVacuumValveOpen</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Verifying that the vacuum valve between SDS and Diff is open.&#39;</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_OPEN_LIMIT_SWITCH</span> <span class="n">AND</span>
    <span class="n">NOT</span> <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_CLOSED_LIMIT_SWITCH</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ExtendPrerotateTransferArmForLoading</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bHArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bRArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm to nominal sample loading position and pre-rotating to allow full rotation for screwing in sample.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">GARAGE_SAMPLE_INSERTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bHArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">PREROTATE_SAMPLE_INSERTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bRArrived</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">bHArrived</span> <span class="n">AND</span> <span class="n">bRArrived</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ExtendTransferArmForDiffractometerExtraction</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm to nominal sample unloading position for diffractometer.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">DIFF_SAMPLE_EXTRACTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ExtendTransferArmForDiffractometerInsertion</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm to nominal sample loading position for diffractometer.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">DIFF_SAMPLE_INSERTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ExtendTransferArmForExtraction</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm to nominal sample extraction position for garage.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">GARAGE_SAMPLE_REMOVAL</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ExtendTransferArmForInsertion</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bHArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bRArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving transfer arm to nominal sample loading position for garage.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">GARAGE_SAMPLE_INSERTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">FineAdjustment</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Use the individual motor control to do fine adjustment. Click &quot;proceed&quot; to move to the next step.&#39;</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">GarageFaceTransferArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bYArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bRArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Facing garage towards the transfer arm.&#39;</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eFaceState</span> <span class="o">:=</span> <span class="n">E_SDSFaceState</span><span class="o">.</span><span class="n">FACE_TRANSFER_ARM</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">HoldThenClear</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">b1</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">tHoldDuration</span> <span class="p">:</span> <span class="n">TIME</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#1s;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INST</span>
    <span class="n">tonHoldTimer</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">tonHoldTimer</span><span class="p">(</span><span class="n">IN</span> <span class="o">:=</span> <span class="n">b1</span><span class="p">,</span> <span class="n">PT</span> <span class="o">:=</span> <span class="n">tHoldDuration</span><span class="p">);</span>

<span class="n">IF</span> <span class="n">tonHoldTimer</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">b1</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">HomeGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Homing the garage.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Garage rotational stage has an active error. Aborting sequence.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">HomeStateMachine</span><span class="p">(</span>
    <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRHomingState</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRHomingState</span> <span class="o">=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">HOMED</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">HomeStateMachine</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">eHomingState</span> <span class="p">:</span> <span class="n">E_SDSHomingState</span><span class="p">;</span>
    <span class="n">stMotionStage</span> <span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bError</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bHome</span> <span class="n">AND</span> <span class="n">F_Limit</span><span class="p">(</span>
    <span class="n">fVal</span> <span class="o">:=</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
    <span class="n">fLLim</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">fHLim</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">bInclusive</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">HOMED</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">CASE</span> <span class="n">eHomingState</span> <span class="n">OF</span>
    <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">INIT</span><span class="p">:</span>
        <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">WAIT_NOT_BUSY</span><span class="p">;</span>
    <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">WAIT_NOT_BUSY</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">TRIGGER_HOMING</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">TRIGGER_HOMING</span><span class="p">:</span>
        <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bHomeCmd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">IF</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">nCommand</span> <span class="o">=</span> <span class="n">E_EpicsMotorCmd</span><span class="o">.</span><span class="n">HOME</span> <span class="n">AND</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">WAIT_FOR_HOMED</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">WAIT_FOR_HOMED</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bDone</span> <span class="n">THEN</span>
            <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">HOMED</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">ELSE</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Homing sequence triggered an unknown state. Aborting sequence.&#39;</span><span class="p">;</span>
<span class="n">END_CASE</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">HomeTransferArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Homing the transfer arm.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Transfer arm horizontal stage has an active error. Aborting sequence.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Transfer arm rotational stage has an active error. Aborting sequence.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">HomeStateMachine</span><span class="p">(</span>
    <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHHomingState</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span>
<span class="p">);</span>

<span class="n">HomeStateMachine</span><span class="p">(</span>
    <span class="n">eHomingState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRHomingState</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHHomingState</span> <span class="o">=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">HOMED</span> <span class="n">AND</span>
   <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRHomingState</span> <span class="o">=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">HOMED</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">InitHomeGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">INIT</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">InitHomeTransferArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmHHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">INIT</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRHomingState</span> <span class="o">:=</span> <span class="n">E_SDSHomingState</span><span class="o">.</span><span class="n">INIT</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">InitRotateGarageForClearance</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">fGarageRotationClearancePos</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">+</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">fGarageRotationClearanceOffset</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">InitSelectGarageSlotForLoading</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">FOR</span> <span class="n">nIndex</span> <span class="o">:=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">TO</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
    <span class="n">CASE</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">:=</span> <span class="n">nIndex</span><span class="p">;</span>
    <span class="n">END_CASE</span>
<span class="n">END_FOR</span>

<span class="n">IF</span> <span class="n">nIndex</span> <span class="o">&gt;</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;There are no empty slots in the garage to load a sample to.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">InitSelectGarageSlotForRemoval</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">FOR</span> <span class="n">nIndex</span> <span class="o">:=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">TO</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
    <span class="n">CASE</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">FULL</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">:=</span> <span class="n">nIndex</span><span class="p">;</span>
    <span class="n">END_CASE</span>
<span class="n">END_FOR</span>

<span class="n">IF</span> <span class="n">nIndex</span> <span class="o">&gt;</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;There are no full slots in the garage to extract a sample from.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">LoadArmFromGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">CASE</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="n">OF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">;</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageAboveCollisionHeight</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">:</span>
        <span class="n">RotateGarageForClearanceManual</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">:</span>
        <span class="n">RetractGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">:</span>
        <span class="n">HomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Select_Garage_Slot_for_Removal</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Select_Garage_Slot_for_Removal</span><span class="p">:</span>
        <span class="n">SelectGarageSlotForRemoval</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Garage_Face_Transfer_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Garage_Face_Transfer_Arm</span><span class="p">:</span>
        <span class="n">GarageFaceTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Lower</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Lower</span><span class="p">:</span>
        <span class="n">RotateGarageForClearance</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Garage_to_Slot_Height</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Garage_to_Slot_Height</span><span class="p">:</span>
        <span class="n">MoveGarageToSlotHeight</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Prerotate_Transfer_Arm_for_Extraction</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Prerotate_Transfer_Arm_for_Extraction</span><span class="p">:</span>
        <span class="n">PrerotateTransferArmForExtraction</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Extraction</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Extraction</span><span class="p">:</span>
        <span class="n">ExtendTransferArmForExtraction</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Screw_in_Half_Turn</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Screw_in_Half_Turn</span><span class="p">:</span>
        <span class="n">ScrewInHalfTurn</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">:</span>
        <span class="n">FineAdjustment</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Unscrew_Sample_from_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Unscrew_Sample_from_Garage</span><span class="p">:</span>
        <span class="n">UnscrewSampleFromGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Extraction</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Extraction</span><span class="p">:</span>
        <span class="n">ConfirmExtraction</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bRetry</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">:</span>
        <span class="n">UpdateSampleLocationDatabaseGarageToArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">OR</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Raise</span><span class="p">:</span>
        <span class="n">RotateGarageForClearance</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_2</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_2</span><span class="p">:</span>
        <span class="n">RetractGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Return_Garage_to_Home</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Return_Garage_to_Home</span><span class="p">:</span>
        <span class="n">HomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">LoadDiffractometerFromArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">CASE</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="n">OF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">;</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageAboveCollisionHeight</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">:</span>
        <span class="n">RotateGarageForClearanceManual</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">:</span>
        <span class="n">RetractGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">:</span>
        <span class="n">HomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Diffractometer_to_Load_Unload_Position</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Diffractometer_to_Load_Unload_Position</span><span class="p">:</span>
        <span class="n">MoveDiffractometerToLoadUnloadPosition</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Vacuum_Valve_Open</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Vacuum_Valve_Open</span><span class="p">:</span>
        <span class="n">ConfirmVacuumValveOpen</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Prerotate_Transfer_Arm_for_Insertion</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Prerotate_Transfer_Arm_for_Insertion</span><span class="p">:</span>
        <span class="n">PrerotateTransferArmForInsertion</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Diffractometer_Insertion</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Diffractometer_Insertion</span><span class="p">:</span>
        <span class="n">ExtendTransferArmForDiffractometerInsertion</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">:</span>
        <span class="n">FineAdjustment</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Screw_Sample_into_Diffractometer</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Screw_Sample_into_Diffractometer</span><span class="p">:</span>
        <span class="n">ScrewSampleIntoDiffractometer</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Diffractometer_Insertion</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Diffractometer_Insertion</span><span class="p">:</span>
        <span class="n">ConfirmDiffractometerInsertion</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bRetry</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">:</span>
        <span class="n">UpdateSampleLocationDatabaseDiffToArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">OR</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">LoadUnloadGarageFromPort</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ManualControl</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">MoveDiffractometerToLoadUnloadPosition</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bXArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bYArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bZArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">b2ThetaYArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bPhiArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bChiArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">b2ThetaArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bThetaArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving the diffractometer to load/unload position.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffXStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffXStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffXStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bXArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffYStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffYStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffYStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bYArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffZStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffZStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffZStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bZArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaYStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiff2ThetaYStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaYStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">b2ThetaYArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffPhiStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffPhiStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffPhiStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bPhiArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffChiStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffChiStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffChiStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bChiArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiff2ThetaStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">b2ThetaArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffThetaStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffThetaStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffThetaStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bThetaArrived</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">bXArrived</span> <span class="n">AND</span>
   <span class="n">bYArrived</span> <span class="n">AND</span>
   <span class="n">bZArrived</span> <span class="n">AND</span>
   <span class="n">b2ThetaYArrived</span> <span class="n">AND</span>
   <span class="n">bPhiArrived</span> <span class="n">AND</span>
   <span class="n">bChiArrived</span> <span class="n">AND</span>
   <span class="n">b2ThetaArrived</span> <span class="n">AND</span>
   <span class="n">bThetaArrived</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">MoveGarageToSlotHeight</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving garage to selected slot height.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageYStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageYStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageYStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">MoveToGarageSlotFaceTransferArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">bYArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bRArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Moving garage to selected slot and facing it towards transfer arm.&#39;</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eFaceState</span> <span class="o">:=</span> <span class="n">E_SDSFaceState</span><span class="o">.</span><span class="n">FACE_TRANSFER_ARM</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageYStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageYStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageYStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bYArrived</span>
<span class="p">);</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">bRArrived</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">bYArrived</span> <span class="n">AND</span> <span class="n">bRArrived</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">PrerotateTransferArmForExtraction</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Pre-rotating transfer arm to allow full rotation for unscrewing the sample.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">PREROTATE_SAMPLE_REMOVAL</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">PrerotateTransferArmForInsertion</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Pre-rotating to allow full rotation for screwing in sample.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">PREROTATE_SAMPLE_INSERTION</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">RetractGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Retracting garage.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageYStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageYStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageYStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">RETRACTED</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">RotateGarageForClearance</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Rotating garage to prevent a collision with the transfer arm sample during movement of the garage.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">F_Limit</span><span class="p">(</span>
       <span class="n">fVal</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
       <span class="n">fLLim</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">fGarageRotationClearancePos</span> <span class="o">-</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fTargetPosControlRange</span><span class="p">,</span>
       <span class="n">fHLim</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">fGarageRotationClearancePos</span> <span class="o">+</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fTargetPosControlRange</span><span class="p">,</span>
       <span class="n">bInclusive</span> <span class="o">:=</span> <span class="n">FALSE</span>
   <span class="p">)</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
   <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">fGarageRotationClearancePos</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">fGarageRotationSpeed</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="o">.</span><span class="n">bMoveCmd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">RotateGarageForClearanceManual</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please manually rotate the garage to 45 degrees to prevent it from colliding with the sample on the transfer arm when raising it up. Click &quot;proceed&quot; when complete.&#39;</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">RotateToFacePort</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Rotating garage so that the selected slot faces the side port.&#39;</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eFaceState</span> <span class="o">:=</span> <span class="n">E_SDSFaceState</span><span class="o">.</span><span class="n">FACE_SIDE_PORT</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eGarageRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ScrewInHalfTurn</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Screwing transfer arm a half turn to catch the sample pin.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">SCREW_IN_HALF_TURN</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ScrewSampleIntoDiffractometer</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Screwing sample into diffractometer.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">SCREW_INTO_DIFF</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">ScrewSampleIntoGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Screwing sample into garage.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">SCREW_INTO_GARAGE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SelectDesiredAction</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please select the desired action.&#39;</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SelectGarageSlotForLoading</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please select a valid garage slot to load a sample to and then click &quot;proceed&quot;.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span> <span class="o">&gt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span> <span class="o">&lt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">CASE</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;The selected garage slot is currently disabled.&#39;</span><span class="p">;</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span><span class="p">;</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">FULL</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;The selected garage slot is currently full.&#39;</span><span class="p">;</span>
    <span class="n">END_CASE</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please select a valid slot from T1 to B4.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SelectGarageSlotForRemoval</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please select a valid garage slot to retrieve a sample from and then click &quot;proceed&quot;.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span> <span class="o">&gt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span> <span class="o">&lt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">CASE</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;The selected garage slot is currently disabled.&#39;</span><span class="p">;</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;The selected garage slot is currently empty.&#39;</span><span class="p">;</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">FULL</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">eGarageSlot</span><span class="p">;</span>
    <span class="n">END_CASE</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please select a valid slot from T1 to B4.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SelectLoadUnloadGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Select whether you would like to load a sample to the garage or remove a sample to the garage.&#39;</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">bLoadingSelected</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bUnloadingSelected</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoad</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bLoadingSelected</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bUnload</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bUnloadingSelected</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SetPositionStateWaitForArrivalQuitIfError</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">eStateGet</span> <span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">stMotionStage</span> <span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">eStateSet</span> <span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
    <span class="n">bError</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="p">:</span> <span class="n">T_MaxString</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_INPUT</span>
    <span class="n">eEnumSet</span> <span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR_OUTPUT</span>
    <span class="n">bArrived</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">eStateGet</span> <span class="o">=</span> <span class="n">eEnumSet</span> <span class="n">AND</span>
    <span class="n">NOT</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
    <span class="n">bArrived</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSIF</span> <span class="n">stMotionStage</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;And axis error occurred. Aborting sequence.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">eStateGet</span> <span class="o">&lt;&gt;</span> <span class="n">eEnumSet</span> <span class="n">THEN</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">eEnumSet</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SetSeqState</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">eSeqState</span> <span class="p">:</span> <span class="n">E_SDSState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">eSeqState</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SetState</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">eState</span> <span class="p">:</span> <span class="n">E_SDSState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">eState</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SetSubstate</span>
<span class="n">VAR_INPUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">eSubState</span> <span class="p">:</span> <span class="n">E_SDSState</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">eSubState</span><span class="p">;</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">StateMachine</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span><span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
<span class="o">//</span>    <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Error</span><span class="p">;</span>
<span class="o">//</span><span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bCancel</span> <span class="n">THEN</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="n">CASE</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
    <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Standby</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Operating</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Select_Desired_Action</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Operating</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">SubStateMachine</span><span class="p">(</span>
                <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
                <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
            <span class="p">);</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">;</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">;</span>
<span class="n">END_CASE</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">SubStateMachine</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">CASE</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="n">OF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">:</span>
        <span class="p">;</span> <span class="o">//</span> <span class="n">Do</span> <span class="n">nothing</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Select_Desired_Action</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bHomeGarage</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Home_Garage</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bHomeTransferArm</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Home_Transfer_Arm</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoadArmFromGarage</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Load_Arm_from_Garage</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bUnloadArmToGarage</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Unload_Arm_to_Garage</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoadUnloadGarageFromPort</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Load_Unload_Garage_from_Port</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bLoadDiffractometerFromArm</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Load_Diffractometer_from_Arm</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bUnloadDiffractometerToArm</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Unload_Diffractometer_to_Arm</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bManualControl</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Check_Can_Manual_Control</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Home_Garage</span><span class="p">:</span>
        <span class="n">CheckCanHomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">:</span>
        <span class="n">HomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Home_Transfer_Arm</span><span class="p">:</span>
        <span class="n">CheckCanHomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSstate</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Load_Arm_From_Garage</span><span class="p">:</span>
        <span class="n">CheckCanLoadArmFromGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Load_Arm_from_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Load_Arm_from_Garage</span><span class="p">:</span>
        <span class="n">LoadArmFromGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSstate</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Load_Diffractometer_from_Arm</span><span class="p">:</span>
        <span class="n">CheckCanLoadDiffractometerFromArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Load_Diffractometer_from_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Load_Diffractometer_from_Arm</span><span class="p">:</span>
        <span class="n">LoadDiffractometerFromArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSstate</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Load_Unload_Garage_from_Port</span><span class="p">:</span>
        <span class="n">CheckCanLoadUnloadGarageFromPort</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Load_Unload_Garage_from_Port</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Load_Unload_Garage_from_Port</span><span class="p">:</span>
        <span class="n">LoadUnloadGarageFromPort</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSstate</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Unload_Arm_to_Garage</span><span class="p">:</span>
        <span class="n">CheckCanUnloadArmToGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Unload_Arm_to_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Unload_Arm_to_Garage</span><span class="p">:</span>
        <span class="n">UnloadArmToGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSstate</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Unload_Diffractometer_to_Arm</span><span class="p">:</span>
        <span class="n">CheckCanUnloadDiffractometerToArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Unload_Diffractometer_to_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Unload_Diffractometer_to_Arm</span><span class="p">:</span>
        <span class="n">UnloadDiffractometerToArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSstate</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Check_Can_Manual_Control</span><span class="p">:</span>
        <span class="n">CheckCanManualControl</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSubState</span> <span class="o">:=</span> <span class="n">E_SDSSubstate</span><span class="o">.</span><span class="n">Manual_Control</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSubState</span><span class="o">.</span><span class="n">Manual_Control</span><span class="p">:</span>
        <span class="n">ManualControl</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSstate</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UnloadArmToGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">CASE</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="n">OF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">;</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageAboveCollisionHeight</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">:</span>
        <span class="n">RotateGarageForClearanceManual</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">:</span>
        <span class="n">RetractGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">:</span>
        <span class="n">HomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Select_Garage_Slot_for_Loading</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Select_Garage_Slot_for_Loading</span><span class="p">:</span>
        <span class="n">SelectGarageSlotForLoading</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Garage_Face_Transfer_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Garage_Face_Transfer_Arm</span><span class="p">:</span>
        <span class="n">GarageFaceTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Lower</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Lower</span><span class="p">:</span>
        <span class="n">RotateGarageForClearance</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Garage_to_Slot_Height</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Garage_to_Slot_Height</span><span class="p">:</span>
        <span class="n">MoveGarageToSlotHeight</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Insertion</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Insertion</span><span class="p">:</span>
        <span class="n">ExtendTransferArmForInsertion</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">:</span>
        <span class="n">FineAdjustment</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Screw_Sample_into_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Screw_Sample_into_Garage</span><span class="p">:</span>
        <span class="n">ScrewSampleIntoGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Insertion</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Insertion</span><span class="p">:</span>
        <span class="n">ConfirmInsertion</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bRetry</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">:</span>
        <span class="n">UpdateSampleLocationDatabaseGarageToArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">OR</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Raise</span><span class="p">:</span>
        <span class="n">RotateGarageForClearance</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_2</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_2</span><span class="p">:</span>
        <span class="n">RetractGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Return_Garage_to_Home</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Return_Garage_to_Home</span><span class="p">:</span>
        <span class="n">HomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SDSState</span><span class="o">.</span><span class="n">Standby</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UnloadDiffractometerToArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">CASE</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="n">OF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Inactive</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">;</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Check_Garage_Height</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageAboveCollisionHeight</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Manually_Rotate_Garage_for_Clearance_to_Raise</span><span class="p">:</span>
        <span class="n">RotateGarageForClearanceManual</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Garage_1</span><span class="p">:</span>
        <span class="n">RetractGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Home_Garage</span><span class="p">:</span>
        <span class="n">HomeGarage</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Diffractometer_to_Load_Unload_Position</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Move_Diffractometer_to_Load_Unload_Position</span><span class="p">:</span>
        <span class="n">MoveDiffractometerToLoadUnloadPosition</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Vacuum_Valve_Open</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Vacuum_Valve_Open</span><span class="p">:</span>
        <span class="n">ConfirmVacuumValveOpen</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Prerotate_Transfer_Arm_for_Extraction</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Prerotate_Transfer_Arm_for_Extraction</span><span class="p">:</span>
        <span class="n">PrerotateTransferArmForExtraction</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Diffractometer_Extraction</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Extend_Transfer_Arm_for_Diffractometer_Extraction</span><span class="p">:</span>
        <span class="n">ExtendTransferArmForDiffractometerExtraction</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">:</span>
        <span class="n">FineAdjustment</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Unscrew_Sample_from_Diffractometer</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Unscrew_Sample_from_Diffractometer</span><span class="p">:</span>
        <span class="n">UnscrewSampleFromDiffractometer</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Diffractometer_Extraction</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Confirm_Diffractometer_Extraction</span><span class="p">:</span>
        <span class="n">ConfirmDiffractometerExtraction</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bRetry</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Fine_Adjustment</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Update_Sample_Database</span><span class="p">:</span>
        <span class="n">UpdateSampleLocationDatabaseDiffToArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
            <span class="n">stSDSP</span> <span class="o">:=</span> <span class="n">stSDSP</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">OR</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">bProceed</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Retract_Transfer_Arm</span><span class="p">:</span>
        <span class="n">HomeTransferArm</span><span class="p">(</span>
            <span class="n">stSDS</span> <span class="o">:=</span> <span class="n">stSDS</span>
        <span class="p">);</span>
        <span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="n">THEN</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">eSeqState</span> <span class="o">:=</span> <span class="n">E_SDSSeqState</span><span class="o">.</span><span class="n">Rotate_Garage_for_Clearance_to_Raise</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UnscrewSampleFromDiffractometer</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Unscrewing sample from diffractometer.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">UNSCREW_FROM_DIFF</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UnscrewSampleFromGarage</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Unscrewing sample from garage.&#39;</span><span class="p">;</span>

<span class="n">SetPositionStateWaitForArrivalQuitIfError</span><span class="p">(</span>
    <span class="n">eStateGet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateGet</span><span class="p">,</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="p">,</span>
    <span class="n">eStateSet</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eTransferArmRStateSet</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">UNSCREW_FROM_GARAGE</span><span class="p">,</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span><span class="p">,</span>
    <span class="n">bArrived</span> <span class="o">=&gt;</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span>
<span class="p">);</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UpdateLoadUnloadAbleStatuses</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Determine</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="ow">is</span> <span class="n">loadable</span> <span class="ow">or</span> <span class="n">unloadable</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="ow">is</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">then</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">allowed</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="ow">is</span> <span class="n">empty</span><span class="p">,</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">loaded</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="ow">is</span> <span class="n">full</span><span class="p">,</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">unloaded</span><span class="o">.</span>
<span class="n">CASE</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
    <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmLoadable</span>   <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmUnloadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">FULL</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmLoadable</span>   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmUnloadable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmLoadable</span>   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bTransferArmUnloadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span>

<span class="o">//</span> <span class="n">Determine</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">loadable</span> <span class="ow">or</span> <span class="n">unloadable</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">then</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">allowed</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">empty</span><span class="p">,</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">loaded</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">slot</span> <span class="ow">is</span> <span class="n">full</span><span class="p">,</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">unloaded</span><span class="o">.</span>
<span class="n">CASE</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">stDiffractometerSlot</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
    <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerLoadable</span>   <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerUnloadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">FULL</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerLoadable</span>   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerUnloadable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">:</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerLoadable</span>   <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">stSDS</span><span class="o">.</span><span class="n">bDiffractometerUnloadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span>

<span class="o">//</span> <span class="n">Determine</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">garage</span> <span class="ow">is</span> <span class="n">loadable</span> <span class="ow">or</span> <span class="n">unloadable</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="nb">all</span> <span class="n">slots</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">garage</span> <span class="n">are</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">then</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">allowed</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">garage</span> <span class="ow">is</span> <span class="n">empty</span><span class="p">,</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">loaded</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">slot</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">garage</span> <span class="ow">is</span> <span class="n">full</span><span class="p">,</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">unloaded</span><span class="o">.</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageLoadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageUnloadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">FOR</span> <span class="n">nIndex</span> <span class="o">:=</span> <span class="mi">0</span> <span class="n">TO</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">nGarageSlots</span> <span class="o">-</span> <span class="mi">1</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
    <span class="n">CASE</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="n">OF</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageLoadable</span>   <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">FULL</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageUnloadable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">:</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageLoadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">stSDS</span><span class="o">.</span><span class="n">bGarageUnloadable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">END_CASE</span>
<span class="n">END_FOR</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UpdatePositionStates</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Update</span> <span class="n">parameters</span> <span class="k">for</span> <span class="n">transfer</span> <span class="n">arm</span> <span class="n">states</span><span class="o">.</span>
<span class="o">//</span> <span class="n">Horizontal</span> <span class="n">axis</span> <span class="n">states</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">RETRACTED</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;RETRACTED&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">2.5</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">GARAGE_SAMPLE_REMOVAL</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;GARAGE_SAMPLE_REMOVAL&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">28</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_GARAGE_EXTRACTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;CONFIRM_GARAGE_EXTRACTION&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">23</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">GARAGE_SAMPLE_INSERTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;GARAGE_SAMPLE_INSERTION&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_GARAGE_INSERTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;CONFIRM_GARAGE_INSERTION&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">DIFF_SAMPLE_INSERTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;DIFF_SAMPLE_INSERTION&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">DIFF_SAMPLE_EXTRACTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;DIFF_SAMPLE_EXTRACTION&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_DIFF_INSERTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;CONFIRM_DIFF_INSERTION&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">75</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmHPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmHStates</span><span class="o">.</span><span class="n">CONFIRM_DIFF_EXTRACTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;CONFIRM_DIFF_EXTRACTION&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">75</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="mi">2</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Rotational</span> <span class="n">axis</span> <span class="n">states</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">FULLY_CCW</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;FULLY_CCW&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fGarageRotationSpeed</span><span class="p">,</span>
    <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">5.0</span>
<span class="p">);</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="n">THEN</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">PREROTATE_SAMPLE_REMOVAL</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;PREROTATE_SAMPLE_REMOVAL&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
    <span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">PREROTATE_SAMPLE_REMOVAL</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;PREROTATE_SAMPLE_REMOVAL&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span><span class="o">:=</span><span class="mi">20000</span><span class="p">,</span>
        <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
    <span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="n">THEN</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">PREROTATE_SAMPLE_INSERTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;PREROTATE_SAMPLE_INSERTION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
    <span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">PREROTATE_SAMPLE_INSERTION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;PREROTATE_SAMPLE_INSERTION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span><span class="o">:=-</span><span class="mi">20000</span><span class="p">,</span>
        <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
    <span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">UNSCREW_FROM_GARAGE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;UNSCREW_FROM_GARAGE&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">UNSCREW_FROM_DIFF</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;UNSCREW_FROM_DIFF&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">SCREW_INTO_GARAGE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;SCREW_INTO_GARAGE&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">1700</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">SCREW_INTO_DIFF</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;SCREW_INTO_DIFF&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="mi">1700</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
<span class="p">);</span>
<span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">astTransferArmRPosState</span><span class="p">[</span><span class="n">E_SDSTransferArmRStates</span><span class="o">.</span><span class="n">SCREW_IN_HALF_TURN</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;SCREW_IN_HALF_TURN&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span>
    <span class="n">fVelocity</span><span class="o">:=</span><span class="n">stSDS</span><span class="o">.</span><span class="n">fTransferArmRotationSpeed</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Update</span> <span class="n">parameters</span> <span class="k">for</span> <span class="n">garage</span> <span class="n">states</span><span class="o">.</span>
<span class="o">//</span> <span class="n">Y</span> <span class="n">axis</span> <span class="n">states</span>
<span class="n">fbStateSetup</span><span class="p">(</span>
    <span class="n">stPositionState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">astGarageYPosState</span><span class="p">[</span><span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">RETRACTED</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;RETRACTED&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">10.0</span>
<span class="p">);</span>

<span class="n">FOR</span> <span class="n">nIndex</span> <span class="o">:=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">TO</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
    <span class="n">fbStateSetup</span><span class="p">(</span>
        <span class="n">stPositionState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">astGarageYPosState</span><span class="p">[</span><span class="n">nIndex</span><span class="p">],</span>
        <span class="n">sName</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">fYPos</span><span class="p">,</span>
        <span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">);</span>
<span class="n">END_FOR</span>

<span class="o">//</span> <span class="n">Rotational</span> <span class="n">axis</span> <span class="n">states</span>
<span class="n">fbStateSetup</span><span class="p">(</span>
    <span class="n">stPositionState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">astGarageRPosState</span><span class="p">[</span><span class="n">E_SDSGarageRStates</span><span class="o">.</span><span class="n">PREDICTED_HOME</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;PREDICTED_HOME&#39;</span><span class="p">,</span>
    <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
    <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">bLocked</span> <span class="o">:=</span> <span class="n">TRUE</span>
<span class="p">);</span>

<span class="n">FOR</span> <span class="n">nIndex</span> <span class="o">:=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">TO</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">BY</span> <span class="mi">1</span> <span class="n">DO</span>
    <span class="n">CASE</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eFaceState</span> <span class="n">OF</span>
        <span class="n">E_SDSFaceState</span><span class="o">.</span><span class="n">FACE_SIDE_PORT</span><span class="p">:</span>
            <span class="n">fbStateSetup</span><span class="p">(</span>
                <span class="n">stPositionState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">astGarageRPosState</span><span class="p">[</span><span class="n">nIndex</span><span class="p">],</span>
                <span class="n">sName</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span><span class="p">,</span>
                <span class="n">fPosition</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span> <span class="o">+</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">fFacePortOffset</span><span class="p">,</span>
                <span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="p">);</span>
    <span class="n">ELSE</span>
        <span class="n">fbStateSetup</span><span class="p">(</span>
            <span class="n">stPositionState</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">astGarageRPosState</span><span class="p">[</span><span class="n">nIndex</span><span class="p">],</span>
            <span class="n">sName</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">sTag</span><span class="p">,</span>
            <span class="n">fPosition</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span><span class="o">.</span><span class="n">fDeg</span><span class="p">,</span>
            <span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="n">END_CASE</span>
<span class="n">END_FOR</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UpdateSampleLocationDatabaseDiffToArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">stTempSlot</span> <span class="p">:</span> <span class="n">ST_SampleSlot</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stTempSlot</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Updating the sample database.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&gt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&lt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">stDiffractometerSlot</span><span class="o">.</span><span class="n">eState</span><span class="p">;</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="o">.</span><span class="n">sDesc</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">stDiffractometerSlot</span><span class="o">.</span><span class="n">sDesc</span><span class="p">;</span>

    <span class="n">stSDSP</span><span class="o">.</span><span class="n">stDiffractometerSlot</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">stTempSlot</span><span class="o">.</span><span class="n">eState</span><span class="p">;</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">stDiffractometerSlot</span><span class="o">.</span><span class="n">sDesc</span> <span class="o">:=</span> <span class="n">stTempSlot</span><span class="o">.</span><span class="n">sDesc</span><span class="p">;</span>

    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Failed to automatically update sample position in database. Invalid slot selected. Sequence will continue, but please manually update the database from the interface. After manually updating the database, click &quot;proceed&quot; to continue.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UpdateSampleLocationDatabaseGarageToArm</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">VAR</span>
    <span class="n">stTempSlot</span> <span class="p">:</span> <span class="n">ST_SampleSlot</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stTempSlot</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Updating the sample database.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&gt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&lt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span><span class="p">;</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">stTransferArmSlot</span><span class="o">.</span><span class="n">sDesc</span> <span class="o">:=</span> <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">sDesc</span><span class="p">;</span>

    <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">stTempSlot</span><span class="o">.</span><span class="n">eState</span><span class="p">;</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">sDesc</span> <span class="o">:=</span> <span class="n">stTempSlot</span><span class="o">.</span><span class="n">sDesc</span><span class="p">;</span>

    <span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Failed to automatically update sample position in database. Invalid slot selected. Sequence will continue, but please manually update the database from the interface. After manually updating the database, click &quot;proceed&quot; to continue.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UpdateSampleLocationDatabaseManualExtraction</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please extract the sample. Click &quot;proceed&quot; when you have finished.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&gt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&lt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">EMPTY</span><span class="p">;</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">sDesc</span> <span class="o">:=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Failed to update sample position in database. Invalid slot selected. Sequence will continue, but please manually update the database from the interface.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>

<span class="n">METHOD</span> <span class="n">PRIVATE</span> <span class="n">UpdateSampleLocationDatabaseManualInsertion</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stSDS</span> <span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">stSDSP</span> <span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">bSuccess</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">sStatusMsg</span> <span class="o">:=</span> <span class="s1">&#39;Please insert the sample and write an identifying description for it in the text field. Click &quot;proceed&quot; when you have finished.&#39;</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&gt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">T1</span> <span class="n">AND</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span> <span class="o">&lt;=</span> <span class="n">E_SDSGarageYStates</span><span class="o">.</span><span class="n">B4</span> <span class="n">THEN</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">eState</span> <span class="o">:=</span> <span class="n">E_SampleSlotStates</span><span class="o">.</span><span class="n">FULL</span><span class="p">;</span>
    <span class="n">stSDSP</span><span class="o">.</span><span class="n">astGarageSlot</span><span class="p">[</span><span class="n">stSDS</span><span class="o">.</span><span class="n">eSelectedGarageSlot</span><span class="p">]</span><span class="o">.</span><span class="n">sDesc</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">stUISelect</span><span class="o">.</span><span class="n">sTextInput</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">stSDS</span><span class="o">.</span><span class="n">sErrorMsg</span> <span class="o">:=</span> <span class="s1">&#39;Failed to update sample position in database. Invalid slot selected. Sequence will continue, but please manually update the database from the interface.&#39;</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_METHOD</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-diffstate">E_DiffState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsfacestate">E_SDSFaceState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsgaragerstates">E_SDSGarageRStates</a></p></li>
<li><p><a class="reference internal" href="#e-sdsgarageystates">E_SDSGarageYStates</a></p></li>
<li><p><a class="reference internal" href="#e-sdshomingstate">E_SDSHomingState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsseqstate">E_SDSSeqState</a></p></li>
<li><p><a class="reference internal" href="#e-sdsstate">E_SDSState</a></p></li>
<li><p><a class="reference internal" href="#e-sdssubstate">E_SDSSubstate</a></p></li>
<li><p><a class="reference internal" href="#e-sdstransferarmhstates">E_SDSTransferArmHStates</a></p></li>
<li><p><a class="reference internal" href="#e-sdstransferarmrstates">E_SDSTransferArmRStates</a></p></li>
<li><p><a class="reference internal" href="#e-sampleslotstates">E_SampleSlotStates</a></p></li>
<li><p><a class="reference internal" href="#f-limit">F_Limit</a></p></li>
<li><p><a class="reference internal" href="#gvl-interface">GVL_Interface</a></p></li>
<li><p><a class="reference internal" href="#st-sds">ST_SDS</a></p></li>
<li><p><a class="reference internal" href="#st-sdspersistent">ST_SDSPersistent</a></p></li>
<li><p><a class="reference internal" href="#st-sampleslot">ST_SampleSlot</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="fb-slits">
<h2>FB_Slits<a class="headerlink" href="#fb-slits" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FUNCTION_BLOCK</span> <span class="n">FB_Slits</span>
<span class="n">VAR_IN_OUT</span>
    <span class="n">stTopBlade</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">Left</span> <span class="n">Slit</span> <span class="kn">from</span><span class="w"> </span><span class="nn">upstream</span> <span class="n">view</span>
    <span class="n">stRightBlade</span><span class="p">:</span> <span class="n">ST_MotionStage</span><span class="p">;</span> <span class="o">//</span> <span class="n">Right</span> <span class="n">Slit</span> <span class="kn">from</span><span class="w"> </span><span class="nn">upstream</span> <span class="n">view</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span><span class="n">BOOL</span> <span class="p">;</span>
    <span class="n">io_fbFFHWO</span>    <span class="p">:</span>    <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>
    <span class="n">fbArbiter</span><span class="p">:</span> <span class="n">FB_Arbiter</span><span class="p">();</span>
<span class="n">END_VAR</span>

<span class="n">VAR_INPUT</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">PMPS_OK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMoveOk</span><span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Offsets</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Offset_Top</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetTop</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Bottom</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetBottom</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: ZeroOffset_Left; io: io;&#39;</span><span class="p">}</span>
    <span class="n">rEncoderOffsetLeft</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ZeroOffset_Right</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rEncoderOffsetRight</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">i_DevName</span> <span class="p">:</span> <span class="n">STRING</span><span class="p">;</span> <span class="o">//</span><span class="n">device</span> <span class="n">name</span> <span class="k">for</span> <span class="n">FFO</span> <span class="ow">and</span> <span class="n">PMPS</span> <span class="n">diagnostics</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">Home</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHome</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_VAR</span>

<span class="n">VAR</span>
    <span class="n">fbTopBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbBottomBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbLeftBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbRightBlade</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fPosTopBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosBottomBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosLeftBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosRightBlade</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">bCollisionLimitationVert</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bCollisionLimitationHorz</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Motion</span> <span class="n">Parameters</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fSmallDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.01</span><span class="p">;</span>
    <span class="n">fBigDelta</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="n">fMaxVelocity</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="n">fHighAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.8</span><span class="p">;</span>
    <span class="n">fLowAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">stTop</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">stBOTTOM</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">stLeft</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">stRight</span><span class="p">:</span> <span class="n">ST_PositionState</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: TOP&#39;</span><span class="p">}</span>
    <span class="n">fbTop</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: BOTTOM&#39;</span><span class="p">}</span>
    <span class="n">fbBottom</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: LEFT&#39;</span><span class="p">}</span>
    <span class="n">fbLeft</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: RIGHT&#39;</span><span class="p">}</span>
    <span class="n">fbRight</span><span class="p">:</span> <span class="n">FB_StatePTPMove</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">EPICS</span> <span class="n">pvs</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XWID_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YWID_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XCEN_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YCEN_REQ</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rReqCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_XWIDTH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_YWIDTH</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_XCENTER</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">ACTUAL_YCENTER</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rActCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">XCEN_SETZERO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rSetCenterX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">YCEN_SETZERO</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="s1">&#39;}</span>
    <span class="n">rSetCenterY</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">OPEN</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bOpen</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">CLOSE</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bClose</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">BLOCK</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">io</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bBlock</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


     <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
    <span class="n">pv</span><span class="p">:</span> <span class="n">HOME_READY</span><span class="p">;</span>
    <span class="n">io</span><span class="p">:</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ZNAM</span> <span class="kc">False</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">ONAM</span> <span class="kc">True</span>
    <span class="s1">&#39;}</span>
    <span class="n">bHomeReady</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>


    <span class="o">//</span><span class="n">Local</span> <span class="n">variables</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">true</span><span class="p">;</span>
    <span class="n">rTrig_Block</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Open</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">rTrig_Close</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="o">//</span><span class="n">old</span> <span class="n">values</span>
    <span class="n">rOldReqApertureSizeX</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqApertureSizeY</span> <span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqCenterX</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>
    <span class="n">rOldReqCenterY</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">bExecuteMotionX</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="n">fPosBlock</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosClose</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fPosOpen</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="n">stSetPositionOptions</span><span class="p">:</span><span class="n">ST_SetPositionOptions</span><span class="p">;</span>
    <span class="n">fbSetPosition_TOP</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Bottom</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Left</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fbSetPosition_Right</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">For</span> <span class="n">logging</span>
    <span class="n">fbLogger</span> <span class="p">:</span> <span class="n">FB_LogMessage</span> <span class="o">:=</span> <span class="p">(</span><span class="n">eSubsystem</span><span class="o">:=</span><span class="n">E_SubSystem</span><span class="o">.</span><span class="n">MOTION</span><span class="p">);</span>
    <span class="n">tErrorPresent</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tAction</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tOverrideActivated</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">FFO</span>    <span class="p">:</span>    <span class="n">FB_FastFault</span> <span class="o">:=</span><span class="p">(</span>
        <span class="n">i_DevName</span> <span class="o">:=</span> <span class="s1">&#39;Slits&#39;</span><span class="p">,</span>
        <span class="n">i_Desc</span> <span class="o">:=</span> <span class="s1">&#39;Fault occurs when center is greated than that requested&#39;</span><span class="p">,</span>
        <span class="n">i_TypeCode</span> <span class="o">:=</span> <span class="mi">16</span><span class="c1">#1010);</span>


    <span class="n">bTest</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">AptArrayStatus</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>
    <span class="n">AptArrayReq</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">ST_PMPS_Aperture_IO</span><span class="p">;</span>

    <span class="n">fbPower</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Initialize</span>
<span class="n">ACT_init</span><span class="p">();</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">ACT_Motion</span><span class="p">();</span>
<span class="o">//</span><span class="n">SET</span> <span class="ow">and</span> <span class="n">GET</span> <span class="n">the</span> <span class="n">requested</span> <span class="ow">and</span> <span class="n">Actual</span> <span class="n">values</span>
<span class="n">ACT_CalculatePositions</span><span class="p">();</span>

<span class="o">//</span> <span class="n">Software</span> <span class="n">Limits</span> <span class="n">to</span> <span class="n">protect</span> <span class="n">blades</span>
<span class="n">ACT_VirtualLimitSW</span><span class="p">();</span>

<span class="n">END_FUNCTION_BLOCK</span>

<span class="n">ACTION</span> <span class="n">ACT_BLOCK</span><span class="p">:</span>
<span class="n">rTrig_Block</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bBlock</span><span class="p">);</span>
<span class="n">rTrig_Open</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bOpen</span><span class="p">);</span>
<span class="n">rTrig_Close</span> <span class="p">(</span><span class="n">CLK</span><span class="o">:=</span> <span class="n">bClose</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Block</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="o">//</span><span class="n">BLOCK</span>

    <span class="n">bBlock</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Open</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>


    <span class="n">bOpen</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="k">if</span> <span class="p">(</span><span class="n">rTrig_Close</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span> <span class="n">THEN</span>


    <span class="n">bClose</span> <span class="o">:=</span> <span class="n">false</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_CalculatePositions</span><span class="p">:</span>
<span class="o">//</span><span class="n">check</span> <span class="k">if</span> <span class="n">requested</span> <span class="n">center</span> <span class="ow">or</span> <span class="n">gap</span> <span class="n">has</span> <span class="n">changed</span>
<span class="o">//</span><span class="n">check</span> <span class="n">that</span> <span class="n">the</span> <span class="n">requested</span> <span class="n">values</span> <span class="n">are</span> <span class="n">within</span> <span class="n">acceptable</span> <span class="n">motion</span> <span class="nb">range</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeX</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeX</span> <span class="o">:=</span> <span class="n">rReqApertureSizeX</span><span class="p">;</span>
        <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterX</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterX</span> <span class="o">:=</span> <span class="n">rReqCenterX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new X center&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterX</span> <span class="o">:=</span> <span class="n">rActCenterX</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqApertureSizeY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqApertureSizeY</span><span class="p">)</span> <span class="n">THEN</span>
        <span class="n">rOldReqApertureSizeY</span> <span class="o">:=</span> <span class="n">rReqApertureSizeY</span><span class="p">;</span>
        <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y gap.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>

<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">rOldReqCenterY</span> <span class="o">&lt;&gt;</span> <span class="n">rReqCenterY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">rOldReqCenterY</span> <span class="o">:=</span> <span class="n">rReqCenterY</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbLogger</span><span class="p">(</span><span class="n">sMsg</span><span class="o">:=</span><span class="s1">&#39;Requested new Y center.&#39;</span><span class="p">,</span> <span class="n">eSevr</span><span class="o">:=</span><span class="n">TcEventSeverity</span><span class="o">.</span><span class="n">Verbose</span><span class="p">);</span>
   <span class="o">//</span> <span class="n">ELSE</span>
      <span class="o">//</span>  <span class="n">rReqCenterY</span> <span class="o">:=</span> <span class="n">rActCenterY</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">requested</span> <span class="n">target</span> <span class="n">positions</span> <span class="kn">from</span><span class="w"> </span><span class="nn">requested</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span>
<span class="n">fPosTopBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span> <span class="o">+</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="p">;</span>
<span class="n">fPosBottomBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeY</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterY</span><span class="o">+</span><span class="n">rEncoderOffsetBottom</span><span class="p">);</span>

<span class="n">fPosLeftBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetLeft</span><span class="p">);</span>
<span class="n">fPosRightBlade</span> <span class="o">:=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">rReqApertureSizeX</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">rReqCenterX</span> <span class="o">+</span> <span class="n">rEncoderOffsetRight</span><span class="p">);</span>


<span class="o">//</span><span class="n">Calculate</span> <span class="n">actual</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">center</span> <span class="kn">from</span><span class="w"> </span><span class="nn">actual</span> <span class="n">stages</span> <span class="n">positions</span>
<span class="n">rActApertureSizeX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stLeftBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetLeft</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stRightBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="o">-</span> <span class="n">rEncoderOffsetRight</span><span class="p">));</span>

<span class="n">rActApertureSizeY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">));</span>

<span class="n">rActCenterX</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stLeftBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetLeft</span><span class="p">)</span>  <span class="o">+</span> <span class="p">(</span><span class="n">stRightBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetRight</span> <span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>

<span class="n">rActCenterY</span> <span class="o">:=</span> <span class="n">LREAL_TO_REAL</span><span class="p">((((</span><span class="n">stTopBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetTop</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">stBottomBlade</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">rEncoderOffsetBottom</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>


<span class="o">//</span> <span class="n">Prevent</span> <span class="n">collision</span>
<span class="n">bCollisionLimitationHorz</span>    <span class="o">:=</span> <span class="p">(</span><span class="n">rActApertureSizeX</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">);</span>
<span class="n">bCollisionLimitationVert</span>    <span class="o">:=</span> <span class="p">(</span><span class="n">rActApertureSizeY</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Init</span><span class="p">:</span>
<span class="o">//</span>  <span class="n">init</span> <span class="n">the</span> <span class="n">motion</span> <span class="n">stages</span> <span class="n">parameters</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">stTopBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">stRightBlade</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">FFO</span><span class="o">.</span><span class="n">i_DevName</span> <span class="o">:=</span> <span class="n">i_DevName</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_Motion</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Instantiate</span> <span class="n">Function</span> <span class="n">block</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">blades</span>
<span class="n">fbTopBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stTopBlade</span><span class="p">);</span>
<span class="n">fbBottomBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stBottomBlade</span><span class="p">);</span>
<span class="n">fbLeftBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stLeftBlade</span><span class="p">);</span>
<span class="n">fbRightBlade</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stRightBlade</span><span class="p">);</span>



<span class="o">//</span> <span class="n">PTP</span> <span class="n">Motion</span> <span class="k">for</span> <span class="n">each</span> <span class="n">blade</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Top&#39;</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosTopBlade</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stTop</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Bottom&#39;</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosBottomBlade</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stBOTTOM</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stLeft</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Left&#39;</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosLeftBlade</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stLeft</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">stRight</span><span class="o">.</span><span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Right&#39;</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">fPosRightBlade</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fDelta</span> <span class="o">:=</span> <span class="n">fSmallDelta</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fMaxVelocity</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fAccel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>
<span class="n">stRight</span><span class="o">.</span><span class="n">fDecel</span> <span class="o">:=</span> <span class="n">fHighAccel</span><span class="p">;</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionY</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbTop</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbBottom</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionY</span><span class="p">;</span>
    <span class="n">bExecuteMotionY</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="p">(</span><span class="n">bExecuteMotionX</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">fbLeft</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">fbRight</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">bExecuteMotionX</span><span class="p">;</span>
    <span class="n">bExecuteMotionX</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="n">fbTop</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stTop</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stTopBlade</span><span class="p">);</span>

<span class="n">fbBottom</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stBOTTOM</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stBottomBlade</span><span class="p">);</span>

<span class="n">fbLeft</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stLeft</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stLeftBlade</span><span class="p">);</span>

<span class="n">fbRight</span><span class="p">(</span>
    <span class="n">stPositionState</span><span class="o">:=</span><span class="n">stRight</span><span class="p">,</span>
    <span class="n">bMoveOk</span><span class="o">:=</span><span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">stRightBlade</span><span class="p">);</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_VirtualLimitSW</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Force</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">false</span>
<span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">SafetyReady</span> <span class="n">flags</span> <span class="n">manually</span>
<span class="n">stTopBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">stRightBlade</span><span class="o">.</span><span class="n">bSafetyReady</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>


<span class="o">//</span> <span class="n">Note</span><span class="p">:</span> <span class="n">FB_MotionStage</span> <span class="n">calls</span> <span class="n">FB_SetEnables</span> <span class="n">internally</span> <span class="n">that</span> <span class="n">overwrites</span> <span class="o">.</span><span class="n">bAllForwardEnable</span><span class="o">/.</span><span class="n">bAllBackwardEnable</span> <span class="n">flags</span>

<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stTopBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationVert</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationVert</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stBottomBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stLeftBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationHorz</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">fbPower</span><span class="p">(</span>
    <span class="n">Axis</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
    <span class="n">Enable</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bAllEnable</span><span class="p">,</span>
    <span class="n">Enable_Positive</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bAllForwardEnable</span> <span class="n">AND</span> <span class="n">bCollisionLimitationHorz</span><span class="p">,</span>
    <span class="n">Enable_Negative</span> <span class="o">:=</span> <span class="n">stRightBlade</span><span class="o">.</span><span class="n">bAllBackwardEnable</span><span class="p">,</span>
    <span class="n">Override</span> <span class="o">:=</span> <span class="mf">100.000</span>
<span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
</section>
<section id="prg-1-plctask">
<h2>PRG_1_PlcTask<a class="headerlink" href="#prg-1-plctask" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_1_PlcTask</span>
<span class="n">VAR</span>
<span class="n">END_VAR</span>
<span class="n">PRG_2_PMPS</span><span class="p">();</span>
<span class="n">PRG_3_LOG</span><span class="p">();</span>
<span class="n">PRG_Diffractometer</span><span class="p">();</span>
<span class="n">PRG_LAS</span><span class="p">();</span>
<span class="n">PRG_SDS</span><span class="p">();</span>
<span class="n">PRG_RotDet</span><span class="p">();</span>
<span class="o">//</span><span class="n">PRG_Questar</span><span class="p">();</span>
<span class="n">PRG_SpetrometerArm</span><span class="p">();</span>
<span class="n">PRG_SSL</span><span class="p">();</span>
<span class="n">PRG_Cryo</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#prg-2-pmps">PRG_2_PMPS</a></p></li>
<li><p><a class="reference internal" href="#prg-3-log">PRG_3_LOG</a></p></li>
<li><p><a class="reference internal" href="#prg-cryo">PRG_Cryo</a></p></li>
<li><p><a class="reference internal" href="#prg-diffractometer">PRG_Diffractometer</a></p></li>
<li><p><a class="reference internal" href="#prg-las">PRG_LAS</a></p></li>
<li><p><a class="reference internal" href="#prg-questar">PRG_Questar</a></p></li>
<li><p><a class="reference internal" href="#prg-rotdet">PRG_RotDet</a></p></li>
<li><p><a class="reference internal" href="#prg-sds">PRG_SDS</a></p></li>
<li><p><a class="reference internal" href="#prg-ssl">PRG_SSL</a></p></li>
<li><p><a class="reference internal" href="#prg-spetrometerarm">PRG_SpetrometerArm</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-2-pmps">
<h2>PRG_2_PMPS<a class="headerlink" href="#prg-2-pmps" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_2_PMPS</span>
<span class="n">VAR</span>
    <span class="n">fbArbiterIO</span><span class="p">:</span> <span class="n">FB_SubSysToArbiter_IO</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="o">.</span><span class="n">Execute</span><span class="p">();</span>
<span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput2</span><span class="o">.</span><span class="n">Execute</span><span class="p">();</span>
<span class="n">fbArbiterIO</span><span class="p">(</span>
    <span class="n">Arbiter</span><span class="o">:=</span><span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
    <span class="n">fbFFHWO</span><span class="o">:=</span><span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-2theta">
<h2>PRG_2Theta<a class="headerlink" href="#prg-2theta" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_2Theta
VAR
    bInit: BOOL := TRUE;
    fbPower_AxisM2:  MC_Power;
    fb2ThetaStepper : FB_MotionStage;
    bMoveOk: BOOL;
    iEnableMotorState: UINT;
    tonEnableMotorTimeout: TON;
    tEnableMotorTimeoutTime: TIME := T#5s;
    bMovePos: BOOL;
    bMoveNeg: BOOL;
    bMovePosAndOK: BOOL;
    bMoveNegAndOK: BOOL;
    rtExecuteMove: R_TRIG;

    {attribute &#39;TcLinkTo&#39; :=  &#39;TIID^Device 2 (EtherCAT)^Rack#1A-01 Coupler (EK1100)^Rack#1A-04 DR_2Th (EL7047)^STM Status^Status^Ready&#39;}
    b2ThetaDriveReady AT %I*: BOOL;
    {attribute &#39;TcLinkTo&#39; :=  &#39;TIPC^qrix_motion^qrix_motion Instance^PlcTask Outputs^PRG_SSL.EL7047_02_01_SSL_Status_to_NC&#39;}
    nSSLDriveStatus AT %I* : USINT;
    bSSLDriveReady : BOOL;
END_VAR

VAR CONSTANT
    fThresholdPS1: REAL := 0.15;
    fThresholdPS2: REAL := 0.15;
    fThresholdPS3: REAL := 0.15;
END_VAR
IF binit THEN
    bInit := FALSE;

    // Stepper
    //Main.M2.nBrakeMode := ENUM_StageBrakeMode.IF_ENABLED;
    // Disabled brake. It actually doesn&#39;t help with anything and we found that it
    // is sometimes interfering with the movement of the motor. We think it might be
    // some sort of lag in the brake disengaging that causes it to fight with the
    // drive for a bit, which causes overcurrent faults.
    Main.M2.nBrakeMode := ENUM_StageBrakeMode.IF_MOVING;
    Main.M2.bBrakeRelease := TRUE;
    Main.M2.bHardwareEnable := TRUE;
    Main.M2.bPowerSelf := TRUE;

    Main.M2.nEnableMode := ENUM_StageEnableMode.NEVER ;
END_IF;

bSSLDriveReady := nSSLDriveStatus.1; // Drive status ready bit after tying it to bFloating.

ACT_Stepper();

END_PROGRAM

ACTION ACT_Stepper:
// Simplified enabling logic by removing separate fbPower function and
// making the estop and other permissives drive the bPowerSelf bit.
// Now, the motor motion is handled entirely within the FB_MotionStage block
// which makes this usage more standard and easier to work with using our
// standard typhos widget.
Main.M2.bHardwareEnable :=          GVL_EPS.bESTOP // ESTOP
                            AND GVL_Sensor.bFloating
                            AND     GVL_Sensor.stPS1.fValue &gt; fThresholdPS1
                            AND GVL_Sensor.stPS2.fValue &gt; fThresholdPS2
                            AND GVL_Sensor.stPS3.fValue &gt; fThresholdPS3 // Compressed-air pressure
                            AND GVL_EPS.bOpenSV1
                            AND GVL_EPS.bOpenSV2;

IF NOT PRG_SSL.bRealignCouple THEN
    CASE iEnableMotorState OF
        0:
            IF Main.M2.bExecute AND GVL_Sensor.bFloating THEN
                rtExecuteMove(CLK:=FALSE);
                Main.M2.bExecute := FALSE;
                Main.M2.bEnable := TRUE;
                Main.M1.bEnable := TRUE;
                iEnableMotorState := iEnableMotorState + 1;
            ELSIF Main.M2.bExecute AND NOT GVL_Sensor.bFloating THEN
                Main.M2.bExecute := FALSE;
                Main.M2.bError := TRUE;
                Main.M1.bError := TRUE;
                Main.M2.sCustomErrorMessage := &#39;Move failed. Arm must be levitating to move.&#39;;
                Main.M1.sCustomErrorMessage := &#39;Move failed. Arm must be levitating to move.&#39;;
            ELSE
                Main.M2.bEnable := FALSE;
                Main.M1.bEnable := FALSE;
            END_IF
            tonEnableMotorTimeout(IN:=FALSE);
        1: // Wait until the logic confirms both motors are fully enabled
            tonEnableMotorTimeout(IN:=NOT Main.M2.bAllEnable OR NOT Main.M1.bAllEnable,PT:=tEnableMotorTimeoutTime);

            // Check which direction we are moving, and if the directional enables will allow that move.
            bMovePos        := Main.M2.stAxisStatus.fActPosition &lt; Main.M2.fPosition;
            bMoveNeg        := Main.M2.stAxisStatus.fActPosition &gt; Main.M2.fPosition;
            bMovePosAndOK   := bMovePos AND Main.M2.bAllForwardEnable AND Main.M1.bAllForwardEnable;
            bMoveNegAndOK   := bMoveNeg AND Main.M2.bAllBackwardEnable AND Main.M1.bAllBackwardEnable;

            // Check for fully enabled
            IF Main.M2.bAllEnable AND Main.M1.bAllEnable THEN
                // Check direction of motion and if that direction is enabled
                IF bMovePosAndOK OR bMoveNegAndOK THEN
                    iEnableMotorState := iEnableMotorState + 1;
                    tonEnableMotorTimeout(IN:=FALSE);
                ELSE
                    IF NOT Main.M2.bError OR Main.M1.bError THEN
                        // Direction of motion is not enabled, so let&#39;s report the error and give a helpful error message.
                        Main.M2.bError := TRUE;
                        Main.M1.bError := TRUE;
                        IF bMovePos THEN
                            IF NOT Main.M2.bLimitForwardEnable THEN
                                Main.M2.sCustomErrorMessage := &#39;Move forward failed due to forward limit switch.&#39;;
                                Main.M1.sCustomErrorMessage := &#39;Move forward failed due to forward limit switch for 2 theta motor.&#39;;
                            ELSIF NOT Main.M1.bLimitForwardEnable THEN
                                Main.M1.sCustomErrorMessage := &#39;Move forward failed due to forward limit switch.&#39;;
                                Main.M2.sCustomErrorMessage := &#39;Move forward failed due to forward limit switch for SSL motor.&#39;;
                            ELSIF NOT Main.M2.bGantryForwardEnable AND Main.M2.bGantryAxis THEN
                                Main.M2.sCustomErrorMessage := &#39;Move forward failed due to gantry motion tolerance limit.&#39;;
                                Main.M1.sCustomErrorMessage := &#39;Move forward failed due to gantry motion tolerance limit for 2 theta motor.&#39;;
                            ELSIF NOT Main.M1.bGantryForwardEnable AND Main.M1.bGantryAxis THEN
                                Main.M1.sCustomErrorMessage := &#39;Move forward failed due to gantry motion tolerance limit.&#39;;
                                Main.M2.sCustomErrorMessage := &#39;Move forward failed due to gantry motion tolerance limit for SSL motor.&#39;;
                            ELSIF NOT Main.M2.stEPSForwardEnable.bEPS_OK THEN
                                Main.M2.sCustomErrorMessage := &#39;Move forward failed due to EPS condition.&#39;;
                                Main.M1.sCustomErrorMessage := &#39;Move forward failed due to EPS condition for 2 theta motor.&#39;;
                            ELSIF NOT Main.M1.stEPSForwardEnable.bEPS_OK THEN
                                Main.M1.sCustomErrorMessage := &#39;Move forward failed due to EPS condition.&#39;;
                                Main.M2.sCustomErrorMessage := &#39;Move forward failed due to EPS condition for SSL motor.&#39;;
                            ELSE
                                Main.M1.sCustomErrorMessage := &#39;Move forward failed for unspecified reason.&#39;;
                                Main.M2.sCustomErrorMessage := &#39;Move forward failed for unspecified reason.&#39;;
                            END_IF
                        ELSIF bMoveNeg THEN
                            IF NOT Main.M2.bLimitBackwardEnable THEN
                                Main.M2.sCustomErrorMessage := &#39;Move backward failed due to forward limit switch.&#39;;
                                Main.M1.sCustomErrorMessage := &#39;Move backward failed due to forward limit switch for 2 theta motor.&#39;;
                            ELSIF NOT Main.M1.bLimitBackwardEnable THEN
                                Main.M1.sCustomErrorMessage := &#39;Move backward failed due to forward limit switch.&#39;;
                                Main.M2.sCustomErrorMessage := &#39;Move backward failed due to forward limit switch for SSL motor.&#39;;
                            ELSIF NOT Main.M2.bGantryBackwardEnable AND Main.M2.bGantryAxis THEN
                                Main.M2.sCustomErrorMessage := &#39;Move backward failed due to gantry motion tolerance limit.&#39;;
                                Main.M1.sCustomErrorMessage := &#39;Move backward failed due to gantry motion tolerance limit for 2 theta motor.&#39;;
                            ELSIF NOT Main.M1.bGantryBackwardEnable AND Main.M1.bGantryAxis THEN
                                Main.M1.sCustomErrorMessage := &#39;Move backward failed due to gantry motion tolerance limit.&#39;;
                                Main.M2.sCustomErrorMessage := &#39;Move backward failed due to gantry motion tolerance limit for SSL motor.&#39;;
                            ELSIF NOT Main.M2.stEPSBackwardEnable.bEPS_OK THEN
                                Main.M2.sCustomErrorMessage := &#39;Move backward failed due to EPS condition.&#39;;
                                Main.M1.sCustomErrorMessage := &#39;Move backward failed due to EPS condition for 2 theta motor.&#39;;
                            ELSIF NOT Main.M1.stEPSBackwardEnable.bEPS_OK THEN
                                Main.M1.sCustomErrorMessage := &#39;Move backward failed due to EPS condition.&#39;;
                                Main.M2.sCustomErrorMessage := &#39;Move backward failed due to EPS condition for SSL motor.&#39;;
                            ELSE
                                Main.M2.sCustomErrorMessage := &#39;Move backward failed for unspecified reason.&#39;;
                                Main.M1.sCustomErrorMessage := &#39;Move backward failed for unspecified reason.&#39;;
                            END_IF
                        ELSE
                            Main.M2.sCustomErrorMessage := &#39;Move failed because it was not large enough to register.&#39;;
                            Main.M1.sCustomErrorMessage := &#39;Move failed because it was not large enough to register.&#39;;
                        END_IF
                    END_IF
                    iEnableMotorState := 0;
                END_IF
            ELSIF tonEnableMotorTimeout.Q THEN
                IF NOT Main.M2.bError OR Main.M1.bError THEN
                    Main.M2.bError := TRUE;
                    Main.M1.bError := TRUE;
                    IF NOT Main.M2.bEnable THEN
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because bEnable never received.&#39;;
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because bEnable never received on 2 theta motor.&#39;;
                    ELSIF NOT Main.M1.bEnable THEN
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because bEnable never received.&#39;;
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because bEnable never received on SSL motor.&#39;;
                    ELSIF NOT Main.M2.bHardwareEnable THEN
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because bHardwareEnable set false.&#39;;
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because bHardwareEnable set false on 2 theta motor.&#39;;
                    ELSIF NOT Main.M1.bHardwareEnable THEN
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because bHardwareEnable set false.&#39;;
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because bHardwareEnable set false on SSL motor.&#39;;
                    ELSIF NOT Main.M2.stEPSPowerEnable.bEPS_OK THEN
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because of EPS condition.&#39;;
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because of EPS condition on 2 theta motor.&#39;;
                    ELSIF NOT Main.M1.stEPSPowerEnable.bEPS_OK THEN
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because of EPS condition.&#39;;
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because of EPS condition on SSL motor.&#39;;
                    ELSIF NOT Main.M2.bUserEnable THEN
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because user enable is set to false.&#39;;
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because user enable is set to false on 2 theta motor.&#39;;
                    ELSIF NOT Main.M1.bUserEnable THEN
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled because user enable is set to false.&#39;;
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled because user enable is set to false on SSL motor.&#39;;
                    ELSE
                        Main.M2.sCustomErrorMessage := &#39;Move never enabled in the timeout duration.&#39;;
                        Main.M1.sCustomErrorMessage := &#39;Move never enabled in the timeout duration.&#39;;
                    END_IF
                END_IF
                iEnableMotorState := 0;
            END_IF
        2: // Wait for the motor drives to switch to the ready state before commanding the move.
            tonEnableMotorTimeout(IN:=NOT b2ThetaDriveReady OR NOT bSSLDriveReady,PT:=tEnableMotorTimeoutTime);

            // Are both drives reporting that they are ready?
            IF b2ThetaDriveReady AND bSSLDriveReady THEN
                iEnableMotorState := iEnableMotorState + 1;
                tonEnableMotorTimeout(IN:=FALSE);
            ELSIF tonEnableMotorTimeout.Q THEN
                IF NOT Main.M2.bError OR Main.M1.bError THEN
                    Main.M2.bError := TRUE;
                    Main.M1.bError := TRUE;
                    IF NOT b2ThetaDriveReady THEN
                        Main.M2.sCustomErrorMessage := &#39;Move failed because motor drive did not get ready status before timeout.&#39;;
                        Main.M1.sCustomErrorMessage := &#39;Move failed because 2 theta motor drive did not get ready status before timeout.&#39;;
                    ELSE
                        Main.M1.sCustomErrorMessage := &#39;Move failed because motor drive did not get ready status before timeout.&#39;;
                        Main.M2.sCustomErrorMessage := &#39;Move failed because SSL motor drive did not get ready status before timeout.&#39;;
                    END_IF
                END_IF
                iEnableMotorState := 0;
            END_IF
        3: // Allow the move execution to begin
            rtExecuteMove(CLK:=TRUE);
            IF rtExecuteMove.Q THEN
                Main.M2.bExecute := TRUE;
            END_IF
            tonEnableMotorTimeout(IN:=NOT Main.M2.bBusy,PT:=T#100ms);
            IF tonEnableMotorTimeout.Q THEN
                iEnableMotorState := iEnableMotorState + 1;
            END_IF
    ELSE
        iEnableMotorState := 0;
    END_CASE
ELSE
    Main.M2.bEnable := TRUE;
    Main.M1.bEnable := TRUE;
END_IF

fb2ThetaStepper(stMotionStage:=Main.M2);
END_ACTION
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-ssl">PRG_SSL</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-3-log">
<h2>PRG_3_LOG<a class="headerlink" href="#prg-3-log" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_3_LOG</span>
<span class="n">VAR</span>
      <span class="n">fbLogHandler</span><span class="p">:</span> <span class="n">FB_LogHandler</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">fbLogHandler</span><span class="p">();</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
</section>
<section id="prg-cryo">
<h2>PRG_Cryo<a class="headerlink" href="#prg-cryo" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Cryo</span>
<span class="n">VAR</span>
    <span class="n">nCryoRotOutEncoderCounts</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">ULINT</span><span class="p">;</span>
    <span class="n">nCryoRotEncoderOffset</span><span class="p">:</span> <span class="n">ULINT</span><span class="p">;</span>
    <span class="n">nDiffThetaOutEncoderCounts</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">ULINT</span><span class="p">;</span>
    <span class="n">nDiffThetaEncoderOffset</span><span class="p">:</span> <span class="n">ULINT</span><span class="p">;</span>
    <span class="n">fb_Cryo_ROT</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Cryo_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Cryo_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Cryo_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>

    <span class="n">fbEPSCryoXBackward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbEPSCryoXForward</span>  <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbEPSCryoYBackward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbEPSCryoYForward</span>  <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbEPSCryoZBackward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbEPSCryoZForward</span>  <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbEPSCryoThetaBackward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fbEPSCryoThetaForward</span>  <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">nGantryTolerance</span><span class="p">:</span> <span class="n">LINT</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">CRYO</span><span class="p">:</span><span class="n">ROT</span><span class="p">:</span><span class="n">bExecuteCouple</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">couple</span> <span class="n">cryo</span> <span class="n">rotation</span> <span class="n">axis</span> <span class="k">with</span> <span class="n">diffractometer</span> <span class="n">theta</span> <span class="n">axis</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bCryoRotDiffThetaExecuteCouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">CRYO</span><span class="p">:</span><span class="n">ROT</span><span class="p">:</span><span class="n">bExecuteDecouple</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Write</span> <span class="n">FALSE</span> <span class="n">to</span> <span class="n">decouple</span> <span class="n">cryo</span> <span class="n">rotation</span> <span class="n">axis</span> <span class="kn">from</span><span class="w"> </span><span class="nn">diffractometer</span> <span class="n">theta</span> <span class="n">axis</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bCryoRotDiffThetaExecuteDecouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.Count := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-02^EL5042_03_17 - Diff - Theta - 2Theta^FB Inputs Channel 1^Position&#39;</span><span class="p">}</span>
    <span class="n">stDiffThetaEnc</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.Count := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL5042_02_16^FB Inputs Channel 2^Position&#39;</span><span class="p">}</span>
    <span class="n">stCryoRotEnc</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DIFF</span><span class="p">:</span><span class="n">THETACOUPLING</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Structure</span> <span class="n">representing</span> <span class="n">cryo</span> <span class="ow">and</span> <span class="n">diffractometer</span> <span class="n">theta</span> <span class="n">coupling</span> <span class="n">enablement</span> <span class="n">coordinator</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">stCryoRotDiffThetaAutoRealignCouple</span><span class="p">:</span> <span class="n">ST_AutoRealignCouple</span><span class="p">;</span>
    <span class="n">fbCryoRotDiffThetaAutoRealignCouple</span><span class="p">:</span> <span class="n">FB_AutoRealignCouple</span><span class="p">;</span>

    <span class="n">fbCryoRotDiffThetaCoupling</span><span class="p">:</span> <span class="n">FB_GantryAutoCoupling</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bLeaderDriveReady := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-02^EL7047_03_16 - Diff - Theta^STM Status^Status^Ready;</span>
                              <span class="o">.</span><span class="n">bFollowDriveReady</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_11</span><span class="o">^</span><span class="n">STM</span> <span class="n">Status</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Ready</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DIFFCRYO</span><span class="p">:</span><span class="n">Coord</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Structure</span> <span class="n">representing</span> <span class="n">cryo</span> <span class="ow">and</span> <span class="n">diffractometer</span> <span class="n">theta</span> <span class="n">coupling</span> <span class="n">enablement</span> <span class="n">coordinator</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">stCryoRotDiffThetaCoordinateGantryAxisEnable</span><span class="p">:</span> <span class="n">ST_CoordinateGantryAxisEnable</span><span class="p">;</span>
    <span class="n">fbCryoRotDiffThetaCoordinateGantryAxisEnable</span><span class="p">:</span> <span class="n">FB_CoordinateGantryAxisEnable</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bFollowerDriveReady := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL7047_02_12^STM Status^Status^Ready</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">CRYO</span><span class="p">:</span><span class="n">MLC</span><span class="p">:</span><span class="n">X</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Structure</span> <span class="n">representing</span> <span class="n">Cryo</span> <span class="n">X</span> <span class="n">multi</span><span class="o">-</span><span class="n">leader</span> <span class="n">coupling</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">stCryoXMultiLeader</span><span class="p">:</span> <span class="n">ST_MultiLeaderMotionCoupling</span><span class="p">;</span>
    <span class="n">fbCryoXMultiLeader</span><span class="p">:</span> <span class="n">FB_MultiLeaderMotionCoupling</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bFollowerDriveReady := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL7047_02_14^STM Status^Status^Ready</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">CRYO</span><span class="p">:</span><span class="n">MLC</span><span class="p">:</span><span class="n">Y</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Structure</span> <span class="n">representing</span> <span class="n">Cryo</span> <span class="n">Y</span> <span class="n">multi</span><span class="o">-</span><span class="n">leader</span> <span class="n">coupling</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">stCryoYMultiLeader</span><span class="p">:</span> <span class="n">ST_MultiLeaderMotionCoupling</span><span class="p">;</span>
    <span class="n">fbCryoYMultiLeader</span><span class="p">:</span> <span class="n">FB_MultiLeaderMotionCoupling</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.bFollowerDriveReady := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL7047_02_15^STM Status^Status^Ready</span>
    <span class="s1">&#39;}</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">CRYO</span><span class="p">:</span><span class="n">MLC</span><span class="p">:</span><span class="n">Z</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Structure</span> <span class="n">representing</span> <span class="n">Cryo</span> <span class="n">Z</span> <span class="n">multi</span><span class="o">-</span><span class="n">leader</span> <span class="n">coupling</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">stCryoZMultiLeader</span><span class="p">:</span> <span class="n">ST_MultiLeaderMotionCoupling</span><span class="p">;</span>
    <span class="n">fbCryoZMultiLeader</span><span class="p">:</span> <span class="n">FB_MultiLeaderMotionCoupling</span><span class="p">;</span>

    <span class="n">fCryoYNeutralPosition</span>         <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nMicrostepCounter := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL7047_02_11^ENC Status compact^Counter value;</span>
                              <span class="o">.</span><span class="n">bCounterOverflow</span>  <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_11</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">overflow</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bCounterUnderflow</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_11</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">underflow</span><span class="s1">&#39;}</span>
    <span class="n">fbMeasureReferenceVelocityCryoROT</span><span class="p">:</span> <span class="n">FB_MeasureReferenceVelocity</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nMicrostepCounter := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL7047_02_12^ENC Status compact^Counter value;</span>
                              <span class="o">.</span><span class="n">bCounterOverflow</span>  <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_12</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">overflow</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bCounterUnderflow</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_12</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">underflow</span><span class="s1">&#39;}</span>
    <span class="n">fbMeasureReferenceVelocityCryoX</span><span class="p">:</span> <span class="n">FB_MeasureReferenceVelocity</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nMicrostepCounter := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL7047_02_14^ENC Status compact^Counter value;</span>
                              <span class="o">.</span><span class="n">bCounterOverflow</span>  <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_14</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">overflow</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bCounterUnderflow</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_14</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">underflow</span><span class="s1">&#39;}</span>
    <span class="n">fbMeasureReferenceVelocityCryoY</span><span class="p">:</span> <span class="n">FB_MeasureReferenceVelocity</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nMicrostepCounter := TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL7047_02_15^ENC Status compact^Counter value;</span>
                              <span class="o">.</span><span class="n">bCounterOverflow</span>  <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_15</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">overflow</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bCounterUnderflow</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">B950</span><span class="o">-</span><span class="mi">233</span><span class="o">-</span><span class="n">WALL</span><span class="o">-</span><span class="n">S</span><span class="o">-</span><span class="n">R01</span><span class="o">-</span><span class="n">DRL</span><span class="o">-</span><span class="mi">01</span><span class="o">^</span><span class="n">EL7047_02_15</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">underflow</span><span class="s1">&#39;}</span>
    <span class="n">fbMeasureReferenceVelocityCryoZ</span><span class="p">:</span> <span class="n">FB_MeasureReferenceVelocity</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span><span class="p">;</span> <span class="o">//</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Encoder</span> <span class="n">count</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">order</span> <span class="n">to</span> <span class="n">shift</span> <span class="n">the</span> <span class="n">overflow</span> <span class="n">point</span><span class="o">.</span>
    <span class="n">nCryoRotEncoderOffset</span> <span class="o">:=</span> <span class="mi">1073741824</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Encoder</span> <span class="n">count</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">order</span> <span class="n">to</span> <span class="n">shift</span> <span class="n">the</span> <span class="n">overflow</span> <span class="n">point</span><span class="o">.</span>
    <span class="n">nDiffThetaEncoderOffset</span> <span class="o">:=</span> <span class="mi">1073741824</span><span class="p">;</span>
    <span class="o">//</span> <span class="mf">0.000000083819</span> <span class="n">deg</span><span class="o">/</span><span class="n">inc</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span><span class="mi">930</span><span class="p">,</span><span class="mf">469.225</span> <span class="n">inc</span><span class="o">/</span><span class="n">degree</span>
    <span class="o">//</span> <span class="n">For</span> <span class="mi">1</span> <span class="n">degree</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">need</span> <span class="mi">11930469</span> <span class="n">inc</span>
    <span class="n">nGantryTolerance</span> <span class="o">:=</span> <span class="mi">119304690000</span><span class="p">;</span>
    <span class="n">stCryoRotDiffThetaCoordinateGantryAxisEnable</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="o">//</span> <span class="n">Allow</span> <span class="n">setting</span> <span class="n">of</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">position</span> <span class="k">for</span> <span class="n">gantry</span> <span class="n">diff</span> <span class="n">limit</span> <span class="n">calculation</span>
    <span class="n">stDiffThetaEnc</span><span class="o">.</span><span class="n">Ref</span> <span class="o">:=</span> <span class="mi">121223792</span><span class="p">;</span>
    <span class="n">stCryoRotEnc</span><span class="o">.</span><span class="n">Ref</span>   <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">stCryoXMultiLeader</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stCryoXMultiLeader</span><span class="o">.</span><span class="n">bUseDynamicLimits</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="o">:=</span> <span class="mf">50.7</span><span class="p">;</span>
    <span class="n">stCryoYMultiLeader</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stCryoYMultiLeader</span><span class="o">.</span><span class="n">bUseDynamicLimits</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoZNeutralPositionAtDiffZ0</span> <span class="o">:=</span> <span class="mf">4.0</span><span class="p">;</span>
    <span class="n">stCryoZMultiLeader</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">stCryoZMultiLeader</span><span class="o">.</span><span class="n">bUseDynamicLimits</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">ACT_CryoThetaDiffThetaCoupling</span><span class="p">();</span>

<span class="n">ACT_CryoXYZCoupling</span><span class="p">();</span>

<span class="n">ACT_EPS</span><span class="p">();</span>

<span class="n">fb_Cryo_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="p">);</span>
<span class="n">fb_Cryo_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="p">);</span>
<span class="n">fb_Cryo_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="p">);</span>
<span class="n">fb_Cryo_ROT</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="p">);</span>

<span class="n">fbMeasureReferenceVelocityCryoX</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="p">,</span>
    <span class="n">nMicrostepsPerStep</span><span class="o">:=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">bBusy</span><span class="o">=&gt;</span><span class="p">,</span>
    <span class="n">fMeasuredReferenceVelocity</span><span class="o">=&gt;</span>
<span class="p">);</span>
<span class="n">fbMeasureReferenceVelocityCryoY</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="p">,</span>
    <span class="n">nMicrostepsPerStep</span><span class="o">:=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">bBusy</span><span class="o">=&gt;</span><span class="p">,</span>
    <span class="n">fMeasuredReferenceVelocity</span><span class="o">=&gt;</span>
<span class="p">);</span>
<span class="n">fbMeasureReferenceVelocityCryoZ</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="p">,</span>
    <span class="n">nMicrostepsPerStep</span><span class="o">:=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">bBusy</span><span class="o">=&gt;</span><span class="p">,</span>
    <span class="n">fMeasuredReferenceVelocity</span><span class="o">=&gt;</span>
<span class="p">);</span>
<span class="n">fbMeasureReferenceVelocityCryoROT</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="p">,</span>
    <span class="n">nMicrostepsPerStep</span><span class="o">:=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">bBusy</span><span class="o">=&gt;</span><span class="p">,</span>
    <span class="n">fMeasuredReferenceVelocity</span><span class="o">=&gt;</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">ACT_CryoThetaDiffThetaCoupling</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Offset</span> <span class="n">the</span> <span class="n">raw</span> <span class="n">value</span> <span class="n">to</span> <span class="n">ensure</span> <span class="n">the</span> <span class="n">rollover</span> <span class="n">point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">path</span> <span class="n">of</span> <span class="n">motion</span><span class="o">.</span>
<span class="o">//</span> <span class="n">offset</span> <span class="n">of</span> <span class="mi">90</span> <span class="n">degrees</span> <span class="n">negative</span> <span class="k">for</span> <span class="o">-</span><span class="mi">90</span> <span class="n">to</span> <span class="mi">270</span> <span class="n">degree</span> <span class="nb">range</span><span class="o">.</span> <span class="mi">90</span> <span class="n">degrees</span> <span class="n">because</span> <span class="mi">90</span><span class="o">/</span><span class="mi">360</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="mi">32</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">073</span><span class="p">,</span><span class="mi">741</span><span class="p">,</span><span class="mf">824.</span>
<span class="n">nCryoRotOutEncoderCounts</span>   <span class="o">:=</span>  <span class="n">stCryoRotEnc</span><span class="o">.</span><span class="n">Count</span> <span class="o">+</span> <span class="n">nCryoRotEncoderOffset</span><span class="p">;</span>
<span class="n">nDiffThetaOutEncoderCounts</span> <span class="o">:=</span>  <span class="n">UDINT_TO_ULINT</span><span class="p">(</span><span class="n">ULINT_TO_UDINT</span><span class="p">(</span><span class="n">stDiffThetaEnc</span><span class="o">.</span><span class="n">Count</span><span class="p">))</span> <span class="o">+</span> <span class="n">nDiffThetaEncoderOffset</span><span class="p">;</span>

<span class="n">stCryoRotEnc</span><span class="o">.</span><span class="n">Count</span> <span class="o">:=</span> <span class="n">stCryoRotEnc</span><span class="o">.</span><span class="n">Count</span> <span class="o">+</span> <span class="n">nCryoRotEncoderOffset</span><span class="p">;</span>
<span class="n">stDiffThetaEnc</span><span class="o">.</span><span class="n">Count</span> <span class="o">:=</span> <span class="n">UDINT_TO_ULINT</span><span class="p">(</span><span class="n">ULINT_TO_UDINT</span><span class="p">(</span><span class="n">stDiffThetaEnc</span><span class="o">.</span><span class="n">Count</span><span class="p">))</span> <span class="o">+</span> <span class="n">nDiffThetaEncoderOffset</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Cryo</span> <span class="n">Rotation</span> <span class="ow">and</span> <span class="n">Diffractometer</span> <span class="n">Theta</span> <span class="n">Coupling</span>
<span class="n">fbCryoRotDiffThetaCoupling</span><span class="p">(</span>
    <span class="n">nGantryTol</span>                      <span class="o">:=</span> <span class="n">nGantryTolerance</span><span class="p">,</span>
    <span class="n">Master</span>                          <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">,</span>
    <span class="n">MasterEnc</span>                       <span class="o">:=</span> <span class="n">stDiffThetaEnc</span><span class="p">,</span>
    <span class="n">Slave</span>                           <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="p">,</span>
    <span class="n">SlaveEnc</span>                        <span class="o">:=</span> <span class="n">stCryoRotEnc</span><span class="p">,</span>
    <span class="n">bExecuteCouple</span>          <span class="o">:=</span> <span class="n">stCryoRotDiffThetaAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteCouple</span><span class="p">,</span>
    <span class="n">bExecuteDecouple</span>        <span class="o">:=</span> <span class="n">stCryoRotDiffThetaAutoRealignCouple</span><span class="o">.</span><span class="n">bExecuteDecouple</span>
<span class="p">);</span>

<span class="n">fbCryoRotDiffThetaAutoRealignCouple</span><span class="p">(</span>
    <span class="n">stMotionStageLeader</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">,</span>
    <span class="n">stMotionStageFollow</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="p">,</span>
    <span class="n">stAutoRealignCouple</span><span class="o">:=</span><span class="n">stCryoRotDiffThetaAutoRealignCouple</span>
<span class="p">);</span>

<span class="p">(</span><span class="o">*</span><span class="n">fbCryoRotDiffThetaCoordinateGantryAxisEnable</span><span class="p">(</span>
    <span class="n">stMotionStageLeader</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">,</span>
    <span class="n">stMotionStageFollow</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="p">,</span>
    <span class="n">stCoordinateGantryAxisEnable</span><span class="o">:=</span><span class="n">stCryoRotDiffThetaCoordinateGantryAxisEnable</span>
<span class="p">);</span><span class="o">*</span><span class="p">)</span>

<span class="n">IF</span> <span class="n">stCryoRotDiffThetaAutoRealignCouple</span><span class="o">.</span><span class="n">bCoupled</span> <span class="n">THEN</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">E_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">ELSE</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">E_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_CryoXYZCoupling</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
    <span class="n">fbCryoXMultiLeader</span><span class="p">(</span>
        <span class="n">stMotionStageFollow</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="p">,</span>
        <span class="n">stMultiLeaderMotionCoupling</span> <span class="o">:=</span> <span class="n">stCryoXMultiLeader</span><span class="p">,</span>
        <span class="n">fTargetPos</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fTargetVel</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">SetVelo</span><span class="p">,</span>
        <span class="n">fTargetAcc</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">SetAcc</span><span class="p">,</span>
        <span class="n">bError</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
        <span class="n">tTimeout</span>   <span class="o">:=</span> <span class="n">T</span><span class="c1">#5s</span>
    <span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">fbCryoXMultiLeader</span><span class="p">(</span>
        <span class="n">stMotionStageFollow</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="p">,</span>
        <span class="n">stMultiLeaderMotionCoupling</span> <span class="o">:=</span> <span class="n">stCryoXMultiLeader</span><span class="p">,</span>
        <span class="n">fTargetPos</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fTargetVel</span> <span class="o">:=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">fTargetAcc</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">bError</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
        <span class="n">tTimeout</span>   <span class="o">:=</span> <span class="n">T</span><span class="c1">#5s</span>
    <span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">stCryoXMultiLeader</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">stCryoXMultiLeader</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fCryoYNeutralPosition</span> <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">;</span>

<span class="n">fbCryoYMultiLeader</span><span class="p">(</span>
    <span class="n">stMotionStageFollow</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="p">,</span>
    <span class="n">stMultiLeaderMotionCoupling</span> <span class="o">:=</span> <span class="n">stCryoYMultiLeader</span><span class="p">,</span>
    <span class="n">fTargetPos</span> <span class="o">:=</span> <span class="n">F_TargetCryoYPosition</span><span class="p">(</span>
        <span class="n">fNeutralPosition</span> <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fBraidDiameter</span>   <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fBraidDiameter</span><span class="p">,</span>
        <span class="n">fPhiAngleDeg</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">),</span>
    <span class="n">fTargetVel</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">fTargetAcc</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">bError</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
    <span class="n">tTimeout</span>   <span class="o">:=</span> <span class="n">T</span><span class="c1">#5s</span>
<span class="p">);</span>
<span class="n">IF</span> <span class="n">stCryoYMultiLeader</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">stCryoYMultiLeader</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">IF</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
    <span class="n">fbCryoZMultiLeader</span><span class="p">(</span>
        <span class="n">stMotionStageFollow</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="p">,</span>
        <span class="n">stMultiLeaderMotionCoupling</span><span class="o">:=</span><span class="n">stCryoZMultiLeader</span><span class="p">,</span>
        <span class="n">fTargetPos</span> <span class="o">:=</span> <span class="n">fCryoZNeutralPositionAtDiffZ0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fTargetVel</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">SetVelo</span><span class="p">,</span>
        <span class="n">fTargetAcc</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">SetAcc</span><span class="p">,</span>
        <span class="n">bError</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
        <span class="n">tTimeout</span>   <span class="o">:=</span> <span class="n">T</span><span class="c1">#5s</span>
    <span class="p">);</span>
<span class="n">ELSE</span>
    <span class="n">fbCryoZMultiLeader</span><span class="p">(</span>
        <span class="n">stMotionStageFollow</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="p">,</span>
        <span class="n">stMultiLeaderMotionCoupling</span><span class="o">:=</span><span class="n">stCryoZMultiLeader</span><span class="p">,</span>
        <span class="n">fTargetPos</span> <span class="o">:=</span> <span class="n">fCryoZNeutralPositionAtDiffZ0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fTargetVel</span> <span class="o">:=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">fTargetAcc</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">,</span>
        <span class="n">bError</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bError</span><span class="p">,</span>
        <span class="n">tTimeout</span>   <span class="o">:=</span> <span class="n">T</span><span class="c1">#5s</span>
    <span class="p">);</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">stCryoZMultiLeader</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">stCryoZMultiLeader</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_EPS</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoXBackward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoXBackward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoXBackward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoXForward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoXForward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoXForward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoYBackward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoYBackward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoYBackward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">F_TargetCryoYPosition</span><span class="p">(</span>
        <span class="n">fNeutralPosition</span> <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fBraidDiameter</span>   <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fBraidDiameter</span><span class="p">,</span>
        <span class="n">fPhiAngleDeg</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoYForward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoYForward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoYForward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">F_TargetCryoYPosition</span><span class="p">(</span>
        <span class="n">fNeutralPosition</span> <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fBraidDiameter</span>   <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fBraidDiameter</span><span class="p">,</span>
        <span class="n">fPhiAngleDeg</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoZBackward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoZBackward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoZBackward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="p">(</span><span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoZNeutralPositionAtDiffZ0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoZForward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoZForward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoZForward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="p">(</span><span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoZNeutralPositionAtDiffZ0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoThetaBackward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoThetaBackward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoThetaBackward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">fbEPSCryoThetaForward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">fbEPSCryoThetaForward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span>
<span class="n">fbEPSCryoThetaForward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-autorealigncouple">FB_AutoRealignCouple</a></p></li>
<li><p><a class="reference internal" href="#fb-coordinategantryaxisenable">FB_CoordinateGantryAxisEnable</a></p></li>
<li><p><a class="reference internal" href="#fb-measurereferencevelocity">FB_MeasureReferenceVelocity</a></p></li>
<li><p><a class="reference internal" href="#fb-multileadermotioncoupling">FB_MultiLeaderMotionCoupling</a></p></li>
<li><p><a class="reference internal" href="#f-targetcryoyposition">F_TargetCryoYPosition</a></p></li>
<li><p><a class="reference internal" href="#gvl-var">GVL_VAR</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#st-autorealigncouple">ST_AutoRealignCouple</a></p></li>
<li><p><a class="reference internal" href="#st-coordinategantryaxisenable">ST_CoordinateGantryAxisEnable</a></p></li>
<li><p><a class="reference internal" href="#st-multileadermotioncoupling">ST_MultiLeaderMotionCoupling</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-arm">
<h2>PRG_DET_ARM<a class="headerlink" href="#prg-det-arm" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_ARM</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bExecuteCouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteDecouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">fbMotionYF1</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionYF2</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionZF</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbAutoCoupling</span><span class="p">:</span> <span class="n">FB_GantryAutoCoupling</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .Count := TIIB[BOX-06 ENC_ZDC_YF1 (EL5042)]^FB Inputs Channel 2^Position&#39;</span><span class="p">}</span>
    <span class="n">stRenishawAbsEncMaster</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .Count := TIIB[BOX-07 ENC_YF2_ZF (EL5042)]^FB Inputs Channel 1^Position&#39;</span><span class="p">}</span>
    <span class="n">stRenishawAbsEncSlave</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>

    <span class="n">tonDelay</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tonDelay2</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">rtDelay</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">bRunTimer</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">nState</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">bDisableStateMachine</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;.nMicrostepCounter := TIID^Device 2 (EtherCAT)^BOX-01 Coupler (EK1100)^BOX-20 DR_YF1 (EL7047)^ENC Status compact^Counter value;</span>
                              <span class="o">.</span><span class="n">bCounterOverflow</span>  <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">BOX</span><span class="o">-</span><span class="mi">01</span> <span class="n">Coupler</span> <span class="p">(</span><span class="n">EK1100</span><span class="p">)</span><span class="o">^</span><span class="n">BOX</span><span class="o">-</span><span class="mi">20</span> <span class="n">DR_YF1</span> <span class="p">(</span><span class="n">EL7047</span><span class="p">)</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">overflow</span><span class="p">;</span>
                              <span class="o">.</span><span class="n">bCounterUnderflow</span> <span class="o">:=</span> <span class="n">TIID</span><span class="o">^</span><span class="n">Device</span> <span class="mi">2</span> <span class="p">(</span><span class="n">EtherCAT</span><span class="p">)</span><span class="o">^</span><span class="n">BOX</span><span class="o">-</span><span class="mi">01</span> <span class="n">Coupler</span> <span class="p">(</span><span class="n">EK1100</span><span class="p">)</span><span class="o">^</span><span class="n">BOX</span><span class="o">-</span><span class="mi">20</span> <span class="n">DR_YF1</span> <span class="p">(</span><span class="n">EL7047</span><span class="p">)</span><span class="o">^</span><span class="n">ENC</span> <span class="n">Status</span> <span class="n">compact</span><span class="o">^</span><span class="n">Status</span><span class="o">^</span><span class="n">Counter</span> <span class="n">underflow</span><span class="s1">&#39;}</span>
    <span class="n">fbMeasureReferenceVelocity</span><span class="p">:</span> <span class="n">FB_MeasureReferenceVelocity</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">IF_ENABLED</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">M25</span> <span class="ow">and</span> <span class="n">M26</span> <span class="n">are</span> <span class="n">coupled</span> <span class="k">with</span> <span class="n">M25</span> <span class="k">as</span> <span class="n">the</span> <span class="n">leader</span><span class="o">.</span>
    <span class="o">//</span> <span class="n">The</span> <span class="n">motors</span> <span class="n">cannot</span> <span class="n">be</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">always</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">because</span> <span class="n">they</span> <span class="n">have</span> <span class="n">brakes</span> <span class="n">that</span>
    <span class="o">//</span> <span class="n">only</span> <span class="n">activate</span> <span class="n">when</span> <span class="n">the</span> <span class="n">motors</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">moving</span><span class="o">.</span> <span class="n">Due</span> <span class="n">to</span> <span class="n">the</span> <span class="n">weight</span>
    <span class="o">//</span> <span class="n">of</span> <span class="n">the</span> <span class="n">frame</span><span class="p">,</span> <span class="n">it</span> <span class="n">appears</span> <span class="n">that</span> <span class="k">if</span> <span class="n">the</span> <span class="n">brake</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">on</span><span class="p">,</span> <span class="n">the</span> <span class="n">motors</span>
    <span class="o">//</span> <span class="n">are</span> <span class="n">moving</span> <span class="n">constantly</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">frame</span> <span class="kn">from</span><span class="w"> </span><span class="nn">falling.</span> <span class="n">So</span> <span class="n">essentially</span><span class="p">,</span>
    <span class="o">//</span> <span class="s2">&quot;is moving&quot;</span> <span class="ow">is</span> <span class="n">synonymous</span> <span class="k">with</span> <span class="s2">&quot;is enabled&quot;</span> <span class="k">for</span> <span class="n">these</span> <span class="n">motors</span> <span class="n">which</span>
    <span class="o">//</span> <span class="n">results</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">brake</span> <span class="n">only</span> <span class="n">applying</span> <span class="k">if</span> <span class="n">the</span> <span class="n">motors</span> <span class="n">are</span> <span class="n">disabled</span><span class="o">.</span> <span class="n">Setting</span> <span class="n">M25</span>
    <span class="o">//</span> <span class="n">to</span> <span class="n">only</span> <span class="n">enable</span> <span class="n">during</span> <span class="n">motion</span><span class="p">,</span> <span class="ow">and</span> <span class="n">M26</span> <span class="n">to</span> <span class="n">NEVER</span> <span class="n">means</span> <span class="n">that</span>
    <span class="o">//</span> <span class="n">M25</span> <span class="n">will</span> <span class="n">be</span> <span class="n">enabled</span> <span class="n">when</span> <span class="n">commanded</span> <span class="n">to</span> <span class="n">move</span> <span class="kn">from</span><span class="w"> </span><span class="nn">EPICS</span> <span class="n">but</span>
    <span class="o">//</span> <span class="k">for</span> <span class="n">M26</span> <span class="n">the</span> <span class="n">FB_MotionStage</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">modify</span> <span class="n">the</span> <span class="n">bEnable</span> <span class="n">boolean</span>
    <span class="o">//</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">state</span> <span class="n">machine</span><span class="o">.</span> <span class="n">Therefore</span><span class="p">,</span> <span class="n">we</span> <span class="n">can</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">M26</span> <span class="n">bEnable</span>
    <span class="o">//</span> <span class="n">status</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">M25</span> <span class="n">bEnable</span> <span class="n">status</span> <span class="n">after</span> <span class="n">the</span> <span class="n">M25</span> <span class="n">FB_MotionStage</span>
    <span class="o">//</span> <span class="n">runs</span><span class="o">.</span> <span class="n">But</span> <span class="n">this</span> <span class="n">also</span> <span class="n">allows</span> <span class="n">the</span> <span class="n">brake</span> <span class="n">to</span> <span class="n">still</span> <span class="n">activate</span> <span class="n">when</span> <span class="n">M26</span> <span class="ow">is</span>
    <span class="o">//</span> <span class="ow">not</span> <span class="n">moving</span><span class="o">.</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>
    <span class="o">//</span> <span class="n">M26</span> <span class="n">bEnable</span> <span class="ow">is</span> <span class="n">coupled</span> <span class="n">to</span> <span class="n">M25</span> <span class="n">bEnable</span> <span class="n">below</span><span class="o">.</span> <span class="n">Set</span> <span class="n">M26</span> <span class="n">enable</span> <span class="n">mode</span> <span class="n">to</span> <span class="n">NEVER</span>
    <span class="o">//</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">function</span> <span class="n">block</span> <span class="n">does</span> <span class="ow">not</span> <span class="k">try</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">bEnable</span> <span class="n">bit</span> <span class="n">unless</span>
    <span class="o">//</span> <span class="n">it</span> <span class="n">detects</span> <span class="n">an</span> <span class="n">error</span><span class="o">.</span> <span class="n">This</span> <span class="n">allows</span> <span class="n">the</span> <span class="n">bEnable</span> <span class="n">to</span> <span class="n">be</span> <span class="nb">set</span> <span class="n">outside</span> <span class="n">of</span>
    <span class="o">//</span> <span class="n">the</span> <span class="n">function</span> <span class="n">block</span><span class="o">.</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span> <span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">stRenishawAbsEncMaster</span><span class="o">.</span><span class="n">Ref</span> <span class="o">:=</span> <span class="mi">15370335</span><span class="p">;</span>
<span class="n">stRenishawAbsEncSlave</span><span class="o">.</span><span class="n">Ref</span> <span class="o">:=</span> <span class="mi">15347257</span><span class="p">;</span>

<span class="o">//</span> <span class="n">AutoCoupling</span>
<span class="n">fbAutoCoupling</span><span class="p">(</span>     <span class="n">nGantryTol</span>                      <span class="o">:=</span> <span class="mi">200000</span><span class="p">,</span> <span class="o">//</span> <span class="mi">50</span><span class="n">nm</span><span class="o">/</span><span class="n">count</span>
                <span class="n">Master</span>                              <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="p">,</span>
                <span class="n">MasterEnc</span>                   <span class="o">:=</span> <span class="n">stRenishawAbsEncMaster</span><span class="p">,</span>
                <span class="n">Slave</span>                               <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="p">,</span>
                <span class="n">SlaveEnc</span>                    <span class="o">:=</span> <span class="n">stRenishawAbsEncSlave</span><span class="p">,</span>
                <span class="n">bExecuteCouple</span>              <span class="o">:=</span> <span class="n">bExecuteCouple</span><span class="p">,</span>
                <span class="n">bExecuteDecouple</span>    <span class="o">:=</span> <span class="n">bExecuteDecouple</span><span class="p">,</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">I</span> <span class="n">don</span><span class="s1">&#39;t think these 3 lines do anything but I am keeping for now.</span>
<span class="o">//</span> <span class="n">The</span> <span class="n">FB_MotionStage</span> <span class="n">overwrites</span> <span class="n">the</span> <span class="n">bAllEnable</span> <span class="n">bit</span> <span class="n">internally</span><span class="o">.</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bAllEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bAllEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bAllEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bEnable</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Call</span> <span class="n">Motion</span> <span class="n">FB</span> <span class="n">instance</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">bDisableStateMachine</span> <span class="n">THEN</span>
    <span class="n">CASE</span> <span class="n">nState</span> <span class="n">OF</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bExecute</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bError</span><span class="p">)</span>  <span class="n">THEN</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">nState</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">0</span><span class="p">:</span>
        <span class="n">tonDelay</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">t</span><span class="c1">#1s);</span>
        <span class="n">IF</span> <span class="n">tonDelay</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bBrakeRelease</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">tonDelay</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">nState</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">tonDelay2</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">t</span><span class="c1">#1s);</span>
        <span class="n">IF</span> <span class="n">tonDelay2</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">tonDelay2</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
            <span class="n">nState</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">100</span><span class="p">:</span>
        <span class="n">nState</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">END_CASE</span>
<span class="n">END_IF</span>

<span class="n">fbMotionYF1</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">M26</span> <span class="n">bEnable</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">the</span> <span class="n">M25</span> <span class="n">bEnable</span> <span class="n">status</span> <span class="n">to</span> <span class="n">couple</span> <span class="n">their</span> <span class="n">enable</span> <span class="n">bits</span> <span class="n">together</span><span class="o">.</span>
<span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bEnable</span><span class="p">;</span>

<span class="n">fbMotionYF2</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="p">);</span>
<span class="n">fbMotionZF</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="p">);</span>

<span class="n">fbMeasureReferenceVelocity</span><span class="p">(</span>
    <span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="p">,</span>
    <span class="n">nMicrostepsPerStep</span><span class="o">:=</span><span class="mi">64</span><span class="p">,</span>
    <span class="n">bBusy</span><span class="o">=&gt;</span><span class="p">,</span>
    <span class="n">fMeasuredReferenceVelocity</span><span class="o">=&gt;</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-measurereferencevelocity">FB_MeasureReferenceVelocity</a></p></li>
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-chamber">
<h2>PRG_DET_CHAMBER<a class="headerlink" href="#prg-det-chamber" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_CHAMBER</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbMotionXDC</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionRyDC</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionZDC</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="n">Det</span><span class="o">.</span> <span class="n">Chmber</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bHardwareEnable</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bPowerSelf</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">nBrakeMode</span><span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bHardwareEnable</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bPowerSelf</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">nBrakeMode</span><span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bHardwareEnable</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bPowerSelf</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">nBrakeMode</span><span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">ALWAYS</span> <span class="p">;</span> <span class="o">//</span> <span class="n">This</span> <span class="n">axis</span> <span class="n">should</span> <span class="n">always</span> <span class="n">be</span> <span class="n">enables</span> <span class="n">due</span> <span class="n">to</span> <span class="n">belows</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>


<span class="n">fbMotionXDC</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="p">);</span>
<span class="n">fbMotionRyDC</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="p">);</span>
<span class="n">fbMotionZDC</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-frame">
<h2>PRG_DET_FRAME<a class="headerlink" href="#prg-det-frame" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_FRAME</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bError</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bError</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bBusy</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bMotorsBusy</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">bMotorsBusy</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:bResetError&#39;</span><span class="p">}</span>
    <span class="n">bResetError</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:EnableJackOff&#39;</span><span class="p">}</span>
    <span class="n">bEnableJackOff</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:EnableLevitation&#39;</span><span class="p">}</span>
    <span class="n">bEnableLevitation</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SA:EnableLanding&#39;</span><span class="p">}</span>
    <span class="n">bEnableLanding</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:EnableAdjustingRoll&#39;</span><span class="p">}</span>
    <span class="n">bEnableAdjustingRoll</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:EnableAdjustingPitch&#39;</span><span class="p">}</span>
    <span class="n">bEnableAdjustingPitch</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DF:EnableAdjustingHeight&#39;</span><span class="p">}</span>
    <span class="n">bEnableAdjustingHeight</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">tonWaitToStabilize</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="n">tonSV2Open</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">tonSV1Close</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="n">tonDelayTrig</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="n">iStepJackOff</span><span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingRoll</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingPitch</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingHeight</span> <span class="p">:</span> <span class="n">INT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">trigDone</span><span class="p">:</span> <span class="n">F_TRIG</span><span class="p">;</span>

    <span class="n">fDistanceX</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">2.114</span><span class="p">;</span> <span class="o">//</span> <span class="ow">in</span> <span class="n">m</span>
    <span class="n">fDistanceZ</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">2.142</span><span class="p">;</span> <span class="o">//</span> <span class="ow">in</span> <span class="n">m</span>

    <span class="n">fPositionThreshold</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.02</span><span class="p">;</span> <span class="o">//</span> <span class="n">mm</span>
    <span class="n">fPositionMaxDeviation</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">10.0</span><span class="p">;</span> <span class="o">//</span> <span class="n">mm</span>
    <span class="n">fPitchThreshold</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.02</span><span class="p">;</span> <span class="o">//</span> <span class="n">mrad</span>
    <span class="n">fRollThreshold</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.02</span><span class="p">;</span> <span class="o">//</span> <span class="n">mrad</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">fRollTarget</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fRollTarget</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:F&#39;</span><span class="p">}</span>
    <span class="n">fbYDFMotion</span><span class="p">:</span> <span class="n">FB_3AxesJack</span><span class="p">;</span>

    <span class="n">fbReset_M15</span><span class="p">:</span> <span class="n">MC_RESET</span><span class="p">;</span>
    <span class="n">fbReset_M16</span><span class="p">:</span> <span class="n">MC_RESET</span><span class="p">;</span>
    <span class="n">fbReset_M17</span><span class="p">:</span> <span class="n">MC_RESET</span><span class="p">;</span>

    <span class="n">nActiveSequenceIterationCount</span><span class="p">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">nSequenceIterationCount</span><span class="p">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">EPS</span> <span class="n">settings</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">jacks</span> <span class="kn">from</span><span class="w"> </span><span class="nn">moving</span> <span class="n">too</span> <span class="n">far</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span> <span class="n">of</span> <span class="n">each</span> <span class="n">other</span><span class="o">.</span>
    <span class="n">EPS_YDF1_Up</span>   <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_YDF1_Down</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_YDF2_Up</span>   <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_YDF2_Down</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_YDF3_Up</span>   <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_YDF3_Down</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">rJackingSpeed</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">rJackingSpeed</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.05</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">rJackingAccel</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">rJackingAccel</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.005</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">bStopAxes</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">bStopAxes</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Sensor Warning}</span>
    <span class="n">bLinearGaugeWarning</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(In)  TxPDO-Map^Sensor Error}</span>
    <span class="n">bLinearGaugeError</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkToOSO&#39;</span> <span class="o">:=</span> <span class="s1">&#39;&lt;0,1,2&gt;TINC^NC-Task 1 SAF^Axes^M15 - YDF1^Enc^Inputs^In^nState1&#39;</span><span class="p">}</span>
    <span class="n">bLinearGaugeYDF1Ready</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkToOSO&#39;</span> <span class="o">:=</span> <span class="s1">&#39;&lt;0,1,2&gt;TINC^NC-Task 1 SAF^Axes^M16 - YDF2^Enc^Inputs^In^nState1&#39;</span><span class="p">}</span>
    <span class="n">bLinearGaugeYDF2Ready</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkToOSO&#39;</span> <span class="o">:=</span> <span class="s1">&#39;&lt;0,1,2&gt;TINC^NC-Task 1 SAF^Axes^M17 - YDF3^Enc^Inputs^In^nState1&#39;</span><span class="p">}</span>
    <span class="n">bLinearGaugeYDF3Ready</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="o">//</span> <span class="n">FRAME</span> <span class="n">JACKS</span> <span class="n">EPS</span> <span class="n">RESTRICTIONS</span>
<span class="o">//</span> <span class="n">YDF1</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">upward</span> <span class="p">(</span><span class="n">positive</span><span class="o">/</span><span class="n">forward</span><span class="p">)</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_YDF1_Up</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_YDF1_Up</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;UPWARD MOVEMENT ALLOWED IF: YDF1 - YDF2 &lt; 10mm AND YDF1 - YDF3 &lt; 10mm |&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">rising</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">above</span> <span class="n">YDF2</span>
<span class="n">EPS_YDF1_Up</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fPositionMaxDeviation</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">rising</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">above</span> <span class="n">YDF3</span>
<span class="n">EPS_YDF1_Up</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fPositionMaxDeviation</span><span class="p">);</span>

<span class="o">//</span> <span class="n">YDF1</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">downward</span> <span class="p">(</span><span class="n">negative</span><span class="o">/</span><span class="n">downward</span><span class="p">)</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_YDF1_Down</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_YDF1_Down</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;DOWNWARD MOVEMENT ALLOWED IF: YDF1 - YDF2 &gt; -10mm AND YDF1 - YDF3 &gt; -10mm |&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">lowering</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">below</span> <span class="n">YDF2</span>
<span class="n">EPS_YDF1_Down</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">fPositionMaxDeviation</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">lowering</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">below</span> <span class="n">YDF3</span>
<span class="n">EPS_YDF1_Down</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">fPositionMaxDeviation</span><span class="p">);</span>

<span class="o">//</span> <span class="n">YDF2</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">upward</span> <span class="p">(</span><span class="n">positive</span><span class="o">/</span><span class="n">forward</span><span class="p">)</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_YDF2_Up</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_YDF2_Up</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;UPWARD MOVEMENT ALLOWED IF:  YDF2 - YDF1 &lt; 10mm AND YDF2 - YDF3 &lt; 10mm |&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">rising</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">above</span> <span class="n">YDF1</span>
<span class="n">EPS_YDF2_Up</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fPositionMaxDeviation</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">rising</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">above</span> <span class="n">YDF3</span>
<span class="n">EPS_YDF2_Up</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fPositionMaxDeviation</span><span class="p">);</span>

<span class="o">//</span> <span class="n">YDF2</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">downward</span> <span class="p">(</span><span class="n">negative</span><span class="o">/</span><span class="n">downward</span><span class="p">)</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_YDF2_Down</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_YDF2_Down</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;DOWNWARD MOVEMENT ALLOWED IF: YDF2 - YDF1 &gt; -10mm AND YDF2 - YDF3 &gt; -10mm |&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">lowering</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">below</span> <span class="n">YDF1</span>
<span class="n">EPS_YDF2_Down</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">fPositionMaxDeviation</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">lowering</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">below</span> <span class="n">YDF3</span>
<span class="n">EPS_YDF2_Down</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">fPositionMaxDeviation</span><span class="p">);</span>

<span class="o">//</span> <span class="n">YDF3</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">upward</span> <span class="p">(</span><span class="n">positive</span><span class="o">/</span><span class="n">forward</span><span class="p">)</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_YDF3_Up</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_YDF3_Up</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;UPWARD MOVEMENT ALLOWED IF: YDF3 - YDF2 &lt; 10mm AND YDF3 - YDF1 &lt; 10mm |&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">rising</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">above</span> <span class="n">YDF2</span>
<span class="n">EPS_YDF3_Up</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fPositionMaxDeviation</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">rising</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">above</span> <span class="n">YDF1</span>
<span class="n">EPS_YDF3_Up</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fPositionMaxDeviation</span><span class="p">);</span>

<span class="o">//</span> <span class="n">YDF3</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">downward</span> <span class="p">(</span><span class="n">negative</span><span class="o">/</span><span class="n">downward</span><span class="p">)</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_YDF3_Down</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_YDF3_Down</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;DOWNWARD MOVEMENT ALLOWED IF: YDF3 - YDF2 &gt; -10mm AND YDF3 - YDF1 &gt; -10mm |&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">lowering</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">below</span> <span class="n">YDF2</span>
<span class="n">EPS_YDF3_Down</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">fPositionMaxDeviation</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Prevent</span> <span class="n">YDF3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">lowering</span> <span class="nb">any</span> <span class="n">more</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">fPositionMaxDeviation</span> <span class="n">below</span> <span class="n">YDF1</span>
<span class="n">EPS_YDF3_Down</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">fPositionMaxDeviation</span><span class="p">);</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">bFloating</span> <span class="o">:=</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.3</span> <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.18</span> <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.15</span><span class="p">;</span>

<span class="n">bMotorsBusy</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bBusy</span><span class="p">;</span>

<span class="n">IF</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bError</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
    <span class="n">bError</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
        <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">ACT_1_JACK_OFF</span><span class="p">();</span>
<span class="n">ACT_2_Levitation</span><span class="p">();</span>
<span class="n">ACT_3_Landing</span><span class="p">();</span>
<span class="n">ACT_4_AdjustingRoll</span><span class="p">();</span>
<span class="n">ACT_5_AdjustingPitch</span><span class="p">();</span>
<span class="n">ACT_6_AdjustingHeight</span><span class="p">();</span>
<span class="n">ACT_ResetError</span><span class="p">();</span>

<span class="n">bLinearGaugeYDF1Ready</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">bLinearGaugeError</span><span class="p">;</span>
<span class="n">bLinearGaugeYDF2Ready</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">bLinearGaugeError</span><span class="p">;</span>
<span class="n">bLinearGaugeYDF3Ready</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">bLinearGaugeError</span><span class="p">;</span>

<span class="n">fbYDFMotion</span><span class="p">(</span>
    <span class="n">bMoveOk</span>                   <span class="o">:=</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">,</span>
    <span class="n">stJack1Axis</span>               <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="p">,</span>
    <span class="n">stJack2Axis</span>               <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="p">,</span>
    <span class="n">stJack3Axis</span>               <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="p">,</span>
    <span class="n">rDistanceX</span>        <span class="o">:=</span> <span class="n">fDistanceX</span><span class="p">,</span>
    <span class="n">rDistanceZ</span>        <span class="o">:=</span> <span class="n">fDistanceZ</span><span class="p">,</span>
    <span class="n">bJack3DoesPitch</span>   <span class="o">:=</span>  <span class="n">TRUE</span><span class="p">,</span>
    <span class="n">rLimitPositionMax</span> <span class="o">:=</span>  <span class="mf">21.5</span><span class="p">,</span>
    <span class="n">rLimitPositionMin</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">rLimitPitchMin</span>    <span class="o">:=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">rLimitPitchMax</span>    <span class="o">:=</span>  <span class="mi">10</span><span class="p">,</span>
    <span class="n">rLimitRollMin</span>     <span class="o">:=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">rLimitRollMax</span>     <span class="o">:=</span>  <span class="mi">10</span><span class="p">,</span>
    <span class="n">fMaxVelocity</span>      <span class="o">:=</span>  <span class="n">rJackingSpeed</span><span class="p">,</span>
    <span class="n">fHighAccel</span>        <span class="o">:=</span>  <span class="n">rJackingAccel</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">bStopAxes</span> <span class="n">THEN</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bExecute</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bStopAxes</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">ACT_1_JACK_OFF</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepJackOff</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableJackOff</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="n">check</span> <span class="k">if</span> <span class="n">we</span> <span class="n">are</span> <span class="n">already</span> <span class="n">at</span> <span class="n">position</span> <span class="ow">or</span> <span class="k">if</span> <span class="n">we</span> <span class="n">are</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">error</span> <span class="n">position</span><span class="o">.</span>
        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fPositionThreshold</span> <span class="n">AND</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fPositionThreshold</span> <span class="n">AND</span>
           <span class="nb">abs</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fPositionThreshold</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">We</span> <span class="n">dont</span> <span class="n">need</span> <span class="n">to</span> <span class="n">move</span> <span class="nb">any</span> <span class="n">more</span><span class="o">....</span>
            <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step3</span> <span class="nb">set</span> <span class="n">target</span> <span class="n">position</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqRoll</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqPitch</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

        <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">End</span>
        <span class="n">bEnableJackOff</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepJackOff</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bEnableJackOff</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepJackOff</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_2_Levitation</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bEnableLevitation</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">IF</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.15</span> <span class="n">AND</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fValue</span> <span class="o">&gt;</span> <span class="mf">0.15</span> <span class="n">THEN</span>
        <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span><span class="p">;</span>
    <span class="n">bDoneLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="o">//</span> <span class="n">SV2</span> <span class="n">will</span> <span class="nb">open</span> <span class="n">after</span> <span class="mi">3</span> <span class="n">secounds</span> <span class="kn">from</span><span class="w"> </span><span class="nn">SV1</span> <span class="n">opened</span><span class="o">...</span>
<span class="n">tonSV2Open</span><span class="p">(</span>
    <span class="n">IN</span> <span class="o">:=</span> <span class="n">bEnableLevitation</span> <span class="n">AND</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span><span class="p">,</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#3s</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">tonSV2Open</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bEnableLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLevitation</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_3_Landing</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bEnableLanding</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="p">(</span><span class="n">bBusy</span> <span class="n">OR</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bDoneLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>

<span class="n">tonSV1Close</span><span class="p">(</span>
    <span class="n">IN</span> <span class="o">:=</span> <span class="n">bEnableLanding</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span><span class="p">,</span>
    <span class="n">PT</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#3s</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">tonSV1Close</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLanding</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_4_AdjustingRoll</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepAdjustingRoll</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableAdjustingRoll</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nActiveSequenceIterationCount</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step3</span> <span class="nb">set</span> <span class="n">target</span> <span class="n">roll</span>
        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span> <span class="o">-</span> <span class="n">fRollTarget</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fRollThreshold</span> <span class="n">THEN</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqRoll</span> <span class="o">:=</span> <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rActRoll</span> <span class="o">-</span> <span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span> <span class="o">-</span> <span class="n">fRollTarget</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">Already</span> <span class="n">at</span> <span class="n">goal</span><span class="o">.</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">Done</span><span class="o">.</span> <span class="ow">and</span> <span class="n">wait</span> <span class="n">tilt</span> <span class="n">sensor</span> <span class="n">stabilization</span><span class="o">.</span>
        <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bMotorsBusy</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
        <span class="n">IF</span> <span class="n">tonWaitToStabilize</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
            <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">nActiveSequenceIterationCount</span> <span class="o">&gt;</span> <span class="n">nSequenceIterationCount</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Exceeded</span> <span class="n">maximum</span> <span class="n">allowable</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="o">.</span> <span class="n">Something</span> <span class="ow">is</span> <span class="n">wrong</span><span class="o">.</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span> <span class="o">-</span> <span class="n">fRollTarget</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fRollThreshold</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Iteration</span>
            <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nActiveSequenceIterationCount</span> <span class="o">:=</span> <span class="n">nActiveSequenceIterationCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">End</span>
            <span class="n">bEnableAdjustingRoll</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepAdjustingRoll</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bEnableAdjustingRoll</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepAdjustingRoll</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_5_AdjustingPitch</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepAdjustingPitch</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableAdjustingPitch</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nActiveSequenceIterationCount</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="nb">set</span> <span class="n">target</span> <span class="n">pitch</span>
        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fPitchThreshold</span> <span class="n">THEN</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqPitch</span> <span class="o">:=</span> <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rActPitch</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">Already</span> <span class="n">at</span> <span class="n">goal</span><span class="o">.</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">Done</span><span class="o">.</span> <span class="ow">and</span> <span class="n">wait</span> <span class="n">tilt</span> <span class="n">sensor</span> <span class="n">stabilization</span><span class="o">.</span>
        <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bMotorsBusy</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
        <span class="n">IF</span> <span class="n">tonWaitToStabilize</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
            <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">nActiveSequenceIterationCount</span> <span class="o">&gt;</span> <span class="n">nSequenceIterationCount</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Exceeded</span> <span class="n">maximum</span> <span class="n">allowable</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="o">.</span> <span class="n">Something</span> <span class="ow">is</span> <span class="n">wrong</span><span class="o">.</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fPitchThreshold</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Iteration</span>
            <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nActiveSequenceIterationCount</span> <span class="o">:=</span> <span class="n">nActiveSequenceIterationCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">End</span>
            <span class="n">bEnableAdjustingPitch</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepAdjustingPitch</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bEnableAdjustingPitch</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepAdjustingPitch</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_6_AdjustingHeight</span><span class="p">:</span>
<span class="n">CASE</span> <span class="n">iStepAdjustingHeight</span> <span class="n">OF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bEnableAdjustingHeight</span> <span class="n">AND</span> <span class="n">NOT</span><span class="p">(</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">bError</span><span class="p">)</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nActiveSequenceIterationCount</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="n">bEnableAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step2</span> <span class="nb">set</span> <span class="n">target</span> <span class="n">position</span>
        <span class="n">IF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fPositionThreshold</span> <span class="n">THEN</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rActPosition</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">Already</span> <span class="n">at</span> <span class="n">goal</span><span class="o">.</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Wait</span> <span class="n">until</span> <span class="n">Done</span><span class="o">.</span> <span class="ow">and</span> <span class="n">wait</span> <span class="n">tilt</span> <span class="n">sensor</span> <span class="n">stabilization</span><span class="o">.</span>
        <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">NOT</span> <span class="n">bMotorsBusy</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#5s);</span>
        <span class="n">IF</span> <span class="n">tonWaitToStabilize</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
            <span class="n">tonWaitToStabilize</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">nActiveSequenceIterationCount</span> <span class="o">&gt;</span> <span class="n">nSequenceIterationCount</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Exceeded</span> <span class="n">maximum</span> <span class="n">allowable</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="o">.</span> <span class="n">Something</span> <span class="ow">is</span> <span class="n">wrong</span><span class="o">.</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="nb">abs</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">fPositionThreshold</span> <span class="n">THEN</span>
            <span class="o">//</span> <span class="n">Iteration</span>
            <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">nActiveSequenceIterationCount</span> <span class="o">:=</span> <span class="n">nActiveSequenceIterationCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">ELSE</span>
            <span class="o">//</span> <span class="n">End</span>
            <span class="n">bEnableAdjustingHeight</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">iStepAdjustingHeight</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">END_IF</span><span class="p">;</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Error</span>
        <span class="n">bError</span><span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
        <span class="n">bBusy</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bEnableAdjustingHeight</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">iStepAdjustingHeight</span><span class="o">:=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_CASE</span><span class="p">;</span>
<span class="n">END_ACTION</span>

<span class="n">ACTION</span> <span class="n">ACT_ResetError</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bResetError</span> <span class="n">THEN</span>
    <span class="n">bResetError</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bError</span><span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bBusy</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnableAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bReset</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bError</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">(</span><span class="o">*</span><span class="n">Reset</span><span class="o">*</span><span class="p">)</span>
    <span class="n">fbReset_M15</span><span class="p">(</span>
        <span class="n">Execute</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span>
        <span class="n">Axis</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
        <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>
    <span class="n">fbReset_M16</span><span class="p">(</span>
        <span class="n">Execute</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span>
        <span class="n">Axis</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
        <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>
    <span class="n">fbReset_M17</span><span class="p">(</span>
        <span class="n">Execute</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span>
        <span class="n">Axis</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">Axis</span><span class="p">,</span>
        <span class="n">Done</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">Busy</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">Error</span><span class="o">=&gt;</span> <span class="p">,</span>
        <span class="n">ErrorID</span><span class="o">=&gt;</span> <span class="p">);</span>

    <span class="n">iStepJackOff</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingRoll</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingPitch</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">iStepAdjustingHeight</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPosition</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">bMoveToRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqPosition</span> <span class="o">:=</span> <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rActPosition</span><span class="p">;</span>
    <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqPitch</span> <span class="o">:=</span> <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rActPitch</span><span class="p">;</span>
    <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rReqRoll</span> <span class="o">:=</span> <span class="n">fbYDFMotion</span><span class="o">.</span><span class="n">rActRoll</span><span class="p">;</span>

    <span class="n">bStopAxes</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-3axesjack">FB_3AxesJack</a></p></li>
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-det-slit">
<h2>PRG_DET_SLIT<a class="headerlink" href="#prg-det-slit" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_DET_SLIT</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:DETSL&#39;</span><span class="p">}</span>
    <span class="n">fbSlits_Det</span><span class="p">:</span> <span class="n">FB_Slits</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bMoveOk</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bInit</span><span class="p">:</span><span class="n">BOOL</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="mi">4</span> <span class="n">jaws</span> <span class="n">slit</span>

<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">fbSlits_Det</span><span class="p">(</span>        <span class="n">i_DevName</span><span class="o">:=</span>                                     <span class="s1">&#39;DET_SLITS&#39;</span><span class="p">,</span>
                <span class="n">stTopBlade</span><span class="o">:=</span>                                <span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="p">,</span>
                <span class="n">stBottomBlade</span><span class="o">:=</span>                             <span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="p">,</span>
                <span class="n">stLeftBlade</span><span class="o">:=</span>                               <span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="p">,</span>
                <span class="n">stRightBlade</span><span class="o">:=</span>                              <span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="p">,</span>
                <span class="n">io_fbFFHWO</span><span class="o">:=</span>                                <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">,</span>
                <span class="n">fbArbiter</span><span class="o">:=</span>                                 <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
                <span class="n">bExecuteMotion</span><span class="o">:=</span>                    <span class="n">bExecuteMotion</span><span class="p">,</span>
                <span class="n">bMoveOk</span><span class="o">:=</span>                                   <span class="n">bMoveOk</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-slits">FB_Slits</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-diffractometer">
<h2>PRG_Diffractometer<a class="headerlink" href="#prg-diffractometer" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Diffractometer</span>
<span class="n">VAR</span>
    <span class="n">fb_Diff_Theta</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_2Theta</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_2ThetaY</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Chi</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Phi</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_Diff_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span><span class="n">EPS</span>
    <span class="n">EPS_Diff_Chi_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">EPS_Diff_Phi_Forward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">EPS_Diff_Theta_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Theta_Forward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">EPS_Diff_X_Forward</span>  <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_X_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Y_Forward</span>  <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Y_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Z_Forward</span>  <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_Diff_Z_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">EPS_Diff_2Theta_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">EPS_Diff_2ThetaY</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="o">//</span><span class="n">Encoders</span> <span class="k">for</span> <span class="n">rotary</span> <span class="n">stages</span>
    <span class="n">fbSetPosition</span><span class="p">:</span> <span class="n">MC_SetPosition</span><span class="p">;</span>
    <span class="n">fb2ThetaAutoCoupling</span><span class="p">:</span> <span class="n">FB_GantryAutoCoupling</span><span class="p">;</span>
    <span class="n">couple</span> <span class="p">:</span> <span class="n">MC_GEARIN</span><span class="p">;</span>
    <span class="n">decouple</span> <span class="p">:</span> <span class="n">MC_GEAROUT</span><span class="p">;</span>
    <span class="n">bExecuteCouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bExecuteDecouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">n2Theta</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span><span class="n">ULINT</span><span class="p">;</span>
    <span class="n">r2Theta</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">temp</span><span class="p">:</span><span class="n">ULINT</span><span class="p">;</span>
    <span class="n">rtemp</span><span class="p">:</span><span class="n">LREAL</span><span class="p">;</span>
    <span class="n">GantryDiff</span><span class="p">:</span><span class="n">REAL</span><span class="p">;</span>

    <span class="n">fb_Diff_2Theta_Encoder</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>

    <span class="n">eDiffXStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffXStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiffXPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiffXStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">eDiffYStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffYStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiffYPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiffYStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">eDiffZStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffZStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiffZPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiffZStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">eDiff2ThetaYStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiff2ThetaYStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiff2ThetaYPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiff2ThetaYStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">eDiffPhiStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffPhiStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiffPhiPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiffPhiStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">eDiffChiStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffChiStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiffChiPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiffChiStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">eDiff2ThetaStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiff2ThetaStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiff2ThetaPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiff2ThetaStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">eDiffThetaStateGet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">eDiffThetaStateSet</span><span class="p">:</span> <span class="n">E_DiffState</span><span class="p">;</span>
    <span class="n">astDiffThetaPosState</span><span class="p">:</span> <span class="n">ARRAY</span><span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">OF</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbDiffThetaStage1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>

    <span class="n">fbStateSetup</span><span class="p">:</span> <span class="n">FB_StateSetupHelper</span><span class="p">;</span>
    <span class="n">stDefault</span><span class="p">:</span> <span class="n">ST_PositionState</span> <span class="o">:=</span> <span class="p">(</span>
        <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">bMoveOk</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span>
        <span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span>
    <span class="p">);</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">stDefault</span><span class="p">,</span> <span class="n">bSetDefault</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">);</span>

    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffXPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffYPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffZPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiff2ThetaYPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffPhiPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffChiPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiff2ThetaPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffThetaPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">TRANSFER_ARM_INTERFACE</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;TRANSFER_ARM_INTERFACE&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>


    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffXPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffYPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffZPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiff2ThetaYPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffPhiPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffChiPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiff2ThetaPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
    <span class="n">fbStateSetup</span><span class="p">(</span><span class="n">stPositionState</span><span class="o">:=</span><span class="n">astDiffThetaPosState</span><span class="p">[</span><span class="n">E_DiffState</span><span class="o">.</span><span class="n">NOMINAL_POSITION</span><span class="p">],</span> <span class="n">sName</span><span class="o">:=</span><span class="s1">&#39;NOMINAL_POSITION&#39;</span><span class="p">,</span>
        <span class="n">fPosition</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="p">);</span>
<span class="n">END_IF</span>

<span class="o">//</span><span class="n">EPS</span>

<span class="o">//</span> <span class="n">All</span> <span class="n">bits</span> <span class="n">must</span> <span class="n">be</span> <span class="n">TRUE</span> <span class="n">to</span> <span class="n">enable</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">direction</span> <span class="p">(</span><span class="n">backward</span> <span class="ow">or</span> <span class="n">forward</span><span class="p">)</span>
<span class="o">//</span> <span class="n">The</span> <span class="n">bits</span> <span class="n">are</span> <span class="n">populated</span> <span class="n">right</span> <span class="n">to</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">typhos</span> <span class="n">screen</span><span class="o">.</span> <span class="n">So</span> <span class="n">Descriptions</span> <span class="n">highest</span> <span class="n">bit</span> <span class="n">number</span> <span class="ow">is</span> <span class="n">at</span> <span class="n">the</span> <span class="n">beginning</span> <span class="n">of</span> <span class="n">the</span> <span class="n">description</span><span class="o">.</span>
<span class="o">//</span> <span class="n">The</span> <span class="n">eps</span> <span class="n">IN_OUT</span> <span class="n">variable</span> <span class="n">must</span> <span class="n">be</span> <span class="n">assigned</span> <span class="n">before</span> <span class="n">using</span> <span class="n">the</span> <span class="n">FB_EPS</span> <span class="ow">in</span> <span class="nb">any</span> <span class="n">way</span><span class="o">.</span>

<span class="o">//</span> <span class="n">DIFFRACTOMETER</span> <span class="n">THETA</span> <span class="n">ANGLE</span> <span class="n">RESTRICTIONS</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_Theta_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Theta_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Theta_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Theta</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">5</span> <span class="n">degrees</span> <span class="k">if</span> <span class="n">the</span> <span class="n">Diffractometer</span> <span class="n">Chi</span> <span class="ow">is</span> <span class="n">less</span> <span class="n">than</span> <span class="o">-</span><span class="mi">5</span> <span class="n">degrees</span>
<span class="n">EPS_Diff_Theta_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">F_CheckAxisGEQ</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="n">OR</span> <span class="n">F_CheckAxisGEQ</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">));</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Theta</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">10</span> <span class="n">degrees</span> <span class="k">if</span> <span class="n">the</span> <span class="n">MID</span> <span class="n">IR</span> <span class="p">(</span><span class="n">LAS</span> <span class="n">VIS</span><span class="p">)</span> <span class="ow">is</span> <span class="n">IN</span><span class="p">,</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">defined</span> <span class="k">as</span> <span class="n">a</span> <span class="n">position</span> <span class="n">of</span> <span class="mi">90</span> <span class="o">+/-</span> <span class="mf">1.</span>
<span class="n">EPS_Diff_Theta_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">F_CheckAxisGRT</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="n">OR</span> <span class="n">F_Limit</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="n">false</span><span class="p">));</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Theta</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">10</span> <span class="n">degrees</span> <span class="k">if</span> <span class="n">the</span> <span class="n">Diffractometer</span> <span class="n">phi</span> <span class="ow">is</span> <span class="n">at</span> <span class="mi">90</span> <span class="o">+/-</span> <span class="mf">1.</span>
<span class="n">EPS_Diff_Theta_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">F_CheckAxisGRT</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="n">OR</span> <span class="n">F_Limit</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="n">false</span><span class="p">));</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_Theta_Forward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Theta_Forward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Theta_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M49</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Theta</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">more</span> <span class="n">than</span> <span class="n">Diffractometer</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">plus</span> <span class="mi">21</span> <span class="n">degrees</span>
<span class="n">EPS_Diff_Theta_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;</span> <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="o">+</span><span class="mi">21</span><span class="p">);</span>

<span class="o">//</span> <span class="n">DIFFRACTOMETER</span> <span class="n">CHI</span> <span class="n">ANGLE</span> <span class="n">RESTRICTIONS</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_Chi_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Chi_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Chi</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">less</span> <span class="n">than</span> <span class="o">-</span><span class="mi">5</span> <span class="n">degrees</span> <span class="k">if</span> <span class="n">the</span> <span class="n">Diffractometer</span> <span class="n">Theta</span> <span class="ow">is</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">5</span> <span class="n">degrees</span>
<span class="n">EPS_Diff_Chi_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">F_CheckAxisGEQ</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="n">OR</span> <span class="n">F_CheckAxisGEQ</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span>

<span class="o">//</span> <span class="n">DIFFRACTOMETER</span> <span class="n">PHI</span> <span class="n">ANGLE</span> <span class="n">RESTRICTIONS</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_Phi_Forward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Phi_Forward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Phi</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">45</span> <span class="n">degrees</span> <span class="n">when</span> <span class="n">the</span> <span class="n">MID</span> <span class="n">IR</span> <span class="p">(</span><span class="n">LAS</span> <span class="n">VIS</span><span class="p">)</span> <span class="ow">is</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">45</span> <span class="n">degrees</span>
<span class="n">EPS_Diff_Phi_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;=</span> <span class="mi">45</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Phi</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">45</span> <span class="n">degrees</span> <span class="n">when</span> <span class="n">theta</span> <span class="ow">is</span> <span class="n">within</span> <span class="mi">1</span> <span class="n">degree</span> <span class="n">of</span> <span class="mi">0</span> <span class="n">degrees</span><span class="o">.</span>
<span class="n">EPS_Diff_Phi_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;=</span> <span class="mi">45</span> <span class="n">OR</span> <span class="n">F_Limit</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">false</span><span class="p">));</span>

<span class="o">//</span> <span class="n">DIFFRACTOMETER</span> <span class="n">Z</span> <span class="n">POSITION</span> <span class="n">RESTRICTIONS</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_Z_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Z_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Z_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoZNeutralPositionAtDiffZ0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="n">Z</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">less</span> <span class="n">than</span> <span class="mi">5</span><span class="n">mm</span> <span class="n">when</span> <span class="n">the</span> <span class="n">diagonal</span> <span class="n">paddle</span> <span class="n">horizontal</span> <span class="p">(</span><span class="n">LAS_D_H</span><span class="p">)</span> <span class="n">position</span> <span class="ow">is</span> <span class="n">greater</span> <span class="n">than</span> <span class="mi">50</span> <span class="n">mm</span><span class="o">.</span>
<span class="n">EPS_Diff_Z_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;=</span> <span class="mi">50</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span>
<span class="n">EPS_Diff_Z_Forward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Z_Forward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Z_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M48</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoZNeutralPositionAtDiffZ0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Diff</span> <span class="n">X</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_X_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_X_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_X_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span>
<span class="n">EPS_Diff_X_Forward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_X_Forward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_X_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M46</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Diff</span> <span class="n">Y</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_Y_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Y_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Y_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">F_TargetCryoYPosition</span><span class="p">(</span>
        <span class="n">fNeutralPosition</span> <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fBraidDiameter</span>   <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fBraidDiameter</span><span class="p">,</span>
        <span class="n">fPhiAngleDeg</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span>
<span class="n">EPS_Diff_Y_Forward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_Y_Forward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="n">EPS_Diff_Y_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">bValue</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M47</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">-</span> <span class="n">F_TargetCryoYPosition</span><span class="p">(</span>
        <span class="n">fNeutralPosition</span> <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fCryoYNeutralPositionAtDiffY0</span> <span class="o">+</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">,</span>
        <span class="n">fBraidDiameter</span>   <span class="o">:=</span> <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">fBraidDiameter</span><span class="p">,</span>
        <span class="n">fPhiAngleDeg</span>     <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">DIFFRACTOMETER</span> <span class="mi">2</span><span class="o">-</span><span class="n">THETA</span> <span class="n">ANGLE</span> <span class="n">RESTRICTIONS</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_Diff_2Theta_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_Diff_2Theta_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Diffractometer</span> <span class="mi">2</span> <span class="n">Theta</span> <span class="n">cannot</span> <span class="n">go</span> <span class="n">less</span> <span class="n">than</span> <span class="n">the</span> <span class="n">diffractometer</span> <span class="n">theta</span> <span class="n">angle</span> <span class="n">minus</span> <span class="mi">21</span> <span class="n">degrees</span><span class="o">.</span>
<span class="n">EPS_Diff_2Theta_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="o">.</span><span class="n">Axis</span><span class="o">.</span><span class="n">NcToPlc</span><span class="o">.</span><span class="n">ActPos</span> <span class="o">&gt;</span> <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="mi">21</span><span class="p">);</span>

<span class="n">fb_Diff_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="p">);</span>
<span class="n">fb_Diff_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="p">);</span>
<span class="n">fb_Diff_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="p">);</span>
<span class="n">fb_Diff_2ThetaY</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="p">);</span>
<span class="n">fb_Diff_Phi</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="p">);</span>
<span class="n">fb_Diff_Chi</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="p">);</span>
<span class="n">fb_Diff_Theta</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">);</span>
<span class="n">fb_Diff_2Theta</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#e-diffstate">E_DiffState</a></p></li>
<li><p><a class="reference internal" href="#f-checkaxisgeq">F_CheckAxisGEQ</a></p></li>
<li><p><a class="reference internal" href="#f-checkaxisgrt">F_CheckAxisGRT</a></p></li>
<li><p><a class="reference internal" href="#f-limit">F_Limit</a></p></li>
<li><p><a class="reference internal" href="#f-targetcryoyposition">F_TargetCryoYPosition</a></p></li>
<li><p><a class="reference internal" href="#gvl-var">GVL_VAR</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-las">
<h2>PRG_LAS<a class="headerlink" href="#prg-las" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_LAS</span>
<span class="n">VAR</span>
    <span class="n">fb_LAS_VIS</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_LAS_D_H</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_LAS_D_V</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span><span class="n">LAS_VIS</span> <span class="n">BEAM</span> <span class="n">OK</span><span class="o">/</span><span class="n">NOK</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">LAS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">VIS</span><span class="p">:</span><span class="n">STATES</span><span class="p">:</span><span class="n">SET</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">eLAS_VIS_StateSet</span><span class="p">:</span> <span class="n">ENUM_LAS_VIS_States</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
      <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">LAS</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">VIS</span><span class="p">:</span><span class="n">STATES</span><span class="p">:</span><span class="n">GET</span>
      <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">eLAS_VIS_StateGet</span><span class="p">:</span> <span class="n">ENUM_LAS_VIS_States</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:LAS:MMS:VIS&#39;</span><span class="p">}</span>
    <span class="n">fbLAS_VIS_PositionState1D</span> <span class="p">:</span> <span class="n">FB_PositionState1D</span><span class="p">;</span>
    <span class="n">astLAS_VIS_PositionState</span> <span class="p">:</span> <span class="n">ARRAY</span> <span class="p">[</span><span class="mf">1.</span><span class="o">.</span><span class="n">GeneralConstants</span><span class="o">.</span><span class="n">MAX_STATES</span><span class="p">]</span> <span class="n">of</span> <span class="n">ST_PositionState</span><span class="p">;</span>
    <span class="n">fbLAS_VIS_StateSetupHelper</span> <span class="p">:</span> <span class="n">FB_StateSetupHelper</span><span class="p">;</span>
    <span class="n">fbLAS_VIS_HardwareFFOutput</span> <span class="p">:</span> <span class="n">FB_HardwareFFOutput</span><span class="p">;</span>

    <span class="o">//</span><span class="n">EPS</span>
    <span class="n">stLAS_VIS</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">fbLAS_VIS_EPS</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">stLAS_D_H</span> <span class="p">:</span> <span class="n">DUT_EPS</span><span class="p">;</span>
    <span class="n">fbLAS_D_H_EPS</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span><span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Initialize</span> <span class="n">the</span> <span class="n">M36</span> <span class="n">LAS</span> <span class="n">VIS</span> <span class="n">Axis</span> <span class="n">States</span>
    <span class="o">//</span> <span class="n">Beam</span> <span class="n">OK</span> <span class="k">if</span> <span class="n">one</span> <span class="n">of</span> <span class="n">these</span> <span class="n">two</span> <span class="n">states</span> <span class="ow">is</span> <span class="n">active</span><span class="o">.</span> <span class="n">Otherwise</span><span class="p">,</span> <span class="n">beam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">okay</span><span class="o">.</span>
    <span class="n">fbLAS_VIS_StateSetupHelper</span><span class="p">(</span><span class="n">stPositionState</span> <span class="o">:=</span> <span class="n">astLAS_VIS_PositionState</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Position7to24mm&#39;</span><span class="p">,</span> <span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">15.5</span><span class="p">,</span> <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">8.5</span><span class="p">);</span>
    <span class="n">fbLAS_VIS_StateSetupHelper</span><span class="p">(</span><span class="n">stPositionState</span> <span class="o">:=</span> <span class="n">astLAS_VIS_PositionState</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sName</span> <span class="o">:=</span> <span class="s1">&#39;Position62to77mm&#39;</span><span class="p">,</span> <span class="n">bValid</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">fPosition</span> <span class="o">:=</span> <span class="mf">69.5</span><span class="p">,</span> <span class="n">fDelta</span> <span class="o">:=</span> <span class="mf">7.5</span><span class="p">);</span>

<span class="n">END_IF</span>
<span class="o">//</span><span class="n">EPS</span>
<span class="p">(</span><span class="o">*</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;Less10mm;SampleZ;PHI&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span><span class="n">Zero</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">retracted</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">10</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Z</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=-</span><span class="mi">20</span><span class="p">);</span>
<span class="n">fbLAS_D_H_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">10</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">);</span>
<span class="n">fbLAS_D_H_EPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">stLAS_D_H</span><span class="p">);</span>
<span class="n">fb_LAS_D_H</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSForwardEnable</span> <span class="o">:=</span> <span class="n">stLAS_D_H</span><span class="p">;</span> <span class="o">//</span> <span class="n">Update</span> <span class="n">Motion</span> <span class="n">stage</span> <span class="n">structure</span><span class="o">.</span>

<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;IN90mm;PHIat90;Theta&lt;10&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRITION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span><span class="n">Zero</span> <span class="ow">is</span> <span class="n">fully</span> <span class="n">retracted</span>
<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">);</span>
<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">5</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Phi</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;&gt;</span><span class="mi">90</span><span class="p">);</span>
<span class="n">fbLAS_VIS_EPS</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&lt;=</span><span class="mi">5</span> <span class="n">OR</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">fb_Diff_Theta</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">fPosition</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">);</span>
<span class="n">fbLAS_VIS_EPS</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">fbLAS_VIS_EPS</span><span class="p">);</span>
<span class="o">//</span><span class="n">fb_LAS_VIS</span><span class="o">.</span><span class="n">stMotionStage</span><span class="o">.</span><span class="n">stEPSForwardEnable</span> <span class="o">:=</span> <span class="n">fbLAS_VIS_EPS</span><span class="p">;</span>
<span class="o">*</span><span class="p">)</span>

<span class="n">fbLAS_VIS_PositionState1D</span><span class="p">(</span>
    <span class="n">stMotionStage</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="p">,</span>
    <span class="n">astPositionState</span> <span class="o">:=</span> <span class="n">astLAS_VIS_PositionState</span><span class="p">,</span>
    <span class="n">eEnumSet</span> <span class="o">:=</span> <span class="n">eLAS_VIS_StateSet</span><span class="p">,</span>
    <span class="n">eEnumGet</span> <span class="o">:=</span> <span class="n">eLAS_VIS_StateGet</span><span class="p">,</span>
    <span class="n">bEnable</span> <span class="o">:=</span> <span class="n">TRUE</span>
<span class="p">);</span>

<span class="n">IF</span> <span class="n">eLAS_VIS_StateGet</span> <span class="o">=</span> <span class="n">ENUM_LAS_VIS_States</span><span class="o">.</span><span class="n">Position7to24mm</span> <span class="n">OR</span> <span class="n">eLAS_VIS_StateGet</span> <span class="o">=</span> <span class="n">ENUM_LAS_VIS_States</span><span class="o">.</span><span class="n">Position62to77mm</span> <span class="n">THEN</span>
    <span class="o">//</span> <span class="n">BEAM</span> <span class="n">OKAY</span>

<span class="n">ELSE</span>
    <span class="o">//</span> <span class="n">BEAM</span> <span class="n">NOT</span> <span class="n">OKAY</span>
<span class="n">END_IF</span>

<span class="n">fb_LAS_VIS</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M36</span><span class="p">);</span>
<span class="n">fb_LAS_D_H</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M37</span><span class="p">);</span>
<span class="n">fb_LAS_D_V</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M38</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#enum-las-vis-states">ENUM_LAS_VIS_States</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-diffractometer">PRG_Diffractometer</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt">
<h2>PRG_OPT<a class="headerlink" href="#prg-opt" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_OPT</span>
<span class="n">VAR</span>
    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">fbMotionRxG</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionXG</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fbMotionRzPM</span><span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>

    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span><span class="p">;</span>


<span class="n">fbMotionRxG</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="p">);</span>
<span class="n">fbMotionXG</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="p">);</span>
<span class="n">fbMotionRzPM</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt-slits">
<h2>PRG_OPT_SLITS<a class="headerlink" href="#prg-opt-slits" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_OPT_SLITS</span>
<span class="n">VAR</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPTSL&#39;</span><span class="p">}</span>
    <span class="n">fbSlits_Opt</span><span class="p">:</span> <span class="n">FB_Slits</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bMoveOk</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bInit</span><span class="p">:</span><span class="n">BOOl</span><span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="o">//</span> <span class="mi">4</span> <span class="n">jaws</span> <span class="n">slit</span>



<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>


    <span class="o">//</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>



<span class="n">fbSlits_Opt</span><span class="p">(</span>        <span class="n">i_DevName</span><span class="o">:=</span>                                     <span class="s1">&#39;OPT_SLITS&#39;</span><span class="p">,</span>
                <span class="n">stTopBlade</span><span class="o">:=</span>                                <span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="p">,</span>
                <span class="n">stBottomBlade</span><span class="o">:=</span>                             <span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="p">,</span>
                <span class="n">stLeftBlade</span><span class="o">:=</span>                               <span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="p">,</span>
                <span class="n">stRightBlade</span><span class="o">:=</span>                              <span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="p">,</span>
                <span class="n">io_fbFFHWO</span><span class="o">:=</span>                                <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbFastFaultOutput1</span><span class="p">,</span>
                <span class="n">fbArbiter</span><span class="o">:=</span>                                 <span class="n">GVL_PMPS</span><span class="o">.</span><span class="n">fbArbiter</span><span class="p">,</span>
                <span class="n">bExecuteMotion</span><span class="o">:=</span>                    <span class="n">bExecuteMotion</span><span class="p">,</span>
                <span class="n">bMoveOk</span><span class="o">:=</span>                                   <span class="n">bMoveOk</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-slits">FB_Slits</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt-xpm">
<h2>PRG_OPT_XPM<a class="headerlink" href="#prg-opt-xpm" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_OPT_XPM
VAR
    bInit: BOOL :=TRUE;
    {attribute &#39;pytmc&#39; := &#39;pv: QRIX:PM&#39;}
    fb2AxesXPM: FB_2AxesTrans;
    bExecuteMotionXPM: BOOL :=TRUE;
    bMoveOkXPM: BOOL :=TRUE;
END_VAR

VAR CONSTANT
    rDistance       :REAL   :=      0.4;
END_VAR
IF bINIT THEN

    Main.M12.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M12.bHardwareEnable := TRUE;
    Main.M12.bPowerSelf := TRUE;
    Main.M12.fVelocity := 0.1;

    Main.M13.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M13.bHardwareEnable := TRUE;
    Main.M13.bPowerSelf := TRUE;
    Main.M13.fVelocity := 0.1;

    Main.M12.nEnableMode := ENUM_StageEnableMode.DURING_MOTION ;
    Main.M13.nEnableMode := ENUM_StageEnableMode.DURING_MOTION ;

    bINIT := FALSE;
END_IF;

fb2AxesXPM( i_DevName               :=      &#39;OPT_XPM&#39;,
            stFirstAxis             :=      Main.M12,
            stSecondAxis    :=      Main.M13,
            bExecuteMotion  :=      bExecuteMotionXPM,
            io_fbFFHWO              :=      GVL_PMPS.fbFastFaultOutput1,
            fbArbiter               :=      GVL_PMPS.fbArbiter,
            rDistance               :=      rDistance,//actually 0.48m?? //0.4, // 0.4m
            bMoveOk                 := bMoveOkXPM
);

END_PROGRAM
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-2axestrans">FB_2AxesTrans</a></p></li>
<li><p><a class="reference internal" href="#gvl-pmps">GVL_PMPS</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-opt-yg">
<h2>PRG_OPT_YG<a class="headerlink" href="#prg-opt-yg" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_OPT_YG</span>
<span class="n">VAR</span>
    <span class="n">bDebug</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">bExecuteMotion</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bMoveOk</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:OPT&#39;</span><span class="p">}</span>
    <span class="n">fbYGMotion</span><span class="p">:</span> <span class="n">FB_3AxesJack</span><span class="p">;</span>

    <span class="n">bInit</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>

    <span class="n">tonDelayUpdate</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span> <span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fbYGMotion</span><span class="p">(</span>
    <span class="n">bMoveOk</span>                 <span class="o">:=</span> <span class="n">bMoveOk</span><span class="p">,</span>
    <span class="n">stJack1Axis</span>             <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="p">,</span>
    <span class="n">stJack2Axis</span>             <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="p">,</span>
    <span class="n">stJack3Axis</span>             <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="p">,</span>
    <span class="n">rDistanceX</span>        <span class="o">:=</span> <span class="mf">0.24</span><span class="p">,</span>
    <span class="n">rDistanceZ</span>        <span class="o">:=</span> <span class="mf">0.88</span><span class="p">,</span>
    <span class="n">bJack3DoesPitch</span>   <span class="o">:=</span>  <span class="n">FALSE</span><span class="p">,</span>
    <span class="n">rLimitPositionMax</span> <span class="o">:=</span>  <span class="mf">8.0</span><span class="p">,</span>
    <span class="n">rLimitPositionMin</span> <span class="o">:=</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">rLimitPitchMin</span>    <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span>
    <span class="n">rLimitPitchMax</span>    <span class="o">:=</span>  <span class="mi">18</span><span class="p">,</span>
    <span class="n">rLimitRollMin</span>     <span class="o">:=</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span>
    <span class="n">rLimitRollMax</span>     <span class="o">:=</span>  <span class="mi">18</span><span class="p">,</span>
    <span class="n">fMaxVelocity</span>      <span class="o">:=</span>  <span class="mf">0.1</span><span class="p">,</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-3axesjack">FB_3AxesJack</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-questar">
<h2>PRG_Questar<a class="headerlink" href="#prg-questar" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PROGRAM PRG_Questar
VAR
    fb_Ques_01 : FB_MotionStage;
    fb_Ques_02: FB_MotionStage;
    bInit : BOOl := TRUE;
END_VAR
IF ( bInit) THEN
    bInit := FALSE;
    Main.M17.bHardwareEnable := TRUE;
    Main.M17.bPowerSelf := TRUE;
    Main.M17.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M17.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;
    Main.M17.fVelocity := 0.1;

    Main.M18.bHardwareEnable := TRUE;
    Main.M18.bPowerSelf := TRUE;
    Main.M18.nBrakeMode := ENUM_StageBrakeMode.NO_BRAKE;
    Main.M18.nEnableMode := ENUM_StageEnableMode.DURING_MOTION;
    Main.M18.fVelocity := 0.1;


END_IF
//EPS??


fb_Ques_01(stMotionStage:=Main.M17);
fb_Ques_02(stMotionStage:=Main.M18);

END_PROGRAM
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-rotdet">
<h2>PRG_RotDet<a class="headerlink" href="#prg-rotdet" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_RotDet</span>
<span class="n">VAR</span>
    <span class="n">fb_Rot_Det</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="p">(</span> <span class="n">bInit</span><span class="p">)</span> <span class="n">THEN</span>
   <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
   <span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">fb_Rot_Det</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M45</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sds">
<h2>PRG_SDS<a class="headerlink" href="#prg-sds" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SDS</span>
<span class="n">VAR</span>
    <span class="n">fb_SDS_ROT_V</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_SDS_X</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_SDS_Y</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_SDS_Z</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_SDS_ROT_H</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">fb_SDS_H</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">EPS_SDS_H_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_SDS_H_Forward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">fSDSYEPSOverride</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">EPS_SDS_Y_Backward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>
    <span class="n">EPS_SDS_Y_Forward</span> <span class="p">:</span> <span class="n">FB_EPS</span><span class="p">;</span>

    <span class="n">fMaxSampleDeliveryArmPositionWithValveClosed</span> <span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mi">50</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SDS</span><span class="p">:</span><span class="n">NP</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Structure</span> <span class="n">defining</span> <span class="n">qrixs</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span> <span class="n">non</span><span class="o">-</span><span class="n">persistent</span> <span class="n">data</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">stSDS</span><span class="p">:</span> <span class="n">ST_SDS</span><span class="p">;</span>
    <span class="n">fbSDS</span><span class="p">:</span> <span class="n">FB_SDS</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SDS</span><span class="p">:</span><span class="n">Y</span><span class="p">:</span><span class="n">EPS</span><span class="p">:</span><span class="n">BACK</span><span class="p">:</span><span class="n">OVRD</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Allow</span> <span class="n">SDS</span> <span class="n">Y</span> <span class="n">backward</span> <span class="n">limit</span> <span class="n">to</span> <span class="n">be</span> <span class="n">user</span> <span class="n">defined</span> <span class="k">for</span> <span class="mi">1</span><span class="n">h</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">bEPS_SDS_Y_Backward_Override</span> <span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="n">fbEPS_SDS_Y_Backward_Override_Start</span> <span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tEPS_SDS_Y_Backward_Override_Time</span> <span class="p">:</span> <span class="n">TIME</span> <span class="o">:=</span> <span class="n">T</span><span class="c1">#1h;</span>
    <span class="n">fbEPS_SDS_Y_EPS_BACK_OVRD_TIMER</span> <span class="p">:</span> <span class="n">TON</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SDS</span><span class="p">:</span><span class="n">Y</span><span class="p">:</span><span class="n">EPS</span><span class="p">:</span><span class="n">BACK</span><span class="p">:</span><span class="n">OVRD_COUNTDOWN</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Time</span> <span class="n">Remaining</span> <span class="n">Untill</span> <span class="n">Override</span> <span class="n">resets</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">tSDS_Y_EPS_BACK_OVRD_TimerCountDown</span> <span class="p">:</span> <span class="n">STRING</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">T</span><span class="c1">#0s);</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SDS</span><span class="p">:</span><span class="n">Y</span><span class="p">:</span><span class="n">EPS</span><span class="p">:</span><span class="n">BACK</span><span class="p">:</span><span class="n">USR</span><span class="p">:</span><span class="n">OVRD_LIM</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Allow</span> <span class="n">SDS</span> <span class="n">Y</span> <span class="n">backward</span> <span class="n">limit</span> <span class="n">to</span> <span class="n">be</span> <span class="n">user</span> <span class="n">defined</span> <span class="k">for</span> <span class="mi">1</span><span class="n">h</span><span class="o">.</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
        <span class="n">autosave_pass1</span><span class="p">:</span> <span class="n">VAL</span> <span class="n">DESC</span>
    <span class="s1">&#39;}</span>
    <span class="n">fSDS_Y_NEGATIVE_LIM_USR</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SDS</span><span class="p">:</span><span class="n">Y</span><span class="p">:</span><span class="n">EPS</span><span class="p">:</span><span class="n">BACK</span><span class="p">:</span><span class="n">OVRD_LIM</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Readback</span> <span class="kn">from</span><span class="w"> </span><span class="nn">Actual</span> <span class="n">Soft</span> <span class="n">Limit</span><span class="o">.</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">fSDS_Y_NEGATIVE_LIM</span> <span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fSDS_Y_NEGATIVE_LIM_DEFAULT</span>  <span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">110</span><span class="p">;</span>


<span class="n">END_VAR</span>
<span class="n">VAR</span> <span class="n">PERSISTENT</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SDS</span><span class="p">:</span><span class="n">P</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">DESC</span> <span class="n">Structure</span> <span class="n">defining</span> <span class="n">qrixs</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span> <span class="n">persistent</span> <span class="n">data</span><span class="o">.</span>
    <span class="s1">&#39;}</span>
    <span class="n">stSDSPersistent</span><span class="p">:</span> <span class="n">ST_SDSPersistent</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">HOME_VIA_LOW</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bLimitForwardEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">LOW_LIMIT</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="o">.</span><span class="n">fHomePosition</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">DURING_MOTION</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">nHomingMode</span> <span class="o">:=</span> <span class="n">ENUM_EpicsHomeCmd</span><span class="o">.</span><span class="n">HOME_VIA_LOW</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">fHomePosition</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span><span class="o">//</span><span class="mf">1.176</span><span class="p">;</span> <span class="n">distance</span> <span class="kn">from</span><span class="w"> </span><span class="nn">home</span> <span class="n">switch</span> <span class="n">trigger</span> <span class="n">to</span> <span class="n">lower</span> <span class="n">limit</span> <span class="n">trigger</span>

    <span class="n">fSDSYEPSOverride</span> <span class="o">:=</span> <span class="o">-</span><span class="mi">40</span><span class="p">;</span>
    <span class="n">fSDS_Y_NEGATIVE_LIM</span> <span class="o">:=</span> <span class="n">fSDS_Y_NEGATIVE_LIM_DEFAULT</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_MOT_SDS_MMS_H_RAW_ENC_CNTS</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">nRawEncoderUINT</span><span class="p">;</span>
<span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_MOT_SDS_MMS_H_FORWARD_EN</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">bLimitForwardEnable</span><span class="p">;</span>
<span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_MOT_SDS_MMS_H_BACKWARD_EN</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">bLimitBackwardEnable</span><span class="p">;</span>

<span class="o">//</span><span class="n">EPS</span>

<span class="o">//</span> <span class="n">Sample</span> <span class="n">Delivery</span> <span class="n">System</span>
<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_SDS_H_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_SDS_H_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION ALLOWED UNTIL LIMIT&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_SDS_H_Forward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_SDS_H_Forward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POS MOTION IF VGC_03 closed: (cmd&lt;50mm | pos&lt;50mm | Homing Valid | SDS Y&lt;-45mm)&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>
<span class="o">//</span> <span class="n">Sample</span> <span class="n">Delivery</span> <span class="n">Arm</span> <span class="n">can</span> <span class="n">Extend</span> <span class="k">if</span> <span class="n">the</span> <span class="n">VGC</span> <span class="n">valve</span> <span class="ow">is</span> <span class="nb">open</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">closed</span><span class="p">,</span> <span class="ow">and</span> <span class="n">it</span> <span class="n">has</span> <span class="n">been</span> <span class="n">homed</span><span class="o">.</span>
<span class="n">EPS_SDS_H_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">NOT</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">tonForwardHomingLimit</span><span class="o">.</span><span class="n">Q</span><span class="p">);</span>
<span class="n">EPS_SDS_H_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="p">(</span><span class="n">NOT</span> <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_CLOSED_LIMIT_SWITCH</span> <span class="n">AND</span>
    <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_OPEN_LIMIT_SWITCH</span><span class="p">)</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">&lt;</span> <span class="n">fMaxSampleDeliveryArmPositionWithValveClosed</span><span class="p">);</span>
<span class="n">EPS_SDS_H_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="p">(</span><span class="n">NOT</span> <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_CLOSED_LIMIT_SWITCH</span> <span class="n">AND</span>
    <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_OPEN_LIMIT_SWITCH</span><span class="p">)</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fMaxSampleDeliveryArmPositionWithValveClosed</span><span class="p">);</span>
<span class="n">EPS_SDS_H_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="p">(</span><span class="n">NOT</span> <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_CLOSED_LIMIT_SWITCH</span> <span class="n">AND</span>
    <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_OPEN_LIMIT_SWITCH</span><span class="p">)</span> <span class="n">OR</span> <span class="n">NOT</span> <span class="n">stSDS</span><span class="o">.</span><span class="n">bHomingRequired</span><span class="p">);</span>
<span class="n">EPS_SDS_H_Forward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span><span class="p">(</span><span class="n">NOT</span> <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_CLOSED_LIMIT_SWITCH</span> <span class="n">AND</span>
    <span class="n">GVL_Interface</span><span class="o">.</span><span class="n">QRIX_VAC_VGC_03_OPEN_LIMIT_SWITCH</span><span class="p">)</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&lt;</span> <span class="n">fSDSYEPSOverride</span><span class="p">);</span>


<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">negative</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_SDS_Y_Backward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">stEPSBackwardEnable</span><span class="p">);</span>
<span class="n">EPS_SDS_Y_Backward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;NEGATIVE MOTION ALLOWED UNTIL LIMIT&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>

<span class="n">EPS_SDS_Y_Backward</span><span class="o">.</span><span class="n">setBit</span><span class="p">(</span><span class="n">nBits</span><span class="o">:=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bValue</span><span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">&gt;</span> <span class="n">fSDS_Y_NEGATIVE_LIM</span><span class="p">);</span>

<span class="n">fbEPS_SDS_Y_EPS_BACK_OVRD_TIMER</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">bEPS_SDS_Y_Backward_Override</span><span class="p">,</span> <span class="n">PT</span><span class="o">:=</span> <span class="n">tEPS_SDS_Y_Backward_Override_Time</span><span class="p">);</span>
<span class="n">tSDS_Y_EPS_BACK_OVRD_TimerCountDown</span> <span class="o">:=</span> <span class="n">TIME_TO_STRING</span><span class="p">(</span><span class="n">tEPS_SDS_Y_Backward_Override_Time</span> <span class="o">-</span> <span class="n">fbEPS_SDS_Y_EPS_BACK_OVRD_TIMER</span><span class="o">.</span><span class="n">ET</span><span class="p">);</span>

<span class="n">IF</span> <span class="n">bEPS_SDS_Y_Backward_Override</span> <span class="n">THEN</span>
    <span class="n">fSDS_Y_NEGATIVE_LIM</span> <span class="o">:=</span> <span class="n">fSDS_Y_NEGATIVE_LIM_USR</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Resets</span> <span class="n">timer</span> <span class="n">when</span> <span class="n">EPS</span> <span class="n">timer</span> <span class="n">has</span> <span class="n">expired</span><span class="p">;</span> <span class="mi">1</span><span class="n">hr</span> <span class="n">default</span>
<span class="n">IF</span> <span class="n">fbEPS_SDS_Y_EPS_BACK_OVRD_TIMER</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">bEPS_SDS_Y_Backward_Override</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">fSDS_Y_NEGATIVE_LIM</span> <span class="o">:=</span> <span class="n">fSDS_Y_NEGATIVE_LIM_DEFAULT</span><span class="p">;</span>
<span class="n">END_IF</span>



<span class="o">//</span> <span class="n">Disable</span> <span class="n">movement</span> <span class="ow">in</span> <span class="n">positive</span> <span class="n">direction</span><span class="o">.</span>
<span class="n">EPS_SDS_Y_Forward</span><span class="p">(</span><span class="n">eps</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="o">.</span><span class="n">stEPSForwardEnable</span><span class="p">);</span>
<span class="n">EPS_SDS_Y_Forward</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s1">&#39;POSITIVE MOTION ALLOWED UNTIL LIMIT&#39;</span><span class="p">);</span> <span class="o">//</span> <span class="n">SET</span> <span class="n">DESCRIPTION</span> <span class="n">FOR</span> <span class="n">BYTE</span> <span class="n">INDICATOR</span> <span class="n">LABELS</span>

<span class="n">fb_SDS_X</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M39</span><span class="p">);</span>
<span class="n">fb_SDS_Y</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="p">);</span>
<span class="n">fb_SDS_Z</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M41</span><span class="p">);</span>

<span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bHome</span> <span class="o">:=</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="o">.</span><span class="n">bHome</span><span class="p">;</span>

<span class="n">fb_SDS_ROT_V</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="p">);</span>
<span class="n">fb_SDS_ROT_H</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="p">);</span>
<span class="n">fb_SDS_H</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="p">);</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageYStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M40</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stGarageRStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M42</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmHStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M44</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stTransferArmRStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M43</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffXStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffXStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffXStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffXStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffXStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M28</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffYStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffYStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffYStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffYStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffYStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M29</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffZStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffZStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffZStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffZStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffZStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M30</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaYStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiff2ThetaYStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaYStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiff2ThetaYStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiff2ThetaYStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M31</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffPhiStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffPhiStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffPhiStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffPhiStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffPhiStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M32</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffChiStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffChiStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffChiStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffChiStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffChiStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M33</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiff2ThetaStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiff2ThetaStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiff2ThetaStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiff2ThetaStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M34</span><span class="p">;</span>

<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffThetaStateGet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffThetaStateGet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">eDiffThetaStateSet</span> <span class="n">REF</span><span class="o">=</span> <span class="n">PRG_Diffractometer</span><span class="o">.</span><span class="n">eDiffThetaStateSet</span><span class="p">;</span>
<span class="n">stSDS</span><span class="o">.</span><span class="n">stDiffThetaStage</span> <span class="n">REF</span><span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M35</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Function</span> <span class="n">block</span> <span class="n">containing</span> <span class="n">logic</span> <span class="k">for</span> <span class="n">sample</span> <span class="n">delivery</span> <span class="n">system</span> <span class="n">motion</span> <span class="n">automation</span><span class="o">.</span>
<span class="n">fbSDS</span><span class="p">(</span>
    <span class="n">stSDSin</span> <span class="o">:=</span> <span class="n">stSDS</span><span class="p">,</span>
    <span class="n">stSDSPersistent</span> <span class="o">:=</span> <span class="n">stSDSPersistent</span>
<span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#fb-sds">FB_SDS</a></p></li>
<li><p><a class="reference internal" href="#gvl-interface">GVL_Interface</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-diffractometer">PRG_Diffractometer</a></p></li>
<li><p><a class="reference internal" href="#st-sds">ST_SDS</a></p></li>
<li><p><a class="reference internal" href="#st-sdspersistent">ST_SDSPersistent</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-sensor">
<h2>PRG_Sensor<a class="headerlink" href="#prg-sensor" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_Sensor</span>
<span class="n">VAR</span>
    <span class="n">bInit</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">:=</span><span class="n">TRUE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(Out) RxPDO-Map^Head Value Mode&#39;</span><span class="p">}</span>
    <span class="n">bSensorHeadValueMode</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#2D LinearGaugeAmp (SC-HG1-ETC)]^Process Data(Out) RxPDO-Map^Normal Value Mode&#39;</span><span class="p">}</span>
    <span class="n">bSensorHeadNormalValueMode</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>

    <span class="n">bResetSensorMode</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">;</span>

    <span class="n">uintTest</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">UINT</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">If</span> <span class="n">bInit</span> <span class="n">Then</span>
    <span class="n">bSensorHeadNormalValueMode</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
<span class="n">End_If</span><span class="p">;</span>

<span class="n">If</span><span class="p">(</span><span class="n">bResetSensorMode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="n">Then</span>
    <span class="n">bResetSensorMode</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">bSensorHeadValueMode</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">bSensorHeadNormalValueMode</span> <span class="o">:=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="kc">True</span><span class="p">;</span>
<span class="n">End_If</span><span class="p">;</span>


<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">sName</span>                     <span class="o">:=</span> <span class="s1">&#39;YDF1 Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">sEGU</span>                      <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fCntsInEGU</span>        <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">nYDF1</span>                <span class="o">:=</span> <span class="n">DINT_TO_UDINT</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">+</span> <span class="mi">10000</span><span class="p">);</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">sName</span>                     <span class="o">:=</span> <span class="s1">&#39;YDF2 Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">sEGU</span>                      <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">fCntsInEGU</span>        <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">nYDF2</span>                <span class="o">:=</span> <span class="n">DINT_TO_UDINT</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">+</span> <span class="mi">10000</span><span class="p">);</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">sName</span>                     <span class="o">:=</span> <span class="s1">&#39;YDF3 Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">sEGU</span>                      <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">fCntsInEGU</span>        <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">nYDF3</span>                <span class="o">:=</span> <span class="n">DINT_TO_UDINT</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">+</span> <span class="mi">10000</span><span class="p">);</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;HDF Panasonic HG-S&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;mm&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mi">10000</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">sName</span>         <span class="o">:=</span> <span class="s1">&#39;Granite Pitch&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">sEGU</span>          <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span> <span class="o">//</span> <span class="mi">1</span><span class="n">V</span> <span class="o">=</span> <span class="mi">1</span><span class="n">mrad</span> <span class="ow">in</span> <span class="n">Low</span> <span class="n">gain</span> <span class="n">mode</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">iOffset</span>   <span class="o">:=</span> <span class="o">-</span><span class="mi">1005</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">sName</span>         <span class="o">:=</span> <span class="s1">&#39;Granite Roll&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">sEGU</span>          <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">iOffset</span>   <span class="o">:=</span> <span class="mi">3326</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">sName</span>           <span class="o">:=</span> <span class="s1">&#39;Det. Frame Pitch&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">sEGU</span>            <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fCntsInEGU</span>      <span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">sName</span>           <span class="o">:=</span> <span class="s1">&#39;Det. Frame Roll&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">sEGU</span>            <span class="o">:=</span> <span class="s1">&#39;mrad&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fCntsInEGU</span>      <span class="o">:=</span> <span class="mf">3276.7</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;PS1&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;MPa&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mf">13106.8</span><span class="p">;</span>     <span class="o">//</span> <span class="mf">0.25</span><span class="n">MPa</span><span class="o">/</span><span class="n">V</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">iOffset</span>            <span class="o">:=</span> <span class="mi">3277</span><span class="p">;</span>        <span class="o">//</span> <span class="mi">0</span><span class="n">MPa</span><span class="o">@</span><span class="mi">1</span><span class="n">V</span>  <span class="n">P</span><span class="o">=</span><span class="mf">0.25</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">V0</span><span class="p">),</span> <span class="n">V0</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;PS2&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;MPa&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mf">13106.8</span><span class="p">;</span>     <span class="o">//</span> <span class="mf">0.25</span><span class="n">MPa</span><span class="o">/</span><span class="n">V</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">iOffset</span>            <span class="o">:=</span> <span class="mi">3277</span><span class="p">;</span>        <span class="o">//</span> <span class="mi">0</span><span class="n">MPa</span><span class="o">@</span><span class="mi">1</span><span class="n">V</span>  <span class="n">P</span><span class="o">=</span><span class="mf">0.25</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">V0</span><span class="p">),</span> <span class="n">V0</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">sName</span>                      <span class="o">:=</span> <span class="s1">&#39;PS3&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">sEGU</span>                       <span class="o">:=</span> <span class="s1">&#39;MPa&#39;</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fCntsInEGU</span>         <span class="o">:=</span> <span class="mf">13106.8</span><span class="p">;</span>     <span class="o">//</span> <span class="mf">0.25</span><span class="n">MPa</span><span class="o">/</span><span class="n">V</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">iOffset</span>            <span class="o">:=</span> <span class="mi">3277</span><span class="p">;</span>        <span class="o">//</span> <span class="mi">0</span><span class="n">MPa</span><span class="o">@</span><span class="mi">1</span><span class="n">V</span>  <span class="n">P</span><span class="o">=</span><span class="mf">0.25</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">V0</span><span class="p">),</span> <span class="n">V0</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fValue</span>            <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">fValue</span>            <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF2</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">fValue</span>            <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF3</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">DINT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">iRawCnts</span>  <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span>  <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stHDF</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">fValue</span>        <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteP</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">fValue</span>        <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stGraniteR</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fValue</span>          <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameP</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fValue</span>          <span class="o">:=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stFrameR</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>

<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS1</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS2</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>
<span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fValue</span>                     <span class="o">:=</span> <span class="n">INT_TO_REAL</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">iRawCnts</span> <span class="o">-</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">iOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stPS3</span><span class="o">.</span><span class="n">fCntsInEGU</span><span class="p">;</span>


<span class="o">//</span><span class="n">uintTest</span><span class="o">:=</span> <span class="n">REAL_TO_UINT</span><span class="p">(</span><span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">stYDF1</span><span class="o">.</span><span class="n">fValue</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-spetrometerarm">
<h2>PRG_SpetrometerArm<a class="headerlink" href="#prg-spetrometerarm" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SpetrometerArm</span>
<span class="n">VAR</span>
        <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-01 Coupler (EK1100)]^Rack#1A-02 SFIN (EL1918)^StandardOutputs^Standard In Var 2&#39;</span><span class="p">}</span>
    <span class="n">bEnaIclk</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-01 Coupler (EK1100)]^Rack#1A-02 SFIN (EL1918)^StandardOutputs^Standard In Var 1&#39;</span><span class="p">}</span>
    <span class="n">bEnaIclkErrAck</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[Rack#1A-01 Coupler (EK1100)]^Rack#1A-02 SFIN (EL1918)^StandardOutputs^Standard In Var 9&#39;</span><span class="p">}</span>
    <span class="n">bEnaIclkRestartESTOP</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">fbPower_AxisM11</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM12</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM13</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>
    <span class="n">fbPower_AxisM14</span><span class="p">:</span> <span class="n">MC_Power</span><span class="p">;</span>

    <span class="n">rtESTOPDeactivated</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>

    <span class="n">tonTurnoffCBReset</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
<span class="n">END_VAR</span>
<span class="n">ACT_ESTOP</span><span class="p">();</span>

<span class="n">PRG_2Theta</span><span class="p">();</span>
<span class="n">PRG_DET_ARM</span><span class="p">();</span>
<span class="n">PRG_DET_CHAMBER</span><span class="p">();</span>
<span class="n">PRG_DET_SLIT</span><span class="p">();</span>
<span class="n">PRG_DET_FRAME</span><span class="p">();</span>
<span class="n">PRG_OPT_SLITS</span><span class="p">();</span>
<span class="n">PRG_OPT_YG</span><span class="p">();</span>
<span class="n">PRG_OPT_XPM</span><span class="p">();</span>
<span class="n">PRG_OPT</span><span class="p">();</span>
<span class="n">PRG_Sensor</span><span class="p">();</span>

<span class="n">tonTurnOffCBReset</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerB0108Reset</span> <span class="n">OR</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerB0113Reset</span> <span class="n">OR</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerB0118Reset</span> <span class="n">OR</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2A02Reset</span> <span class="n">OR</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2A07Reset</span> <span class="n">OR</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2A13Reset</span> <span class="n">OR</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2B14Reset</span> <span class="n">OR</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2B17Reset</span><span class="p">,</span>
    <span class="n">PT</span><span class="o">:=</span><span class="n">T</span><span class="c1">#2s</span>
<span class="p">);</span>
<span class="n">IF</span> <span class="n">tonTurnOffCBReset</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerB0108Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerB0113Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerB0118Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2A02Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2A07Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2A13Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2B14Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_VAR</span><span class="o">.</span><span class="n">bCircuitBreakerR2B17Reset</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="n">END_PROGRAM</span>

<span class="n">ACTION</span> <span class="n">ACT_ESTOP</span><span class="p">:</span>
<span class="n">IF</span> <span class="n">bEnaIclkErrAck</span> <span class="n">THEN</span>
    <span class="n">bEnaIclkErrAck</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">IF</span> <span class="n">bEnaIclkRestartESTOP</span> <span class="n">THEN</span>
    <span class="n">bEnaIclkRestartESTOP</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">When</span> <span class="n">user</span> <span class="n">push</span> <span class="n">the</span> <span class="n">ESTOPs</span>
<span class="o">//</span> <span class="n">REVALUATE</span> <span class="n">AFTER</span> <span class="n">TESTING</span><span class="p">:</span>
<span class="o">//</span> <span class="n">Only</span> <span class="n">specific</span> <span class="n">motors</span> <span class="n">are</span> <span class="n">a</span> <span class="n">part</span> <span class="n">of</span> <span class="n">the</span> <span class="n">ESTOP</span> <span class="n">at</span> <span class="n">this</span> <span class="n">point</span> <span class="n">based</span> <span class="n">on</span>
<span class="o">//</span> <span class="s2">&quot;Components&quot;</span> <span class="n">column</span> <span class="n">on</span> <span class="n">this</span> <span class="n">page</span><span class="p">:</span>
<span class="o">//</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">confluence</span><span class="o">.</span><span class="n">slac</span><span class="o">.</span><span class="n">stanford</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">display</span><span class="o">/</span><span class="n">L2SI</span><span class="o">/</span><span class="n">qRIXS</span><span class="o">+</span><span class="n">Spectrometer</span><span class="o">+</span><span class="n">Arm</span>
<span class="o">//</span> <span class="n">Items</span> <span class="n">are</span> <span class="n">commented</span> <span class="n">out</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">included</span> <span class="ow">in</span> <span class="n">ESTOP</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">them</span> <span class="n">to</span> <span class="n">be</span> <span class="n">added</span> <span class="n">back</span> <span class="n">easily</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span> <span class="n">THEN</span>

    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV1</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bOpenSV2</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">SSL</span> <span class="n">Sliding</span> <span class="n">Seal</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SSL</span><span class="p">:</span><span class="n">MMS</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">Arm</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="mi">2</span><span class="n">Theta</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">XS1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">NORTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">XS2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SOUTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">YS1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">TOP</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">YS2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">BOTTOM</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Base</span> <span class="n">YG1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPT</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y1</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Base</span> <span class="n">YG2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPT</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y2</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Base</span> <span class="n">YG3</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPT</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y3</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Grating</span> <span class="n">RxG</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">G</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Rx</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Grating</span> <span class="n">XG</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">G</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Mirror</span> <span class="n">XPM1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">PM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X1</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Mirror</span> <span class="n">XPM2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">PM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X2</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Mirror</span> <span class="n">RzPM</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">PM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Rz</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Frame</span> <span class="n">YDF1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y1</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Frame</span> <span class="n">YDF2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y2</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Frame</span> <span class="n">YDF3</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y3</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">XSDC1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">NORTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">XSDC2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SOUTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">YSDC1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">TOP</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">YSDC2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">BOTTOM</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Chamber</span> <span class="n">XDC</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DC</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Chamber</span> <span class="n">RyDC</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DC</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Ry</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Chamber</span> <span class="n">ZDC</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DC</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Z</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Arm</span> <span class="n">YF1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y1</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Arm</span> <span class="n">YF2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y2</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Arm</span> <span class="n">ZF</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Z</span>

    <span class="n">bDoneJackOff</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLevitation</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneLanding</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneAdjustingRoll</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneAdjustingPitch</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bDoneAdjustingHeight</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">rtESTOPDeactivated</span><span class="p">(</span><span class="n">CLK</span><span class="o">:=</span><span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bESTOP</span><span class="p">);</span>
<span class="n">IF</span> <span class="n">rtESTOPDeactivated</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">SSL</span> <span class="n">Sliding</span> <span class="n">Seal</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SSL</span><span class="p">:</span><span class="n">MMS</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">Arm</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="mi">2</span><span class="n">Theta</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M3</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">XS1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">NORTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M4</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">XS2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SOUTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M5</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">YS1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">TOP</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M6</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Slits</span> <span class="n">YS2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPTSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">BOTTOM</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M7</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Base</span> <span class="n">YG1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPT</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y1</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M8</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Base</span> <span class="n">YG2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPT</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y2</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M9</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Base</span> <span class="n">YG3</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">OPT</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y3</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M10</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Grating</span> <span class="n">RxG</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">G</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Rx</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M11</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Grating</span> <span class="n">XG</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">G</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M12</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Mirror</span> <span class="n">XPM1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">PM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X1</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M13</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Mirror</span> <span class="n">XPM2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">PM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X2</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M14</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Optics</span> <span class="n">Mirror</span> <span class="n">RzPM</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">PM</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Rz</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M15</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Frame</span> <span class="n">YDF1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y1</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M16</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Frame</span> <span class="n">YDF2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y2</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M17</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Frame</span> <span class="n">YDF3</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DF</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y3</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M18</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">XSDC1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">NORTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M19</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">XSDC2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">SOUTH</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M20</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">YSDC1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">TOP</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M21</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Slits</span> <span class="n">YSDC2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DETSL</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">BOTTOM</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M22</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Chamber</span> <span class="n">XDC</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DC</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">X</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M23</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Chamber</span> <span class="n">RyDC</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DC</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Ry</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M24</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Chamber</span> <span class="n">ZDC</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DC</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Z</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M25</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Arm</span> <span class="n">YF1</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y1</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M26</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Arm</span> <span class="n">YF2</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Y2</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M27</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span> <span class="o">//</span> <span class="n">Detector</span> <span class="n">Arm</span> <span class="n">ZF</span> <span class="o">//</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">DA</span><span class="p">:</span><span class="n">MMS</span><span class="p">:</span><span class="n">Z</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Disable</span> <span class="n">M1</span><span class="p">(</span><span class="n">Servo</span><span class="p">)</span> <span class="ow">and</span> <span class="n">M2</span><span class="p">(</span><span class="n">Stepper</span><span class="p">)</span> <span class="k">if</span> <span class="n">the</span> <span class="n">frame</span> <span class="ow">is</span> <span class="n">landing</span><span class="o">...</span>
<span class="n">IF</span> <span class="n">NOT</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">bFloating</span> <span class="n">THEN</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="o">//</span><span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">bEnable</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="n">END_IF</span>


<span class="o">//</span> <span class="n">When</span> <span class="n">user</span> <span class="n">requests</span> <span class="n">to</span> <span class="n">reset</span> <span class="n">ESTOP</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bResetIclk</span> <span class="n">THEN</span>
    <span class="n">GVL_EPS</span><span class="o">.</span><span class="n">bResetIclk</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bEnaIclkErrAck</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">bEnaIclkRestartESTOP</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="n">END_IF</span>
<span class="n">END_ACTION</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-eps">GVL_EPS</a></p></li>
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
<li><p><a class="reference internal" href="#gvl-var">GVL_VAR</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
<li><p><a class="reference internal" href="#prg-2theta">PRG_2Theta</a></p></li>
<li><p><a class="reference internal" href="#prg-det-arm">PRG_DET_ARM</a></p></li>
<li><p><a class="reference internal" href="#prg-det-chamber">PRG_DET_CHAMBER</a></p></li>
<li><p><a class="reference internal" href="#prg-det-frame">PRG_DET_FRAME</a></p></li>
<li><p><a class="reference internal" href="#prg-det-slit">PRG_DET_SLIT</a></p></li>
<li><p><a class="reference internal" href="#prg-opt">PRG_OPT</a></p></li>
<li><p><a class="reference internal" href="#prg-opt-slits">PRG_OPT_SLITS</a></p></li>
<li><p><a class="reference internal" href="#prg-opt-xpm">PRG_OPT_XPM</a></p></li>
<li><p><a class="reference internal" href="#prg-opt-yg">PRG_OPT_YG</a></p></li>
<li><p><a class="reference internal" href="#prg-sensor">PRG_Sensor</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="prg-ssl">
<h2>PRG_SSL<a class="headerlink" href="#prg-ssl" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROGRAM</span> <span class="n">PRG_SSL</span>
<span class="n">VAR</span>
    <span class="n">fb_SSL_Motor</span> <span class="p">:</span> <span class="n">FB_MotionStage</span><span class="p">;</span>
    <span class="p">(</span><span class="o">*</span><span class="n">EPS</span> <span class="n">Limit</span> <span class="n">switches</span><span class="o">*</span><span class="p">)</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[EL1004_02_03]^Channel 2^Input&#39;</span><span class="p">}</span>
    <span class="n">bLimitBackwardEnable</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIIB[EL1004_02_03]^Channel 3^Input&#39;</span><span class="p">}</span>
    <span class="n">bLimitForwardEnable</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span> <span class="p">:</span><span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;pv: QRIX:SPCA:COUPLED&#39;</span><span class="p">}</span>

    <span class="n">bExecuteCouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">bExecuteDecouple</span><span class="p">:</span> <span class="n">BOOL</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>

    <span class="n">bInit</span> <span class="p">:</span> <span class="n">BOOl</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>

    <span class="o">//</span> <span class="n">Function</span> <span class="n">block</span> <span class="n">to</span> <span class="n">couple</span> <span class="n">sliding</span> <span class="n">seal</span> <span class="n">motor</span> <span class="n">motion</span> <span class="n">to</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">motion</span>
    <span class="n">fbSSLTo2ThetaCoupling</span><span class="p">:</span> <span class="n">FB_GantryAutoCoupling</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;      .Count := TIID^Device 2 (EtherCAT)^Rack#1A-01 Coupler (EK1100)^Rack#1A-06 ENC_2Th (EL5042)^FB Inputs Channel 1^Position&#39;</span><span class="p">}</span>
    <span class="n">stRenishawAbsEncMaster</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;TcLinkTo&#39;</span> <span class="o">:=</span> <span class="s1">&#39;TIID^Device 2 (EtherCAT)^B950-233-WALL-S-R01-DRL-01^EL5042_02_02^FB Inputs Channel 1^Position&#39;</span><span class="p">}</span>
    <span class="n">nRenishawAbsEncSlaveCounts</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">ULINT</span><span class="p">;</span> <span class="o">//</span> <span class="n">Connect</span> <span class="n">to</span> <span class="n">encoder</span> <span class="s2">&quot;Position&quot;</span> <span class="n">inputULINT</span>
    <span class="n">fSlaveCountsToMasterCountsScalingFactor</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">fRenishawAbsEncSlaveCountsInMasterScale</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>
    <span class="n">nRenishawAbsEncSlaveCountsInMasterScale</span><span class="p">:</span> <span class="n">ULINT</span><span class="p">;</span>
    <span class="n">stRenishawAbsEncSlave</span><span class="p">:</span> <span class="n">ST_RenishawAbsEnc</span><span class="p">;</span>

    <span class="n">nGantryTolerance</span><span class="p">:</span> <span class="n">LINT</span><span class="p">;</span>
    <span class="n">fAngleOffset</span><span class="p">:</span> <span class="n">LREAL</span><span class="p">;</span>


    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SSL2ThetaDegTol</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fAngleTolerance</span><span class="p">:</span> <span class="n">REAL</span> <span class="o">:=</span> <span class="mf">0.2</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">SSL2ThetaPosDiff</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">fPosDiff</span><span class="p">:</span> <span class="n">REAL</span><span class="p">;</span>

    <span class="n">fbExtSetPointGenEnable</span><span class="p">:</span> <span class="n">MC_ExtSetPointGenEnable</span><span class="p">;</span>
    <span class="n">fbExtSetPointGenDisable</span><span class="p">:</span> <span class="n">MC_ExtSetPointGenDisable</span><span class="p">;</span>

    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">bRealignCouple</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">bRealignCouple</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">iRealignStep</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">i</span>
    <span class="s1">&#39;}</span>
    <span class="n">iRealignStep</span><span class="p">:</span> <span class="n">UINT</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">{</span><span class="n">attribute</span> <span class="s1">&#39;pytmc&#39;</span> <span class="o">:=</span> <span class="s1">&#39;</span>
        <span class="n">pv</span><span class="p">:</span> <span class="n">QRIX</span><span class="p">:</span><span class="n">bRealignSpeed</span>
        <span class="n">io</span><span class="p">:</span> <span class="n">io</span>
    <span class="s1">&#39;}</span>
    <span class="n">fRealignSpeed</span><span class="p">:</span> <span class="n">LREAL</span> <span class="o">:=</span> <span class="mf">0.05</span><span class="p">;</span>
    <span class="n">rtStopSSL</span><span class="p">:</span> <span class="n">R_TRIG</span><span class="p">;</span>
    <span class="n">tonRealignCoupleTimeout</span><span class="p">:</span> <span class="n">TON</span><span class="p">;</span>
    <span class="n">timeRealignTimeout</span><span class="p">:</span> <span class="n">TIME</span><span class="p">;</span>
    <span class="n">bFullyDecouple</span><span class="p">:</span> <span class="n">BOOL</span><span class="p">;</span>

    <span class="n">EL7047_02_01_SSL_Status</span> <span class="n">AT</span> <span class="o">%</span><span class="n">I</span><span class="o">*</span><span class="p">:</span> <span class="n">USINT</span><span class="p">;</span>
    <span class="n">EL7047_02_01_SSL_Status_to_NC</span> <span class="n">AT</span> <span class="o">%</span><span class="n">Q</span><span class="o">*</span><span class="p">:</span> <span class="n">USINT</span><span class="p">;</span>

<span class="n">END_VAR</span>
<span class="n">IF</span> <span class="n">bInit</span> <span class="n">THEN</span>
    <span class="n">bInit</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bPowerSelf</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bHardwareEnable</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">nBrakeMode</span> <span class="o">:=</span> <span class="n">ENUM_StageBrakeMode</span><span class="o">.</span><span class="n">NO_BRAKE</span><span class="p">;</span>
    <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">nEnableMode</span> <span class="o">:=</span> <span class="n">ENUM_StageEnableMode</span><span class="o">.</span><span class="n">NEVER</span><span class="p">;</span>
<span class="n">END_IF</span>

<span class="o">//</span> <span class="n">Due</span> <span class="n">to</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">SSL</span> <span class="n">drive</span><span class="p">,</span> <span class="n">ready</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">being</span> <span class="n">reported</span> <span class="n">properly</span><span class="o">.</span> <span class="n">This</span> <span class="n">will</span> <span class="n">tie</span> <span class="n">the</span> <span class="n">ready</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">the</span> <span class="n">floating</span> <span class="n">status</span><span class="o">.</span>
<span class="n">EL7047_02_01_SSL_Status</span><span class="mf">.1</span> <span class="o">:=</span> <span class="n">GVL_Sensor</span><span class="o">.</span><span class="n">bFloating</span><span class="p">;</span>
<span class="n">EL7047_02_01_SSL_Status_to_NC</span> <span class="o">:=</span> <span class="n">EL7047_02_01_SSL_Status</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">encoder</span> <span class="n">counts</span> <span class="n">at</span> <span class="n">the</span> <span class="n">zero</span> <span class="n">position</span>
<span class="o">//</span> <span class="n">CHOOSING</span> <span class="n">TO</span> <span class="n">SET</span> <span class="n">THE</span> <span class="n">COUNTS</span> <span class="n">IN</span> <span class="n">UNITS</span> <span class="n">OF</span> <span class="n">THE</span> <span class="n">SCALE</span> <span class="n">OF</span> <span class="n">THE</span> <span class="n">PRIMARY</span> <span class="n">AXIS</span> <span class="n">ENCODER</span><span class="o">.</span>
<span class="o">//</span> <span class="n">THE</span> <span class="n">VIRTUAL</span> <span class="n">LIMIT</span> <span class="n">SWITCH</span> <span class="n">FUNCTION</span> <span class="n">BLOCK</span> <span class="n">IN</span> <span class="n">THE</span> <span class="n">GANTRY</span> <span class="n">AUTOCOUPLING</span> <span class="n">FB</span> <span class="n">ASSUMES</span>
<span class="o">//</span> <span class="n">THAT</span> <span class="n">THE</span> <span class="n">ENCODERS</span> <span class="n">HAVE</span> <span class="n">THE</span> <span class="n">SAME</span> <span class="n">SCALE</span><span class="o">.</span> <span class="n">HOWEVER</span> <span class="n">IN</span> <span class="n">THIS</span> <span class="n">CASE</span><span class="p">,</span> <span class="n">THEY</span> <span class="n">DO</span> <span class="n">NOT</span> <span class="n">HAVE</span>
<span class="o">//</span> <span class="n">THE</span> <span class="n">SAME</span> <span class="n">SCALE</span><span class="o">.</span> <span class="n">IN</span> <span class="n">ORDER</span> <span class="n">TO</span> <span class="n">COMPARE</span> <span class="n">THEM</span> <span class="n">USING</span> <span class="n">THE</span> <span class="n">GANTRY</span> <span class="n">FB</span><span class="p">,</span> <span class="n">THE</span> <span class="n">SECONDARY</span>
<span class="o">//</span> <span class="n">AXIS</span> <span class="n">ENCODER</span> <span class="n">COUNTS</span> <span class="n">HAVE</span> <span class="n">TO</span> <span class="n">BE</span> <span class="n">SCALED</span> <span class="n">TO</span> <span class="n">MATCH</span> <span class="n">THE</span> <span class="n">PRIMARY</span> <span class="n">AXIS</span> <span class="n">ENCODER</span> <span class="n">COUNTS</span><span class="o">.</span>
<span class="n">fSlaveCountsToMasterCountsScalingFactor</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncScaleFactorInternal</span> <span class="o">/</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncScaleFactorInternal</span><span class="p">;</span>
<span class="n">fRenishawAbsEncSlaveCountsInMasterScale</span> <span class="o">:=</span> <span class="n">ULINT_TO_LREAL</span><span class="p">(</span><span class="n">nRenishawAbsEncSlaveCounts</span><span class="p">)</span> <span class="o">*</span> <span class="n">fSlaveCountsToMasterCountsScalingFactor</span><span class="p">;</span>
<span class="n">nRenishawAbsEncSlaveCountsInMasterScale</span> <span class="o">:=</span> <span class="n">LREAL_TO_ULINT</span><span class="p">(</span><span class="n">fRenishawAbsEncSlaveCountsInMasterScale</span><span class="p">);</span>
<span class="n">stRenishawAbsEncSlave</span><span class="o">.</span><span class="n">Count</span> <span class="o">:=</span> <span class="n">nRenishawAbsEncSlaveCountsInMasterScale</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Going</span> <span class="n">to</span> <span class="n">use</span> <span class="mi">90</span> <span class="n">degree</span> <span class="n">position</span> <span class="k">as</span> <span class="n">the</span> <span class="n">reference</span> <span class="n">position</span> <span class="n">because</span> <span class="n">the</span> <span class="n">Ref</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">unsigned</span> <span class="n">value</span><span class="o">.</span> <span class="n">This</span> <span class="n">makes</span> <span class="n">it</span> <span class="n">so</span> <span class="n">I</span>
<span class="o">//</span> <span class="n">can</span><span class="s1">&#39;t set the reference to actual 0 because that requires a negative number.</span>
<span class="n">stRenishawAbsEncMaster</span><span class="o">.</span><span class="n">Ref</span> <span class="o">:=</span> <span class="n">LREAL_TO_ULINT</span><span class="p">((</span><span class="mf">90.0</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncScaleFactorInternal</span><span class="p">);</span>
<span class="n">stRenishawAbsEncSlave</span><span class="o">.</span><span class="n">Ref</span> <span class="o">:=</span> <span class="n">LREAL_TO_ULINT</span><span class="p">((</span><span class="mf">90.0</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncOffset</span><span class="p">)</span> <span class="o">/</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncScaleFactorInternal</span> <span class="o">*</span> <span class="n">fSlaveCountsToMasterCountsScalingFactor</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Compute</span> <span class="n">the</span> <span class="n">gantry</span> <span class="n">tolerance</span>
<span class="o">//</span> <span class="n">Tolerance</span> <span class="o">=</span> <span class="n">X</span> <span class="n">degrees</span>
<span class="o">//</span> <span class="mf">0.000003001664895</span> <span class="n">deg</span><span class="o">/</span><span class="n">count</span> <span class="o">=&gt;</span> <span class="n">For</span> <span class="mf">0.1</span> <span class="n">deg</span> <span class="n">tolerance</span> <span class="n">then</span> <span class="mf">0.1</span> <span class="n">deg</span> <span class="o">/</span> <span class="mf">0.000003001664895</span> <span class="n">deg</span><span class="o">/</span><span class="n">count</span> <span class="o">=</span> <span class="mi">33315</span> <span class="n">counts</span> <span class="k">for</span> <span class="mf">0.1</span> <span class="n">deg</span>
<span class="n">nGantryTolerance</span> <span class="o">:=</span> <span class="n">LREAL_TO_LINT</span><span class="p">(</span><span class="n">fAngleTolerance</span> <span class="o">/</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncScaleFactorInternal</span><span class="p">);</span>

<span class="n">fAngleOffset</span> <span class="o">:=</span> <span class="n">LINT_TO_LREAL</span><span class="p">(</span>
        <span class="p">(</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">stRenishawAbsEncMaster</span><span class="o">.</span><span class="n">Count</span><span class="p">)</span> <span class="o">-</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">stRenishawAbsEncMaster</span><span class="o">.</span><span class="n">Ref</span><span class="p">)</span> <span class="p">)</span> <span class="o">-</span>
        <span class="p">(</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">stRenishawAbsEncSlave</span><span class="o">.</span><span class="n">Count</span><span class="p">)</span> <span class="o">-</span> <span class="n">ULINT_TO_LINT</span><span class="p">(</span><span class="n">stRenishawAbsEncSlave</span><span class="o">.</span><span class="n">Ref</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">)</span> <span class="o">*</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisParameters</span><span class="o">.</span><span class="n">fEncScaleFactorInternal</span><span class="p">;</span>

<span class="o">//</span> <span class="n">AutoCoupling</span>
<span class="n">fbSSLTo2ThetaCoupling</span><span class="p">(</span>      <span class="n">nGantryTol</span>                      <span class="o">:=</span> <span class="n">nGantryTolerance</span><span class="p">,</span>
                        <span class="n">Master</span>                              <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="p">,</span>
                        <span class="n">MasterEnc</span>                   <span class="o">:=</span> <span class="n">stRenishawAbsEncMaster</span><span class="p">,</span>
                        <span class="n">Slave</span>                               <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="p">,</span>
                        <span class="n">SlaveEnc</span>                    <span class="o">:=</span> <span class="n">stRenishawAbsEncSlave</span><span class="p">,</span>
                        <span class="n">bExecuteCouple</span>              <span class="o">:=</span> <span class="n">bExecuteCouple</span><span class="p">,</span>
                        <span class="n">bExecuteDecouple</span>    <span class="o">:=</span> <span class="n">bExecuteDecouple</span><span class="p">,</span>
<span class="p">);</span>

<span class="o">//</span> <span class="n">Calculate</span> <span class="n">twice</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">time</span> <span class="n">to</span> <span class="n">make</span> <span class="n">the</span> <span class="n">realignment</span> <span class="n">move</span><span class="o">.</span>
<span class="n">timeRealignTimeout</span> <span class="o">:=</span> <span class="n">LREAL_TO_TIME</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">)</span> <span class="o">/</span> <span class="n">fRealignSpeed</span> <span class="o">*</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">);</span>
<span class="n">tonRealignCoupleTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">bRealignCouple</span><span class="p">,</span><span class="n">PT</span><span class="o">:=</span><span class="n">timeRealignTimeout</span><span class="p">);</span>
<span class="n">CASE</span> <span class="n">iRealignStep</span> <span class="n">OF</span>
    <span class="mi">0</span><span class="p">:</span>
        <span class="n">IF</span> <span class="n">bRealignCouple</span> <span class="n">THEN</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">1</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="n">If</span> <span class="n">the</span> <span class="n">gantry</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">coupled</span><span class="p">,</span> <span class="n">the</span> <span class="n">motor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">busy</span><span class="p">,</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">then</span> <span class="n">decouple</span> <span class="n">the</span> <span class="n">axes</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">fbSSLTo2ThetaCoupling</span><span class="o">.</span><span class="n">bGantryAlreadyCoupled</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">fbSSLTo2ThetaCoupling</span><span class="o">.</span><span class="n">bGantryAlreadyCoupled</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">2</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="n">If</span> <span class="n">the</span> <span class="n">gantry</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">coupled</span><span class="p">,</span> <span class="n">the</span> <span class="n">motor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">busy</span><span class="p">,</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">then</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">decouple</span> <span class="n">command</span> <span class="ow">and</span>
        <span class="o">//</span>         <span class="n">command</span> <span class="n">the</span> <span class="n">axis</span> <span class="n">to</span> <span class="n">align</span> <span class="n">the</span> <span class="n">SSL</span> <span class="n">motor</span> <span class="n">to</span> <span class="n">the</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">motor</span><span class="o">.</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">bTriedToRealign</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">true</span> <span class="n">to</span> <span class="n">record</span> <span class="n">that</span>
        <span class="o">//</span>         <span class="n">the</span> <span class="n">realign</span> <span class="n">sequence</span> <span class="ow">is</span> <span class="n">what</span> <span class="n">commanded</span> <span class="n">the</span> <span class="n">move</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">fbSSLTo2ThetaCoupling</span><span class="o">.</span><span class="n">bGantryAlreadyCoupled</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">fPosition</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">fVelocity</span> <span class="o">:=</span> <span class="n">fRealignSpeed</span><span class="p">;</span>
            <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bMoveCmd</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">3</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">the</span> <span class="n">SSL</span> <span class="n">motor</span> <span class="n">to</span> <span class="n">reach</span> <span class="n">the</span> <span class="n">busy</span> <span class="n">status</span><span class="p">,</span> <span class="n">then</span> <span class="n">proceed</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">4</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step</span> <span class="mi">4</span><span class="p">:</span> <span class="n">If</span> <span class="n">the</span> <span class="n">SSL</span> <span class="n">motor</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">busy</span> <span class="p">(</span><span class="n">finished</span> <span class="ow">or</span> <span class="n">errored</span> <span class="ow">or</span> <span class="n">stopped</span><span class="p">)</span> <span class="n">then</span> <span class="n">recouple</span> <span class="n">the</span> <span class="n">SSL</span> <span class="n">motor</span> <span class="n">to</span>
        <span class="o">//</span>         <span class="n">the</span> <span class="mi">2</span><span class="n">Theta</span> <span class="n">motor</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">AND</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
            <span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">END_IF</span>
    <span class="mi">5</span><span class="p">:</span>
        <span class="o">//</span> <span class="n">Step</span> <span class="mi">5</span><span class="p">:</span> <span class="n">If</span> <span class="n">the</span> <span class="n">motors</span> <span class="n">are</span> <span class="n">coupled</span> <span class="n">again</span> <span class="n">then</span> <span class="n">reinitialize</span> <span class="n">the</span> <span class="n">bits</span> <span class="n">to</span>
        <span class="o">//</span>         <span class="n">get</span> <span class="n">them</span> <span class="n">ready</span> <span class="k">for</span> <span class="n">another</span> <span class="n">realignment</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">future</span><span class="o">.</span>
        <span class="n">IF</span> <span class="n">fbSSLTo2ThetaCoupling</span><span class="o">.</span><span class="n">bGantryAlreadyCoupled</span> <span class="n">THEN</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">bRealignCouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="n">tonRealignCoupleTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
        <span class="n">ELSE</span>
            <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">END_IF</span>
<span class="n">END_CASE</span>

<span class="o">//</span> <span class="n">Timeout</span><span class="p">:</span> <span class="n">In</span> <span class="n">case</span> <span class="n">something</span> <span class="n">bad</span> <span class="n">happens</span><span class="p">,</span> <span class="n">have</span> <span class="n">the</span> <span class="n">timeout</span> <span class="n">timer</span> <span class="ow">in</span> <span class="n">place</span> <span class="n">to</span> <span class="n">reset</span> <span class="n">the</span> <span class="n">bits</span> <span class="n">to</span> <span class="n">guarantee</span> <span class="n">we</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">get</span>
<span class="o">//</span>          <span class="n">stuck</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">recoupling</span> <span class="ow">and</span> <span class="n">alignment</span> <span class="n">sequence</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">coupled</span> <span class="n">axis</span> <span class="n">fails</span> <span class="n">to</span> <span class="n">move</span> <span class="n">due</span> <span class="n">to</span> <span class="n">axis</span> <span class="ow">not</span> <span class="n">ready</span><span class="p">,</span> <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">force</span> <span class="n">the</span> <span class="n">SSL</span> <span class="n">motor</span> <span class="n">ready</span> <span class="n">status</span> <span class="n">to</span> <span class="n">TRUE</span><span class="o">.</span> <span class="n">Then</span> <span class="ow">is</span> <span class="n">allows</span> <span class="n">it</span> <span class="n">to</span> <span class="n">move</span><span class="o">.</span>
<span class="o">//</span> <span class="n">seems</span> <span class="n">like</span> <span class="n">some</span> <span class="n">sort</span> <span class="n">of</span> <span class="n">bug</span> <span class="k">with</span> <span class="n">decoupling</span><span class="o">/</span><span class="n">coupling</span> <span class="n">the</span> <span class="n">axes</span> <span class="n">too</span> <span class="n">much</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">bRealignCouple</span> <span class="n">AND</span> <span class="n">tonRealignCoupleTimeout</span><span class="o">.</span><span class="n">Q</span> <span class="n">THEN</span>
    <span class="n">IF</span> <span class="n">fbSSLTo2ThetaCoupling</span><span class="o">.</span><span class="n">bGantryAlreadyCoupled</span> <span class="n">OR</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bError</span> <span class="n">THEN</span>
        <span class="n">iRealignStep</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">bRealignCouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bExecuteDecouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="n">tonRealignCoupleTimeout</span><span class="p">(</span><span class="n">IN</span><span class="o">:=</span><span class="n">FALSE</span><span class="p">);</span>
    <span class="n">ELSIF</span> <span class="n">NOT</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">bBusy</span> <span class="n">THEN</span>
        <span class="n">bExecuteCouple</span> <span class="o">:=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="n">END_IF</span>
<span class="n">END_IF</span>

<span class="n">fPosDiff</span> <span class="o">:=</span> <span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span> <span class="o">-</span> <span class="n">Main</span><span class="o">.</span><span class="n">M2</span><span class="o">.</span><span class="n">stAxisStatus</span><span class="o">.</span><span class="n">fActPosition</span><span class="p">;</span>

<span class="n">fb_SSL_Motor</span><span class="p">(</span><span class="n">stMotionStage</span><span class="o">:=</span><span class="n">Main</span><span class="o">.</span><span class="n">M1</span><span class="p">);</span>

<span class="n">END_PROGRAM</span>
</pre></div>
</div>
<dl class="simple">
<dt>Related:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#gvl-sensor">GVL_Sensor</a></p></li>
<li><p><a class="reference internal" href="#main">Main</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lcls-plc-qrix-motion_qrix_motion_epics.html" class="btn btn-neutral float-left" title="Data Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>